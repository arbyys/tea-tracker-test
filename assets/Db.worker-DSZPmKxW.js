var cse=Object.defineProperty;var lse=(bn,w,Ke)=>w in bn?cse(bn,w,{enumerable:!0,configurable:!0,writable:!0,value:Ke}):bn[w]=Ke;var g=(bn,w,Ke)=>(lse(bn,typeof w!="symbol"?w+"":w,Ke),Ke),kE=(bn,w,Ke)=>{if(!w.has(bn))throw TypeError("Cannot "+Ke)};var a=(bn,w,Ke)=>(kE(bn,w,"read from private field"),Ke?Ke.call(bn):w.get(bn)),ae=(bn,w,Ke)=>{if(w.has(bn))throw TypeError("Cannot add the same private member more than once");w instanceof WeakSet?w.add(bn):w.set(bn,Ke)},Ee=(bn,w,Ke,ka)=>(kE(bn,w,"write to private field"),ka?ka.call(bn,Ke):w.set(bn,Ke),Ke);var Lt=(bn,w,Ke)=>(kE(bn,w,"access private method"),Ke);(function(){"use strict";var Yd,zte,Vte,Kte,Qte,Hte,Jte,Gte,Yte,Xte,Zte,ene,tne,nne,rne,sne,ine,one,ane,cne,lne,une,fne,dne,hne,pne,mne,gne,_ne,yne,bne,wne,Sne,Ene,vne,Nne,kne,xne,qne,One,Ine,Tne,Ane,Cne,Fne,Rne,Pne,$ne,Lne,Mne,Dne,Wne,Bne,Une,jne,zne,Vne,Kne,pa,Qne,Hne,Jne,Gne,Yne,Xne,Zne,ere,tre,nre,rre,sre,Au,Vs,Nc,un,Zd,Ks,ct,Ye,rt,lo,Cu,__,Fu,kc,xc,y_,uF,b_,fF,w_,dF,ma,ef,th,xE,S_,hF,nh,rh,Ru,Pu,qc,sh,qE,Es,Sn,$u,W_,uo,Wc,Qs,ga,Ht,fo,Mu,_a,Ic,Tc,Se,Du,Wu,Fr,Bu,Uu,ju,zu,Ei,Vu,vi,oh,OE,Ac,Ku,ba,Jt,Cc,ho,ah,Hs,Nr,Bn,dn,Qu,Kt,Rn,Xt,cs,Bt,_r,Rr,Pr,I_,En,yr,us,fs,ar,Hu,Ni,ki,po,Gs,Sa,mo,Ju,go,dh,T_,pF,A_,mF,C_,gF,F_,_F,hh,IE,ph,Ea,R_,yF,va,$c,br,Ys,Lc,Xs,P_,Xu,Mc;const bn=t=>typeof t=="function",w=function(t,e){if(typeof t=="function")return function(){return t(arguments)?e.apply(this,arguments):n=>e(n,...arguments)};switch(t){case 0:case 1:throw new RangeError(`Invalid arity ${t}`);case 2:return function(n,r){return arguments.length>=2?e(n,r):function(s){return e(s,n)}};case 3:return function(n,r,s){return arguments.length>=3?e(n,r,s):function(i){return e(i,n,r)}};case 4:return function(n,r,s,i){return arguments.length>=4?e(n,r,s,i):function(o){return e(o,n,r,s)}};case 5:return function(n,r,s,i,o){return arguments.length>=5?e(n,r,s,i,o):function(l){return e(l,n,r,s,i)}};default:return function(){if(arguments.length>=t)return e.apply(this,arguments);const n=arguments;return function(r){return e(r,...n)}}}},Ke=t=>t,ka=t=>()=>t,_h=ka(!0),Bc=ka(!1),TE=ka(void 0),bo=TE,U_=t=>{throw new Error("Called `absurd` function which should be uncallable")};function I(t,e,n,r,s,i,o,l,f){switch(arguments.length){case 1:return t;case 2:return e(t);case 3:return n(e(t));case 4:return r(n(e(t)));case 5:return s(r(n(e(t))));case 6:return i(s(r(n(e(t)))));case 7:return o(i(s(r(n(e(t))))));case 8:return l(o(i(s(r(n(e(t)))))));case 9:return f(l(o(i(s(r(n(e(t))))))));default:{let m=arguments[0];for(let S=1;S<arguments.length;S++)m=arguments[S](m);return m}}}function j_(t,e,n,r,s,i,o,l,f){switch(arguments.length){case 1:return t;case 2:return function(){return e(t.apply(this,arguments))};case 3:return function(){return n(e(t.apply(this,arguments)))};case 4:return function(){return r(n(e(t.apply(this,arguments))))};case 5:return function(){return s(r(n(e(t.apply(this,arguments)))))};case 6:return function(){return i(s(r(n(e(t.apply(this,arguments))))))};case 7:return function(){return o(i(s(r(n(e(t.apply(this,arguments)))))))};case 8:return function(){return l(o(i(s(r(n(e(t.apply(this,arguments))))))))};case 9:return function(){return f(l(o(i(s(r(n(e(t.apply(this,arguments)))))))))}}}let bF="3.9.2";const yh=()=>bF,z_=Symbol.for(`effect/GlobalValue/globalStoreId/${yh()}`);z_ in globalThis||(globalThis[z_]=new Map);const V_=globalThis[z_],gt=(t,e)=>(V_.has(t)||V_.set(t,e()),V_.get(t)),Hr=t=>typeof t=="string",wo=t=>typeof t=="number",tf=t=>typeof t=="boolean",bh=t=>typeof t=="bigint",wh=t=>typeof t=="symbol",Uc=bn,wF=t=>t===void 0,SF=t=>t!==void 0,EF=t=>!1,AE=t=>typeof t=="object"&&t!==null,So=t=>AE(t)||Uc(t),it=w(2,(t,e)=>So(t)&&e in t),Sh=w(2,(t,e)=>it(t,"_tag")&&t._tag===e),jc=t=>t==null,vF=t=>t!=null,zc=t=>t instanceof Uint8Array,NF=t=>t instanceof Date,Ti=t=>it(t,Symbol.iterator),kF=t=>AE(t)&&!Array.isArray(t),CE=t=>it(t,"then")&&Uc(t.then),Eh=t=>`BUG: ${t} - please report an issue at https://github.com/Effect-TS/effect/issues`;let xF=class lF{constructor(e){g(this,"self");g(this,"called",!1);this.self=e}next(e){return this.called?{value:e,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(e){return{value:e,done:!0}}throw(e){throw e}[Symbol.iterator](){return new lF(this.self)}};const qF=335903614,OF=4150755663,IF=1481765933,TF=1284865837,AF=9007199254740992,CF=134217728;class FF{constructor(e,n,r,s){g(this,"_state");return jc(n)&&jc(e)?(n=Math.random()*4294967295>>>0,e=0):jc(n)&&(n=e,e=0),jc(s)&&jc(r)?(s=this._state?this._state[3]:OF,r=this._state?this._state[2]:qF):jc(s)&&(s=r,r=0),this._state=new Int32Array([0,0,r>>>0,((s||0)|1)>>>0]),this._next(),FE(this._state,this._state[0],this._state[1],e>>>0,n>>>0),this._next(),this}getState(){return[this._state[0],this._state[1],this._state[2],this._state[3]]}setState(e){this._state[0]=e[0],this._state[1]=e[1],this._state[2]=e[2],this._state[3]=e[3]|1}integer(e){return Math.round(this.number()*Number.MAX_SAFE_INTEGER)%e}number(){const e=(this._next()&67108863)*1,n=(this._next()&134217727)*1;return(e*CF+n)/AF}_next(){const e=this._state[0]>>>0,n=this._state[1]>>>0;RF(this._state,e,n,IF,TF),FE(this._state,this._state[0],this._state[1],this._state[2],this._state[3]);let r=e>>>18,s=(n>>>18|e<<14)>>>0;r=(r^e)>>>0,s=(s^n)>>>0;const i=(s>>>27|r<<5)>>>0,o=e>>>27,l=(-o>>>0&31)>>>0;return(i>>>o|i<<l)>>>0}}function RF(t,e,n,r,s){let i=(n>>>16)*(s&65535)>>>0,o=(n&65535)*(s>>>16)>>>0,l=(n&65535)*(s&65535)>>>0,f=(n>>>16)*(s>>>16)+((o>>>16)+(i>>>16))>>>0;o=o<<16>>>0,l=l+o>>>0,l>>>0<o>>>0&&(f=f+1>>>0),i=i<<16>>>0,l=l+i>>>0,l>>>0<i>>>0&&(f=f+1>>>0),f=f+Math.imul(n,r)>>>0,f=f+Math.imul(e,s)>>>0,t[0]=f,t[1]=l}function FE(t,e,n,r,s){let i=e+r>>>0;const o=n+s>>>0;o>>>0<n>>>0&&(i=i+1|0),t[0]=i,t[1]=o}const K_=Symbol.for("effect/Utils/YieldWrap");class nf{constructor(e){ae(this,Yd,void 0);Ee(this,Yd,e)}[K_](){return a(this,Yd)}}Yd=new WeakMap;function PF(t){if(typeof t=="object"&&t!==null&&K_ in t)return t[K_]();throw new Error(Eh("yieldWrapGet"))}const hs=gt("effect/Utils/isStructuralRegion",()=>({enabled:!1,tester:void 0})),Un=(t=>{const e={[t](n){return n()}};return function(n){return e[t](n)}})("effect_internal_function"),Q_=gt(Symbol.for("effect/Hash/randomHashCache"),()=>new WeakMap),_t=Symbol.for("effect/Hash"),Qe=t=>{if(hs.enabled===!0)return 0;switch(typeof t){case"number":return J_(t);case"bigint":return Pn(t.toString(10));case"boolean":return Pn(String(t));case"symbol":return Pn(String(t));case"string":return Pn(t);case"undefined":return Pn("undefined");case"function":case"object":return t===null?Pn("null"):t instanceof Date?Qe(t.toISOString()):$F(t)?t[_t]():H_(t);default:throw new Error(`BUG: unhandled typeof ${typeof t} - please report an issue at https://github.com/Effect-TS/effect/issues`)}},H_=t=>(Q_.has(t)||Q_.set(t,J_(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER))),Q_.get(t)),Ot=t=>e=>e*53^t,vh=t=>t&3221225471|t>>>1&1073741824,$F=t=>it(t,_t),J_=t=>{if(t!==t||t===1/0)return 0;let e=t|0;for(e!==t&&(e^=t*4294967295);t>4294967295;)e^=t/=4294967295;return vh(e)},Pn=t=>{let e=5381,n=t.length;for(;n;)e=e*33^t.charCodeAt(--n);return vh(e)},LF=(t,e)=>{let n=12289;for(let r=0;r<e.length;r++)n^=I(Pn(e[r]),Ot(Qe(t[e[r]])));return vh(n)},RE=t=>LF(t,Object.keys(t)),rf=t=>{let e=6151;for(let n=0;n<t.length;n++)e=I(e,Ot(Qe(t[n])));return vh(e)},hn=function(){if(arguments.length===1){const n=arguments[0];return function(r){return Object.defineProperty(n,_t,{value(){return r},enumerable:!1}),r}}const t=arguments[0],e=arguments[1];return Object.defineProperty(t,_t,{value(){return e},enumerable:!1}),e},yt=Symbol.for("effect/Equal");function ot(){return arguments.length===1?t=>Nh(t,arguments[0]):Nh(arguments[0],arguments[1])}function Nh(t,e){if(t===e)return!0;const n=typeof t;if(n!==typeof e)return!1;if(n==="object"||n==="function"){if(t!==null&&e!==null){if(sf(t)&&sf(e))return Qe(t)===Qe(e)&&t[yt](e)?!0:hs.enabled&&hs.tester?hs.tester(t,e):!1;if(t instanceof Date&&e instanceof Date)return t.toISOString()===e.toISOString()}if(hs.enabled){if(Array.isArray(t)&&Array.isArray(e))return t.length===e.length&&t.every((r,s)=>Nh(r,e[s]));if(Object.getPrototypeOf(t)===Object.prototype&&Object.getPrototypeOf(t)===Object.prototype){const r=Object.keys(t),s=Object.keys(e);if(r.length===s.length){for(const i of r)if(!(i in e&&Nh(t[i],e[i])))return hs.tester?hs.tester(t,e):!1;return!0}}return hs.tester?hs.tester(t,e):!1}}return hs.enabled&&hs.tester?hs.tester(t,e):!1}const sf=t=>it(t,yt),G_=()=>ot,Zt=Symbol.for("nodejs.util.inspect.custom"),gn=t=>it(t,"toJSON")&&Uc(t.toJSON)&&t.toJSON.length===0?t.toJSON():Array.isArray(t)?t.map(gn):t,vn=t=>JSON.stringify(t,null,2),kh={toJSON(){return gn(this)},[Zt](){return this.toJSON()},toString(){return vn(this.toJSON())}};let MF=class{[Zt](){return this.toJSON()}toString(){return vn(this.toJSON())}};const of=(t,e=2)=>{if(typeof t=="string")return t;try{return typeof t=="object"?DF(t,e):String(t)}catch{return String(t)}},DF=(t,e)=>{let n=[];const r=JSON.stringify(t,(s,i)=>typeof i=="object"&&i!==null?n.includes(i)?void 0:n.push(i)&&i:i,e);return n=void 0,r},et=(t,e)=>{switch(e.length){case 0:return t;case 1:return e[0](t);case 2:return e[1](e[0](t));case 3:return e[2](e[1](e[0](t)));case 4:return e[3](e[2](e[1](e[0](t))));case 5:return e[4](e[3](e[2](e[1](e[0](t)))));case 6:return e[5](e[4](e[3](e[2](e[1](e[0](t))))));case 7:return e[6](e[5](e[4](e[3](e[2](e[1](e[0](t)))))));case 8:return e[7](e[6](e[5](e[4](e[3](e[2](e[1](e[0](t))))))));case 9:return e[8](e[7](e[6](e[5](e[4](e[3](e[2](e[1](e[0](t)))))))));default:{let n=t;for(let r=0,s=e.length;r<s;r++)n=e[r](n);return n}}},af="Async",Y_="Commit",Gn="Failure",xh="OnFailure",qh="OnSuccess",Oh="OnSuccessAndFailure",Yn="Success",PE="Sync",WF="Tag",xa="UpdateRuntimeFlags",Ih="While",$E="WithRuntime",Th="Yield",X_="RevertFlags",BF=Symbol.for("effect/Effect"),UF=Symbol.for("effect/Stream"),jF=Symbol.for("effect/Sink"),zF=Symbol.for("effect/Channel"),Vc={_R:t=>t,_E:t=>t,_A:t=>t,_V:yh()},VF={_A:t=>t,_In:t=>t,_L:t=>t,_E:t=>t,_R:t=>t},KF={_Env:t=>t,_InErr:t=>t,_InElem:t=>t,_InDone:t=>t,_OutErr:t=>t,_OutElem:t=>t,_OutDone:t=>t},cf={[BF]:Vc,[UF]:Vc,[jF]:VF,[zF]:KF,[yt](t){return this===t},[_t](){return hn(this,H_(this))},[Symbol.iterator](){return new xF(new nf(this))},pipe(){return et(this,arguments)}},Ah={[_t](){return hn(this,RE(this))},[yt](t){const e=Object.keys(this),n=Object.keys(t);if(e.length!==n.length)return!1;for(const r of e)if(!(r in t&&ot(this[r],t[r])))return!1;return!0}},Kc={...cf,_op:Y_},QF={...Kc,...Ah},HF=function(){function t(){}return t.prototype=Kc,t}(),LE=Symbol.for("effect/Option"),ME={...cf,[LE]:{_A:t=>t},[Zt](){return this.toJSON()},toString(){return vn(this.toJSON())}},JF=Object.assign(Object.create(ME),{_tag:"Some",_op:"Some",[yt](t){return DE(t)&&WE(t)&&ot(this.value,t.value)},[_t](){return hn(this,Ot(Qe(this._tag))(Qe(this.value)))},toJSON(){return{_id:"Option",_tag:this._tag,value:gn(this.value)}}}),GF=Qe("None"),YF=Object.assign(Object.create(ME),{_tag:"None",_op:"None",[yt](t){return DE(t)&&Z_(t)},[_t](){return GF},toJSON(){return{_id:"Option",_tag:this._tag}}}),DE=t=>it(t,LE),Z_=t=>t._tag==="None",WE=t=>t._tag==="Some",Ch=Object.create(YF),Qc=t=>{const e=Object.create(JF);return e.value=t,e},BE=Symbol.for("effect/Context/Tag"),Fh={...cf,_op:"Tag",[Symbol.for("effect/STM")]:Vc,[BE]:{_Service:t=>t,_Identifier:t=>t},toString(){return vn(this.toJSON())},toJSON(){return{_id:"Tag",key:this.key,stack:this.stack}},[Zt](){return this.toJSON()},of(t){return t},context(t){return zE(this,t)}},XF=t=>{const e=Error.stackTraceLimit;Error.stackTraceLimit=2;const n=new Error;Error.stackTraceLimit=e;const r=Object.create(Fh);return Object.defineProperty(r,"stack",{get(){return n.stack}}),r.key=t,r},ZF=t=>()=>{const e=Error.stackTraceLimit;Error.stackTraceLimit=2;const n=new Error;Error.stackTraceLimit=e;function r(){}return Object.setPrototypeOf(r,Fh),r.key=t,Object.defineProperty(r,"stack",{get(){return n.stack}}),r},UE=Symbol.for("effect/Context"),e2={[UE]:{_Services:t=>t},[yt](t){if(jE(t)&&this.unsafeMap.size===t.unsafeMap.size){for(const e of this.unsafeMap.keys())if(!t.unsafeMap.has(e)||!ot(this.unsafeMap.get(e),t.unsafeMap.get(e)))return!1;return!0}return!1},[_t](){return hn(this,J_(this.unsafeMap.size))},pipe(){return et(this,arguments)},toString(){return vn(this.toJSON())},toJSON(){return{_id:"Context",services:Array.from(this.unsafeMap).map(gn)}},[Zt](){return this.toJSON()}},Hc=t=>{const e=Object.create(e2);return e.unsafeMap=t,e},t2=t=>{const e=new Error(`Service not found${t.key?`: ${String(t.key)}`:""}`);if(t.stack){const n=t.stack.split(`
`);if(n.length>2){const r=n[2].match(/at (.*)/);r&&(e.message=e.message+` (defined at ${r[1]})`)}}if(e.stack){const n=e.stack.split(`
`);n.splice(1,3),e.stack=n.join(`
`)}return e},jE=t=>it(t,UE),n2=t=>it(t,BE),r2=Hc(new Map),s2=()=>r2,zE=(t,e)=>Hc(new Map([[t.key,e]])),i2=w(3,(t,e,n)=>{const r=new Map(t.unsafeMap);return r.set(e.key,n),Hc(r)}),VE=w(2,(t,e)=>{if(!t.unsafeMap.has(e.key))throw t2(e);return t.unsafeMap.get(e.key)}),o2=VE,a2=w(2,(t,e)=>t.unsafeMap.has(e.key)?Qc(t.unsafeMap.get(e.key)):Ch),c2=w(2,(t,e)=>{const n=new Map(t.unsafeMap);for(const[r,s]of e.unsafeMap)n.set(r,s);return Hc(n)}),xr=XF,l2=jE,Rh=n2,Ns=s2,lf=zE,zt=i2,Eo=o2,uf=VE,vo=a2,Jc=c2,Ai=ZF,ey=t=>(e,n)=>e===n||t(e,n),u2=(t,e)=>t===e,f2=u2,d2=w(2,(t,e)=>ey((n,r)=>t(e(n),e(r)))),h2=t=>ey((e,n)=>{if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(!t(e[r],n[r]))return!1;return!0}),p2=t=>w(3,(e,n,r)=>t(e,s=>Object.assign({},s,{[n]:r(s)}))),m2=t=>w(2,(e,n)=>t(e,r=>({[n]:r}))),g2=(t,e)=>w(3,(n,r,s)=>e(n,i=>t(s(i),o=>Object.assign({},i,{[r]:o})))),KE=Symbol.for("effect/Either"),QE={...cf,[KE]:{_R:t=>t},[Zt](){return this.toJSON()},toString(){return vn(this.toJSON())}},_2=Object.assign(Object.create(QE),{_tag:"Right",_op:"Right",[yt](t){return ty(t)&&JE(t)&&ot(this.right,t.right)},[_t](){return Ot(Qe(this._tag))(Qe(this.right))},toJSON(){return{_id:"Either",_tag:this._tag,right:gn(this.right)}}}),y2=Object.assign(Object.create(QE),{_tag:"Left",_op:"Left",[yt](t){return ty(t)&&HE(t)&&ot(this.left,t.left)},[_t](){return Ot(Qe(this._tag))(Qe(this.left))},toJSON(){return{_id:"Either",_tag:this._tag,left:gn(this.left)}}}),ty=t=>it(t,KE),HE=t=>t._tag==="Left",JE=t=>t._tag==="Right",GE=t=>{const e=Object.create(y2);return e.left=t,e},YE=t=>{const e=Object.create(_2);return e.right=t,e},b2=w(2,(t,e)=>Z_(t)?GE(e()):YE(t.value)),XE=t=>(e,n)=>e===n?0:t(e,n),w2=XE((t,e)=>t<e?-1:1),ZE=w(2,(t,e)=>XE((n,r)=>t(e(n),e(r)))),S2=t=>w(2,(e,n)=>t(e,n)===1),ce=()=>Ch,de=Qc,tn=Z_,pt=WE,Nn=w(2,(t,{onNone:e,onSome:n})=>tn(t)?e():n(t.value)),nn=w(2,(t,e)=>tn(t)?e():t.value),Ph=w(2,(t,e)=>tn(t)?e():t),E2=w(2,(t,e)=>tn(t)?de(e()):t),ff=t=>t==null?ce():de(t),qr=nn(TE),v2=t=>(...e)=>{try{return de(t(...e))}catch{return ce()}},ev=w(2,(t,e)=>{if(pt(t))return t.value;throw e()})(()=>new Error("getOrThrow called on a None")),df=w(2,(t,e)=>tn(t)?ce():de(e(t.value))),$h=w(2,(t,e)=>tn(t)?ce():e(t.value)),N2=w(2,(t,e)=>tn(t)?ce():e(t.value)),k2=(t=>w(2,(e,n)=>tn(e)?!1:t(e.value,n)))(G_()),x2=w(2,(t,e)=>tn(t)?!1:e(t.value)),ny=Symbol.for("effect/Duration"),q2=BigInt(0),tv=BigInt(24),Lh=BigInt(60),ry=BigInt(1e3),nv=BigInt(1e6),sy=BigInt(1e9),rv=/^(-?\d+(?:\.\d+)?)\s+(nanos?|micros?|millis?|seconds?|minutes?|hours?|days?|weeks?)$/,Or=t=>{if(iv(t))return t;if(wo(t))return Dh(t);if(bh(t))return Mh(t);if(Array.isArray(t)){if(t.length===2&&wo(t[0])&&wo(t[1]))return Mh(BigInt(t[0])*sy+BigInt(t[1]))}else if(Hr(t)){rv.lastIndex=0;const e=rv.exec(t);if(e){const[n,r,s]=e,i=Number(r);switch(s){case"nano":case"nanos":return Mh(BigInt(r));case"micro":case"micros":return A2(BigInt(r));case"milli":case"millis":return Dh(i);case"second":case"seconds":return iy(i);case"minute":case"minutes":return C2(i);case"hour":case"hours":return F2(i);case"day":case"days":return R2(i);case"week":case"weeks":return P2(i)}}}throw new Error("Invalid DurationInput")},sv={_tag:"Millis",millis:0},O2={_tag:"Infinity"},I2={[ny]:ny,[_t](){return hn(this,RE(this.value))},[yt](t){return iv(t)&&B2(this,t)},toString(){return`Duration(${av(this)})`},toJSON(){switch(this.value._tag){case"Millis":return{_id:"Duration",_tag:"Millis",millis:this.value.millis};case"Nanos":return{_id:"Duration",_tag:"Nanos",hrtime:L2(this)};case"Infinity":return{_id:"Duration",_tag:"Infinity"}}},[Zt](){return this.toJSON()},pipe(){return et(this,arguments)}},Ci=t=>{const e=Object.create(I2);return wo(t)?isNaN(t)||t<=0?e.value=sv:Number.isFinite(t)?Number.isInteger(t)?e.value={_tag:"Millis",millis:t}:e.value={_tag:"Nanos",nanos:BigInt(Math.round(t*1e6))}:e.value=O2:t<=q2?e.value=sv:e.value={_tag:"Nanos",nanos:t},e},iv=t=>it(t,ny),T2=Ci(0),Mh=t=>Ci(t),A2=t=>Ci(t*ry),Dh=t=>Ci(t),iy=t=>Ci(t*1e3),C2=t=>Ci(t*6e4),F2=t=>Ci(t*36e5),R2=t=>Ci(t*864e5),P2=t=>Ci(t*6048e5),Gc=t=>M2(t,{onMillis:e=>e,onNanos:e=>Number(e)/1e6}),$2=t=>{const e=Or(t);switch(e.value._tag){case"Infinity":throw new Error("Cannot convert infinite duration to nanos");case"Nanos":return e.value.nanos;case"Millis":return BigInt(Math.round(e.value.millis*1e6))}},L2=t=>{const e=Or(t);switch(e.value._tag){case"Infinity":return[1/0,0];case"Nanos":return[Number(e.value.nanos/sy),Number(e.value.nanos%sy)];case"Millis":return[Math.floor(e.value.millis/1e3),Math.round(e.value.millis%1e3*1e6)]}},M2=w(2,(t,e)=>{const n=Or(t);switch(n.value._tag){case"Nanos":return e.onNanos(n.value.nanos);case"Infinity":return e.onMillis(1/0);case"Millis":return e.onMillis(n.value.millis)}}),ov=w(3,(t,e,n)=>{const r=Or(t),s=Or(e);if(r.value._tag==="Infinity"||s.value._tag==="Infinity")return n.onMillis(Gc(r),Gc(s));if(r.value._tag==="Nanos"||s.value._tag==="Nanos"){const i=r.value._tag==="Nanos"?r.value.nanos:BigInt(Math.round(r.value.millis*1e6)),o=s.value._tag==="Nanos"?s.value.nanos:BigInt(Math.round(s.value.millis*1e6));return n.onNanos(i,o)}return n.onMillis(r.value.millis,s.value.millis)}),D2=(t,e)=>ov(t,e,{onMillis:(n,r)=>n===r,onNanos:(n,r)=>n===r}),W2=w(2,(t,e)=>ov(t,e,{onMillis:(n,r)=>n>=r,onNanos:(n,r)=>n>=r})),B2=w(2,(t,e)=>D2(Or(t),Or(e))),U2=t=>{const e=Or(t);if(e.value._tag==="Infinity")return{days:1/0,hours:1/0,minutes:1/0,seconds:1/0,millis:1/0,nanos:1/0};const n=$2(e),r=n/nv,s=r/ry,i=s/Lh,o=i/Lh,l=o/tv;return{days:Number(l),hours:Number(o%tv),minutes:Number(i%Lh),seconds:Number(s%Lh),millis:Number(r%ry),nanos:Number(n%nv)}},av=t=>{const e=Or(t);if(e.value._tag==="Infinity")return"Infinity";const n=U2(e),r=[];return n.days!==0&&r.push(`${n.days}d`),n.hours!==0&&r.push(`${n.hours}h`),n.minutes!==0&&r.push(`${n.minutes}m`),n.seconds!==0&&r.push(`${n.seconds}s`),n.millis!==0&&r.push(`${n.millis}ms`),n.nanos!==0&&r.push(`${n.nanos}ns`),r.join(" ")},Mt=YE,ut=GE,j2=b2,z2=ty,Xn=HE,Fi=JE,cv=w(2,(t,e)=>Xn(t)?ut(e(t.left)):Mt(t.right)),ps=w(2,(t,{onLeft:e,onRight:n})=>Xn(t)?e(t.left):n(t.right)),lv=ps({onLeft:Ke,onRight:Ke}),V2=w(2,(t,e)=>{if(Fi(t))return t.right;throw e(t.left)}),uv=t=>t.length>0,K2=(...t)=>t,Q2=w(2,(t,e)=>{let n=0;for(const r of t){const s=e(r,n);if(tf(s)){if(s)return de(r)}else if(pt(s))return s;n++}return ce()}),H2=w(2,(t,e)=>{const n=[];for(const r of fv(t))n.push(e(r,t[r]));return n})((t,e)=>[t,e]),J2=w(2,(t,e)=>{const n={...t};for(const r of fv(t))n[r]=e(t[r],r);return n}),fv=t=>Object.keys(t),Wh=t=>new Array(t),G2=(t,e)=>{const n=Math.max(1,Math.floor(t)),r=new Array(n);for(let s=0;s<n;s++)r[s]=e(s);return r},bt=t=>Array.isArray(t)?t:Array.from(t),Y2=t=>Array.isArray(t)?t:[t],X2=w(2,(t,{onEmpty:e,onNonEmpty:n})=>xn(t)?n(Lr(t),qa(t)):e()),Bh=w(2,(t,e)=>[e,...t]),Z2=w(2,(t,e)=>[...t,e]),oy=w(2,(t,e)=>bt(t).concat(bt(e))),Yc=Array.isArray,eR=t=>t.length===0,Uh=uv,xn=uv,ay=(t,e)=>t<0||t>=e.length,tR=(t,e)=>Math.floor(Math.min(Math.max(0,t),e.length)),nR=w(2,(t,e)=>{const n=Math.floor(e);return ay(n,t)?ce():de(t[n])}),dv=w(2,(t,e)=>{const n=Math.floor(e);if(ay(n,t))throw new Error(`Index ${n} out of bounds`);return t[n]}),hf=nR(0),Lr=dv(0),rR=t=>xn(t)?de(hv(t)):ce(),hv=t=>t[t.length-1],qa=t=>t.slice(1),sR=(t,e)=>{let n=0;for(const r of t){if(!e(r,n))break;n++}return n},iR=w(2,(t,e)=>yv(t,sR(t,e))),oR=w(2,(t,e)=>{const n=bt(t);return n.slice(tR(e,n),n.length)}),aR=Q2,cR=w(3,(t,e,n)=>lR(t,e,()=>n)),lR=w(3,(t,e,n)=>nn(uR(t,e,n),()=>Array.from(t))),uR=w(3,(t,e,n)=>{const r=Array.from(t);if(ay(e,r))return ce();const s=n(r[e]);return r[e]=s,de(r)}),pv=t=>Array.from(t).reverse(),pf=w(2,(t,e)=>{const n=Array.from(t);return n.sort(e),n}),mv=w(2,(t,e)=>fR(t,e,K2)),fR=w(3,(t,e,n)=>{const r=bt(t),s=bt(e);if(xn(r)&&xn(s)){const i=[n(Lr(r),Lr(s))],o=Math.min(r.length,s.length);for(let l=1;l<o;l++)i[l]=n(r[l],s[l]);return i}return[]}),dR=t=>{const e=bt(t);if(xn(e)){const n=[e[0][0]],r=[e[0][1]];for(let s=1;s<e.length;s++)n[s]=e[s][0],r[s]=e[s][1];return[n,r]}return[[],[]]},gv=t=>w(2,(e,n)=>{for(const r of e)if(t(n,r))return!0;return!1}),_v=G_(),yv=w(2,(t,e)=>{const n=Array.from(t),r=Math.floor(e);return xn(n)?r>=1?hR(n,r):[[],n]:[n,[]]}),hR=w(2,(t,e)=>{const n=Math.max(1,Math.floor(e));return n>=t.length?[mf(t),[]]:[Bh(t.slice(1,n),Lr(t)),t.slice(n)]}),mf=t=>t.slice(),pR=w(3,(t,e,n)=>{const r=bt(t),s=bt(e);return xn(r)?xn(s)?fy(n)(oy(r,s)):r:s}),Xc=w(2,(t,e)=>pR(t,e,_v)),bv=t=>{const e=gv(t);return w(2,(n,r)=>bt(n).filter(s=>e(r,s)))},mR=bv(_v),cy=t=>{const e=gv(t);return w(2,(n,r)=>bt(n).filter(s=>!e(r,s)))},No=()=>[],ks=t=>[t],xs=w(2,(t,e)=>t.map(e)),wv=w(2,(t,e)=>{if(eR(t))return[];const n=[];for(let r=0;r<t.length;r++){const s=e(t[r],r);for(let i=0;i<s.length;i++)n.push(s[i])}return n}),Sv=wv(Ke),Zc=w(2,(t,e)=>{const n=bt(t),r=[];for(let s=0;s<n.length;s++){const i=e(n[s],s);pt(i)&&r.push(i.value)}return r}),gR=w(2,(t,e)=>{const n=[],r=[],s=bt(t);for(let i=0;i<s.length;i++){const o=e(s[i],i);Xn(o)?n.push(o.left):r.push(o.right)}return[n,r]}),_R=Zc(Ke),ly=w(2,(t,e)=>{const n=bt(t),r=[];for(let s=0;s<n.length;s++)e(n[s],s)&&r.push(n[s]);return r}),yR=w(2,(t,e)=>{const n=[],r=[],s=bt(t);for(let i=0;i<s.length;i++)e(s[i],i)?r.push(s[i]):n.push(s[i]);return[n,r]}),Oa=w(3,(t,e,n)=>bt(t).reduce((r,s,i)=>n(r,s,i),e)),bR=w(3,(t,e,n)=>bt(t).reduceRight((r,s,i)=>n(r,s,i),e)),Ev=(t,e)=>{const n=[];let r=t,s;for(;pt(s=e(r));){const[i,o]=s.value;n.push(i),r=o}return n},uy=h2,fy=w(2,(t,e)=>{const n=bt(t);if(xn(n)){const r=[Lr(n)],s=qa(n);for(const i of s)r.every(o=>!e(i,o))&&r.push(i);return r}return[]}),vv=t=>fy(t,G_()),el=w(2,(t,e)=>bt(t).join(e)),Nv=Symbol.for("effect/Chunk");function wR(t,e,n,r,s){for(let i=e;i<Math.min(t.length,e+s);i++)n[r+i-e]=t[i];return n}const kv=[],SR=(t=>ey((e,n)=>e.length===n.length&&ti(e).every((r,s)=>t(r,ko(n,s)))))(ot),ER={[Nv]:{_A:t=>t},toString(){return vn(this.toJSON())},toJSON(){return{_id:"Chunk",values:ti(this).map(gn)}},[Zt](){return this.toJSON()},[yt](t){return xv(t)&&SR(this,t)},[_t](){return hn(this,rf(ti(this)))},[Symbol.iterator](){switch(this.backing._tag){case"IArray":return this.backing.array[Symbol.iterator]();case"IEmpty":return kv[Symbol.iterator]();default:return ti(this)[Symbol.iterator]()}},pipe(){return et(this,arguments)}},$n=t=>{const e=Object.create(ER);switch(e.backing=t,t._tag){case"IEmpty":{e.length=0,e.depth=0,e.left=e,e.right=e;break}case"IConcat":{e.length=t.left.length+t.right.length,e.depth=1+Math.max(t.left.depth,t.right.depth),e.left=t.left,e.right=t.right;break}case"IArray":{e.length=t.array.length,e.depth=0,e.left=ei,e.right=ei;break}case"ISingleton":{e.length=1,e.depth=0,e.left=ei,e.right=ei;break}case"ISlice":{e.length=t.length,e.depth=t.chunk.depth+1,e.left=ei,e.right=ei;break}}return e},xv=t=>it(t,Nv),ei=$n({_tag:"IEmpty"}),Jr=()=>ei,dy=(...t)=>t.length===1?Zn(t[0]):NR(t),Zn=t=>$n({_tag:"ISingleton",a:t}),Ia=t=>xv(t)?t:$n({_tag:"IArray",array:bt(t)}),hy=(t,e,n)=>{switch(t.backing._tag){case"IArray":{wR(t.backing.array,0,e,n,t.length);break}case"IConcat":{hy(t.left,e,n),hy(t.right,e,n+t.left.length);break}case"ISingleton":{e[n]=t.backing.a;break}case"ISlice":{let r=0,s=n;for(;r<t.length;)e[s]=ko(t,r),r+=1,s+=1;break}}},ti=t=>{switch(t.backing._tag){case"IEmpty":return kv;case"IArray":return t.backing.array;default:{const e=new Array(t.length);return hy(t,e,0),t.backing={_tag:"IArray",array:e},t.left=ei,t.right=ei,t.depth=0,e}}},Ri=t=>{switch(t.backing._tag){case"IEmpty":case"ISingleton":return t;case"IArray":return $n({_tag:"IArray",array:pv(t.backing.array)});case"IConcat":return $n({_tag:"IConcat",left:Ri(t.backing.right),right:Ri(t.backing.left)});case"ISlice":return tl(pv(ti(t)))}},vR=w(2,(t,e)=>e<0||e>=t.length?ce():de(ko(t,e))),tl=t=>$n({_tag:"IArray",array:t}),NR=t=>tl(t),ko=w(2,(t,e)=>{switch(t.backing._tag){case"IEmpty":throw new Error("Index out of bounds");case"ISingleton":{if(e!==0)throw new Error("Index out of bounds");return t.backing.a}case"IArray":{if(e>=t.length||e<0)throw new Error("Index out of bounds");return t.backing.array[e]}case"IConcat":return e<t.left.length?ko(t.left,e):ko(t.right,e-t.left.length);case"ISlice":return ko(t.backing.chunk,e+t.backing.offset)}}),jh=w(2,(t,e)=>Mr(t,Zn(e))),lr=w(2,(t,e)=>Mr(Zn(e),t)),py=w(2,(t,e)=>{if(e<=0)return t;if(e>=t.length)return ei;switch(t.backing._tag){case"ISlice":return $n({_tag:"ISlice",chunk:t.backing.chunk,offset:t.backing.offset+e,length:t.backing.length-e});case"IConcat":return e>t.left.length?py(t.right,e-t.left.length):$n({_tag:"IConcat",left:py(t.left,e),right:t.right});default:return $n({_tag:"ISlice",chunk:t,offset:e,length:t.length-e})}}),Mr=w(2,(t,e)=>{if(t.backing._tag==="IEmpty")return e;if(e.backing._tag==="IEmpty")return t;const n=e.depth-t.depth;if(Math.abs(n)<=1)return $n({_tag:"IConcat",left:t,right:e});if(n<-1)if(t.left.depth>=t.right.depth){const r=Mr(t.right,e);return $n({_tag:"IConcat",left:t.left,right:r})}else{const r=Mr(t.right.right,e);if(r.depth===t.depth-3){const s=$n({_tag:"IConcat",left:t.right.left,right:r});return $n({_tag:"IConcat",left:t.left,right:s})}else{const s=$n({_tag:"IConcat",left:t.left,right:t.right.left});return $n({_tag:"IConcat",left:s,right:r})}}else if(e.right.depth>=e.left.depth){const r=Mr(t,e.left);return $n({_tag:"IConcat",left:r,right:e.right})}else{const r=Mr(t,e.left.left);if(r.depth===e.depth-3){const s=$n({_tag:"IConcat",left:r,right:e.left.right});return $n({_tag:"IConcat",left:s,right:e.right})}else{const s=$n({_tag:"IConcat",left:e.left.right,right:e.right});return $n({_tag:"IConcat",left:r,right:s})}}}),qv=w(2,(t,e)=>tl(ly(t,e))),my=t=>t.length===0,qs=t=>t.length>0,Ov=vR(0),Iv=t=>ko(t,0),ms=Iv,Tv=w(2,(t,e)=>t.backing._tag==="ISingleton"?Zn(e(t.backing.a,0)):tl(I(ti(t),xs((n,r)=>e(n,r))))),Os=t=>py(t,1),kR=Oa,Ta=5,gy=Math.pow(2,Ta),xR=gy-1,qR=gy/2,OR=gy/4;function IR(t){return t-=t>>1&1431655765,t=(t&858993459)+(t>>2&858993459),t=t+(t>>4)&252645135,t+=t>>8,t+=t>>16,t&127}function nl(t,e){return e>>>t&xR}function rl(t){return 1<<t}function Av(t,e){return IR(t&e-1)}const TR=(t,e)=>({value:t,previous:e});function sl(t,e,n,r){let s=r;if(!t){const i=r.length;s=new Array(i);for(let o=0;o<i;++o)s[o]=r[o]}return s[e]=n,s}function Cv(t,e,n){const r=n.length-1;let s=0,i=0,o=n;if(t)s=i=e;else for(o=new Array(r);s<e;)o[i++]=n[s++];for(++s;s<=r;)o[i++]=n[s++];return t&&(o.length=r),o}function AR(t,e,n,r){const s=r.length;if(t){let f=s;for(;f>=e;)r[f--]=r[f];return r[e]=n,r}let i=0,o=0;const l=new Array(s+1);for(;i<e;)l[o++]=r[i++];for(l[e]=n;i<s;)l[++o]=r[i++];return l}class xo{constructor(){g(this,"_tag","EmptyNode")}modify(e,n,r,s,i,o){const l=r(ce());return tn(l)?new xo:(++o.value,new Aa(e,s,i,l))}}function Is(t){return Sh(t,"EmptyNode")}function CR(t){return Is(t)||t._tag==="LeafNode"||t._tag==="CollisionNode"}function zh(t,e){return Is(t)?!1:e===t.edit}class Aa{constructor(e,n,r,s){g(this,"edit");g(this,"hash");g(this,"key");g(this,"value");g(this,"_tag","LeafNode");this.edit=e,this.hash=n,this.key=r,this.value=s}modify(e,n,r,s,i,o){if(ot(i,this.key)){const f=r(this.value);return f===this.value?this:tn(f)?(--o.value,new xo):zh(this,e)?(this.value=f,this):new Aa(e,s,i,f)}const l=r(ce());return tn(l)?this:(++o.value,Fv(e,n,this.hash,this,s,new Aa(e,s,i,l)))}}class _y{constructor(e,n,r){g(this,"edit");g(this,"hash");g(this,"children");g(this,"_tag","CollisionNode");this.edit=e,this.hash=n,this.children=r}modify(e,n,r,s,i,o){if(s===this.hash){const f=zh(this,e),m=this.updateCollisionList(f,e,this.hash,this.children,r,i,o);return m===this.children?this:m.length>1?new _y(e,this.hash,m):m[0]}const l=r(ce());return tn(l)?this:(++o.value,Fv(e,n,this.hash,this,s,new Aa(e,s,i,l)))}updateCollisionList(e,n,r,s,i,o,l){const f=s.length;for(let S=0;S<f;++S){const N=s[S];if("key"in N&&ot(o,N.key)){const O=N.value,M=i(O);return M===O?s:tn(M)?(--l.value,Cv(e,S,s)):sl(e,S,new Aa(n,r,o,M),s)}}const m=i(ce());return tn(m)?s:(++l.value,sl(e,f,new Aa(n,r,o,m),s))}}class il{constructor(e,n,r){g(this,"edit");g(this,"mask");g(this,"children");g(this,"_tag","IndexedNode");this.edit=e,this.mask=n,this.children=r}modify(e,n,r,s,i,o){const l=this.mask,f=this.children,m=nl(n,s),S=rl(m),N=Av(l,S),O=l&S,M=zh(this,e);if(!O){const ve=new xo().modify(e,n+Ta,r,s,i,o);return ve?f.length>=qR?RR(e,m,ve,l,f):new il(e,l|S,AR(M,N,ve,f)):this}const z=f[N],Z=z.modify(e,n+Ta,r,s,i,o);if(z===Z)return this;let J=l,ee;if(Is(Z)){if(J&=~S,!J)return new xo;if(f.length<=2&&CR(f[N^1]))return f[N^1];ee=Cv(M,N,f)}else ee=sl(M,N,Z,f);return M?(this.mask=J,this.children=ee,this):new il(e,J,ee)}}class yy{constructor(e,n,r){g(this,"edit");g(this,"size");g(this,"children");g(this,"_tag","ArrayNode");this.edit=e,this.size=n,this.children=r}modify(e,n,r,s,i,o){let l=this.size;const f=this.children,m=nl(n,s),S=f[m],N=(S||new xo).modify(e,n+Ta,r,s,i,o);if(S===N)return this;const O=zh(this,e);let M;if(Is(S)&&!Is(N))++l,M=sl(O,m,N,f);else if(!Is(S)&&Is(N)){if(--l,l<=OR)return FR(e,l,m,f);M=sl(O,m,new xo,f)}else M=sl(O,m,N,f);return O?(this.size=l,this.children=M,this):new yy(e,l,M)}}function FR(t,e,n,r){const s=new Array(e-1);let i=0,o=0;for(let l=0,f=r.length;l<f;++l)if(l!==n){const m=r[l];m&&!Is(m)&&(s[i++]=m,o|=1<<l)}return new il(t,o,s)}function RR(t,e,n,r,s){const i=[];let o=r,l=0;for(let f=0;o;++f)o&1&&(i[f]=s[l++]),o>>>=1;return i[e]=n,new yy(t,l+1,i)}function PR(t,e,n,r,s,i){if(n===s)return new _y(t,n,[i,r]);const o=nl(e,n),l=nl(e,s);if(o===l)return f=>new il(t,rl(o)|rl(l),[f]);{const f=o<l?[r,i]:[i,r];return new il(t,rl(o)|rl(l),f)}}function Fv(t,e,n,r,s,i){let o,l=e;for(;;){const f=PR(t,l,n,r,s,i);if(typeof f=="function")o=TR(f,o),l=l+Ta;else{let m=f;for(;o!=null;)m=o.value(m),o=o.previous;return m}}}const Rv="effect/HashMap",by=Symbol.for(Rv),$R={[by]:by,[Symbol.iterator](){return new Vh(this,(t,e)=>[t,e])},[_t](){let t=Qe(Rv);for(const e of this)t^=I(Qe(e[0]),Ot(Qe(e[1])));return hn(this,t)},[yt](t){if(DR(t)){if(t._size!==this._size)return!1;for(const e of this){const n=I(t,Sy(e[0],Qe(e[0])));if(tn(n))return!1;if(!ot(e[1],n.value))return!1}return!0}return!1},toString(){return vn(this.toJSON())},toJSON(){return{_id:"HashMap",values:Array.from(this).map(gn)}},[Zt](){return this.toJSON()},pipe(){return et(this,arguments)}},wy=(t,e,n,r)=>{const s=Object.create($R);return s._editable=t,s._edit=e,s._root=n,s._size=r,s};class Vh{constructor(e,n){g(this,"map");g(this,"f");g(this,"v");this.map=e,this.f=n,this.v=Pv(this.map._root,this.f,void 0)}next(){if(tn(this.v))return{done:!0,value:void 0};const e=this.v.value;return this.v=Kh(e.cont),{done:!1,value:e.value}}[Symbol.iterator](){return new Vh(this.map,this.f)}}const Kh=t=>t?$v(t[0],t[1],t[2],t[3],t[4]):ce(),Pv=(t,e,n=void 0)=>{switch(t._tag){case"LeafNode":return pt(t.value)?de({value:e(t.key,t.value.value),cont:n}):Kh(n);case"CollisionNode":case"ArrayNode":case"IndexedNode":{const r=t.children;return $v(r.length,r,0,e,n)}default:return Kh(n)}},$v=(t,e,n,r,s)=>{for(;n<t;){const i=e[n++];if(i&&!Is(i))return Pv(i,r,[t,e,n,r,s])}return Kh(s)},LR=wy(!1,0,new xo,0),Qh=()=>LR,MR=t=>{const e=Ey(Qh());for(const n of t)gf(e,n[0],n[1]);return Mv(e)},DR=t=>it(t,by),WR=t=>t&&Is(t._root),BR=w(2,(t,e)=>Sy(t,e,Qe(e))),Sy=w(3,(t,e,n)=>{let r=t._root,s=0;for(;;)switch(r._tag){case"LeafNode":return ot(e,r.key)?r.value:ce();case"CollisionNode":{if(n===r.hash){const i=r.children;for(let o=0,l=i.length;o<l;++o){const f=i[o];if("key"in f&&ot(e,f.key))return f.value}}return ce()}case"IndexedNode":{const i=nl(s,n),o=rl(i);if(r.mask&o){r=r.children[Av(r.mask,o)],s+=Ta;break}return ce()}case"ArrayNode":{if(r=r.children[nl(s,n)],r){s+=Ta;break}return ce()}default:return ce()}}),UR=w(2,(t,e)=>pt(Sy(t,e,Qe(e)))),gf=w(3,(t,e,n)=>vy(t,e,()=>de(n))),jR=w(3,(t,e,n)=>t._editable?(t._root=e,t._size=n,t):e===t._root?t:wy(t._editable,t._edit,e,n)),Lv=t=>new Vh(t,e=>e),Hh=t=>t._size,Ey=t=>wy(!0,t._edit+1,t._root,t._size),Mv=t=>(t._editable=!1,t),zR=w(2,(t,e)=>{const n=Ey(t);return e(n),Mv(n)}),vy=w(3,(t,e,n)=>VR(t,e,Qe(e),n)),VR=w(4,(t,e,n,r)=>{const s={value:t._size},i=t._root.modify(t._editable?t._edit:NaN,0,r,n,e,s);return I(t,jR(i,s.value))}),Dv=w(2,(t,e)=>vy(t,e,ce)),KR=w(2,(t,e)=>Jh(t,Qh(),(n,r,s)=>gf(n,s,e(r,s)))),Wv=w(2,(t,e)=>Jh(t,void 0,(n,r,s)=>e(r,s))),Jh=w(3,(t,e,n)=>{const r=t._root;if(r._tag==="LeafNode")return pt(r.value)?n(e,r.value.value,r.key):e;if(r._tag==="EmptyNode")return e;const s=[r.children];let i;for(;i=s.pop();)for(let o=0,l=i.length;o<l;){const f=i[o++];f&&!Is(f)&&(f._tag==="LeafNode"?pt(f.value)&&(e=n(e,f.value.value,f.key)):s.push(f.children))}return e}),Bv="effect/HashSet",Ny=Symbol.for(Bv),QR={[Ny]:Ny,[Symbol.iterator](){return Lv(this._keyMap)},[_t](){return hn(this,Ot(Qe(this._keyMap))(Qe(Bv)))},[yt](t){return HR(t)?Hh(this._keyMap)===Hh(t._keyMap)&&ot(this._keyMap,t._keyMap):!1},toString(){return vn(this.toJSON())},toJSON(){return{_id:"HashSet",values:Array.from(this).map(gn)}},[Zt](){return this.toJSON()},pipe(){return et(this,arguments)}},Gh=t=>{const e=Object.create(QR);return e._keyMap=t,e},HR=t=>it(t,Ny),JR=Gh(Qh()),Yh=()=>JR,GR=t=>{const e=ky(Yh());for(const n of t)_f(e,n);return xy(e)},YR=(...t)=>{const e=ky(Yh());for(const n of t)_f(e,n);return xy(e)},XR=w(2,(t,e)=>UR(t._keyMap,e)),ZR=t=>Hh(t._keyMap),ky=t=>Gh(Ey(t._keyMap)),xy=t=>(t._keyMap._editable=!1,t),Uv=w(2,(t,e)=>{const n=ky(t);return e(n),xy(n)}),_f=w(2,(t,e)=>t._keyMap._editable?(gf(e,!0)(t._keyMap),t):Gh(gf(e,!0)(t._keyMap))),jv=w(2,(t,e)=>t._keyMap._editable?(Dv(e)(t._keyMap),t):Gh(Dv(e)(t._keyMap))),eP=w(2,(t,e)=>Uv(t,n=>{for(const r of e)jv(n,r)})),tP=w(2,(t,e)=>Uv(Yh(),n=>{nP(t,r=>_f(n,r));for(const r of e)_f(n,r)})),nP=w(2,(t,e)=>Wv(t._keyMap,(n,r)=>e(r))),rP=w(3,(t,e,n)=>Jh(t._keyMap,e,(r,s,i)=>n(r,i))),Ca=Yh,zv=GR,qy=YR,sP=XR,Oy=ZR,ol=_f,Iy=jv,Vv=eP,yf=tP,Xh=rP,Kv=Symbol.for("effect/MutableRef"),iP={[Kv]:Kv,toString(){return vn(this.toJSON())},toJSON(){return{_id:"MutableRef",current:gn(this.current)}},[Zt](){return this.toJSON()},pipe(){return et(this,arguments)}},al=t=>{const e=Object.create(iP);return e.current=t,e},Qv=w(3,(t,e,n)=>ot(e,t.current)?(t.current=n,!0):!1),jn=t=>t.current,cl=w(2,(t,e)=>(t.current=e,t)),Zh="effect/FiberId",Fa=Symbol.for(Zh),ll="None",Ty="Runtime",Ay="Composite",oP=Pn(`${Zh}-${ll}`);let aP=class{constructor(){g(this,zte,Fa);g(this,"_tag",ll);g(this,"id",-1);g(this,"startTimeMillis",-1)}[(zte=Fa,_t)](){return oP}[yt](e){return Cy(e)&&e._tag===ll}toString(){return vn(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag}}[Zt](){return this.toJSON()}};class cP{constructor(e,n){g(this,"id");g(this,"startTimeMillis");g(this,Vte,Fa);g(this,"_tag",Ty);this.id=e,this.startTimeMillis=n}[(Vte=Fa,_t)](){return hn(this,Pn(`${Zh}-${this._tag}-${this.id}-${this.startTimeMillis}`))}[yt](e){return Cy(e)&&e._tag===Ty&&this.id===e.id&&this.startTimeMillis===e.startTimeMillis}toString(){return vn(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,id:this.id,startTimeMillis:this.startTimeMillis}}[Zt](){return this.toJSON()}}let lP=class{constructor(e,n){g(this,"left");g(this,"right");g(this,Kte,Fa);g(this,"_tag",Ay);g(this,"_hash");this.left=e,this.right=n}[(Kte=Fa,_t)](){return I(Pn(`${Zh}-${this._tag}`),Ot(Qe(this.left)),Ot(Qe(this.right)),hn(this))}[yt](e){return Cy(e)&&e._tag===Ay&&ot(this.left,e.left)&&ot(this.right,e.right)}toString(){return vn(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,left:gn(this.left),right:gn(this.right)}}[Zt](){return this.toJSON()}};const Hv=new aP,Cy=t=>it(t,Fa),uP=w(2,(t,e)=>t._tag===ll?e:e._tag===ll?t:new lP(t,e)),Fy=t=>{switch(t._tag){case ll:return Ca();case Ty:return qy(t.id);case Ay:return I(Fy(t.left),yf(Fy(t.right)))}},Jv=gt(Symbol.for("effect/Fiber/Id/_fiberCounter"),()=>al(0)),Gv=t=>Array.from(Fy(t)).map(n=>`#${n}`).join(","),fP=()=>{const t=jn(Jv);return I(Jv,cl(t+1)),new cP(t,Date.now())},qo=Hv,Yv=uP,dP=Gv,Xv=fP,ep=Qh,hP=MR,pP=WR,Zv=BR,Oo=gf,eN=Lv,mP=Hh,gP=zR,_P=vy,yP=KR,bP=Wv,tN=Jh,bf=Symbol.for("effect/List"),Ry=t=>bt(t),wP=(t=>d2(uy(t),Ry))(ot),SP={[bf]:bf,_tag:"Cons",toString(){return vn(this.toJSON())},toJSON(){return{_id:"List",_tag:"Cons",values:Ry(this).map(gn)}},[Zt](){return this.toJSON()},[yt](t){return rN(t)&&this._tag===t._tag&&wP(this,t)},[_t](){return hn(this,rf(Ry(this)))},[Symbol.iterator](){let t=!1,e=this;return{next(){if(t)return this.return();if(e._tag==="Nil")return t=!0,this.return();const n=e.head;return e=e.tail,{done:t,value:n}},return(n){return t||(t=!0),{done:!0,value:n}}}},pipe(){return et(this,arguments)}},tp=(t,e)=>{const n=Object.create(SP);return n.head=t,n.tail=e,n},EP=Pn("Nil"),vP={[bf]:bf,_tag:"Nil",toString(){return vn(this.toJSON())},toJSON(){return{_id:"List",_tag:"Nil"}},[Zt](){return this.toJSON()},[_t](){return EP},[yt](t){return rN(t)&&this._tag===t._tag},[Symbol.iterator](){return{next(){return{done:!0,value:void 0}}}},pipe(){return et(this,arguments)}},nN=Object.create(vP),rN=t=>it(t,bf),Pi=t=>t._tag==="Nil",sN=t=>t._tag==="Cons",NP=()=>nN,Ra=(t,e)=>tp(t,e),Pa=NP,Py=t=>tp(t,nN),kP=w(2,(t,e)=>xP(e,t)),$y=w(2,(t,e)=>Ra(e,t)),xP=w(2,(t,e)=>{if(Pi(t))return e;if(Pi(e))return t;{const n=tp(e.head,t);let r=n,s=e.tail;for(;!Pi(s);){const i=tp(s.head,t);r.tail=i,r=i,s=s.tail}return n}}),qP=w(3,(t,e,n)=>{let r=e,s=t;for(;!Pi(s);)r=n(r,s.head),s=s.tail;return r}),OP=t=>{let e=Pa(),n=t;for(;!Pi(n);)e=$y(e,n.head),n=n.tail;return e},Ly=function(){function t(e){e&&Object.assign(this,e)}return t.prototype=Ah,t}(),My=t=>Object.assign(Object.create(Ah),t),IP=Symbol.for("effect/DifferContextPatch");function iN(t){return t}const wf={...Ly.prototype,[IP]:{_Value:iN,_Patch:iN}},TP=Object.create(Object.assign(Object.create(wf),{_tag:"Empty"})),oN=()=>TP,AP=Object.assign(Object.create(wf),{_tag:"AndThen"}),CP=(t,e)=>{const n=Object.create(AP);return n.first=t,n.second=e,n},FP=Object.assign(Object.create(wf),{_tag:"AddService"}),RP=(t,e)=>{const n=Object.create(FP);return n.key=t,n.service=e,n},PP=Object.assign(Object.create(wf),{_tag:"RemoveService"}),$P=t=>{const e=Object.create(PP);return e.key=t,e},LP=Object.assign(Object.create(wf),{_tag:"UpdateService"}),MP=(t,e)=>{const n=Object.create(LP);return n.key=t,n.update=e,n},DP=(t,e)=>{const n=new Map(t.unsafeMap);let r=oN();for(const[s,i]of e.unsafeMap.entries())if(n.has(s)){const o=n.get(s);n.delete(s),ot(o,i)||(r=np(MP(s,()=>i))(r))}else n.delete(s),r=np(RP(s,i))(r);for(const[s]of n.entries())r=np($P(s))(r);return r},np=w(2,(t,e)=>CP(t,e)),WP=w(2,(t,e)=>{if(t._tag==="Empty")return e;let n=!1,r=Zn(t);const s=new Map(e.unsafeMap);for(;qs(r);){const o=ms(r),l=Os(r);switch(o._tag){case"Empty":{r=l;break}case"AddService":{s.set(o.key,o.service),r=l;break}case"AndThen":{r=lr(lr(l,o.second),o.first);break}case"RemoveService":{s.delete(o.key),r=l;break}case"UpdateService":{s.set(o.key,o.update(s.get(o.key))),n=!0,r=l;break}}}if(!n)return Hc(s);const i=new Map;for(const[o]of e.unsafeMap)s.has(o)&&(i.set(o,s.get(o)),s.delete(o));for(const[o,l]of s)i.set(o,l);return Hc(i)}),BP=Symbol.for("effect/DifferHashSetPatch");function Dy(t){return t}const rp={...Ly.prototype,[BP]:{_Value:Dy,_Key:Dy,_Patch:Dy}},UP=Object.create(Object.assign(Object.create(rp),{_tag:"Empty"})),aN=()=>UP,jP=Object.assign(Object.create(rp),{_tag:"AndThen"}),zP=(t,e)=>{const n=Object.create(jP);return n.first=t,n.second=e,n},VP=Object.assign(Object.create(rp),{_tag:"Add"}),KP=t=>{const e=Object.create(VP);return e.value=t,e},QP=Object.assign(Object.create(rp),{_tag:"Remove"}),HP=t=>{const e=Object.create(QP);return e.value=t,e},JP=(t,e)=>{const[n,r]=Xh([t,aN()],([s,i],o)=>sP(o)(s)?[Iy(o)(s),i]:[s,Wy(KP(o))(i)])(e);return Xh(r,(s,i)=>Wy(HP(i))(s))(n)},Wy=w(2,(t,e)=>zP(t,e)),GP=w(2,(t,e)=>{if(t._tag==="Empty")return e;let n=e,r=Zn(t);for(;qs(r);){const s=ms(r),i=Os(r);switch(s._tag){case"Empty":{r=i;break}case"AndThen":{r=lr(s.first)(lr(s.second)(i));break}case"Add":{n=ol(s.value)(n),r=i;break}case"Remove":n=Iy(s.value)(n),r=i}}return n}),YP=Symbol.for("effect/DifferReadonlyArrayPatch");function cN(t){return t}const Sf={...Ly.prototype,[YP]:{_Value:cN,_Patch:cN}},XP=Object.create(Object.assign(Object.create(Sf),{_tag:"Empty"})),lN=()=>XP,ZP=Object.assign(Object.create(Sf),{_tag:"AndThen"}),e$=(t,e)=>{const n=Object.create(ZP);return n.first=t,n.second=e,n},t$=Object.assign(Object.create(Sf),{_tag:"Append"}),n$=t=>{const e=Object.create(t$);return e.values=t,e},r$=Object.assign(Object.create(Sf),{_tag:"Slice"}),s$=(t,e)=>{const n=Object.create(r$);return n.from=t,n.until=e,n},i$=Object.assign(Object.create(Sf),{_tag:"Update"}),o$=(t,e)=>{const n=Object.create(i$);return n.index=t,n.patch=e,n},a$=t=>{let e=0,n=lN();for(;e<t.oldValue.length&&e<t.newValue.length;){const r=t.oldValue[e],s=t.newValue[e],i=t.differ.diff(r,s);ot(i,t.differ.empty)||(n=sp(n,o$(e,i))),e=e+1}return e<t.oldValue.length&&(n=sp(n,s$(0,e))),e<t.newValue.length&&(n=sp(n,n$(oR(e)(t.newValue)))),n},sp=w(2,(t,e)=>e$(t,e)),c$=w(3,(t,e,n)=>{if(t._tag==="Empty")return e;let r=e.slice(),s=ks(t);for(;Uh(s);){const i=Lr(s),o=qa(s);switch(i._tag){case"Empty":{s=o;break}case"AndThen":{o.unshift(i.first,i.second),s=o;break}case"Append":{for(const l of i.values)r.push(l);s=o;break}case"Slice":{r=r.slice(i.from,i.until),s=o;break}case"Update":{r[i.index]=n.patch(i.patch,r[i.index]),s=o;break}}}return r}),l$={[Symbol.for("effect/Differ")]:{_P:Ke,_V:Ke}},ul=t=>{const e=Object.create(l$);return e.empty=t.empty,e.diff=t.diff,e.combine=t.combine,e.patch=t.patch,e},u$=()=>ul({empty:oN(),combine:(t,e)=>np(e)(t),diff:(t,e)=>DP(t,e),patch:(t,e)=>WP(e)(t)}),f$=()=>ul({empty:aN(),combine:(t,e)=>Wy(e)(t),diff:(t,e)=>JP(t,e),patch:(t,e)=>GP(e)(t)}),d$=t=>ul({empty:lN(),combine:(e,n)=>sp(e,n),diff:(e,n)=>a$({oldValue:e,newValue:n,differ:t}),patch:(e,n)=>c$(e,n,t)}),uN=()=>h$((t,e)=>e),h$=t=>ul({empty:Ke,combine:(e,n)=>e===Ke?n:n===Ke?e:r=>n(e(r)),diff:(e,n)=>ot(e,n)?Ke:ka(n),patch:(e,n)=>t(n,e(n))}),Ef=255,fN=8,By=t=>t&Ef,Uy=t=>t>>fN&Ef,vf=(t,e)=>(t&Ef)+((e&t&Ef)<<fN),dN=vf(0,0),p$=t=>vf(t,t),m$=t=>vf(t,0),g$=w(2,(t,e)=>vf(By(t)&~e,Uy(t))),_$=w(2,(t,e)=>t|e),y$=t=>~t>>>0&Ef,b$=0,$a=1,w$=2,hN=4,jy=16,pN=32,S$=t=>op(t,pN),E$=w(2,(t,e)=>t|e),Io=t=>ip(t)&&!N$(t),ip=t=>op(t,$a),op=w(2,(t,e)=>(t&e)!==0),mN=(...t)=>t.reduce((e,n)=>e|n,0),v$=mN(b$),gN=t=>op(t,hN),N$=t=>op(t,jy),$i=w(2,(t,e)=>vf(t^e,e)),La=w(2,(t,e)=>t&(y$(By(e))|Uy(e))|By(e)&Uy(e)),_N=ul({empty:dN,diff:(t,e)=>$i(t,e),combine:(t,e)=>_$(e)(t),patch:(t,e)=>La(e,t)}),k$=dN,yN=p$,bN=m$,wN=g$,x$={_tag:"Empty"},SN=(t,e)=>({_tag:"Par",left:t,right:e}),ap=(t,e)=>({_tag:"Seq",left:t,right:e}),EN=(t,e)=>({_tag:"Single",dataSource:t,blockedRequest:e}),q$=t=>{let e=Py(t),n=Pa();for(;;){const[r,s]=qP(e,[NN(),Pa()],([i,o],l)=>{const[f,m]=O$(l);return[$$(i,f),kP(o,m)]});if(n=I$(n,r),Pi(s))return OP(n);e=s}throw new Error("BUG: BlockedRequests.flatten - please report an issue at https://github.com/Effect-TS/effect/issues")},O$=t=>{let e=t,n=NN(),r=Pa(),s=Pa();for(;;)switch(e._tag){case"Empty":{if(Pi(r))return[n,s];e=r.head,r=r.tail;break}case"Par":{r=Ra(e.right,r),e=e.left;break}case"Seq":{const i=e.left,o=e.right;switch(i._tag){case"Empty":{e=o;break}case"Par":{const l=i.left,f=i.right;e=SN(ap(l,o),ap(f,o));break}case"Seq":{const l=i.left,f=i.right;e=ap(l,ap(f,o));break}case"Single":{e=i,s=Ra(o,s);break}}break}case"Single":{if(n=P$(n,e),Pi(r))return[n,s];e=r.head,r=r.tail;break}}throw new Error("BUG: BlockedRequests.step - please report an issue at https://github.com/Effect-TS/effect/issues")},I$=(t,e)=>{if(Pi(t))return Py(Vy(e));if(L$(e))return t;const n=j$(t.head),r=M$(e);return n.length===1&&r.length===1&&ot(n[0],r[0])?Ra(U$(t.head,Vy(e)),t.tail):Ra(Vy(e),t)},T$=Symbol.for("effect/RequestBlock/Entry");class A${constructor(e,n,r,s,i){g(this,"request");g(this,"result");g(this,"listeners");g(this,"ownerId");g(this,"state");g(this,Qte,C$);this.request=e,this.result=n,this.listeners=r,this.ownerId=s,this.state=i}}Qte=T$;const C$={_R:t=>t},vN=t=>new A$(t.request,t.result,t.listeners,t.ownerId,t.state),F$=Symbol.for("effect/RequestBlock/RequestBlockParallel"),R$={_R:t=>t};class zy{constructor(e){g(this,"map");g(this,Hte,R$);this.map=e}}Hte=F$;const NN=()=>new zy(ep()),P$=(t,e)=>new zy(_P(t.map,e.dataSource,n=>E2(df(n,jh(e.blockedRequest)),()=>Zn(e.blockedRequest)))),$$=(t,e)=>new zy(tN(t.map,e.map,(n,r,s)=>Oo(n,s,Nn(Zv(n,s),{onNone:()=>r,onSome:i=>Mr(r,i)})))),L$=t=>pP(t.map),M$=t=>Array.from(eN(t.map)),Vy=t=>B$(yP(t.map,e=>Zn(e))),D$=Symbol.for("effect/RequestBlock/RequestBlockSequential"),W$={_R:t=>t};class kN{constructor(e){g(this,"map");g(this,Jte,W$);this.map=e}}Jte=D$;const B$=t=>new kN(t),U$=(t,e)=>new kN(tN(e.map,t.map,(n,r,s)=>Oo(n,s,Nn(Zv(n,s),{onNone:()=>Jr(),onSome:i=>Mr(i,r)})))),j$=t=>Array.from(eN(t.map)),z$=t=>Array.from(t.map),fl="Die",dl="Empty",hl="Fail",pl="Interrupt",ml="Parallel",gl="Sequential",xN="effect/Cause",qN=Symbol.for(xN),V$={_E:t=>t},_l={[qN]:V$,[_t](){return I(Qe(xN),Ot(Qe(tL(this))),hn(this))},[yt](t){return ON(t)&&eL(this,t)},pipe(){return et(this,arguments)},toJSON(){switch(this._tag){case"Empty":return{_id:"Cause",_tag:this._tag};case"Die":return{_id:"Cause",_tag:this._tag,defect:gn(this.defect)};case"Interrupt":return{_id:"Cause",_tag:this._tag,fiberId:this.fiberId.toJSON()};case"Fail":return{_id:"Cause",_tag:this._tag,failure:gn(this.error)};case"Sequential":case"Parallel":return{_id:"Cause",_tag:this._tag,left:gn(this.left),right:gn(this.right)}}},toString(){return cp(this)},[Zt](){return this.toJSON()}},To=(()=>{const t=Object.create(_l);return t._tag=dl,t})(),Ma=t=>{const e=Object.create(_l);return e._tag=hl,e.error=t,e},Ir=t=>{const e=Object.create(_l);return e._tag=fl,e.defect=t,e},Ts=t=>{const e=Object.create(_l);return e._tag=pl,e.fiberId=t,e},gs=(t,e)=>{const n=Object.create(_l);return n._tag=ml,n.left=t,n.right=e,n},zn=(t,e)=>{const n=Object.create(_l);return n._tag=gl,n.left=t,n.right=e,n},ON=t=>it(t,qN),Ky=t=>t._tag===fl,K$=t=>t._tag===dl?!0:yl(t,!0,(e,n)=>{switch(n._tag){case dl:return de(e);case fl:case hl:case pl:return de(!1);default:return ce()}}),IN=t=>pt(H$(t)),Qy=t=>Jy(void 0,rL)(t),TN=t=>Ri(yl(t,Jr(),(e,n)=>n._tag===hl?de(I(e,lr(n.error))):ce())),AN=t=>Ri(yl(t,Jr(),(e,n)=>n._tag===fl?de(I(e,lr(n.defect))):ce())),CN=t=>yl(t,Ca(),(e,n)=>n._tag===pl?de(I(e,ol(n.fiberId))):ce()),Q$=t=>Nf(t,e=>e._tag===hl?de(e.error):ce()),Da=t=>{const e=Q$(t);switch(e._tag){case"None":return Mt(t);case"Some":return ut(e.value)}},H$=t=>Nf(t,e=>e._tag===pl?de(e.fiberId):ce()),J$=t=>kf(t,{onEmpty:ce(),onFail:()=>ce(),onDie:e=>de(Ir(e)),onInterrupt:()=>ce(),onSequential:(e,n)=>pt(e)&&pt(n)?de(zn(e.value,n.value)):pt(e)&&tn(n)?de(e.value):tn(e)&&pt(n)?de(n.value):ce(),onParallel:(e,n)=>pt(e)&&pt(n)?de(gs(e.value,n.value)):pt(e)&&tn(n)?de(e.value):tn(e)&&pt(n)?de(n.value):ce()}),G$=t=>kf(t,{onEmpty:ce(),onFail:e=>de(Ir(e)),onDie:e=>de(Ir(e)),onInterrupt:()=>ce(),onSequential:(e,n)=>pt(e)&&pt(n)?de(zn(e.value,n.value)):pt(e)&&tn(n)?de(e.value):tn(e)&&pt(n)?de(n.value):ce(),onParallel:(e,n)=>pt(e)&&pt(n)?de(gs(e.value,n.value)):pt(e)&&tn(n)?de(e.value):tn(e)&&pt(n)?de(n.value):ce()}),FN=t=>kf(t,{onEmpty:To,onFail:()=>To,onDie:e=>Ir(e),onInterrupt:e=>Ts(e),onSequential:zn,onParallel:gs}),Y$=t=>kf(t,{onEmpty:To,onFail:e=>Ir(e),onDie:e=>Ir(e),onInterrupt:e=>Ts(e),onSequential:(e,n)=>zn(e,n),onParallel:(e,n)=>gs(e,n)}),X$=w(2,(t,e)=>RN(t,n=>Ma(e(n)))),RN=w(2,(t,e)=>kf(t,{onEmpty:To,onFail:n=>e(n),onDie:n=>Ir(n),onInterrupt:n=>Ts(n),onSequential:(n,r)=>zn(n,r),onParallel:(n,r)=>gs(n,r)})),Z$=t=>RN(t,Ke),eL=(t,e)=>{let n=Zn(t),r=Zn(e);for(;qs(n)&&qs(r);){const[s,i]=I(ms(n),yl([Ca(),Jr()],([f,m],S)=>{const[N,O]=Hy(S);return de([I(f,yf(N)),I(m,Mr(O))])})),[o,l]=I(ms(r),yl([Ca(),Jr()],([f,m],S)=>{const[N,O]=Hy(S);return de([I(f,yf(N)),I(m,Mr(O))])}));if(!ot(s,o))return!1;n=i,r=l}return!0},tL=t=>nL(Zn(t),Jr()),nL=(t,e)=>{for(;;){const[n,r]=I(t,Oa([Ca(),Jr()],([i,o],l)=>{const[f,m]=Hy(l);return[I(i,yf(f)),I(o,Mr(m))]})),s=Oy(n)>0?I(e,lr(n)):e;if(my(r))return Ri(s);t=r,e=s}throw new Error(Eh("Cause.flattenCauseLoop"))},Nf=w(2,(t,e)=>{const n=[t];for(;n.length>0;){const r=n.pop(),s=e(r);switch(s._tag){case"None":{switch(r._tag){case gl:case ml:{n.push(r.right),n.push(r.left);break}}break}case"Some":return s}}return ce()}),Hy=t=>{let e=t;const n=[];let r=Ca(),s=Jr();for(;e!==void 0;)switch(e._tag){case dl:{if(n.length===0)return[r,s];e=n.pop();break}case hl:{if(r=ol(r,dy(e._tag,e.error)),n.length===0)return[r,s];e=n.pop();break}case fl:{if(r=ol(r,dy(e._tag,e.defect)),n.length===0)return[r,s];e=n.pop();break}case pl:{if(r=ol(r,dy(e._tag,e.fiberId)),n.length===0)return[r,s];e=n.pop();break}case gl:{switch(e.left._tag){case dl:{e=e.right;break}case gl:{e=zn(e.left.left,zn(e.left.right,e.right));break}case ml:{e=gs(zn(e.left.left,e.right),zn(e.left.right,e.right));break}default:{s=lr(s,e.right),e=e.left;break}}break}case ml:{n.push(e.right),e=e.left;break}}throw new Error(Eh("Cause.evaluateCauseLoop"))},rL={emptyCase:_h,failCase:Bc,dieCase:Bc,interruptCase:_h,sequentialCase:(t,e,n)=>e&&n,parallelCase:(t,e,n)=>e&&n},PN="SequentialCase",$N="ParallelCase",kf=w(2,(t,{onDie:e,onEmpty:n,onFail:r,onInterrupt:s,onParallel:i,onSequential:o})=>Jy(t,void 0,{emptyCase:()=>n,failCase:(l,f)=>r(f),dieCase:(l,f)=>e(f),interruptCase:(l,f)=>s(f),sequentialCase:(l,f,m)=>o(f,m),parallelCase:(l,f,m)=>i(f,m)})),yl=w(3,(t,e,n)=>{let r=e,s=t;const i=[];for(;s!==void 0;){const o=n(r,s);switch(r=pt(o)?o.value:r,s._tag){case gl:{i.push(s.right),s=s.left;break}case ml:{i.push(s.right),s=s.left;break}default:{s=void 0;break}}s===void 0&&i.length>0&&(s=i.pop())}return r}),Jy=w(3,(t,e,n)=>{const r=[t],s=[];for(;r.length>0;){const o=r.pop();switch(o._tag){case dl:{s.push(Mt(n.emptyCase(e)));break}case hl:{s.push(Mt(n.failCase(e,o.error)));break}case fl:{s.push(Mt(n.dieCase(e,o.defect)));break}case pl:{s.push(Mt(n.interruptCase(e,o.fiberId)));break}case gl:{r.push(o.right),r.push(o.left),s.push(ut({_tag:PN}));break}case ml:{r.push(o.right),r.push(o.left),s.push(ut({_tag:$N}));break}}}const i=[];for(;s.length>0;){const o=s.pop();switch(o._tag){case"Left":{switch(o.left._tag){case PN:{const l=i.pop(),f=i.pop(),m=n.sequentialCase(e,l,f);i.push(m);break}case $N:{const l=i.pop(),f=i.pop(),m=n.parallelCase(e,l,f);i.push(m);break}}break}case"Right":{i.push(o.right);break}}}if(i.length===0)throw new Error("BUG: Cause.reduceWithContext - please report an issue at https://github.com/Effect-TS/effect/issues");return i.pop()}),cp=(t,e)=>Qy(t)?"All fibers interrupted without errors.":DN(t).map(function(n){return(e==null?void 0:e.renderErrorCause)!==!0||n.cause===void 0?n.stack:`${n.stack} {
${LN(n.cause,"  ")}
}`}).join(`
`),LN=(t,e)=>{const n=t.stack.split(`
`);let r=`${e}[cause]: ${n[0]}`;for(let s=1,i=n.length;s<i;s++)r+=`
${e}${n[s]}`;return t.cause&&(r+=` {
${LN(t.cause,`${e}  `)}
${e}}`),r};class lp extends globalThis.Error{constructor(n){const r=typeof n=="object"&&n!==null,s=Error.stackTraceLimit;Error.stackTraceLimit=1;super(sL(n),r&&"cause"in n&&typeof n.cause<"u"?{cause:new lp(n.cause)}:void 0);g(this,"span");this.message===""&&(this.message="An error has occurred"),Error.stackTraceLimit=s,this.name=n instanceof Error?n.name:"Error",r&&(MN in n&&(this.span=n[MN]),Object.keys(n).forEach(i=>{i in this||(this[i]=n[i])})),this.stack=oL(`${this.name}: ${this.message}`,n instanceof Error&&n.stack?n.stack:"",this.span)}}const sL=t=>{if(typeof t=="string")return t;if(typeof t=="object"&&t!==null&&t instanceof Error)return t.message;try{if(it(t,"toString")&&Uc(t.toString)&&t.toString!==Object.prototype.toString&&t.toString!==globalThis.Array.prototype.toString)return t.toString()}catch{}return JSON.stringify(t)},iL=/\((.*)\)/,up=gt("effect/Tracer/spanToTrace",()=>new WeakMap),oL=(t,e,n)=>{const r=[t],s=e.startsWith(t)?e.slice(t.length).split(`
`):e.split(`
`);for(let i=1;i<s.length&&!s[i].includes("Generator.next");i++){if(s[i].includes("effect_internal_function")){r.pop();break}r.push(s[i].replace(/at .*effect_instruction_i.*\((.*)\)/,"at $1").replace(/EffectPrimitive\.\w+/,"<anonymous>"))}if(n){let i=n,o=0;for(;i&&i._tag==="Span"&&o<10;){const l=up.get(i);if(typeof l=="function"){const f=l();if(typeof f=="string"){const m=f.match(iL),S=m?m[1]:f.replace(/^at /,"");r.push(`    at ${i.name} (${S})`)}else r.push(`    at ${i.name}`)}else r.push(`    at ${i.name}`);i=qr(i.parent),o++}}return r.join(`
`)},MN=Symbol.for("effect/SpanAnnotation"),DN=t=>Jy(t,void 0,{emptyCase:()=>[],dieCase:(e,n)=>[new lp(n)],failCase:(e,n)=>[new lp(n)],interruptCase:()=>[],parallelCase:(e,n,r)=>[...n,...r],sequentialCase:(e,n,r)=>[...n,...r]}),xf="Pending",fp="Done",aL=Symbol.for("effect/Deferred"),cL={_E:t=>t,_A:t=>t},lL=t=>({_tag:xf,joiners:t}),WN=t=>({_tag:fp,effect:t});class bl{constructor(e){g(this,"self");g(this,"called",!1);this.self=e}next(e){return this.called?{value:e,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(e){return{value:e,done:!0}}throw(e){throw e}[Symbol.iterator](){return new bl(this.self)}}const Gy=Symbol.for("effect/EffectError"),uL=t=>it(t,Gy),fL=t=>({[Gy]:Gy,_tag:"EffectError",cause:t}),wl=(t,e)=>{const n=new Vn("Blocked");return n.effect_instruction_i0=t,n.effect_instruction_i1=e,n},BN=t=>{const e=new Vn("RunBlocked");return e.effect_instruction_i0=t,e},Wa=Symbol.for("effect/Effect");class dL{constructor(e,n){g(this,"patch");g(this,"op");g(this,"_op",X_);this.patch=e,this.op=n}}class Vn{constructor(e){g(this,"_op");g(this,"effect_instruction_i0");g(this,"effect_instruction_i1");g(this,"effect_instruction_i2");g(this,"trace");g(this,Gte,Vc);this._op=e}[(Gte=Wa,yt)](e){return this===e}[_t](){return hn(this,H_(this))}pipe(){return et(this,arguments)}toJSON(){return{_id:"Effect",_op:this._op,effect_instruction_i0:gn(this.effect_instruction_i0),effect_instruction_i1:gn(this.effect_instruction_i1),effect_instruction_i2:gn(this.effect_instruction_i2)}}toString(){return vn(this.toJSON())}[Zt](){return this.toJSON()}[Symbol.iterator](){return new bl(new nf(this))}}class UN{constructor(e){g(this,"_op");g(this,"effect_instruction_i0");g(this,"effect_instruction_i1");g(this,"effect_instruction_i2");g(this,"trace");g(this,Yte,Vc);this._op=e,this._tag=e}[(Yte=Wa,yt)](e){return lb(e)&&e._op==="Failure"&&ot(this.effect_instruction_i0,e.effect_instruction_i0)}[_t](){return I(Pn(this._tag),Ot(Qe(this.effect_instruction_i0)),hn(this))}get cause(){return this.effect_instruction_i0}pipe(){return et(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,cause:this.cause.toJSON()}}toString(){return vn(this.toJSON())}[Zt](){return this.toJSON()}[Symbol.iterator](){return new bl(new nf(this))}}class jN{constructor(e){g(this,"_op");g(this,"effect_instruction_i0");g(this,"effect_instruction_i1");g(this,"effect_instruction_i2");g(this,"trace");g(this,Xte,Vc);this._op=e,this._tag=e}[(Xte=Wa,yt)](e){return lb(e)&&e._op==="Success"&&ot(this.effect_instruction_i0,e.effect_instruction_i0)}[_t](){return I(Pn(this._tag),Ot(Qe(this.effect_instruction_i0)),hn(this))}get value(){return this.effect_instruction_i0}pipe(){return et(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,value:gn(this.value)}}toString(){return vn(this.toJSON())}[Zt](){return this.toJSON()}[Symbol.iterator](){return new bl(new nf(this))}}const rn=t=>it(t,Wa),It=t=>{const e=new Vn($E);return e.effect_instruction_i0=t,e},dp=w(3,(t,e,n)=>tr(r=>U(t,s=>U(fr(je(()=>r(e(s)))),i=>je(()=>n(s,i)).pipe(Ln({onFailure:o=>{switch(i._tag){case Gn:return At(gs(i.effect_instruction_i0,o));case Yn:return At(o)}},onSuccess:()=>i})))))),wn=w(2,(t,e)=>U(t,()=>se(e))),er=t=>wn(t,void 0),hp=function(){const t=new Vn(Y_);switch(arguments.length){case 2:{t.effect_instruction_i0=arguments[0],t.commit=arguments[1];break}case 3:{t.effect_instruction_i0=arguments[0],t.effect_instruction_i1=arguments[1],t.commit=arguments[2];break}case 4:{t.effect_instruction_i0=arguments[0],t.effect_instruction_i1=arguments[1],t.effect_instruction_i2=arguments[2],t.commit=arguments[3];break}default:throw new Error(Eh("you're not supposed to end up here"))}return t},zN=(t,e=qo)=>{const n=new Vn(af);let r;return n.effect_instruction_i0=s=>{r=t(s)},n.effect_instruction_i1=e,Mi(n,s=>rn(r)?r:ft)},ur=(t,e=qo)=>hp(t,function(){let n,r;function s(f){n?n(f):r===void 0&&(r=f)}const i=new Vn(af);i.effect_instruction_i0=f=>{n=f,r&&f(r)},i.effect_instruction_i1=e;let o,l;return this.effect_instruction_i0.length!==1?(l=new AbortController,o=Un(()=>this.effect_instruction_i0(s,l.signal))):o=Un(()=>this.effect_instruction_i0(s)),o||l?Mi(i,f=>(l&&l.abort(),o??ft)):i}),Ba=w(2,(t,e)=>{const n=new Vn(xh);return n.effect_instruction_i0=t,n.effect_instruction_i1=e,n}),Ao=w(2,(t,e)=>Tr(t,{onFailure:e,onSuccess:se})),Yy=w(3,(t,e,n)=>Ba(t,r=>{const s=Da(r);switch(s._tag){case"Left":return e(s.left)?n(s.left):At(r);case"Right":return At(s.right)}})),hL=w(2,(t,e)=>Ba(t,n=>{const r=Da(n);switch(r._tag){case"Left":return I(e(r.left),nn(()=>At(n)));case"Right":return At(r.right)}})),pL=t=>It((e,n)=>t(ip(n.runtimeFlags))),pp=Symbol.for("effect/SpanAnnotation"),VN=Symbol.for("effect/OriginalAnnotation"),Xy=(t,e)=>pt(e)?new Proxy(t,{has(n,r){return r===pp||r===VN||r in n},get(n,r){return r===pp?e.value:r===VN?t:n[r]}}):t,Ua=t=>So(t)&&!(pp in t)?It(e=>At(Ir(Xy(t,pb(e))))):At(Ir(t)),mp=t=>_p(()=>Ir(new ML(t))),gp=t=>U(he(t),Ua),ja=t=>Tr(t,{onFailure:e=>se(ut(e)),onSuccess:e=>se(Mt(e))}),fr=t=>Zy(t,{onFailure:Qt,onSuccess:pn}),vt=t=>So(t)&&!(pp in t)?It(e=>At(Ma(Xy(t,pb(e))))):At(Ma(t)),As=t=>U(he(t),vt),At=t=>{const e=new UN(Gn);return e.effect_instruction_i0=t,e},_p=t=>U(he(t),At),Sl=It(t=>se(t.id())),Li=t=>It(e=>t(e.id())),U=w(2,(t,e)=>{const n=new Vn(qh);return n.effect_instruction_i0=t,n.effect_instruction_i1=e,n}),za=w(2,(t,e)=>U(t,n=>{const r=typeof e=="function"?e(n):e;return rn(r)?r:CE(r)?ur(s=>{r.then(i=>s(se(i)),i=>s(vt(new Qa(i))))}):se(r)})),KN=t=>{const e=new Vn("OnStep");return e.effect_instruction_i0=t,e},ni=t=>U(t,Ke),qf=t=>Tr(t,{onFailure:se,onSuccess:vt}),Zy=w(2,(t,e)=>Ln(t,{onFailure:n=>se(e.onFailure(n)),onSuccess:n=>se(e.onSuccess(n))})),Ln=w(2,(t,e)=>{const n=new Vn(Oh);return n.effect_instruction_i0=t,n.effect_instruction_i1=e.onFailure,n.effect_instruction_i2=e.onSuccess,n}),Tr=w(2,(t,e)=>Ln(t,{onFailure:n=>{if(AN(n).length>0)return At(Y$(n));const s=TN(n);return s.length>0?e.onFailure(Iv(s)):At(n)},onSuccess:e.onSuccess})),Gr=w(2,(t,e)=>je(()=>{const n=bt(t),r=Wh(n.length);let s=0;return wn(Sp({while:()=>s<n.length,body:()=>e(n[s],s),step:i=>{r[s++]=i}}),r)})),Co=w(2,(t,e)=>je(()=>{const n=bt(t);let r=0;return Sp({while:()=>r<n.length,body:()=>e(n[r],r),step:()=>{r++}})})),QN=w(t=>typeof t[0]=="boolean"||rn(t[0]),(t,e)=>rn(t)?U(t,n=>n?e.onTrue():e.onFalse()):t?e.onTrue():e.onFalse()),ri=U(Sl,t=>yp(t)),yp=t=>At(Ts(t)),Va=t=>{const e=new Vn(xa);return e.effect_instruction_i0=yN($a),e.effect_instruction_i1=()=>t,e},mL=t=>hp(t,function(){const e=new Vn(xa);return e.effect_instruction_i0=yN($a),e.effect_instruction_i1=n=>ip(n)?Un(()=>this.effect_instruction_i0(Va)):Un(()=>this.effect_instruction_i0(Ro)),e}),El=w(2,(t,e)=>tr(n=>U(fr(n(t)),r=>gk(e,r)))),qe=w(2,(t,e)=>U(t,n=>he(()=>e(n)))),eb=w(2,(t,e)=>Tr(t,{onFailure:n=>As(()=>e.onFailure(n)),onSuccess:n=>he(()=>e.onSuccess(n))})),Of=w(2,(t,e)=>Ln(t,{onFailure:n=>{const r=Da(n);switch(r._tag){case"Left":return As(()=>e(r.left));case"Right":return At(r.right)}},onSuccess:se})),HN=w(2,(t,e)=>si(t,n=>pk(n)?ft:e(n.effect_instruction_i0))),si=w(2,(t,e)=>tr(n=>Ln(n(t),{onFailure:r=>{const s=Qt(r);return Ln(e(s),{onFailure:i=>Qt(zn(r,i)),onSuccess:()=>s})},onSuccess:r=>{const s=pn(r);return sn(e(s),s)}}))),Mi=w(2,(t,e)=>si(t,Ip({onFailure:n=>Qy(n)?er(e(CN(n))):ft,onSuccess:()=>ft}))),If=w(2,(t,e)=>_L(t,e,se)),bp=t=>JN(t,Ke),JN=w(2,(t,e)=>Tr(t,{onFailure:n=>Ua(e(n)),onSuccess:se})),gL=gR,tb=It((t,e)=>se(e.runtimeFlags)),se=t=>{const e=new jN(Yn);return e.effect_instruction_i0=t,e},je=t=>U(he(t),Ke),he=t=>{const e=new Vn(PE);return e.effect_instruction_i0=t,e},Fo=w(t=>t.length===3||t.length===2&&!(So(t[1])&&"onlyEffect"in t[1]),(t,e)=>U(t,n=>{const r=typeof e=="function"?e(n):e;return rn(r)?wn(r,n):CE(r)?ur(s=>{r.then(i=>s(se(n)),i=>s(vt(new Qa(i))))}):se(n)})),GN=t=>It(e=>{const n=e.getFiberRef(Np),r=I(n,nn(()=>e.scope()));return t(Sr(Np,de(r)))}),_L=w(3,(t,e,n)=>Ln(t,{onFailure:r=>AN(r).length>0?At(ev(G$(r))):e(),onSuccess:n})),Ro=t=>{const e=new Vn(xa);return e.effect_instruction_i0=bN($a),e.effect_instruction_i1=()=>t,e},tr=t=>hp(t,function(){const e=new Vn(xa);return e.effect_instruction_i0=bN($a),e.effect_instruction_i1=n=>ip(n)?Un(()=>this.effect_instruction_i0(Va)):Un(()=>this.effect_instruction_i0(Ro)),e}),ft=se(void 0),Tf=t=>{const e=new Vn(xa);return e.effect_instruction_i0=t,e.effect_instruction_i1=void 0,e},wp=w(2,(t,e)=>U(e,n=>n?I(t,qe(de)):se(ce()))),Sp=t=>{const e=new Vn(Ih);return e.effect_instruction_i0=t.while,e.effect_instruction_i1=t.body,e.effect_instruction_i2=t.step,e},yL=w(2,(t,e)=>Sr(t,rb,e)),bL=w(2,(t,e)=>Sr(t,rk,e)),YN=w(2,(t,e)=>{const n=new Vn(xa);return n.effect_instruction_i0=e,n.effect_instruction_i1=()=>t,n}),wL=w(2,(t,e)=>Sr(t,sb,e)),SL=w(2,(t,e)=>Sr(t,kp,e)),Ka=t=>{const e=new Vn(Th);return typeof(t==null?void 0:t.priority)<"u"?nk(e,t.priority):e},Ep=w(2,(t,e)=>U(t,n=>qe(e,r=>[n,r]))),Af=w(2,(t,e)=>U(t,n=>wn(e,n))),sn=w(2,(t,e)=>U(t,()=>e)),Cf=w(3,(t,e,n)=>U(t,r=>qe(e,s=>n(r,s)))),vp=ur(()=>{const t=setInterval(()=>{},2147483647);return he(()=>clearInterval(t))}),Ff=t=>U(Sl,e=>I(t,Di(e))),Di=w(2,(t,e)=>U(t.interruptAsFork(e),()=>t.await)),EL={_tag:"All",syslog:0,label:"ALL",ordinal:Number.MIN_SAFE_INTEGER,pipe(){return et(this,arguments)}},vL={_tag:"Fatal",syslog:2,label:"FATAL",ordinal:5e4,pipe(){return et(this,arguments)}},NL={_tag:"Error",syslog:3,label:"ERROR",ordinal:4e4,pipe(){return et(this,arguments)}},kL={_tag:"Warning",syslog:4,label:"WARN",ordinal:3e4,pipe(){return et(this,arguments)}},XN={_tag:"Info",syslog:6,label:"INFO",ordinal:2e4,pipe(){return et(this,arguments)}},ZN={_tag:"Debug",syslog:7,label:"DEBUG",ordinal:1e4,pipe(){return et(this,arguments)}},xL={_tag:"Trace",syslog:7,label:"TRACE",ordinal:0,pipe(){return et(this,arguments)}},qL={_tag:"None",syslog:7,label:"OFF",ordinal:Number.MAX_SAFE_INTEGER,pipe(){return et(this,arguments)}},OL=Symbol.for("effect/FiberRef"),IL={_A:t=>t},ii=t=>It(e=>pn(e.getFiberRef(t))),Cs=w(2,(t,e)=>U(ii(t),e)),Rf=w(2,(t,e)=>TL(t,()=>[void 0,e])),TL=w(2,(t,e)=>It(n=>{const[r,s]=e(n.getFiberRef(t));return n.setFiberRef(t,s),se(r)})),Sr=w(3,(t,e,n)=>dp(Af(ii(e),Rf(e,n)),()=>t,r=>Rf(e,r))),Yr=w(3,(t,e,n)=>Cs(e,r=>Sr(t,e,n(r)))),Mn=(t,e)=>vl(t,{differ:uN(),fork:(e==null?void 0:e.fork)??Ke,join:e==null?void 0:e.join}),AL=t=>{const e=f$();return vl(t,{differ:e,fork:e.empty})},CL=t=>{const e=d$(uN());return vl(t,{differ:e,fork:e.empty})},ek=t=>{const e=u$();return vl(t,{differ:e,fork:e.empty})},vl=(t,e)=>({...Kc,[OL]:IL,initial:t,commit(){return ii(this)},diff:(r,s)=>e.differ.diff(r,s),combine:(r,s)=>e.differ.combine(r,s),patch:r=>s=>e.differ.patch(r,s),fork:e.fork,join:e.join??((r,s)=>s)}),FL=t=>vl(t,{differ:_N,fork:_N.empty}),_s=gt(Symbol.for("effect/FiberRef/currentContext"),()=>ek(Ns())),Nl=gt(Symbol.for("effect/FiberRef/currentSchedulingPriority"),()=>Mn(0)),nb=gt(Symbol.for("effect/FiberRef/currentMaxOpsBeforeYield"),()=>Mn(2048)),Pf=gt(Symbol.for("effect/FiberRef/currentLogAnnotation"),()=>Mn(ep())),RL=gt(Symbol.for("effect/FiberRef/currentLogLevel"),()=>Mn(XN)),tk=gt(Symbol.for("effect/FiberRef/currentLogSpan"),()=>Mn(Pa())),nk=w(2,(t,e)=>Sr(t,Nl,e)),PL=w(2,(t,e)=>Sr(t,nb,e)),rb=gt(Symbol.for("effect/FiberRef/currentConcurrency"),()=>Mn("unbounded")),rk=gt(Symbol.for("effect/FiberRef/currentRequestBatching"),()=>Mn(!0)),sk=gt(Symbol.for("effect/FiberRef/currentUnhandledErrorLogLevel"),()=>Mn(de(ZN))),$L=w(2,(t,e)=>Sr(t,sk,e)),kl=gt(Symbol.for("effect/FiberRef/currentMetricLabels"),()=>CL(No())),LL=ii(kl),Np=gt(Symbol.for("effect/FiberRef/currentForkScopeOverride"),()=>Mn(ce(),{fork:()=>ce(),join:(t,e)=>t})),$f=gt(Symbol.for("effect/FiberRef/currentInterruptedCause"),()=>Mn(To,{fork:()=>To,join:(t,e)=>t})),sb=gt(Symbol.for("effect/FiberRef/currentTracerEnabled"),()=>Mn(!0)),kp=gt(Symbol.for("effect/FiberRef/currentTracerTiming"),()=>Mn(!0)),ib=gt(Symbol.for("effect/FiberRef/currentTracerSpanAnnotations"),()=>Mn(ep())),ob=gt(Symbol.for("effect/FiberRef/currentTracerSpanLinks"),()=>Mn(Jr())),ik=Symbol.for("effect/Scope"),ok=Symbol.for("effect/CloseableScope"),ak=(t,e)=>t.addFinalizer(()=>er(e)),xp=(t,e)=>t.addFinalizer(e),xl=(t,e)=>t.close(e),Lf=(t,e)=>t.fork(e),ab=function(){class t extends globalThis.Error{commit(){return vt(this)}toJSON(){return{...this}}[Zt](){return this.toString!==globalThis.Error.prototype.toString?this.stack?`${this.toString()}
${this.stack.split(`
`).slice(1).join(`
`)}`:this.toString():"Bun"in globalThis?cp(Ma(this),{renderErrorCause:!0}):this}}return Object.assign(t.prototype,QF),t}(),qp=(t,e)=>{class n extends ab{constructor(){super(...arguments);g(this,"_tag",e)}}return Object.assign(n.prototype,t),n.prototype.name=e,n},ck=Symbol.for("effect/Cause/errors/RuntimeException"),ML=qp({[ck]:ck},"RuntimeException"),DL=Symbol.for("effect/Cause/errors/InterruptedException"),WL=t=>it(t,DL),lk=Symbol.for("effect/Cause/errors/IllegalArgument"),uk=qp({[lk]:lk},"IllegalArgumentException"),cb=Symbol.for("effect/Cause/errors/NoSuchElement"),Po=qp({[cb]:cb},"NoSuchElementException"),BL=t=>it(t,cb),fk=Symbol.for("effect/Cause/errors/Timeout"),UL=qp({[fk]:fk},"TimeoutException"),jL=t=>new UL(`Operation timed out before the specified duration of '${av(t)}' elapsed`),dk=Symbol.for("effect/Cause/errors/UnknownException"),Qa=function(){class t extends ab{constructor(r,s){super(s??"An unknown error occurred",{cause:r});g(this,"cause");g(this,"_tag","UnknownException");g(this,"error");this.cause=r,this.error=r}}return Object.assign(t.prototype,{[dk]:dk,name:"UnknownException"}),t}(),lb=t=>rn(t)&&"_tag"in t&&(t._tag==="Success"||t._tag==="Failure"),hk=t=>t._tag==="Failure",pk=t=>t._tag==="Success",zL=w(2,(t,e)=>{switch(t._tag){case Gn:return Qt(t.effect_instruction_i0);case Yn:return pn(e)}}),ub=t=>zL(t,void 0),Ha=(t,e)=>JL(t,e!=null&&e.parallel?gs:zn),ql=t=>Qt(Ir(t)),fb=t=>Qt(Ma(t)),Qt=t=>{const e=new UN(Gn);return e.effect_instruction_i0=t,e},VL=w(2,(t,e)=>{switch(t._tag){case Gn:return Qt(t.effect_instruction_i0);case Yn:return e(t.effect_instruction_i0)}}),KL=t=>I(t,VL(Ke)),mk=t=>Qt(Ts(t)),Op=w(2,(t,e)=>{switch(t._tag){case Gn:return Qt(t.effect_instruction_i0);case Yn:return pn(e(t.effect_instruction_i0))}}),Ip=w(2,(t,{onFailure:e,onSuccess:n})=>{switch(t._tag){case Gn:return e(t.effect_instruction_i0);case Yn:return n(t.effect_instruction_i0)}}),Tp=w(2,(t,{onFailure:e,onSuccess:n})=>{switch(t._tag){case Gn:return e(t.effect_instruction_i0);case Yn:return n(t.effect_instruction_i0)}}),pn=t=>{const e=new jN(Yn);return e.effect_instruction_i0=t,e},Dr=pn(void 0),QL=w(2,(t,e)=>Mf(t,e,{onSuccess:(n,r)=>[n,r],onFailure:zn})),HL=w(2,(t,e)=>Mf(t,e,{onSuccess:(n,r)=>r,onFailure:zn})),Mf=w(3,(t,e,{onFailure:n,onSuccess:r})=>{switch(t._tag){case Gn:switch(e._tag){case Yn:return Qt(t.effect_instruction_i0);case Gn:return Qt(n(t.effect_instruction_i0,e.effect_instruction_i0))}case Yn:switch(e._tag){case Yn:return pn(r(t.effect_instruction_i0,e.effect_instruction_i0));case Gn:return Qt(e.effect_instruction_i0)}}}),JL=(t,e)=>{const n=Ia(t);return qs(n)?I(Os(n),Oa(I(ms(n),Op(Zn)),(r,s)=>I(r,Mf(s,{onSuccess:(i,o)=>I(i,lr(o)),onFailure:e}))),Op(Ri),Op(r=>ti(r)),de):ce()},Df=t=>({...Kc,[aL]:cL,state:al(lL([])),commit(){return Ar(this)},blockingOn:t}),oi=()=>U(Sl,t=>GL(t)),GL=t=>he(()=>Df(t)),Ar=t=>ur(e=>{const n=jn(t.state);switch(n._tag){case fp:return e(n.effect);case xf:return n.joiners.push(e),eM(t,e)}},t.blockingOn),YL=w(2,(t,e)=>El(e,t)),Wf=w(2,(t,e)=>he(()=>{const n=jn(t.state);switch(n._tag){case fp:return!1;case xf:{cl(t.state,WN(e));for(let r=0,s=n.joiners.length;r<s;r++)n.joiners[r](e);return!0}}})),gk=w(2,(t,e)=>Wf(t,e)),Ap=w(2,(t,e)=>Wf(t,At(e))),XL=t=>U(Sl,e=>Wf(t,yp(e))),_k=w(2,(t,e)=>Wf(t,yp(e))),ZL=t=>he(()=>jn(t.state)._tag===fp),Cp=w(2,(t,e)=>Wf(t,se(e))),Fp=(t,e)=>{const n=jn(t.state);if(n._tag===xf){cl(t.state,WN(e));for(let r=0,s=n.joiners.length;r<s;r++)n.joiners[r](e)}},eM=(t,e)=>he(()=>{const n=jn(t.state);if(n._tag===xf){const r=n.joiners.indexOf(e);r>=0&&n.joiners.splice(r,1)}}),tM=It(t=>pn(t.currentContext)),$o=()=>tM,Lo=t=>U($o(),t),Mo=w(2,(t,e)=>Sr(_s,e)(t)),db=w(2,(t,e)=>Yr(_s,n=>Jc(n,e))(t)),hb=w(2,(t,e)=>Lo(n=>Mo(t,e(n)))),pb=t=>{const e=t.currentSpan;return e!==void 0&&e._tag==="Span"?de(e):ce()},nM={_tag:"Span",spanId:"noop",traceId:"noop",name:"noop",sampled:!1,parent:ce(),context:Ns(),status:{_tag:"Ended",startTime:BigInt(0),endTime:BigInt(0),exit:Dr},attributes:new Map,links:[],kind:"internal",attribute(){},event(){},end(){}},rM=t=>{const e=Object.create(nM);return e.name=t,e},yk=Symbol.for("effect/Clock"),Wi=xr("effect/Clock"),sM=2**31-1,bk={unsafeSchedule(t,e){const n=Gc(e);if(n>sM)return Bc;let r=!1;const s=setTimeout(()=>{r=!0,t()},n);return()=>(clearTimeout(s),!r)}},wk=function(){const t=BigInt(1e6);if(typeof performance>"u")return()=>BigInt(Date.now())*t;if(typeof performance.timeOrigin=="number"&&performance.timeOrigin===0)return()=>BigInt(Math.round(performance.now()*1e6));const e=BigInt(Date.now())*t-BigInt(Math.round(performance.now()*1e6));return()=>e+BigInt(Math.round(performance.now()*1e6))}(),iM=function(){const t=typeof process=="object"&&"hrtime"in process&&typeof process.hrtime.bigint=="function"?process.hrtime:void 0;if(!t)return wk;const e=wk()-t.bigint();return()=>e+t.bigint()}();class oM{constructor(){g(this,Zte,yk);g(this,"currentTimeMillis",he(()=>this.unsafeCurrentTimeMillis()));g(this,"currentTimeNanos",he(()=>this.unsafeCurrentTimeNanos()))}unsafeCurrentTimeMillis(){return Date.now()}unsafeCurrentTimeNanos(){return iM()}scheduler(){return se(bk)}sleep(e){return ur(n=>{const r=bk.unsafeSchedule(()=>n(ft),e);return er(he(r))})}}Zte=yk;const aM=()=>new oM,Sk=t=>t+1,cM=t=>t-1,Ol=w2,lM=t=>{if(t==="NaN")return Qc(NaN);if(t==="Infinity")return Qc(1/0);if(t==="-Infinity")return Qc(-1/0);if(t.trim()==="")return Ch;const e=Number(t);return Number.isNaN(e)?Ch:Qc(e)},mb=t=>t.replace(/[/\\^$*+?.()|[\]{}]/g,"\\$&"),Ek="And",vk="Or",Nk="InvalidData",kk="MissingData",xk="SourceUnavailable",qk="Unsupported",Ok=Symbol.for("effect/ConfigError"),Il={_tag:"ConfigError",[Ok]:Ok},Ik=(t,e)=>{const n=Object.create(Il);return n._op=Ek,n.left=t,n.right=e,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} and ${this.right}`}}),n},Tk=(t,e)=>{const n=Object.create(Il);return n._op=vk,n.left=t,n.right=e,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} or ${this.right}`}}),n},uM=(t,e,n={pathDelim:"."})=>{const r=Object.create(Il);return r._op=Nk,r.path=t,r.message=e,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Invalid data at ${I(this.path,el(n.pathDelim))}: "${this.message}")`}}),r},Ja=(t,e,n={pathDelim:"."})=>{const r=Object.create(Il);return r._op=kk,r.path=t,r.message=e,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Missing data at ${I(this.path,el(n.pathDelim))}: "${this.message}")`}}),r},fM=(t,e,n,r={pathDelim:"."})=>{const s=Object.create(Il);return s._op=xk,s.path=t,s.message=e,s.cause=n,Object.defineProperty(s,"toString",{enumerable:!1,value(){return`(Source unavailable at ${I(this.path,el(r.pathDelim))}: "${this.message}")`}}),s},dM=(t,e,n={pathDelim:"."})=>{const r=Object.create(Il);return r._op=qk,r.path=t,r.message=e,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Unsupported operation at ${I(this.path,el(n.pathDelim))}: "${this.message}")`}}),r},Ga=w(2,(t,e)=>{switch(t._op){case Ek:return Ik(Ga(t.left,e),Ga(t.right,e));case vk:return Tk(Ga(t.left,e),Ga(t.right,e));case Nk:return uM([...e,...t.path],t.message);case kk:return Ja([...e,...t.path],t.message);case xk:return fM([...e,...t.path],t.message,t.cause);case qk:return dM([...e,...t.path],t.message)}}),hM={_tag:"Empty"},gb=w(2,(t,e)=>{let n=Py(e),r=t;for(;sN(n);){const s=n.head;switch(s._tag){case"Empty":{n=n.tail;break}case"AndThen":{n=Ra(s.first,Ra(s.second,n.tail));break}case"MapName":{r=xs(r,s.f),n=n.tail;break}case"Nested":{r=Bh(r,s.name),n=n.tail;break}case"Unnested":{if(I(hf(r),k2(s.name)))r=qa(r),n=n.tail;else return ut(Ja(r,`Expected ${s.name} to be in path in ConfigProvider#unnested`));break}}}return Mt(r)}),pM="Constant",mM="Fail",gM="Fallback",_M="Described",yM="Lazy",bM="MapOrFail",wM="Nested",SM="Primitive",EM="Sequence",vM="HashMap",NM="ZipWith";var Ak={};const Rp=(t,e)=>[...t,...e],Ck=Symbol.for("effect/ConfigProvider"),Pp=xr("effect/ConfigProvider"),Fk=Symbol.for("effect/ConfigProviderFlat"),kM=t=>({[Ck]:Ck,pipe(){return et(this,arguments)},...t}),xM=t=>({[Fk]:Fk,patch:t.patch,load:(e,n,r=!0)=>t.load(e,n,r),enumerateChildren:t.enumerateChildren}),qM=t=>kM({load:e=>U(ys(t,No(),e,!1),n=>Nn(hf(n),{onNone:()=>vt(Ja(No(),`Expected a single value having structure: ${e}`)),onSome:se})),flattened:t}),OM=t=>{const{pathDelim:e,seqDelim:n}=Object.assign({},{pathDelim:"_",seqDelim:","},t),r=f=>I(f,el(e)),s=f=>f.split(e),i=()=>typeof process<"u"&&"env"in process&&typeof Ak=="object"?Ak:{};return qM(xM({load:(f,m,S=!0)=>{const N=r(f),O=i(),M=N in O?de(O[N]):ce();return I(M,Of(()=>Ja(f,`Expected ${N} to exist in the process context`)),U(z=>FM(z,f,m,n,S)))},enumerateChildren:f=>he(()=>{const m=i(),O=Object.keys(m).map(M=>s(M.toUpperCase())).filter(M=>{for(let z=0;z<f.length;z++){const Z=I(f,dv(z)),J=M[z];if(J===void 0||Z!==J)return!1}return!0}).flatMap(M=>M.slice(f.length,f.length+1));return zv(O)}),patch:hM}))},IM=(t,e,n,r)=>{const s=Ev(n.length,f=>f>=r.length?ce():de([t(f),f+1])),i=Ev(r.length,f=>f>=n.length?ce():de([e(f),f+1])),o=Rp(n,s),l=Rp(r,i);return[o,l]},TM=(t,e)=>{let n=e;if(n._tag==="Nested"){const r=t.slice();for(;n._tag==="Nested";)r.push(n.name),n=n.config;return r}return t},ys=(t,e,n,r)=>{const s=n;switch(s._tag){case pM:return se(ks(s.value));case _M:return je(()=>ys(t,e,s.config,r));case mM:return vt(Ja(e,s.message));case gM:return I(je(()=>ys(t,e,s.first,r)),Ao(i=>s.condition(i)?I(ys(t,e,s.second,r),Ao(o=>vt(Tk(i,o)))):vt(i)));case yM:return je(()=>ys(t,e,s.config(),r));case bM:return je(()=>I(ys(t,e,s.original,r),U(Gr(i=>I(s.mapOrFail(i),Of(Ga(TM(e,s.original))))))));case wM:return je(()=>ys(t,Rp(e,ks(s.name)),s.config,r));case SM:return I(gb(e,t.patch),U(i=>I(t.load(i,s,r),U(o=>{if(o.length===0){const l=I(rR(i),nn(()=>"<n/a>"));return vt(Ja([],`Expected ${s.description} with name ${l}`))}return se(o)}))));case EM:return I(gb(e,t.patch),U(i=>I(t.enumerateChildren(i),U(PM),U(o=>o.length===0?je(()=>qe(ys(t,e,s.config,!0),ks)):I(Gr(o,l=>ys(t,Z2(e,`[${l}]`),s.config,!0)),qe(l=>{const f=Sv(l);return f.length===0?ks(No()):ks(f)}))))));case vM:return je(()=>I(gb(e,t.patch),U(i=>I(t.enumerateChildren(i),U(o=>I(o,Gr(l=>ys(t,Rp(i,ks(l)),s.valueConfig,r)),qe(l=>l.length===0?ks(ep()):I(RM(l),xs(f=>hP(mv(bt(o),f)))))))))));case NM:return je(()=>I(ys(t,e,s.left,r),ja,U(i=>I(ys(t,e,s.right,r),ja,U(o=>{if(Xn(i)&&Xn(o))return vt(Ik(i.left,o.left));if(Xn(i)&&Fi(o))return vt(i.left);if(Fi(i)&&Xn(o))return vt(o.left);if(Fi(i)&&Fi(o)){const l=I(e,el(".")),f=AM(e,l),[m,S]=IM(f,f,I(i.right,xs(Mt)),I(o.right,xs(Mt)));return I(m,mv(S),Gr(([N,O])=>I(Ep(N,O),qe(([M,z])=>s.zip(M,z)))))}throw new Error("BUG: ConfigProvider.fromFlatLoop - please report an issue at https://github.com/Effect-TS/effect/issues")})))))}},AM=(t,e)=>n=>ut(Ja(t,`The element at index ${n} in a sequence at path "${e}" was missing`)),CM=(t,e)=>t.split(new RegExp(`\\s*${mb(e)}\\s*`)),FM=(t,e,n,r,s)=>s?I(CM(t,r),Gr(i=>n.parse(i.trim())),Of(Ga(e))):I(n.parse(t),eb({onFailure:Ga(e),onSuccess:ks})),RM=t=>Object.keys(t[0]).map(e=>t.map(n=>n[e])),PM=t=>I(Gr(t,LM),eb({onFailure:()=>No(),onSuccess:pf(Ol)}),ja,qe(lv)),$M=/^(\[(\d+)\])$/,LM=t=>{const e=t.match($M);if(e!==null){const n=e[2];return I(n!==void 0&&n.length>0?de(n):ce(),$h(MM))}return ce()},MM=t=>{const e=Number.parseInt(t);return Number.isNaN(e)?ce():de(e)},Rk=Symbol.for("effect/Console"),Tl=xr("effect/Console"),DM={[Rk]:Rk,assert(t,...e){return he(()=>{console.assert(t,...e)})},clear:he(()=>{console.clear()}),count(t){return he(()=>{console.count(t)})},countReset(t){return he(()=>{console.countReset(t)})},debug(...t){return he(()=>{console.debug(...t)})},dir(t,e){return he(()=>{console.dir(t,e)})},dirxml(...t){return he(()=>{console.dirxml(...t)})},error(...t){return he(()=>{console.error(...t)})},group(t){return t!=null&&t.collapsed?he(()=>console.groupCollapsed(t==null?void 0:t.label)):he(()=>console.group(t==null?void 0:t.label))},groupEnd:he(()=>{console.groupEnd()}),info(...t){return he(()=>{console.info(...t)})},log(...t){return he(()=>{console.log(...t)})},table(t,e){return he(()=>{console.table(t,e)})},time(t){return he(()=>console.time(t))},timeEnd(t){return he(()=>console.timeEnd(t))},timeLog(t,...e){return he(()=>{console.timeLog(t,...e)})},trace(...t){return he(()=>{console.trace(...t)})},warn(...t){return he(()=>{console.warn(...t)})},unsafe:console},Pk=Symbol.for("effect/Random"),$p=xr("effect/Random");class WM{constructor(e){g(this,"seed");g(this,ene,Pk);g(this,"PRNG");this.seed=e,this.PRNG=new FF(e)}get next(){return he(()=>this.PRNG.number())}get nextBoolean(){return qe(this.next,e=>e>.5)}get nextInt(){return he(()=>this.PRNG.integer(Number.MAX_SAFE_INTEGER))}nextRange(e,n){return qe(this.next,r=>(n-e)*r+e)}nextIntBetween(e,n){return he(()=>this.PRNG.integer(n-e)+e)}shuffle(e){return BM(e,n=>this.nextIntBetween(0,n))}}ene=Pk;const BM=(t,e)=>je(()=>I(he(()=>Array.from(t)),U(n=>{const r=[];for(let s=n.length;s>=2;s=s-1)r.push(s);return I(r,Co(s=>I(e(s),qe(i=>UM(n,s-1,i)))),wn(Ia(n)))}))),UM=(t,e,n)=>{const r=t[e];return t[e]=t[n],t[n]=r,t},jM=t=>new WM(Qe(t)),$k=Symbol.for("effect/Tracer"),zM=t=>({[$k]:$k,...t}),Al=xr("effect/Tracer"),Do=xr("effect/ParentSpan"),Lk=function(){const t="abcdef0123456789",e=t.length;return function(n){let r="";for(let s=0;s<n;s++)r+=t.charAt(Math.floor(Math.random()*e));return r}}();class VM{constructor(e,n,r,s,i,o){g(this,"name");g(this,"parent");g(this,"context");g(this,"links");g(this,"startTime");g(this,"kind");g(this,"_tag","Span");g(this,"spanId");g(this,"traceId","native");g(this,"sampled",!0);g(this,"status");g(this,"attributes");g(this,"events",[]);this.name=e,this.parent=n,this.context=r,this.links=s,this.startTime=i,this.kind=o,this.status={_tag:"Started",startTime:i},this.attributes=new Map,this.traceId=n._tag==="Some"?n.value.traceId:Lk(32),this.spanId=Lk(16)}end(e,n){this.status={_tag:"Ended",endTime:e,exit:n,startTime:this.status.startTime}}attribute(e,n){this.attributes.set(e,n)}event(e,n,r){this.events.push([e,n,r??{}])}}const KM=zM({span:(t,e,n,r,s,i)=>new VM(t,e,n,r,s,i),context:t=>t()}),Ya=t=>{if((t==null?void 0:t.captureStackTrace)===!1)return t;if((t==null?void 0:t.captureStackTrace)!==void 0&&typeof t.captureStackTrace!="boolean")return t;const e=Error.stackTraceLimit;Error.stackTraceLimit=3;const n=new Error;Error.stackTraceLimit=e;let r=!1;return{...t,captureStackTrace:()=>{if(r!==!1)return r;if(n.stack!==void 0){const s=n.stack.split(`
`);if(s[3]!==void 0)return r=s[3].trim(),r}}}},QM=I(Ns(),zt(Wi,aM()),zt(Tl,DM),zt($p,jM(Math.random())),zt(Pp,OM()),zt(Al,KM)),Kn=gt(Symbol.for("effect/DefaultServices/currentServices"),()=>ek(QM)),HM=t=>{const e=Or(t);return Mp(n=>n.sleep(e))},Lp=t=>It(e=>t(e.currentDefaultServices)),Mp=t=>Lp(e=>t(e.unsafeMap.get(Wi.key))),JM=Mp(t=>t.currentTimeMillis),GM=Mp(t=>t.currentTimeNanos),YM=w(2,(t,e)=>Yr(Kn,zt(Wi,e))(t)),XM=w(2,(t,e)=>Yr(Kn,zt(Pp,e))(t)),ZM=t=>Lp(e=>t(e.unsafeMap.get(Pp.key))),Mk=t=>Lp(e=>t(e.unsafeMap.get($p.key))),eD=w(2,(t,e)=>Yr(Kn,zt($p,e))(t)),Dk=t=>Lp(e=>t(e.unsafeMap.get(Al.key))),tD=w(2,(t,e)=>Yr(Kn,zt(Al,e))(t)),nD=t=>!t,Bi=oi,Qn=Ar,rD=gk,sD=Ap,iD=XL,Wk=ZL,Wo=Cp,Bk=Df,oD=Fp,aD=cf,_b=Kc,cD=HF;class Bf extends cD{}const Uk="Sequential",jk="Parallel",lD="ParallelN",Cl={_tag:Uk},uD={_tag:jk},fD=t=>({_tag:lD,parallelism:t}),dD=t=>t._tag===Uk,hD=t=>t._tag===jk,yb=Cl,bb=uD,wb=fD;function pD(t){return new Bo(t)}function mD(){return pD(new Map)}const zk=Symbol.for("effect/FiberRefs");class Bo{constructor(e){g(this,"locals");g(this,tne,zk);this.locals=e}pipe(){return et(this,arguments)}}tne=zk;const gD=(t,e,n,r=!1)=>{const s=t;let i=e,o=n,l=r,f;for(;f===void 0;)if(xn(i)&&xn(o)){const m=Lr(i)[0],S=qa(i),N=Lr(o)[0],O=Lr(o)[1],M=qa(o);m.startTimeMillis<N.startTimeMillis?(o=M,l=!0):m.startTimeMillis>N.startTimeMillis?i=S:m.id<N.id?(o=M,l=!0):m.id>N.id?i=S:f=[O,l]}else f=[s.initial,!0];return f},Vk=w(3,(t,e,n)=>{const r=new Map(t.locals);return n.locals.forEach((s,i)=>{const o=s[0][1];if(!s[0][0][yt](e)){if(!r.has(i)){if(ot(o,i.initial))return;r.set(i,[[e,i.join(i.initial,o)]]);return}const l=r.get(i),[f,m]=gD(i,l,s);if(m){const S=i.diff(f,o),N=l[0][1],O=i.join(N,i.patch(S)(N));if(!ot(N,O)){let M;const z=l[0][0];z[yt](e)?M=[[z,O],...l.slice(1)]:M=[[e,O],...l],r.set(i,M)}}}}),new Bo(r)}),_D=w(2,(t,e)=>{const n=new Map;return Kk(t,n,e),new Bo(n)}),Kk=(t,e,n)=>{t.locals.forEach((r,s)=>{const i=r[0][1],o=s.patch(s.fork)(i);ot(i,o)?e.set(s,r):e.set(s,[[n,o],...r])})},yD=t=>zv(t.locals.keys()),bD=t=>Co(yD(t),e=>Rf(e,Fl(t,e))),Qk=w(2,(t,e)=>{const n=new Map(t.locals);return n.delete(e),new Bo(n)}),Hk=w(2,(t,e)=>t.locals.has(e)?de(Lr(t.locals.get(e))[1]):ce()),Fl=w(2,(t,e)=>I(Hk(t,e),nn(()=>e.initial))),Sb=w(2,(t,{fiberId:e,fiberRef:n,value:r})=>{if(t.locals.size===0)return new Bo(new Map([[n,[[e,r]]]]));const s=new Map(t.locals);return Eb(s,e,n,r),new Bo(s)}),Eb=(t,e,n,r)=>{const s=t.get(n)??[];let i;if(xn(s)){const[o,l]=Lr(s);if(o[yt](e)){if(ot(l,r))return;i=[[e,r],...s.slice(1)]}else i=[[e,r],...s]}else i=[[e,r]];t.set(n,i)},wD=w(2,(t,{entries:e,forkAs:n})=>{if(t.locals.size===0)return new Bo(new Map(e));const r=new Map(t.locals);return n!==void 0&&Kk(t,r,n),e.forEach(([s,i])=>{i.length===1?Eb(r,i[0][0],s,i[0][1]):i.forEach(([o,l])=>{Eb(r,o,s,l)})}),new Bo(r)}),Jk=Hk,SD=Fl,ED=Vk,vD=bD,ND=wD,kD=mD,Gk="Empty",Yk="Add",Xk="Remove",Zk="Update",ex="AndThen",xD={_tag:Gk},vb=(t,e)=>{const n=new Map(t.locals);let r=xD;for(const[s,i]of e.locals.entries()){const o=Lr(i)[1],l=n.get(s);if(l!==void 0){const f=Lr(l)[1];ot(f,o)||(r=Nb({_tag:Zk,fiberRef:s,patch:s.diff(f,o)})(r))}else r=Nb({_tag:Yk,fiberRef:s,value:o})(r);n.delete(s)}for(const[s]of n.entries())r=Nb({_tag:Xk,fiberRef:s})(r);return r},Nb=w(2,(t,e)=>({_tag:ex,first:t,second:e})),tx=w(3,(t,e,n)=>{let r=n,s=ks(t);for(;xn(s);){const i=Lr(s),o=qa(s);switch(i._tag){case Gk:{s=o;break}case Yk:{r=Sb(r,{fiberId:e,fiberRef:i.fiberRef,value:i.value}),s=o;break}case Xk:{r=Qk(r,i.fiberRef),s=o;break}case Zk:{const l=Fl(r,i.fiberRef);r=Sb(r,{fiberId:e,fiberRef:i.fiberRef,value:i.fiberRef.patch(i.patch)(l)}),s=o;break}case ex:{s=Bh(i.first)(Bh(i.second)(o));break}}}return r}),Uf=vb,jf=tx,Dp="effect/FiberStatus",Xa=Symbol.for(Dp),Wp="Done",nx="Running",rx="Suspended",qD=Pn(`${Dp}-${Wp}`);let OD=class{constructor(){g(this,nne,Xa);g(this,"_tag",Wp)}[(nne=Xa,_t)](){return qD}[yt](e){return kb(e)&&e._tag===Wp}};class ID{constructor(e){g(this,"runtimeFlags");g(this,rne,Xa);g(this,"_tag",nx);this.runtimeFlags=e}[(rne=Xa,_t)](){return I(Qe(Dp),Ot(Qe(this._tag)),Ot(Qe(this.runtimeFlags)),hn(this))}[yt](e){return kb(e)&&e._tag===nx&&this.runtimeFlags===e.runtimeFlags}}class TD{constructor(e,n){g(this,"runtimeFlags");g(this,"blockingOn");g(this,sne,Xa);g(this,"_tag",rx);this.runtimeFlags=e,this.blockingOn=n}[(sne=Xa,_t)](){return I(Qe(Dp),Ot(Qe(this._tag)),Ot(Qe(this.runtimeFlags)),Ot(Qe(this.blockingOn)),hn(this))}[yt](e){return kb(e)&&e._tag===rx&&this.runtimeFlags===e.runtimeFlags&&ot(this.blockingOn,e.blockingOn)}}const AD=new OD,CD=t=>new ID(t),FD=(t,e)=>new TD(t,e),kb=t=>it(t,Xa),RD=t=>t._tag===Wp,PD=AD,sx=CD,$D=FD,LD=RD,MD=EL,ix=vL,ox=NL,xb=kL,ax=XN,qb=ZN,Ob=xL,cx=qL,DD=S2(I(Ol,ZE(t=>t.ordinal))),WD=t=>{switch(t){case"All":return MD;case"Debug":return qb;case"Error":return ox;case"Fatal":return ix;case"Info":return ax;case"Trace":return Ob;case"None":return cx;case"Warning":return xb}},BD=Symbol.for("effect/Micro"),Bp=Symbol.for("effect/Micro/runSymbol"),lx={...aD,_op:"Micro",[BD]:{_A:Ke,_E:Ke,_R:Ke},[Symbol.iterator](){return new bl(new nf(this))}},ux=Symbol.for("effect/Micro/MicroCause"),UD={_E:Ke};class fx extends globalThis.Error{constructor(n,r,s){const i=`MicroCause.${n}`;let o,l,f;if(r instanceof globalThis.Error){o=`(${i}) ${r.name}`,l=r.message;const m=l.split(`
`).length;f=r.stack?`(${i}) ${r.stack.split(`
`).slice(0,m+3).join(`
`)}`:`${o}: ${l}`}else o=i,l=of(r,0),f=`${o}: ${l}`;s.length>0&&(f+=`
    ${s.join(`
    `)}`);super(l);g(this,"_tag");g(this,"traces");g(this,ine);this._tag=n,this.traces=s,this[ux]=UD,this.name=o,this.stack=f}pipe(){return et(this,arguments)}toString(){return this.stack}[(ine=ux,Zt)](){return this.stack}}class jD extends fx{constructor(n,r=[]){super("Die",n,r);g(this,"defect");this.defect=n}}const zD=(t,e=[])=>new jD(t,e);class VD extends fx{constructor(e=[]){super("Interrupt","interrupted",e)}}const KD=ut(((t=[])=>new VD(t))()),QD=t=>ut(zD(t)),HD={[Symbol.for("effect/Micro/Env")]:{_R:Ke},pipe(){return et(this,arguments)}},dx=t=>{const e=Object.create(HD);return e.refs=t,e},JD=()=>{const t=new AbortController,e=Object.create(null);return e[mx.key]=t,e[gx.key]=t.signal,e[yx.key]=new hx,dx(e)},Ib=w(2,(t,e)=>e.key in t.refs?t.refs[e.key]:e.initial),GD=w(3,(t,e,n)=>{const r=Object.assign(Object.create(null),t.refs);return r[e.key]=n,dx(r)}),YD=t=>sW((e,n)=>n(Mt(Ib(e,t)))),XD="setImmediate"in globalThis?globalThis.setImmediate:t=>setTimeout(t,0);class hx{constructor(){g(this,"tasks",[]);g(this,"running",!1);g(this,"afterScheduled",()=>{this.running=!1,this.runTasks()})}scheduleTask(e,n){this.tasks.push(e),this.running||(this.running=!0,XD(this.afterScheduled))}runTasks(){const e=this.tasks;this.tasks=[];for(let n=0,r=e.length;n<r;n++)e[n]()}shouldYield(e){return!1}flush(){for(;this.tasks.length>0;)this.runTasks()}}const px=Symbol.for("effect/Micro/EnvRef"),ZD={...lx,[px]:px,[Bp](t,e){YD(this)[Bp](t,e)}},Rl=(t,e)=>gt(t,()=>{const n=Object.create(ZD);return n.key=t,n.initial=e(),n}),mx=Rl("effect/Micro/currentAbortController",()=>{}),gx=Rl("effect/Micro/currentAbortSignal",()=>{}),eW=Rl("effect/Micro/currentContext",()=>Ns()),_x=Rl("effect/Micro/currentMaxDepthBeforeYield",()=>2048),tW=Rl("effect/Micro/currentInterruptible",()=>!0),yx=Rl("effect/Micro/currentScheduler",()=>new hx),Pl=gt("effect/Micro/microDepthState",()=>({depth:0,maxDepthBeforeYield:_x.initial})),nW=t=>{const e=Object.create(lx);return e[Bp]=t,e},rW=(t,e)=>nW(function n(r,s){if(r.refs[tW.key]!==!1&&r.refs[gx.key].aborted)return s(KD);Pl.depth++,Pl.depth===1&&(Pl.maxDepthBeforeYield=Ib(r,_x));const i=r.refs[yx.key];if(Pl.depth>=Pl.maxDepthBeforeYield||i.shouldYield(r))i.scheduleTask(()=>n(r,s),0);else try{t(r,s)}catch(o){s(QD(o))}Pl.depth--}),sW=t=>rW(t),Up=Symbol.for("effect/Readable"),bx=Symbol.for("effect/Ref"),wx={_A:t=>t};class iW extends Bf{constructor(n){super();g(this,"ref");g(this,one,wx);g(this,ane,Up);g(this,"get");this.ref=n,this.get=he(()=>jn(this.ref))}commit(){return this.get}modify(n){return he(()=>{const r=jn(this.ref),[s,i]=n(r);return r!==i&&cl(i)(this.ref),s})}}one=bx,ane=Up;const Sx=t=>new iW(al(t)),jp=t=>he(()=>Sx(t)),Ui=t=>t.get,$l=w(2,(t,e)=>t.modify(()=>[void 0,e])),oW=w(2,(t,e)=>t.modify(n=>[n,e])),Ex=w(2,(t,e)=>t.modify(e)),Tb=w(2,(t,e)=>t.modify(n=>[void 0,e(n)])),Ll=jp,zp=Ui,aW=oW,Ml=Ex,cW=$l,vx=Tb;class Nx{constructor(){g(this,"buckets",[])}scheduleTask(e,n){const r=this.buckets.length;let s,i=0;for(;i<r&&this.buckets[i][0]<=n;i++)s=this.buckets[i];s&&s[0]===n?s[1].push(e):i===r?this.buckets.push([n,[e]]):this.buckets.splice(i,0,[n,[e]])}}class lW{constructor(e){g(this,"maxNextTickBeforeTimer");g(this,"running",!1);g(this,"tasks",new Nx);this.maxNextTickBeforeTimer=e}starveInternal(e){const n=this.tasks.buckets;this.tasks.buckets=[];for(const[r,s]of n)for(let i=0;i<s.length;i++)s[i]();this.tasks.buckets.length===0?this.running=!1:this.starve(e)}starve(e=0){e>=this.maxNextTickBeforeTimer?setTimeout(()=>this.starveInternal(0),0):Promise.resolve(void 0).then(()=>this.starveInternal(e+1))}shouldYield(e){return e.currentOpCount>e.getFiberRef(nb)?e.getFiberRef(Nl):!1}scheduleTask(e,n){this.tasks.scheduleTask(e,n),this.running||(this.running=!0,this.starve())}}const kx=gt(Symbol.for("effect/Scheduler/defaultScheduler"),()=>new lW(2048));class uW{constructor(){g(this,"tasks",new Nx);g(this,"deferred",!1)}scheduleTask(e,n){this.deferred?kx.scheduleTask(e,n):this.tasks.scheduleTask(e,n)}shouldYield(e){return e.currentOpCount>e.getFiberRef(nb)?e.getFiberRef(Nl):!1}flush(){for(;this.tasks.buckets.length>0;){const e=this.tasks.buckets;this.tasks.buckets=[];for(const[n,r]of e)for(let s=0;s<r.length;s++)r[s]()}this.deferred=!0}}const Vp=gt(Symbol.for("effect/FiberRef/currentScheduler"),()=>Mn(kx)),fW=w(2,(t,e)=>Sr(t,Vp,e)),xx=gt(Symbol.for("effect/FiberRef/currentRequestMap"),()=>Mn(new Map)),qx=(t,e,n,r)=>{switch(t){case void 0:return e();case"unbounded":return n();case"inherit":return Cs(rb,s=>s==="unbounded"?n():s>1?r(s):e());default:return t>1?r(t):e()}},Kp=(t,e,n)=>{switch(t){case void 0:return e();case"unbounded":return n();case"inherit":return Cs(rb,r=>r==="unbounded"||r>1?n():e());default:return t>1?n():e()}},Ox=HM,Ix=JM,dW=GM,hW=Mp,pW=Wi,mW=(t,e)=>({label:t,startTime:e}),gW=t=>e=>`${e.label.replace(/[\s="]/g,"_")}=${t-e.startTime}ms`,_W=mW,yW=gW,bW=Dk,Tx="effect/MetricLabel",Ab=Symbol.for(Tx);class wW{constructor(e,n){g(this,"key");g(this,"value");g(this,cne,Ab);g(this,"_hash");this.key=e,this.value=n,this._hash=Pn(Tx+this.key+this.value)}[(cne=Ab,_t)](){return this._hash}[yt](e){return SW(e)&&this.key===e.key&&this.value===e.value}pipe(){return et(this,arguments)}}const Qp=(t,e)=>new wW(t,e),SW=t=>it(t,Ab),EW=w(t=>rn(t[0]),function(){const t=arguments;return Yr(t[0],Pf,typeof t[1]=="string"?Oo(t[1],t[2]):e=>Object.entries(t[1]).reduce((n,[r,s])=>Oo(n,r,s),e))}),Hp=t=>qe(t,de),vW=t=>Of(t,de),Ax=t=>{let e,n;return typeof t=="function"?e=t:(e=t.try,n=t.catch),he(()=>{try{return e()}catch(r){throw fL(Ma(n?n(r):new Qa(r)))}})},NW=w(3,(t,e,n)=>Ao(t,r=>it(r,e)&&r[e]===n.failure?n.onFailure(r):vt(r))),kW=w(2,(t,e)=>Ba(t,n=>{const r=Nf(n,s=>Ky(s)?de(s):ce());switch(r._tag){case"None":return At(n);case"Some":return e(r.value.defect)}})),xW=w(2,(t,e)=>Ln(t,{onFailure:n=>{const r=e(n);switch(r._tag){case"None":return At(n);case"Some":return r.value}},onSuccess:se})),qW=w(2,(t,e)=>Ba(t,n=>{const r=Nf(n,s=>Ky(s)?de(s):ce());switch(r._tag){case"None":return At(n);case"Some":{const s=e(r.value.defect);return s._tag==="Some"?s.value:At(n)}}})),OW=w(3,(t,e,n)=>Yy(t,Sh(e),n)),IW=w(2,(t,e)=>{let n;return Yy(t,r=>(n??(n=Object.keys(e)),it(r,"_tag")&&Hr(r._tag)&&n.includes(r._tag)),r=>e[r._tag](r))}),TW=t=>Zy(t,{onFailure:Ke,onSuccess:()=>To}),Za=hW,AW=Za(se),CW=w(2,(t,e)=>sn(Ox(e),t)),Cb=t=>It((e,n)=>t({id:e.id(),status:n,interruptors:CN(e.getFiberRef($f))})),FW=Cb(t=>Oy(t.interruptors)>0?ri:ft),RW=Cb(se),Fb=t=>em(t,Rb,vb),PW=t=>em(t,Ep(Rb,tb),([e,n],[r,s])=>[vb(e,r),$i(n,s)]),$W=se({}),LW=g2(qe,U),MW=m2(qe),DW=p2(qe),WW=w(2,(t,e)=>je(()=>{const n=t[Symbol.iterator](),r=[];let s,i=se(!1),o=0;for(;(s=n.next())&&!s.done;){const l=s.value,f=o++;i=U(i,m=>m?(r.push(l),se(!0)):e(l,f))}return qe(i,()=>r)})),BW=w(2,(t,e)=>je(()=>{const n=t[Symbol.iterator](),r=[];let s,i=se(!0),o=0;for(;(s=n.next())&&!s.done;){const l=s.value,f=o++;i=U(i,m=>qe(m?e(l,f):se(!1),S=>(S||r.push(l),S)))}return qe(i,()=>r)})),UW=t=>qe($o(),t),Cx=t=>If(t,()=>U(Ka(),()=>Cx(t))),jW=w(2,(t,e)=>qe(Gr(t,Ke),Zc(e))),zW=w(3,(t,e,n)=>Jp(t,e,r=>gp(()=>n(r)))),VW=w(3,(t,e,n)=>Jp(t,e,()=>mp(n))),Jp=w(3,(t,e,n)=>U(t,r=>e(r)?se(r):n(r))),KW=w(3,(t,e,n)=>je(()=>e(t)?se(t):vt(n(t)))),QW=w(t=>rn(t[0]),(t,e,n)=>Jp(t,e,r=>n===void 0?vt(new Po):As(()=>n(r)))),HW=w(2,(t,e)=>je(()=>{const n=t[Symbol.iterator](),r=n.next();return r.done?se(ce()):Fx(n,0,e,r.value)})),Fx=(t,e,n,r)=>U(n(r,e),s=>{if(s)return se(de(r));const i=t.next();return i.done?se(ce()):Fx(t,e+1,n,i.value)}),JW=t=>je(()=>{const e=Ia(t);return qs(e)?I(Os(e),Oa(ms(e),(n,r)=>If(n,()=>r))):gp(()=>new uk("Received an empty collection of effects"))}),GW=w(2,(t,e)=>qf(e(qf(t)))),Gp=w(2,(t,e)=>Tr(t,{onFailure:n=>se(e.onFailure(n)),onSuccess:n=>se(e.onSuccess(n))})),YW=w(2,(t,e)=>je(()=>Rx(t[Symbol.iterator](),0,e))),Rx=(t,e,n)=>{const r=t.next();return r.done?se(!0):U(n(r.value,e),s=>s?Rx(t,e+1,n):se(s))},XW=t=>{const e=U(U(t,()=>Ka()),()=>e);return e},ZW=function(){let t;return arguments.length===1?t=arguments[0]:t=arguments[1].bind(arguments[0]),je(()=>{const e=t(I),n=Un(()=>e.next()),r=s=>s.done?se(s.value):U(PF(s.value),i=>r(Un(()=>e.next(i))));return r(n)})},Rb=It(t=>se(t.getFiberRefs())),eB=t=>U(t,e=>{const r=e[Symbol.iterator]().next();return r.done?vt(new Po):se(r.value)}),Px=t=>Gp(t,{onFailure:bo,onSuccess:bo}),tB=t=>Ln(t,{onFailure:e=>Lx(e,"An error was silently ignored because it is not anticipated to be useful"),onSuccess:()=>ft}),nB=t=>$b((e,n)=>ED(n,e,t)),rB=t=>Gp(t,{onFailure:_h,onSuccess:Bc}),sB=t=>Gp(t,{onFailure:Bc,onSuccess:_h}),$x=(t,e)=>je(()=>e.while(t)?U(e.body(t),n=>$x(n,e)):se(t)),Uo=t=>(...e)=>{const n=ff(t);let r;for(let s=0,i=e.length;s<i;s++){const o=e[s];ON(o)&&(r!==void 0?r=zn(r,o):r=o,e=[...e.slice(0,s),...e.slice(s+1)],s--)}return r===void 0&&(r=To),It(s=>(s.log(e,r,n),ft))},iB=Uo(),oB=Uo(Ob),Lx=Uo(qb),aB=Uo(ax),cB=Uo(xb),lB=Uo(ox),uB=Uo(ix),fB=w(2,(t,e)=>U(Ix,n=>Yr(t,tk,$y(_W(e,n))))),dB=ii(Pf),hB=(t,e)=>e.discard?Dx(t,e.while,e.step,e.body):qe(Mx(t,e.while,e.step,e.body),bt),Mx=(t,e,n,r)=>je(()=>e(t)?U(r(t),s=>qe(Mx(n(t),e,n,r),$y(s))):he(()=>Pa())),Dx=(t,e,n,r)=>je(()=>e(t)?U(r(t),()=>Dx(n(t),e,n,r)):ft),pB=w(3,(t,e,n)=>je(()=>{const r=t[Symbol.iterator](),s=[];let i=se(e),o,l=0;for(;!(o=r.next()).done;){const f=l++,m=o.value;i=U(i,S=>qe(n(S,m,f),([N,O])=>(s.push(O),N)))}return qe(i,f=>[f,s])})),Yp=w(2,(t,e)=>Ln(t,{onFailure:n=>_p(()=>e(n)),onSuccess:se})),Wx=t=>I(oi(),U(e=>I(PW(t),El(e),Ux,qe(n=>sn(n,I(Ar(e),U(([r,s])=>wn(Ep(Xp(r[0]),Tf(r[1])),s)))))))),mB=t=>Tr(t,{onFailure:e=>se(e),onSuccess:se}),Bx=t=>qe(t,e=>!e),gB=t=>U(t,e=>{switch(e._tag){case"None":return ft;case"Some":return vt(new Po)}}),Ux=t=>qe(Ll(!0),e=>er(wp(t,aW(e,!1)))),_B=t=>Tr(t,{onFailure:()=>se(ce()),onSuccess:e=>se(de(e))}),yB=w(2,(t,e)=>If(t,()=>As(e))),bB=w(2,(t,e)=>If(t,()=>he(e))),wB=t=>Ln(t,{onFailure:e=>{const n=bt(TN(e));return n.length===0?At(e):vt(n)},onSuccess:se}),Xp=t=>$b((e,n)=>I(t,tx(e,n))),SB=t=>t.length>=1?ur((e,n)=>{try{t(n).then(r=>e(pn(r)),r=>e(ql(r)))}catch(r){e(ql(r))}}):ur(e=>{try{t().then(n=>e(pn(n)),n=>e(ql(n)))}catch(n){e(ql(n))}}),Zp=w(3,(t,e,n)=>Lo(r=>Mo(t,zt(r,e,n)))),EB=w(3,(t,e,n)=>Lo(r=>U(n,s=>Mo(t,I(r,zt(e,s)))))),vB=Mk(se),NB=w(3,(t,e,n)=>bt(t).reduce((r,s,i)=>U(r,o=>n(o,s,i)),se(e))),kB=w(3,(t,e,n)=>bt(t).reduceRight((r,s,i)=>U(r,o=>n(s,o,i)),se(e))),xB=w(3,(t,e,n)=>U(he(()=>t[Symbol.iterator]()),r=>jx(r,0,e,n.while,n.body))),jx=(t,e,n,r,s)=>{const i=t.next();return!i.done&&r(n)?U(s(n,i.value,e),o=>jx(t,e+1,o,r,s)):se(n)},qB=w(2,(t,e)=>je(()=>zx(t,e))),zx=(t,e)=>U(t,n=>e<=0?se(n):sn(Ka(),zx(t,e-1))),OB=t=>Ln(t,{onFailure:vt,onSuccess:se}),IB=t=>je(()=>vD(t)),Pb=Ox,zf=se(ce()),TB=t=>se(de(t)),em=w(3,(t,e,n)=>U(e,r=>U(t,s=>qe(e,i=>[n(r,i),s])))),AB=w(t=>rn(t[0]),function(){return Vx(arguments[0],typeof arguments[1]=="string"?[Qp(arguments[1],arguments[2])]:Object.entries(arguments[1]).map(([t,e])=>Qp(t,e)))}),Vx=w(2,(t,e)=>Yr(t,kl,n=>Xc(n,e))),CB=w(2,(t,e)=>je(()=>{const n=t[Symbol.iterator](),r=[];let s,i=se(!1),o=0;for(;(s=n.next())&&!s.done;){const l=s.value,f=o++;i=U(i,m=>m?se(!0):(r.push(l),e(l,f)))}return qe(i,()=>r)})),FB=w(2,(t,e)=>je(()=>{const n=t[Symbol.iterator](),r=[];let s,i=se(!0),o=0;for(;(s=n.next())&&!s.done;){const l=s.value,f=o++;i=U(i,m=>I(m?e(l,f):se(!1),qe(S=>(S&&r.push(l),S))))}return qe(i,()=>r)})),RB=w(2,(t,{onFailure:e,onSuccess:n})=>Ln(t,{onFailure:r=>{const s=Da(r);switch(s._tag){case"Left":return sn(e(s.left),At(r));case"Right":return At(r)}},onSuccess:r=>wn(n(r),r)})),PB=w(2,(t,e)=>Ba(t,n=>Nn(J$(n),{onNone:()=>At(n),onSome:r=>sn(e(r),At(n))}))),Kx=w(2,(t,e)=>Ln(t,{onFailure:n=>{const r=Da(n);switch(r._tag){case"Left":return sn(e(r.left),At(n));case"Right":return At(n)}},onSuccess:se})),$B=w(3,(t,e,n)=>Kx(t,r=>Sh(r,e)?n(r):ft)),LB=w(2,(t,e)=>Ln(t,{onFailure:n=>sn(e(n),At(n)),onSuccess:se})),MB=t=>Qx(t,dW),Qx=w(2,(t,e)=>em(t,e,(n,r)=>Mh(r-n))),DB=bW(se),Hx=t=>{let e,n;return typeof t=="function"?e=t:(e=t.try,n=t.catch),e.length>=1?ur((r,s)=>{try{e(s).then(i=>r(pn(i)),i=>r(n?As(()=>n(i)):vt(new Qa(i))))}catch(i){r(n?As(()=>n(i)):vt(new Qa(i)))}}):ur(r=>{try{e().then(s=>r(pn(s)),s=>r(n?As(()=>n(s)):vt(new Qa(s))))}catch(s){r(n?As(()=>n(s)):vt(new Qa(s)))}})},WB=w(2,(t,e)=>U(t,n=>Ax({try:()=>e.try(n),catch:e.catch}))),BB=w(2,(t,e)=>U(t,n=>Hx({try:e.try.length>=1?r=>e.try(n,r):()=>e.try(n),catch:e.catch}))),UB=w(2,(t,e)=>je(()=>e()?zf:Hp(t))),jB=w(2,(t,e)=>U(e,n=>n?zf:Hp(t))),zB=t=>Yp(t,Z$),$b=t=>It(e=>(e.setFiberRefs(t(e.id(),e.getFiberRefs())),ft)),VB=w(3,(t,e,n)=>hb(t,r=>zt(r,e,n(uf(r,e))))),Jx=w(2,(t,e)=>je(()=>e()?qe(t,de):se(ce()))),KB=w(3,(t,e,n)=>U(ii(e),r=>n(r)?qe(t,s=>[r,de(s)]):se([r,ce()]))),QB=w(3,(t,e,n)=>U(zp(e),r=>n(r)?qe(t,s=>[r,de(s)]):se([r,ce()]))),HB=w(2,(t,e)=>e(t)),JB=(t,e)=>(...n)=>U(t,r=>e(r)(...n)),GB=(t,e)=>(...n)=>qe(t,r=>e(r)(...n)),Gx=t=>new Proxy({},{get(e,n,r){return(...s)=>U(t,i=>i[n](...s))}}),Yx=t=>new Proxy({},{get(e,n,r){return U(t,s=>rn(s[n])?s[n]:se(s[n]))}}),YB=t=>({functions:Gx(t),constants:Yx(t)}),XB=t=>qe($o(),vo(t)),Xx=t=>U($o(),vo(t)),ZB=function(){const t=arguments;return Px(U(Zx,e=>he(()=>{if(typeof t[0]=="string")e.attribute(t[0],t[1]);else for(const n in t[0])e.attribute(n,t[0][n])})))},e4=w(t=>rn(t[0]),function(){const t=arguments;return Yr(t[0],ib,typeof t[1]=="string"?Oo(t[1],t[2]):e=>Object.entries(t[1]).reduce((n,[r,s])=>Oo(n,r,s),e))}),t4=Xx(Do),Zx=U($o(),t=>{const e=t.unsafeMap.get(Do.key);return e!==void 0&&e._tag==="Span"?se(e):vt(new Po)}),n4=w(t=>rn(t[0]),(t,e,n)=>Yr(t,ob,jh({_tag:"SpanLink",span:e,attributes:n??{}}))),e3=BigInt(0),Lb=(t,e,n)=>{if(t.getFiberRef(sb)===!1)return rM(e);const s=t.getFiberRef(_s),i=t.getFiberRef(Kn),o=Eo(i,Al),l=Eo(i,pW),f=t.getFiberRef(kp),m=t.getFiberRefs(),S=Jk(m,ib),N=Jk(m,ob),O=n.parent?de(n.parent):n.root?ce():vo(s,Do),M=N._tag==="Some"?n.links!==void 0?[...ti(N.value),...n.links??[]]:ti(N.value):n.links??No(),z=o.span(e,O,n.context??Ns(),M,f?l.unsafeCurrentTimeNanos():e3,n.kind??"internal");return typeof n.captureStackTrace=="function"&&up.set(z,n.captureStackTrace),S._tag==="Some"&&bP(S.value,(Z,J)=>z.attribute(J,Z)),n.attributes!==void 0&&Object.entries(n.attributes).forEach(([Z,J])=>z.attribute(Z,J)),z},r4=(t,e)=>(e=Ya(e),It(n=>se(Lb(n,t,e)))),s4=ii(ib),i4=ii(ob),t3=(t,e,n,r)=>he(()=>{t.status._tag!=="Ended"&&(hk(e)&&up.has(t)&&t.attribute("code.stacktrace",up.get(t)()),t.end(r?n.unsafeCurrentTimeNanos():e3,e))}),Mb=(t,...e)=>{const n=Ya(e.length===1?void 0:e[0]),r=e[e.length-1];return It(s=>{const i=Lb(s,t,n),o=s.getFiberRef(kp),l=Eo(s.getFiberRef(Kn),Wi);return si(r(i),f=>t3(i,f,l,o))})},Db=w(2,(t,e)=>Zp(t,Do,e)),n3=function(){const t=typeof arguments[0]!="string",e=t?arguments[1]:arguments[0],n=Ya(t?arguments[2]:arguments[1]);if(t){const r=arguments[0];return Mb(e,n,s=>Db(r,s))}return r=>Mb(e,n,s=>Db(r,s))},o4=t=>function(){let e=t.captureStackTrace??!1;if(t.captureStackTrace!==!1){const n=Error.stackTraceLimit;Error.stackTraceLimit=2;const r=new Error;Error.stackTraceLimit=n;let s=!1;e=()=>{if(s!==!1)return s;if(r.stack)return s=r.stack.trim().split(`
`).slice(2).join(`
`).trim(),s}}return je(()=>{const n=typeof t.options=="function"?t.options.apply(null,arguments):t.options;return n3(je(()=>Un(()=>t.body.apply(this,arguments))),n.name,{...n,captureStackTrace:e})})},a4=t=>t==null?vt(new Po):se(t),c4=t=>Ao(qe(t,de),e=>BL(e)?zf:vt(e)),r3=hk,l4=Ha,u4=ql,f4=fb,Fs=Qt,d4=KL,h4=Op,ji=Ip,Rs=pn,Wb=Dr,s3=QL,Vf=HL,Bb="InterruptSignal",Ub="Stateful",jb="Resume",zb="YieldNow",Vb=t=>({_tag:Bb,cause:t}),tm=t=>({_tag:Ub,onFiber:t}),Dl=t=>({_tag:jb,effect:t}),p4=()=>({_tag:zb}),nm=Symbol.for("effect/FiberScope");class m4{constructor(){g(this,lne,nm);g(this,"fiberId",qo);g(this,"roots",new Set)}add(e,n){this.roots.add(n),n.addObserver(()=>{this.roots.delete(n)})}}lne=nm;class g4{constructor(e,n){g(this,"fiberId");g(this,"parent");g(this,une,nm);this.fiberId=e,this.parent=n}add(e,n){this.parent.tell(tm(r=>{r.addChild(n),n.addObserver(()=>{r.removeChild(n)})}))}}une=nm;const _4=t=>new g4(t.id(),t),Kf=gt(Symbol.for("effect/FiberScope/Global"),()=>new m4),Kb=Symbol.for("effect/Fiber"),Qb={_E:t=>t,_A:t=>t},y4={[Kb]:Qb,pipe(){return et(this,arguments)}},b4=Symbol.for("effect/Fiber"),Hb=t=>t.await,w4=t=>t.inheritAll,S4=w(2,(t,e)=>t.interruptAsFork(e)),ai=t=>Af(ni(t.await),t.inheritAll);({...Kc,...y4});const ec="effect/FiberCurrent",E4=Symbol.for("effect/Logger"),v4={_Message:t=>t,_Output:t=>t},rm=t=>({[E4]:v4,log:t,pipe(){return et(this,arguments)}}),N4=rm(({annotations:t,cause:e,date:n,fiberId:r,logLevel:s,message:i,spans:o})=>{const l=n.getTime();let m=[`timestamp=${n.toISOString()}`,`level=${s.label}`,`fiber=${Gv(r)}`].join(" ");const S=Y2(i);for(let N=0;N<S.length;N++){const O=of(S[N]);O.length>0&&(m=m+" message=",m=Jb(O,m))}if(e!=null&&e._tag!=="Empty"&&(m=m+" cause=",m=Jb(cp(e,{renderErrorCause:!0}),m)),sN(o)){m=m+" ";let N=!0;for(const O of o)N?N=!1:m=m+" ",m=m+I(O,yW(l))}if(mP(t)>0){m=m+" ";let N=!0;for(const[O,M]of t)N?N=!1:m=m+" ",m=m+q4(O),m=m+"=",m=Jb(of(M),m)}return m}),k4=t=>`"${t.replace(/\\([\s\S])|(")/g,"\\$1$2")}"`,x4=/^[^\s"=]+$/,Jb=(t,e)=>e+(t.match(x4)?t:k4(t)),q4=t=>t.replace(/[\s="]/g,"_");typeof process=="object"&&process!==null&&typeof process.stdout=="object"&&process.stdout!==null&&process.stdout.isTTY;const i3="effect/MetricBoundaries",Gb=Symbol.for(i3);class O4{constructor(e){g(this,"values");g(this,fne,Gb);g(this,"_hash");this.values=e,this._hash=I(Pn(i3),Ot(rf(this.values)))}[(fne=Gb,_t)](){return this._hash}[yt](e){return I4(e)&&ot(this.values,e.values)}pipe(){return et(this,arguments)}}const I4=t=>it(t,Gb),T4=t=>{const e=I(t,oy(Zn(Number.POSITIVE_INFINITY)),vv);return new O4(e)},A4=t=>I(G2(t.count-1,e=>t.start*Math.pow(t.factor,e)),tl,T4),o3=Symbol.for("effect/MetricKeyType"),a3="effect/MetricKeyType/Counter",Yb=Symbol.for(a3),C4=Symbol.for("effect/MetricKeyType/Frequency"),F4=Symbol.for("effect/MetricKeyType/Gauge"),c3="effect/MetricKeyType/Histogram",Xb=Symbol.for(c3),R4=Symbol.for("effect/MetricKeyType/Summary"),l3={_In:t=>t,_Out:t=>t};class P4{constructor(e,n){g(this,"incremental");g(this,"bigint");g(this,dne,l3);g(this,hne,Yb);g(this,"_hash");this.incremental=e,this.bigint=n,this._hash=Pn(a3)}[(dne=o3,hne=Yb,_t)](){return this._hash}[yt](e){return u3(e)}pipe(){return et(this,arguments)}}class $4{constructor(e){g(this,"boundaries");g(this,pne,l3);g(this,mne,Xb);g(this,"_hash");this.boundaries=e,this._hash=I(Pn(c3),Ot(Qe(this.boundaries)))}[(pne=o3,mne=Xb,_t)](){return this._hash}[yt](e){return f3(e)&&ot(this.boundaries,e.boundaries)}pipe(){return et(this,arguments)}}const L4=t=>new P4((t==null?void 0:t.incremental)??!1,(t==null?void 0:t.bigint)??!1),M4=t=>new $4(t),u3=t=>it(t,Yb),D4=t=>it(t,C4),W4=t=>it(t,F4),f3=t=>it(t,Xb),B4=t=>it(t,R4),d3=Symbol.for("effect/MetricKey"),U4={_Type:t=>t},j4=uy(ot);class Zb{constructor(e,n,r,s=[]){g(this,"name");g(this,"keyType");g(this,"description");g(this,"tags");g(this,gne,U4);g(this,"_hash");this.name=e,this.keyType=n,this.description=r,this.tags=s,this._hash=I(Pn(this.name+this.description),Ot(Qe(this.keyType)),Ot(rf(this.tags)))}[(gne=d3,_t)](){return this._hash}[yt](e){return z4(e)&&this.name===e.name&&ot(this.keyType,e.keyType)&&ot(this.description,e.description)&&j4(this.tags,e.tags)}pipe(){return et(this,arguments)}}const z4=t=>it(t,d3),V4=(t,e)=>new Zb(t,L4(e),ff(e==null?void 0:e.description)),K4=(t,e,n)=>new Zb(t,M4(e),ff(n)),Q4=w(2,(t,e)=>e.length===0?t:new Zb(t.name,t.keyType,t.description,Xc(t.tags,e))),h3=Symbol.for("effect/MutableHashMap"),H4={[h3]:h3,[Symbol.iterator](){return new ew(this)},toString(){return vn(this.toJSON())},toJSON(){return{_id:"MutableHashMap",values:Array.from(this).map(gn)}},[Zt](){return this.toJSON()},pipe(){return et(this,arguments)}};class ew{constructor(e){g(this,"self");g(this,"referentialIterator");g(this,"bucketIterator");this.self=e,this.referentialIterator=e.referential[Symbol.iterator]()}next(){if(this.bucketIterator!==void 0)return this.bucketIterator.next();const e=this.referentialIterator.next();return e.done?(this.bucketIterator=new J4(this.self.buckets.values()),this.next()):e}[Symbol.iterator](){return new ew(this.self)}}class J4{constructor(e){g(this,"backing");g(this,"currentBucket");this.backing=e}next(){if(this.currentBucket===void 0){const n=this.backing.next();if(n.done)return n;this.currentBucket=n.value[Symbol.iterator]()}const e=this.currentBucket.next();return e.done?(this.currentBucket=void 0,this.next()):e}}const sm=()=>{const t=Object.create(H4);return t.referential=new Map,t.buckets=new Map,t.bucketsSize=0,t},nr=w(2,(t,e)=>{if(sf(e)===!1)return t.referential.has(e)?de(t.referential.get(e)):ce();const n=e[_t](),r=t.buckets.get(n);return r===void 0?ce():G4(t,r,e)}),G4=(t,e,n,r=!1)=>{for(let s=0,i=e.length;s<i;s++)if(n[yt](e[s][0])){const o=e[s][1];return r&&(e.splice(s,1),t.bucketsSize--),de(o)}return ce()},zi=w(2,(t,e)=>pt(nr(t,e))),Ps=w(3,(t,e,n)=>{if(sf(e)===!1)return t.referential.set(e,n),t;const r=e[_t](),s=t.buckets.get(r);return s===void 0?(t.buckets.set(r,[[e,n]]),t.bucketsSize++,t):(p3(t,s,e),s.push([e,n]),t.bucketsSize++,t)}),p3=(t,e,n)=>{for(let r=0,s=e.length;r<s;r++)if(n[yt](e[r][0])){e.splice(r,1),t.bucketsSize--;return}},Wl=w(2,(t,e)=>{if(sf(e)===!1)return t.referential.delete(e),t;const n=e[_t](),r=t.buckets.get(n);return r===void 0||(p3(t,r,e),r.length===0&&t.buckets.delete(n)),t}),tw=t=>t.referential.size+t.bucketsSize,Qf=Symbol.for("effect/MetricState"),m3="effect/MetricState/Counter",nw=Symbol.for(m3),g3="effect/MetricState/Frequency",rw=Symbol.for(g3),_3="effect/MetricState/Gauge",sw=Symbol.for(_3),y3="effect/MetricState/Histogram",iw=Symbol.for(y3),b3="effect/MetricState/Summary",ow=Symbol.for(b3),Hf={_A:t=>t};class Y4{constructor(e){g(this,"count");g(this,_ne,Hf);g(this,yne,nw);this.count=e}[(_ne=Qf,yne=nw,_t)](){return I(Qe(m3),Ot(Qe(this.count)),hn(this))}[yt](e){return c6(e)&&this.count===e.count}pipe(){return et(this,arguments)}}const X4=uy(ot);class Z4{constructor(e){g(this,"occurrences");g(this,bne,Hf);g(this,wne,rw);g(this,"_hash");this.occurrences=e}[(bne=Qf,wne=rw,_t)](){return I(Pn(g3),Ot(rf(bt(this.occurrences.entries()))),hn(this))}[yt](e){return l6(e)&&X4(bt(this.occurrences.entries()),bt(e.occurrences.entries()))}pipe(){return et(this,arguments)}}class e6{constructor(e){g(this,"value");g(this,Sne,Hf);g(this,Ene,sw);this.value=e}[(Sne=Qf,Ene=sw,_t)](){return I(Qe(_3),Ot(Qe(this.value)),hn(this))}[yt](e){return u6(e)&&this.value===e.value}pipe(){return et(this,arguments)}}class t6{constructor(e,n,r,s,i){g(this,"buckets");g(this,"count");g(this,"min");g(this,"max");g(this,"sum");g(this,vne,Hf);g(this,Nne,iw);this.buckets=e,this.count=n,this.min=r,this.max=s,this.sum=i}[(vne=Qf,Nne=iw,_t)](){return I(Qe(y3),Ot(Qe(this.buckets)),Ot(Qe(this.count)),Ot(Qe(this.min)),Ot(Qe(this.max)),Ot(Qe(this.sum)),hn(this))}[yt](e){return f6(e)&&ot(this.buckets,e.buckets)&&this.count===e.count&&this.min===e.min&&this.max===e.max&&this.sum===e.sum}pipe(){return et(this,arguments)}}class n6{constructor(e,n,r,s,i,o){g(this,"error");g(this,"quantiles");g(this,"count");g(this,"min");g(this,"max");g(this,"sum");g(this,kne,Hf);g(this,xne,ow);this.error=e,this.quantiles=n,this.count=r,this.min=s,this.max=i,this.sum=o}[(kne=Qf,xne=ow,_t)](){return I(Qe(b3),Ot(Qe(this.error)),Ot(Qe(this.quantiles)),Ot(Qe(this.count)),Ot(Qe(this.min)),Ot(Qe(this.max)),Ot(Qe(this.sum)),hn(this))}[yt](e){return d6(e)&&this.error===e.error&&ot(this.quantiles,e.quantiles)&&this.count===e.count&&this.min===e.min&&this.max===e.max&&this.sum===e.sum}pipe(){return et(this,arguments)}}const r6=t=>new Y4(t),s6=t=>new Z4(t),i6=t=>new e6(t),o6=t=>new t6(t.buckets,t.count,t.min,t.max,t.sum),a6=t=>new n6(t.error,t.quantiles,t.count,t.min,t.max,t.sum),c6=t=>it(t,nw),l6=t=>it(t,rw),u6=t=>it(t,sw),f6=t=>it(t,iw),d6=t=>it(t,ow),h6=Symbol.for("effect/MetricHook"),p6={_In:t=>t,_Out:t=>t},Jf=t=>({[h6]:p6,pipe(){return et(this,arguments)},...t}),w3=BigInt(0),m6=t=>{let e=t.keyType.bigint?w3:0;const n=t.keyType.incremental?t.keyType.bigint?s=>s>=w3:s=>s>=0:s=>!0,r=s=>{n(s)&&(e=e+s)};return Jf({get:()=>r6(e),update:r,modify:r})},g6=t=>{const e=new Map;for(const r of t.keyType.preregisteredWords)e.set(r,0);const n=r=>{const s=e.get(r)??0;e.set(r,s+1)};return Jf({get:()=>s6(e),update:n,modify:n})},_6=(t,e)=>{let n=e;return Jf({get:()=>i6(n),update:r=>{n=r},modify:r=>{n=n+r}})},y6=t=>{const e=t.keyType.boundaries.values,n=e.length,r=new Uint32Array(n+1),s=new Float32Array(n);let i=0,o=0,l=Number.MAX_VALUE,f=Number.MIN_VALUE;I(e,pf(Ol),xs((N,O)=>{s[O]=N}));const m=N=>{let O=0,M=n;for(;O!==M;){const z=Math.floor(O+(M-O)/2),Z=s[z];N<=Z?M=z:O=z,M===O+1&&(N<=s[O]?M=O:O=M)}r[O]=r[O]+1,i=i+1,o=o+N,N<l&&(l=N),N>f&&(f=N)},S=()=>{const N=Wh(n);let O=0;for(let M=0;M<n;M++){const z=s[M],Z=r[M];O=O+Z,N[M]=[z,O]}return N};return Jf({get:()=>o6({buckets:S(),count:i,min:l,max:f,sum:o}),update:m,modify:m})},b6=t=>{const{error:e,maxAge:n,maxSize:r,quantiles:s}=t.keyType,i=I(s,pf(Ol)),o=Wh(r);let l=0,f=0,m=0,S=Number.MAX_VALUE,N=Number.MIN_VALUE;const O=z=>{const Z=[];let J=0;for(;J!==r-1;){const ee=o[J];if(ee!=null){const[ve,ye]=ee,Fe=Dh(z-ve);W2(Fe,T2)&&Fe<=n&&Z.push(ye)}J=J+1}return w6(e,i,pf(Z,Ol))},M=(z,Z)=>{if(r>0){l=l+1;const J=l%r;o[J]=[Z,z]}f=f+1,m=m+z,z<S&&(S=z),z>N&&(N=z)};return Jf({get:()=>a6({error:e,quantiles:O(Date.now()),count:f,min:S,max:N,sum:m}),update:([z,Z])=>M(z,Z),modify:([z,Z])=>M(z,Z)})},w6=(t,e,n)=>{const r=n.length;if(!xn(e))return No();const s=e[0],i=e.slice(1),o=S3(t,r,ce(),0,s,n),l=ks(o);return i.forEach(f=>{l.push(S3(t,r,o.value,o.consumed,f,o.rest))}),xs(l,f=>[f.quantile,f.value])},S3=(t,e,n,r,s,i)=>{let o=t,l=e,f=n,m=r,S=s,N=i,O=t,M=e,z=n,Z=r,J=s,ee=i;for(;;){if(!xn(N))return{quantile:S,value:ce(),consumed:m,rest:[]};if(S===1)return{quantile:S,value:de(hv(N)),consumed:m+N.length,rest:[]};const ve=iR(N,We=>We<=N[0]),ye=S*l,Fe=o/2*ye,Je=m+ve[0].length,Xe=Math.abs(Je-ye);if(Je<ye-Fe){O=o,M=l,z=hf(N),Z=Je,J=S,ee=ve[1],o=O,l=M,f=z,m=Z,S=J,N=ee;continue}if(Je>ye+Fe)return{quantile:S,value:f,consumed:m,rest:N};switch(f._tag){case"None":{O=o,M=l,z=hf(N),Z=Je,J=S,ee=ve[1],o=O,l=M,f=z,m=Z,S=J,N=ee;continue}case"Some":{const We=Math.abs(ye-f.value);if(Xe<We){O=o,M=l,z=hf(N),Z=Je,J=S,ee=ve[1],o=O,l=M,f=z,m=Z,S=J,N=ee;continue}return{quantile:S,value:de(f.value),consumed:m,rest:N}}}}throw new Error("BUG: MetricHook.resolveQuantiles - please report an issue at https://github.com/Effect-TS/effect/issues")},S6=Symbol.for("effect/MetricPair"),E6={_Type:t=>t},v6=(t,e)=>({[S6]:E6,metricKey:t,metricState:e,pipe(){return et(this,arguments)}}),E3=Symbol.for("effect/MetricRegistry");class N6{constructor(){g(this,qne,E3);g(this,"map",sm())}snapshot(){const e=[];for(const[n,r]of this.map)e.push(v6(n,r.get()));return e}get(e){const n=I(this.map,nr(e),qr);if(n==null){if(u3(e.keyType))return this.getCounter(e);if(W4(e.keyType))return this.getGauge(e);if(D4(e.keyType))return this.getFrequency(e);if(f3(e.keyType))return this.getHistogram(e);if(B4(e.keyType))return this.getSummary(e);throw new Error("BUG: MetricRegistry.get - unknown MetricKeyType - please report an issue at https://github.com/Effect-TS/effect/issues")}else return n}getCounter(e){let n=I(this.map,nr(e),qr);if(n==null){const r=m6(e);I(this.map,zi(e))||I(this.map,Ps(e,r)),n=r}return n}getFrequency(e){let n=I(this.map,nr(e),qr);if(n==null){const r=g6(e);I(this.map,zi(e))||I(this.map,Ps(e,r)),n=r}return n}getGauge(e){let n=I(this.map,nr(e),qr);if(n==null){const r=_6(e,e.keyType.bigint?BigInt(0):0);I(this.map,zi(e))||I(this.map,Ps(e,r)),n=r}return n}getHistogram(e){let n=I(this.map,nr(e),qr);if(n==null){const r=y6(e);I(this.map,zi(e))||I(this.map,Ps(e,r)),n=r}return n}getSummary(e){let n=I(this.map,nr(e),qr);if(n==null){const r=b6(e);I(this.map,zi(e))||I(this.map,Ps(e,r)),n=r}return n}}qne=E3;const k6=()=>new N6,x6=Symbol.for("effect/Metric"),q6={_Type:t=>t,_In:t=>t,_Out:t=>t},v3=gt(Symbol.for("effect/Metric/globalMetricRegistry"),()=>k6()),N3=function(t,e,n,r){const s=Object.assign(i=>Fo(i,o=>A6(s,o)),{[x6]:q6,keyType:t,unsafeUpdate:e,unsafeValue:n,unsafeModify:r,register(){return this.unsafeValue([]),this},pipe(){return et(this,arguments)}});return s},im=(t,e)=>k3(V4(t,e)),k3=t=>{let e;const n=new WeakMap,r=s=>{if(s.length===0)return e!==void 0||(e=v3.get(t)),e;let i=n.get(s);return i!==void 0||(i=v3.get(Q4(t,s)),n.set(s,i)),i};return N3(t.keyType,(s,i)=>r(i).update(s),s=>r(s).get(),(s,i)=>r(i).modify(s))},O6=(t,e,n)=>k3(K4(t,e,n)),I6=w(3,(t,e,n)=>T6(t,[Qp(e,n)])),T6=w(2,(t,e)=>N3(t.keyType,(n,r)=>t.unsafeUpdate(n,Xc(e,r)),n=>t.unsafeValue(Xc(e,n)),(n,r)=>t.unsafeModify(n,Xc(e,r)))),A6=w(2,(t,e)=>Cs(kl,n=>he(()=>t.unsafeUpdate(e,n)))),x3=Symbol.for("effect/Request"),C6={_E:t=>t,_A:t=>t};({...Ah,[x3]:0});const F6=t=>it(t,x3),R6=w(2,(t,e)=>Cs(xx,n=>he(()=>{if(n.has(t)){const r=n.get(t);r.state.completed||(r.state.completed=!0,Fp(r.result,e))}})));class q3{constructor(){g(this,"count",0);g(this,"observers",new Set);g(this,"interrupted",!1)}addObserver(e){this.observers.add(e)}removeObserver(e){this.observers.delete(e)}increment(){this.count++,this.observers.forEach(e=>e(this.count))}decrement(){this.count--,this.observers.forEach(e=>e(this.count))}}const Gf=Symbol.for("effect/Supervisor"),om={_T:t=>t},dE=class dE{constructor(e,n){g(this,"underlying");g(this,"value0");g(this,One,om);this.underlying=e,this.value0=n}get value(){return this.value0}onStart(e,n,r,s){this.underlying.onStart(e,n,r,s)}onEnd(e,n){this.underlying.onEnd(e,n)}onEffect(e,n){this.underlying.onEffect(e,n)}onSuspend(e){this.underlying.onSuspend(e)}onResume(e){this.underlying.onResume(e)}map(e){return new dE(this,I(this.value,qe(e)))}zip(e){return new Xf(this,e)}};One=Gf;let Yf=dE;const hE=class hE{constructor(e,n){g(this,"left");g(this,"right");g(this,"_tag","Zip");g(this,Ine,om);this.left=e,this.right=n}get value(){return Ep(this.left.value,this.right.value)}onStart(e,n,r,s){this.left.onStart(e,n,r,s),this.right.onStart(e,n,r,s)}onEnd(e,n){this.left.onEnd(e,n),this.right.onEnd(e,n)}onEffect(e,n){this.left.onEffect(e,n),this.right.onEffect(e,n)}onSuspend(e){this.left.onSuspend(e),this.right.onSuspend(e)}onResume(e){this.left.onResume(e),this.right.onResume(e)}map(e){return new Yf(this,I(this.value,qe(e)))}zip(e){return new hE(this,e)}};Ine=Gf;let Xf=hE;const O3=t=>it(t,Gf)&&Sh(t,"Zip");class P6{constructor(){g(this,Tne,om);g(this,"fibers",new Set)}get value(){return he(()=>Array.from(this.fibers))}onStart(e,n,r,s){this.fibers.add(s)}onEnd(e,n){this.fibers.delete(n)}onEffect(e,n){}onSuspend(e){}onResume(e){}map(e){return new Yf(this,I(this.value,qe(e)))}zip(e){return new Xf(this,e)}onRun(e,n){return e()}}Tne=Gf;class $6{constructor(e){g(this,"effect");g(this,Ane,om);this.effect=e}get value(){return this.effect}onStart(e,n,r,s){}onEnd(e,n){}onEffect(e,n){}onSuspend(e){}onResume(e){}map(e){return new Yf(this,I(this.value,qe(e)))}zip(e){return new Xf(this,e)}onRun(e,n){return e()}}Ane=Gf;const L6=he(()=>new P6),M6=t=>new $6(t),am=gt("effect/Supervisor/none",()=>M6(ft)),D6=ul,I3="Empty",T3="AddSupervisor",A3="RemoveSupervisor",C3="AndThen",Zf={_tag:I3},cm=(t,e)=>({_tag:C3,first:t,second:e}),W6=(t,e)=>B6(e,Zn(t)),B6=(t,e)=>{let n=t,r=e;for(;qs(r);){const s=ms(r);switch(s._tag){case I3:{r=Os(r);break}case T3:{n=n.zip(s.supervisor),r=Os(r);break}case A3:{n=aw(n,s.supervisor),r=Os(r);break}case C3:{r=lr(s.first)(lr(s.second)(Os(r)));break}}}return n},aw=(t,e)=>ot(t,e)?am:O3(t)?aw(t.left,e).zip(aw(t.right,e)):t,lm=t=>ot(t,am)?Ca():O3(t)?I(lm(t.left),yf(lm(t.right))):qy(t),U6=D6({empty:Zf,patch:W6,combine:cm,diff:(t,e)=>{if(ot(t,e))return Zf;const n=lm(t),r=lm(e),s=I(r,Vv(n),Xh(Zf,(o,l)=>cm(o,{_tag:T3,supervisor:l}))),i=I(n,Vv(r),Xh(Zf,(o,l)=>cm(o,{_tag:A3,supervisor:l})));return cm(s,i)}}),j6=im("effect_fiber_started",{incremental:!0}),F3=im("effect_fiber_active"),z6=im("effect_fiber_successes",{incremental:!0}),V6=im("effect_fiber_failures",{incremental:!0}),K6=I6(O6("effect_fiber_lifetimes",A4({start:.5,factor:2,count:35})),"time_unit","milliseconds"),ed="Continue",Q6="Done",R3="Yield",H6={_E:t=>t,_A:t=>t},td=t=>{throw new Error(`BUG: FiberRuntime - ${of(t)} - please report an issue at https://github.com/Effect-TS/effect/issues`)},jo=Symbol.for("effect/internal/fiberRuntime/YieldedOp"),Vi=gt("effect/internal/fiberRuntime/yieldedOpChannel",()=>({currentOp:null})),um={[qh]:(t,e,n)=>Un(()=>e.effect_instruction_i1(n)),OnStep:(t,e,n)=>pn(pn(n)),[Oh]:(t,e,n)=>Un(()=>e.effect_instruction_i2(n)),[X_]:(t,e,n)=>(t.patchRuntimeFlags(t.currentRuntimeFlags,e.patch),Io(t.currentRuntimeFlags)&&t.isInterrupted()?Qt(t.getInterruptedCause()):pn(n)),[Ih]:(t,e,n)=>(Un(()=>e.effect_instruction_i2(n)),Un(()=>e.effect_instruction_i0())?(t.pushStack(e),Un(()=>e.effect_instruction_i1())):ft)},J6={[Bb]:(t,e,n,r)=>(t.processNewInterruptSignal(r.cause),Io(e)?Qt(r.cause):n),[jb]:(t,e,n,r)=>{throw new Error("It is illegal to have multiple concurrent run loops in a single fiber")},[Ub]:(t,e,n,r)=>(r.onFiber(t,sx(e)),n),[zb]:(t,e,n,r)=>U(Ka(),()=>n)},G6=t=>Co(q$(t),e=>Ki(z$(e),([n,r])=>{const s=new Map,i=[];for(const l of r){i.push(ti(l));for(const f of l)s.set(f.request,f)}const o=i.flat();return Sr(LU(n.runAll(i),o,()=>o.forEach(l=>{l.listeners.interrupted=!0})),xx,s)},!1,!1));class P3 extends Bf{constructor(n,r,s){super();g(this,Cne,Qb);g(this,Fne,H6);g(this,"_fiberRefs");g(this,"_fiberId");g(this,"_queue",new Array);g(this,"_children",null);g(this,"_observers",new Array);g(this,"_running",!1);g(this,"_stack",[]);g(this,"_asyncInterruptor",null);g(this,"_asyncBlockingOn",null);g(this,"_exitValue",null);g(this,"_steps",[]);g(this,"_isYielding",!1);g(this,"currentRuntimeFlags");g(this,"currentOpCount",0);g(this,"currentSupervisor");g(this,"currentScheduler");g(this,"currentTracer");g(this,"currentSpan");g(this,"currentContext");g(this,"currentDefaultServices");g(this,"run",()=>{this.drainQueueOnCurrentThread()});if(this.currentRuntimeFlags=s,this._fiberId=n,this._fiberRefs=r,gN(s)){const i=this.getFiberRef(kl);j6.unsafeUpdate(1,i),F3.unsafeUpdate(1,i)}this.refreshRefCache()}commit(){return ai(this)}id(){return this._fiberId}resume(n){this.tell(Dl(n))}get status(){return this.ask((n,r)=>r)}get runtimeFlags(){return this.ask((n,r)=>LD(r)?n.currentRuntimeFlags:r.runtimeFlags)}scope(){return _4(this)}get children(){return this.ask(n=>Array.from(n.getChildren()))}getChildren(){return this._children===null&&(this._children=new Set),this._children}getInterruptedCause(){return this.getFiberRef($f)}fiberRefs(){return this.ask(n=>n.getFiberRefs())}ask(n){return je(()=>{const r=Df(this._fiberId);return this.tell(tm((s,i)=>{Fp(r,he(()=>n(s,i)))})),Ar(r)})}tell(n){this._queue.push(n),this._running||(this._running=!0,this.drainQueueLaterOnExecutor())}get await(){return ur(n=>{const r=s=>n(se(s));return this.tell(tm((s,i)=>{s._exitValue!==null?r(this._exitValue):s.addObserver(r)})),he(()=>this.tell(tm((s,i)=>{s.removeObserver(r)})))},this.id())}get inheritAll(){return It((n,r)=>{const s=n.id(),i=n.getFiberRefs(),o=r.runtimeFlags,l=this.getFiberRefs(),f=Vk(i,s,l);n.setFiberRefs(f);const m=n.getFiberRef(G3),S=I($i(o,m),wN($a),wN(jy));return Tf(S)})}get poll(){return he(()=>ff(this._exitValue))}unsafePoll(){return this._exitValue}interruptAsFork(n){return he(()=>this.tell(Vb(Ts(n))))}unsafeInterruptAsFork(n){this.tell(Vb(Ts(n)))}addObserver(n){this._exitValue!==null?n(this._exitValue):this._observers.push(n)}removeObserver(n){this._observers=this._observers.filter(r=>r!==n)}getFiberRefs(){return this.setFiberRef(G3,this.currentRuntimeFlags),this._fiberRefs}unsafeDeleteFiberRef(n){this._fiberRefs=Qk(this._fiberRefs,n)}getFiberRef(n){return this._fiberRefs.locals.has(n)?this._fiberRefs.locals.get(n)[0][1]:n.initial}setFiberRef(n,r){this._fiberRefs=Sb(this._fiberRefs,{fiberId:this._fiberId,fiberRef:n,value:r}),this.refreshRefCache()}refreshRefCache(){this.currentDefaultServices=this.getFiberRef(Kn),this.currentTracer=this.currentDefaultServices.unsafeMap.get(Al.key),this.currentSupervisor=this.getFiberRef(Y3),this.currentScheduler=this.getFiberRef(Vp),this.currentContext=this.getFiberRef(_s),this.currentSpan=this.currentContext.unsafeMap.get(Do.key)}setFiberRefs(n){this._fiberRefs=n,this.refreshRefCache()}addChild(n){this.getChildren().add(n)}removeChild(n){this.getChildren().delete(n)}drainQueueOnCurrentThread(){let n=!0;for(;n;){let r=ed;const s=globalThis[ec];globalThis[ec]=this;try{for(;r===ed;)r=this._queue.length===0?Q6:this.evaluateMessageWhileSuspended(this._queue.splice(0,1)[0])}finally{this._running=!1,globalThis[ec]=s}this._queue.length>0&&!this._running?(this._running=!0,r===R3?(this.drainQueueLaterOnExecutor(),n=!1):n=!0):n=!1}}drainQueueLaterOnExecutor(){this.currentScheduler.scheduleTask(this.run,this.getFiberRef(Nl))}drainQueueWhileRunning(n,r){let s=r;for(;this._queue.length>0;){const i=this._queue.splice(0,1)[0];s=J6[i._tag](this,n,s,i)}return s}isInterrupted(){return!K$(this.getFiberRef($f))}addInterruptedCause(n){const r=this.getFiberRef($f);this.setFiberRef($f,zn(r,n))}processNewInterruptSignal(n){this.addInterruptedCause(n),this.sendInterruptSignalToAllChildren()}sendInterruptSignalToAllChildren(){if(this._children===null||this._children.size===0)return!1;let n=!1;for(const r of this._children)r.tell(Vb(Ts(this.id()))),n=!0;return n}interruptAllChildren(){if(this.sendInterruptSignalToAllChildren()){const n=this._children.values();this._children=null;let r=!1;return Sp({while:()=>!r,body:()=>{const i=n.next();return i.done?he(()=>{r=!0}):er(i.value.await)},step:()=>{}})}return null}reportExitValue(n){if(gN(this.currentRuntimeFlags)){const r=this.getFiberRef(kl),s=this.id().startTimeMillis,i=Date.now();switch(K6.unsafeUpdate(i-s,r),F3.unsafeUpdate(-1,r),n._tag){case Yn:{z6.unsafeUpdate(1,r);break}case Gn:{V6.unsafeUpdate(1,r);break}}}if(n._tag==="Failure"){const r=this.getFiberRef(sk);!Qy(n.cause)&&r._tag==="Some"&&this.log("Fiber terminated with an unhandled error",n.cause,r)}}setExitValue(n){this._exitValue=n,this.reportExitValue(n);for(let r=this._observers.length-1;r>=0;r--)this._observers[r](n)}getLoggers(){return this.getFiberRef(cw)}log(n,r,s){const i=pt(s)?s.value:this.getFiberRef(RL),o=this.getFiberRef($3);if(DD(o,i))return;const l=this.getFiberRef(tk),f=this.getFiberRef(Pf),m=this.getLoggers(),S=this.getFiberRefs();if(Oy(m)>0){const N=Eo(this.getFiberRef(Kn),Wi),O=new Date(N.unsafeCurrentTimeMillis());for(const M of m)M.log({fiberId:this.id(),logLevel:i,message:n,cause:r,context:S,spans:l,annotations:f,date:O})}}evaluateMessageWhileSuspended(n){switch(n._tag){case zb:return R3;case Bb:return this.processNewInterruptSignal(n.cause),this._asyncInterruptor!==null&&(this._asyncInterruptor(Qt(n.cause)),this._asyncInterruptor=null),ed;case jb:return this._asyncInterruptor=null,this._asyncBlockingOn=null,this.evaluateEffect(n.effect),ed;case Ub:return n.onFiber(this,this._exitValue!==null?PD:$D(this.currentRuntimeFlags,this._asyncBlockingOn)),ed;default:return td(n)}}evaluateEffect(n){this.currentSupervisor.onResume(this);try{let r=Io(this.currentRuntimeFlags)&&this.isInterrupted()?Qt(this.getInterruptedCause()):n;for(;r!==null;){const s=r,i=this.runLoop(s);if(i===jo){const o=Vi.currentOp;Vi.currentOp=null,o._op===Th?S$(this.currentRuntimeFlags)?(this.tell(p4()),this.tell(Dl(Dr)),r=null):r=Dr:o._op===af&&(r=null)}else{this.currentRuntimeFlags=I(this.currentRuntimeFlags,E$(jy));const o=this.interruptAllChildren();o!==null?r=U(o,()=>i):(this._queue.length===0?this.setExitValue(i):this.tell(Dl(i)),r=null)}}}finally{this.currentSupervisor.onSuspend(this)}}start(n){if(this._running)this.tell(Dl(n));else{this._running=!0;const r=globalThis[ec];globalThis[ec]=this;try{this.evaluateEffect(n)}finally{this._running=!1,globalThis[ec]=r,this._queue.length>0&&this.drainQueueLaterOnExecutor()}}}startFork(n){this.tell(Dl(n))}patchRuntimeFlags(n,r){const s=La(n,r);return globalThis[ec]=this,this.currentRuntimeFlags=s,s}initiateAsync(n,r){let s=!1;const i=o=>{s||(s=!0,this.tell(Dl(o)))};Io(n)&&(this._asyncInterruptor=i);try{r(i)}catch(o){i(At(Ir(o)))}}pushStack(n){this._stack.push(n),n._op==="OnStep"&&this._steps.push({refs:this.getFiberRefs(),flags:this.currentRuntimeFlags})}popStack(){const n=this._stack.pop();if(n)return n._op==="OnStep"&&this._steps.pop(),n}getNextSuccessCont(){let n=this.popStack();for(;n;){if(n._op!==xh)return n;n=this.popStack()}}getNextFailCont(){let n=this.popStack();for(;n;){if(n._op!==qh&&n._op!==Ih)return n;n=this.popStack()}}[(Cne=Kb,Fne=b4,WF)](n){return he(()=>uf(this.currentContext,n))}Left(n){return vt(n.left)}None(n){return vt(new Po)}Right(n){return pn(n.right)}Some(n){return pn(n.value)}Micro(n){return zN(r=>{const s=JD().pipe(GD(eW,this.getFiberRef(_s)));let i=r;return n[Bp](s,o=>{if(o._tag==="Right")return i(pn(o.right));switch(o.left._tag){case"Interrupt":return i(Qt(Ts(qo)));case"Fail":return i(vt(o.left.error));case"Die":return i(Ua(o.left.defect))}}),ur(o=>{i=l=>{o(ft)},Ib(s,mx).abort()})})}[PE](n){const r=Un(()=>n.effect_instruction_i0()),s=this.getNextSuccessCont();return s!==void 0?(s._op in um||td(s),um[s._op](this,s,r)):(Vi.currentOp=pn(r),jo)}[Yn](n){const r=n,s=this.getNextSuccessCont();return s!==void 0?(s._op in um||td(s),um[s._op](this,s,r.effect_instruction_i0)):(Vi.currentOp=r,jo)}[Gn](n){const r=n.effect_instruction_i0,s=this.getNextFailCont();if(s!==void 0)switch(s._op){case xh:case Oh:return Io(this.currentRuntimeFlags)&&this.isInterrupted()?Qt(FN(r)):Un(()=>s.effect_instruction_i1(r));case"OnStep":return Io(this.currentRuntimeFlags)&&this.isInterrupted()?Qt(FN(r)):pn(Qt(r));case X_:return this.patchRuntimeFlags(this.currentRuntimeFlags,s.patch),Io(this.currentRuntimeFlags)&&this.isInterrupted()?Qt(zn(r,this.getInterruptedCause())):Qt(r);default:td(s)}else return Vi.currentOp=Qt(r),jo}[$E](n){return Un(()=>n.effect_instruction_i0(this,sx(this.currentRuntimeFlags)))}Blocked(n){const r=this.getFiberRefs(),s=this.currentRuntimeFlags;if(this._steps.length>0){const i=[],o=this._steps[this._steps.length-1];let l=this.popStack();for(;l&&l._op!=="OnStep";)i.push(l),l=this.popStack();this.setFiberRefs(o.refs),this.currentRuntimeFlags=o.flags;const f=Uf(o.refs,r),m=$i(o.flags,s);return pn(wl(n.effect_instruction_i0,It(S=>{for(;i.length>0;)S.pushStack(i.pop());return S.setFiberRefs(jf(S.id(),S.getFiberRefs())(f)),S.currentRuntimeFlags=La(m)(S.currentRuntimeFlags),n.effect_instruction_i1})))}return tr(i=>U(nd(BN(n.effect_instruction_i0)),()=>i(n.effect_instruction_i1)))}RunBlocked(n){return G6(n.effect_instruction_i0)}[xa](n){const r=n.effect_instruction_i0,s=this.currentRuntimeFlags,i=La(s,r);if(Io(i)&&this.isInterrupted())return Qt(this.getInterruptedCause());if(this.patchRuntimeFlags(this.currentRuntimeFlags,r),n.effect_instruction_i1){const o=$i(i,s);return this.pushStack(new dL(o,n)),Un(()=>n.effect_instruction_i1(s))}else return Dr}[qh](n){return this.pushStack(n),n.effect_instruction_i0}OnStep(n){return this.pushStack(n),n.effect_instruction_i0}[xh](n){return this.pushStack(n),n.effect_instruction_i0}[Oh](n){return this.pushStack(n),n.effect_instruction_i0}[af](n){return this._asyncBlockingOn=n.effect_instruction_i1,this.initiateAsync(this.currentRuntimeFlags,n.effect_instruction_i0),Vi.currentOp=n,jo}[Th](n){return this._isYielding=!1,Vi.currentOp=n,jo}[Ih](n){const r=n.effect_instruction_i0,s=n.effect_instruction_i1;return r()?(this.pushStack(n),s()):Dr}[Y_](n){return Un(()=>n.commit())}runLoop(n){let r=n;for(this.currentOpCount=0;;){if(this.currentRuntimeFlags&w$&&this.currentSupervisor.onEffect(this,r),this._queue.length>0&&(r=this.drainQueueWhileRunning(this.currentRuntimeFlags,r)),!this._isYielding){this.currentOpCount+=1;const s=this.currentScheduler.shouldYield(this);if(s!==!1){this._isYielding=!0,this.currentOpCount=0;const i=r;r=U(Ka({priority:s}),()=>i)}}try{if((!("_op"in r)||!(r._op in this))&&td(r),r=this.currentTracer.context(()=>yh()!==r[Wa]._V?mp(`Cannot execute an Effect versioned ${r[Wa]._V} with a Runtime of version ${yh()}`):this[r._op](r),this),r===jo){const s=Vi.currentOp;return s._op===Th||s._op===af?jo:(Vi.currentOp=null,s._op===Yn||s._op===Gn?s:Qt(Ir(s)))}}catch(s){uL(s)?r=Qt(s.cause):WL(s)?r=Qt(zn(Ir(s),Ts(qo))):r=Ua(s)}}}}const $3=gt("effect/FiberRef/currentMinimumLogLevel",()=>Mn(WD("Info"))),Y6=t=>rm(e=>{const n=SD(e.context,Kn);Eo(n,Tl).unsafe.log(t.log(e))}),L3=gt(Symbol.for("effect/Logger/defaultLogger"),()=>Y6(N4)),X6=gt(Symbol.for("effect/Logger/tracerLogger"),()=>rm(({annotations:t,cause:e,context:n,fiberId:r,logLevel:s,message:i})=>{const o=vo(Fl(n,_s),Do);if(o._tag==="None"||o.value._tag==="ExternalSpan")return;const l=uf(Fl(n,Kn),Wi),f={};for(const[m,S]of t)f[m]=S;f["effect.fiberId"]=dP(r),f["effect.logLevel"]=s.label,e!==null&&e._tag!=="Empty"&&(f["effect.cause"]=cp(e,{renderErrorCause:!0})),o.value.event(of(Array.isArray(i)?i[0]:i),l.unsafeCurrentTimeNanos(),f)})),cw=gt(Symbol.for("effect/FiberRef/currentLoggers"),()=>AL(qy(L3,X6))),Z6=function(){if(typeof arguments[0]=="string")return $s(Pf,Oo(arguments[0],arguments[1]));const t=Object.entries(arguments[0]);return $s(Pf,gP(e=>{for(let n=0;n<t.length;n++){const[r,s]=t[n];Oo(e,r,s)}return e}))},M3=w(t=>rn(t[0]),(t,e)=>Ro(Fo(t,n=>fm(r=>e(n,r))))),eU=w(t=>rn(t[0]),(t,e)=>Vo(t,fm(n=>e(n)))),fm=t=>It(e=>{const n=e.getFiberRefs(),r=e.currentRuntimeFlags;return U(H3,s=>xp(s,i=>It(o=>{const l=o.getFiberRefs(),f=o.currentRuntimeFlags,m=Uf(l,n),S=$i(f,r),N=Uf(n,l);return o.setFiberRefs(jf(m,o.id(),n)),Vo(YN(t(i),S),he(()=>{o.setFiberRefs(jf(N,o.id(),o.getFiberRefs()))}))})))}),tU=t=>Sr(Np,de(Kf))(t),D3=Symbol.for("effect/Effect/existsPar/found"),nU=w(t=>Ti(t[0])&&!rn(t[0]),(t,e,n)=>Kp(n==null?void 0:n.concurrency,()=>je(()=>W3(t[Symbol.iterator](),0,e)),()=>Tr(bs(t,(r,s)=>QN(e(r,s),{onTrue:()=>vt(D3),onFalse:()=>ft}),n),{onFailure:r=>r===D3?se(!0):vt(r),onSuccess:()=>se(!1)}))),W3=(t,e,n)=>{const r=t.next();return r.done?se(!1):I(U(n(r.value,e),s=>s?se(s):W3(t,e+1,n)))},rU=w(t=>Ti(t[0])&&!rn(t[0]),(t,e,n)=>{const r=n!=null&&n.negate?(s,i)=>qe(e(s,i),nD):e;return Kp(n==null?void 0:n.concurrency,()=>je(()=>bt(t).reduceRight((s,i,o)=>Cf(s,je(()=>r(i,o)),(l,f)=>f?[i,...l]:l),he(()=>new Array))),()=>qe(bs(t,(s,i)=>qe(r(s,i),o=>o?de(s):ce()),n),_R))}),sU=t=>{if(Array.isArray(t)||Ti(t))return[t,ce()];const e=Object.keys(t),n=e.length;return[e.map(r=>t[r]),de(r=>{const s={};for(let i=0;i<n;i++)s[e[i]]=r[i];return s})]},iU=(t,e,n)=>{const r=[];for(const s of t)r.push(ja(s));return U(bs(r,Ke,{concurrency:n==null?void 0:n.concurrency,batching:n==null?void 0:n.batching}),s=>{const i=ce(),o=s.length,l=new Array(o),f=new Array(o);let m=!1;for(let S=0;S<o;S++){const N=s[S];N._tag==="Left"?(l[S]=de(N.left),m=!0):(f[S]=N.right,l[S]=i)}return m?e._tag==="Some"?vt(e.value(l)):vt(l):n!=null&&n.discard?ft:e._tag==="Some"?se(e.value(f)):se(f)})},oU=(t,e,n)=>{const r=[];for(const s of t)r.push(ja(s));return n!=null&&n.discard?bs(r,Ke,{concurrency:n==null?void 0:n.concurrency,batching:n==null?void 0:n.batching,discard:!0}):qe(bs(r,Ke,{concurrency:n==null?void 0:n.concurrency,batching:n==null?void 0:n.batching}),s=>e._tag==="Some"?e.value(s):s)},Bl=(t,e)=>{const[n,r]=sU(t);return(e==null?void 0:e.mode)==="validate"?iU(n,r,e):(e==null?void 0:e.mode)==="either"?oU(n,r,e):(e==null?void 0:e.discard)!==!0&&r._tag==="Some"?qe(bs(n,Ke,e),r.value):bs(n,Ke,e)},aU=t=>e=>Bl(e,t),cU=(t,e)=>qe(Bl(bt(t).map(fr),e),Zc(n=>pk(n)?de(n.effect_instruction_i0):ce())),B3=w(2,(t,e)=>Array.from({length:e},()=>t)),lU=w(t=>rn(t[0]),(t,e,n)=>Bl(B3(t,e),n)),bs=w(t=>Ti(t[0]),(t,e,n)=>It(r=>{const s=(n==null?void 0:n.batching)===!0||(n==null?void 0:n.batching)==="inherit"&&r.getFiberRef(rk);return n!=null&&n.discard?qx(n.concurrency,()=>tc(yb,n==null?void 0:n.concurrentFinalizers)(i=>s?Ki(t,(o,l)=>i(e(o,l)),!0,!1,1):Co(t,(o,l)=>i(e(o,l)))),()=>tc(bb,n==null?void 0:n.concurrentFinalizers)(i=>Ki(t,(o,l)=>i(e(o,l)),s,!1)),i=>tc(wb(i),n==null?void 0:n.concurrentFinalizers)(o=>Ki(t,(l,f)=>o(e(l,f)),s,!1,i))):qx(n==null?void 0:n.concurrency,()=>tc(yb,n==null?void 0:n.concurrentFinalizers)(i=>s?lw(t,1,(o,l)=>i(e(o,l)),!0):Gr(t,(o,l)=>i(e(o,l)))),()=>tc(bb,n==null?void 0:n.concurrentFinalizers)(i=>dm(t,(o,l)=>i(e(o,l)),s)),i=>tc(wb(i),n==null?void 0:n.concurrentFinalizers)(o=>lw(t,i,(l,f)=>o(e(l,f)),s)))})),dm=(t,e,n)=>je(()=>{const r=bt(t),s=new Array(r.length);return sn(Ki(r,(o,l)=>U(e(o,l),f=>he(()=>s[l]=f)),n,!1),se(s))}),Ki=(t,e,n,r,s)=>tr(i=>GN(o=>It(l=>{let f=Array.from(t).reverse(),m=f.length;if(m===0)return ft;let S=0,N=!1;const O=s?Math.min(f.length,s):f.length,M=new Set,z=new Array,Z=()=>M.forEach(Re=>{Re.currentScheduler.scheduleTask(()=>{Re.unsafeInterruptAsFork(l.id())},0)}),J=new Array,ee=new Array,ve=new Array,ye=()=>{const Re=z.filter(({exit:Be})=>Be._tag==="Failure").sort((Be,ze)=>Be.index<ze.index?-1:Be.index===ze.index?0:1).map(({exit:Be})=>Be);return Re.length===0&&Re.push(Dr),Re},Fe=(Re,Be=!1)=>{const ze=Ro(o(Re)),Le=fU(ze,l,l.currentRuntimeFlags,Kf);return l.currentScheduler.scheduleTask(()=>{Be&&Le.unsafeInterruptAsFork(l.id()),Le.resume(ze)},0),Le},Je=()=>{r||(m-=f.length,f=[]),N=!0,Z()},Xe=n?KN:fr,We=Fe(ur(Re=>{const Be=(Le,He)=>{Le._op==="Blocked"?ve.push(Le):(z.push({index:He,exit:Le}),Le._op==="Failure"&&!N&&Je())},ze=()=>{if(f.length>0){const Le=f.pop();let He=S++;const Ze=()=>{const Ue=f.pop();return He=S++,U(Ka(),()=>U(Xe(i(e(Ue,He))),ht))},ht=Ue=>f.length>0&&(Be(Ue,He),f.length>0)?Ze():se(Ue),qt=U(Xe(i(e(Le,He))),ht),Ae=Fe(qt);J.push(Ae),M.add(Ae),N&&Ae.currentScheduler.scheduleTask(()=>{Ae.unsafeInterruptAsFork(l.id())},0),Ae.addObserver(Ue=>{let ke;if(Ue._op==="Failure"?ke=Ue:ke=Ue.effect_instruction_i0,ee.push(Ae),M.delete(Ae),Be(ke,He),z.length===m)Re(se(nn(Ha(ye(),{parallel:!0}),()=>Dr)));else if(ve.length+z.length===m){const Ne=ve.map(Ve=>Ve.effect_instruction_i0).reduce(SN);Re(se(wl(Ne,Ki([nn(Ha(ye(),{parallel:!0}),()=>Dr),...ve.map(Ve=>Ve.effect_instruction_i1)],Ve=>Ve,n,!0,s))))}else ze()})}};for(let Le=0;Le<O;Le++)ze()}));return er(si(ni(i(ai(We))),Ip({onFailure:()=>{Je();const Re=ve.length+1,Be=Math.min(typeof s=="number"?s:ve.length,ve.length),ze=Array.from(ve);return ur(Le=>{const He=[];let Ze=0,ht=0;const qt=(Ue,ke)=>Ne=>{He[Ue]=Ne,Ze++,Ze===Re&&Le(ev(Ha(He,{parallel:!0}))),ze.length>0&&ke&&Ae()},Ae=()=>{Fe(ze.pop(),!0).addObserver(qt(ht,!0)),ht++};We.addObserver(qt(ht,!1)),ht++;for(let Ue=0;Ue<Be;Ue++)Ae()})},onSuccess:()=>Gr(ee,Re=>Re.inheritAll)})))}))),lw=(t,e,n,r)=>je(()=>{const s=bt(t),i=new Array(s.length);return sn(Ki(s,(l,f)=>qe(n(l,f),m=>i[f]=m),r,!1,e),se(i))}),Qi=t=>It((e,n)=>se(U3(t,e,n.runtimeFlags))),nd=t=>dU(t,Kf),uU=w(2,(t,e)=>Qi(HN(t,n=>{const r=Da(n);switch(r._tag){case"Left":return e(r.left);case"Right":return At(r.right)}}))),U3=(t,e,n,r=null)=>{const s=hm(t,e,n,r);return s.resume(t),s},fU=(t,e,n,r=null)=>hm(t,e,n,r),hm=(t,e,n,r=null)=>{const s=Xv(),i=e.getFiberRefs(),o=_D(i,s),l=new P3(s,o,n),f=Fl(o,_s),m=l.currentSupervisor;return m.onStart(f,t,de(e),l),l.addObserver(N=>m.onEnd(N,l)),(r!==null?r:I(e.getFiberRef(Np),nn(()=>e.scope()))).add(n,l),l},dU=(t,e)=>It((n,r)=>se(U3(t,n,r.runtimeFlags,e))),j3=w(t=>Uc(t[2]),(t,e,n,r)=>Kp(r==null?void 0:r.concurrency,()=>bt(t).reduce((s,i,o)=>Cf(s,i,(l,f)=>n(l,f,o)),se(e)),()=>U(Ll(e),s=>U(bs(t,(i,o)=>U(i,l=>vx(s,f=>n(f,l,o))),r),()=>zp(s))))),z3=w(t=>Ti(t[0]),(t,e,n)=>I(bs(t,(r,s)=>ja(e(r,s)),n),qe(r=>gL(r,Ke)))),hU=w(t=>Ti(t[0]),(t,e,n)=>U(z3(t,e,{concurrency:n==null?void 0:n.concurrency,batching:n==null?void 0:n.batching}),([r,s])=>r.length===0?n!=null&&n.discard?ft:se(s):vt(r))),pU=t=>{const e=Ia(t);if(!qs(e))return gp(()=>new uk("Received an empty collection of effects"));const n=ms(e),r=Os(e),s=i=>I(w4(i[1]),wn(i[0]));return I(oi(),U(i=>I(Ll(r.length),U(o=>tr(l=>I(Qi(Va(n)),U(f=>I(r,Gr(m=>Qi(Va(m))),qe(m=>tl(m)),qe(m=>I(m,lr(f))),Fo(m=>I(m,Oa(ft,(S,N)=>I(S,sn(I(Hb(N),U(mU(m,N,i,o)),Qi,er)))))),U(m=>I(l(I(Qn(i),U(s))),Mi(()=>I(m,Oa(ft,(S,N)=>I(S,Af(Ff(N))))))))))))))))},mU=(t,e,n,r)=>s=>Tp(s,{onFailure:i=>I(Ml(r,o=>[o===0?I(Ap(n,i),er):ft,o-1]),ni),onSuccess:i=>I(Cp(n,[i,e]),U(o=>o?I(Ia(t),Oa(ft,(l,f)=>f===e?l:I(l,Af(Ff(f))))):ft))}),gU=w(t=>Ti(t[0])&&!rn(t[0]),(t,e,n,r)=>Kp(r==null?void 0:r.concurrency,()=>bt(t).reduce((s,i,o)=>Cf(s,i,(l,f)=>n(l,f,o)),e),()=>je(()=>I(j3([e,...t],ce(),(s,i,o)=>{switch(s._tag){case"None":return de(i);case"Some":return de(n(s.value,i,o))}},r),qe(s=>{switch(s._tag){case"None":throw new Error("BUG: Effect.reduceEffect - please report an issue at https://github.com/Effect-TS/effect/issues");case"Some":return s.value}}))))),uw=t=>Lo(e=>Nn(vo(e,Hi),{onNone:()=>t,onSome:n=>{switch(n.strategy._tag){case"Parallel":return t;case"Sequential":case"ParallelN":return U(Lf(n,bb),r=>zo(t,r))}}})),V3=t=>e=>Lo(n=>Nn(vo(n,Hi),{onNone:()=>e,onSome:r=>r.strategy._tag==="ParallelN"&&r.strategy.parallelism===t?e:U(Lf(r,wb(t)),s=>zo(e,s))})),_U=t=>e=>tc(t,!0)(e),tc=(t,e)=>n=>Lo(r=>Nn(vo(r,Hi),{onNone:()=>n(Ke),onSome:s=>{if(e===!0){const i=t._tag==="Parallel"?uw:t._tag==="Sequential"?fw:V3(t.parallelism);switch(s.strategy._tag){case"Parallel":return i(n(uw));case"Sequential":return i(n(fw));case"ParallelN":return i(n(V3(s.strategy.parallelism)))}}else return n(Ke)}})),rd=t=>U(Hi,t),yU=t=>U(jl(),e=>FU(t,e)),fw=t=>Lo(e=>Nn(vo(e,Hi),{onNone:()=>t,onSome:n=>{switch(n.strategy._tag){case"Sequential":return t;case"Parallel":case"ParallelN":return U(Lf(n,yb),r=>zo(t,r))}}})),bU=(t,e)=>K3([Qp(t,e)]),K3=t=>$s(kl,e=>Xc(e,t)),wU=w(2,(t,e)=>dp(jl(),n=>U(zo(t,n),e),(n,r)=>xl(n,r))),SU=w(t=>rn(t[1]),(t,e,n)=>Q3(t,e,(r,s)=>[r,s],n)),Q3=w(t=>rn(t[1]),(t,e,n,r)=>ni(Ul(fr(t),fr(e),(s,i)=>Mf(s,i,{onSuccess:n,onFailure:(o,l)=>r!=null&&r.concurrent?gs(o,l):zn(o,l)}),r))),EU=w(t=>Ti(t[0]),(t,e,n)=>qf(bs(t,(r,s)=>qf(e(r,s)),n))),vU=t=>$s(Kn,zt(Wi,t)),NU=t=>$s(Kn,zt($p,t)),kU=t=>$s(Kn,zt(Pp,t)),xU=t=>rd(e=>U(Lf(e,Cl),n=>I(t,zo(n),qe(r=>[Li(s=>xl(n,mk(s))),r])))),qU=w(t=>rn(t[1]),(t,e,n)=>Ul(t,e,(r,s)=>[r,s],n)),OU=w(t=>rn(t[1]),(t,e,n)=>(n==null?void 0:n.concurrent)!==!0&&((n==null?void 0:n.batching)===void 0||n.batching===!1)?Af(t,e):Ul(t,e,(r,s)=>r,n)),IU=w(t=>rn(t[1]),(t,e,n)=>(n==null?void 0:n.concurrent)!==!0&&((n==null?void 0:n.batching)===void 0||n.batching===!1)?sn(t,e):Ul(t,e,(r,s)=>s,n)),Ul=w(t=>rn(t[1]),(t,e,n,r)=>qe(Bl([t,e],{concurrency:r!=null&&r.concurrent?2:1,batching:r==null?void 0:r.batching,concurrentFinalizers:r==null?void 0:r.concurrentFinalizers}),([s,i])=>n(s,i))),TU=t=>t===k$?ft:I(tb,U(e=>{const n=La(e,t),r=$i(n,e);return I(Tf(t),sn(fm(()=>Tf(r))),er)}),Ro),Hi=xr("effect/Scope"),H3=Hi,AU=(t,e)=>{t.state._tag==="Open"&&t.state.finalizers.add(e)},CU={[ik]:ik,[ok]:ok,pipe(){return et(this,arguments)},fork(t){return he(()=>{const e=J3(t);if(this.state._tag==="Closed")return e.state=this.state,e;const n=r=>e.close(r);return this.state.finalizers.add(n),AU(e,r=>he(()=>{this.state._tag==="Open"&&this.state.finalizers.delete(n)})),e})},close(t){return je(()=>{if(this.state._tag==="Closed")return ft;const e=Array.from(this.state.finalizers.values()).reverse();return this.state={_tag:"Closed",exit:t},e.length===0?ft:dD(this.strategy)?I(Gr(e,n=>fr(n(t))),U(n=>I(Ha(n),df(ub),nn(()=>Dr)))):hD(this.strategy)?I(dm(e,n=>fr(n(t)),!1),U(n=>I(Ha(n,{parallel:!0}),df(ub),nn(()=>Dr)))):I(lw(e,this.strategy.parallelism,n=>fr(n(t)),!1),U(n=>I(Ha(n,{parallel:!0}),df(ub),nn(()=>Dr))))})},addFinalizer(t){return je(()=>this.state._tag==="Closed"?t(this.state.exit):(this.state.finalizers.add(t),ft))}},J3=(t=Cl)=>{const e=Object.create(CU);return e.strategy=t,e.state={_tag:"Open",finalizers:new Set},e},jl=(t=Cl)=>he(()=>J3(t)),zo=w(2,(t,e)=>hb(t,Jc(lf(Hi,e)))),FU=w(2,(t,e)=>I(t,zo(e),si(n=>e.close(n)))),RU=t=>vl(t,{differ:U6,fork:Zf}),dw=w(2,(t,e)=>er(M3(U(ii(t),n=>wn(Rf(t,e),n)),n=>Rf(t,n)))),$s=w(2,(t,e)=>Cs(t,n=>dw(t,e(n)))),G3=FL(v$),Y3=RU(am),PU=t=>bs(t,Hb),X3=t=>({..._b,commit(){return ai(this)},[Kb]:Qb,id:()=>bt(t).reduce((n,r)=>Yv(n,r.id()),qo),await:fr(dm(t,n=>ni(n.await),!1)),children:qe(dm(t,n=>n.children,!1),Sv),inheritAll:Co(t,n=>n.inheritAll),poll:qe(Gr(t,n=>n.poll),bR(de(pn(new Array)),(n,r)=>{switch(r._tag){case"None":return ce();case"Some":switch(n._tag){case"None":return ce();case"Some":return de(Mf(r.value,n.value,{onSuccess:(s,i)=>[s,...i],onFailure:gs}))}}})),interruptAsFork:n=>Co(t,r=>r.interruptAsFork(n))}),Z3=w(3,(t,e,n)=>tq(t,e,{onSelfWin:(r,s)=>U(r.await,i=>{switch(i._tag){case Yn:return U(r.inheritAll,()=>n.onSelfDone(i,s));case Gn:return n.onSelfDone(i,s)}}),onOtherWin:(r,s)=>U(r.await,i=>{switch(i._tag){case Yn:return U(r.inheritAll,()=>n.onOtherDone(i,s));case Gn:return n.onOtherDone(i,s)}})})),$U=t=>tr(e=>Li(n=>U(nd(e(t)),r=>I(e(ai(r)),Mi(()=>I(r,S4(n))))))),eq=w(2,(t,e)=>Li(n=>Z3(t,e,{onSelfDone:(r,s)=>Tp(r,{onFailure:i=>I(ai(s),Yp(o=>gs(i,o))),onSuccess:i=>I(s,Di(n),wn(i))}),onOtherDone:(r,s)=>Tp(r,{onFailure:i=>I(ai(s),Yp(o=>gs(o,i))),onSuccess:i=>I(s,Di(n),wn(i))})}))),tq=w(3,(t,e,n)=>It((r,s)=>{const i=s.runtimeFlags,o=al(!0),l=hm(t,r,i,n.selfScope),f=hm(e,r,i,n.otherScope);return ur(m=>{l.addObserver(()=>nq(l,f,n.onSelfWin,o,m)),f.addObserver(()=>nq(f,l,n.onOtherWin,o,m)),l.startFork(t),f.startFork(e)},Yv(l.id(),f.id()))})),nq=(t,e,n,r,s)=>{Qv(!0,!1)(r)&&s(n(t,e))},Vo=w(2,(t,e)=>tr(n=>Ln(n(t),{onFailure:r=>Ln(e,{onFailure:s=>At(zn(r,s)),onSuccess:()=>At(r)}),onSuccess:r=>wn(e,r)}))),LU=(t,e,n)=>Li(r=>U(U(nd(Va(t)),s=>ur(i=>{const o=e.map(m=>m.listeners.count),l=()=>{o.every(m=>m===0)&&e.every(m=>m.result.state.current._tag==="Pending"?!0:!!(m.result.state.current._tag==="Done"&&lb(m.result.state.current.effect)&&m.result.state.current.effect._tag==="Failure"&&IN(m.result.state.current.effect.cause)))&&(f.forEach(m=>m()),n==null||n(),i(Ff(s)))};s.addObserver(m=>{f.forEach(S=>S()),i(m)});const f=e.map((m,S)=>{const N=O=>{o[S]=O,l()};return m.listeners.addObserver(N),()=>m.listeners.removeObserver(N)});return l(),he(()=>{f.forEach(m=>m())})})),()=>je(()=>{const s=e.flatMap(i=>i.state.completed?[]:[i]);return Co(s,i=>R6(i.request,mk(r)))}))),hw=(t,e)=>(e=Ya(e),Ro(It(n=>{const r=uf(n.getFiberRef(_s),Hi),s=Lb(n,t,e),i=n.getFiberRef(kp),o=Eo(n.getFiberRef(Kn),Wi);return wn(xp(r,l=>t3(s,l,o,i)),s)}))),MU=t=>$s(Kn,zt(Al,t)),DU=function(){const t=typeof arguments[0]!="string",e=t?arguments[1]:arguments[0],n=Ya(t?arguments[2]:arguments[1]);if(t){const r=arguments[0];return U(hw(e,Ya(n)),s=>Zp(r,Do,s))}return r=>U(hw(e,Ya(n)),s=>Zp(r,Do,s))},rq=Ma,WU=Ir,BU=Ts,UU=IN,sq=Da,jU=X$,pm=Symbol.for("effect/ScheduleInterval"),iq={[pm]:pm,startMillis:0,endMillis:0},oq=(t,e)=>t>e?iq:{[pm]:pm,startMillis:t,endMillis:e},zU=w(2,(t,e)=>VU(t,e)===t),VU=w(2,(t,e)=>t.endMillis<=e.startMillis?t:e.endMillis<=t.startMillis?e:t.startMillis<e.startMillis?t:e.startMillis<t.startMillis?e:t.endMillis<=e.endMillis?t:e),KU=t=>t.startMillis>=t.endMillis,QU=w(2,(t,e)=>{const n=Math.max(t.startMillis,e.startMillis),r=Math.min(t.endMillis,e.endMillis);return oq(n,r)}),HU=t=>oq(t,Number.POSITIVE_INFINITY),aq=iq,JU=zU,GU=KU,YU=QU,XU=HU,cq=Symbol.for("effect/ScheduleIntervals"),lq=t=>({[cq]:cq,intervals:t}),ZU=w(2,(t,e)=>ej(t.intervals,e.intervals,Jr())),ej=(t,e,n)=>{let r=t,s=e,i=n;for(;qs(r)&&qs(s);){const o=I(ms(r),YU(ms(s))),l=GU(o)?i:I(i,lr(o));I(ms(r),JU(ms(s)))?r=Os(r):s=Os(s),i=l}return lq(Ri(i))},pw=t=>I(t.intervals,Ov,nn(()=>aq)).startMillis,tj=t=>I(t.intervals,Ov,nn(()=>aq)).endMillis,nj=w(2,(t,e)=>pw(t)<pw(e)),rj=t=>qs(t.intervals),sj=lq,ij=ZU,oj=pw,uq=tj,aj=nj,cj=rj,mw="Continue",fq="Done",lj=t=>({_tag:mw,intervals:t}),uj=t=>({_tag:mw,intervals:sj(Zn(t))}),fj={_tag:fq},dj=t=>t._tag===mw,hj=t=>t._tag===fq,pj=lj,mj=uj,sd=fj,dq=dj,mm=hj,gj=Hi,_j=ak,zl=xl,gw=zo,yj=Lf,hq=jl,pq=f2,mq=Symbol.for("effect/Schedule"),gq=t=>it(t,mq),bj=Symbol.for("effect/ScheduleDriver"),wj={_Out:t=>t,_In:t=>t,_R:t=>t},Sj={_Out:t=>t,_In:t=>t,_R:t=>t};class Ej{constructor(e,n){g(this,"initial");g(this,"step");g(this,Rne,wj);this.initial=e,this.step=n}pipe(){return et(this,arguments)}}Rne=mq;class vj{constructor(e,n){g(this,"schedule");g(this,"ref");g(this,Pne,Sj);this.schedule=e,this.ref=n}get state(){return qe(Ui(this.ref),e=>e[1])}get last(){return U(Ui(this.ref),([e,n])=>{switch(e._tag){case"None":return As(()=>new Po);case"Some":return se(e.value)}})}get reset(){return $l(this.ref,[ce(),this.schedule.initial])}next(e){return I(qe(Ui(this.ref),n=>n[1]),U(n=>I(Ix,U(r=>I(je(()=>this.schedule.step(r,e,n)),U(([s,i,o])=>{const l=$l(this.ref,[de(i),s]);if(mm(o))return sn(l,vt(ce()));const f=oj(o.intervals)-r;return f<=0?wn(l,i):I(l,sn(Pb(Dh(f))),wn(i))}))))))}}Pne=bj;const id=(t,e)=>new Ej(t,e),Nj=w(2,(t,e)=>_w(t,(n,r)=>he(()=>e(n,r)))),_w=w(2,(t,e)=>id(t.initial,(n,r,s)=>U(t.step(n,r,s),([i,o,l])=>mm(l)?se([i,o,sd]):qe(e(r,o),f=>f?[i,o,l]:[i,o,sd])))),yw=t=>I(jp([ce(),t.initial]),qe(e=>new vj(t,e))),_q=w(2,(t,e)=>kj(t,e,ij)),kj=w(3,(t,e,n)=>id([t.initial,e.initial],(r,s,i)=>I(Cf(t.step(r,s,i[0]),e.step(r,s,i[1]),(o,l)=>[o,l]),U(([[o,l,f],[m,S,N]])=>dq(f)&&dq(N)?bw(t,e,s,o,l,f.intervals,m,S,N.intervals,n):se([[o,m],[l,S],sd]))))),bw=(t,e,n,r,s,i,o,l,f,m)=>{const S=m(i,f);return cj(S)?se([[r,o],[s,l],pj(S)]):I(i,aj(f))?U(t.step(uq(i),n,r),([N,O,M])=>mm(M)?se([[N,o],[O,l],sd]):bw(t,e,n,N,O,M.intervals,o,l,f,m)):U(e.step(uq(f),n,o),([N,O,M])=>mm(M)?se([[r,N],[s,O],sd]):bw(t,e,n,r,s,i,N,O,M.intervals,m))},xj=w(2,(t,e)=>qj(t,n=>he(()=>e(n)))),qj=w(2,(t,e)=>id(t.initial,(n,r,s)=>U(t.step(n,r,s),([i,o,l])=>qe(e(o),f=>[i,f,l])))),Oj=t=>id(t.initial,(e,n,r)=>I(t.step(e,n,r),qe(([s,i,o])=>[s,n,o]))),ww=t=>Tj(Sw,e=>e<t),Ij=(t,e)=>id(t,(n,r,s)=>he(()=>[e(s),s,mj(XU(n))])),yq=w(2,(t,e)=>_w(t,(n,r)=>Bx(e(n)))),bq=w(2,(t,e)=>_w(t,(n,r)=>e(n))),Tj=w(2,(t,e)=>Nj(t,(n,r)=>e(r))),gm=Symbol.for("effect/Schedule/ScheduleDefect");class Aj{constructor(e){g(this,"error");g(this,$ne);this.error=e,this[gm]=gm}}$ne=gm;const Cj=t=>it(t,gm),_m=t=>Ao(t,e=>Ua(new Aj(e))),wq=t=>Ba(t,e=>Nn(Nf(e,n=>Ky(n)&&Cj(n.defect)?de(n.defect):ce()),{onNone:()=>At(e),onSome:n=>vt(n.error)})),Sq=w(2,(t,e)=>Eq(t,e,(n,r)=>vt(n))),Fj=w(2,(t,e)=>{if(gq(e))return Sq(t,e);const n=e.schedule??Oj(Sw),r=e.while?bq(n,o=>{const l=e.while(o);return typeof l=="boolean"?se(l):_m(l)}):n,s=e.until?yq(r,o=>{const l=e.until(o);return typeof l=="boolean"?se(l):_m(l)}):r,i=e.times?_q(s,ww(e.times)).pipe(xj(o=>o[0])):s;return wq(Sq(t,i))}),Eq=w(3,(t,e,n)=>U(yw(e),r=>Tr(t,{onFailure:s=>n(s,ce()),onSuccess:s=>vq(t,r,n,s)}))),vq=(t,e,n,r)=>Tr(e.next(r),{onFailure:()=>bp(e.last),onSuccess:s=>Tr(t,{onFailure:i=>n(i,de(s)),onSuccess:i=>vq(t,e,n,i)})}),Nq=w(2,(t,e)=>kq(t,e,(n,r)=>vt(n))),Rj=w(2,(t,e)=>{if(gq(e))return Nq(t,e);const n=e.schedule??Sw,r=e.while?bq(n,o=>{const l=e.while(o);return typeof l=="boolean"?se(l):_m(l)}):n,s=e.until?yq(r,o=>{const l=e.until(o);return typeof l=="boolean"?se(l):_m(l)}):r,i=e.times?_q(s,ww(e.times)):s;return wq(Nq(t,i))}),kq=w(3,(t,e,n)=>U(yw(e),r=>xq(t,r,n))),xq=(t,e,n)=>Ao(t,r=>Tr(e.next(r),{onFailure:()=>I(e.last,bp,U(s=>n(r,s))),onSuccess:()=>xq(t,e,n)})),qq=w(2,(t,e)=>Oq(t,void 0,e)),Oq=w(3,(t,e,n)=>U(yw(n),r=>Iq(t,e,r))),Iq=(t,e,n)=>Tr(n.next(e),{onFailure:()=>bp(n.last),onSuccess:()=>U(t,r=>Iq(t,r,n))}),Sw=Ij(0,t=>t+1);class Pj{constructor(e){g(this,"permits");g(this,"waiters",new Set);g(this,"taken",0);g(this,"take",e=>ur(n=>{if(this.free<e){const r=()=>{this.free<e||(this.waiters.delete(r),this.taken+=e,n(se(e)))};return this.waiters.add(r),he(()=>{this.waiters.delete(r)})}return this.taken+=e,n(se(e))}));g(this,"updateTaken",e=>It(n=>(this.taken=e(this.taken),this.waiters.size>0&&n.getFiberRef(Vp).scheduleTask(()=>{const r=this.waiters.values();let s=r.next();for(;s.done===!1&&this.free>0;)s.value(),s=r.next()},n.getFiberRef(Nl)),se(this.free))));g(this,"release",e=>this.updateTaken(n=>n-e));g(this,"releaseAll",this.updateTaken(e=>0));g(this,"withPermits",e=>n=>tr(r=>U(r(this.take(e)),s=>Vo(r(n),this.release(s)))));g(this,"withPermitsIfAvailable",e=>n=>tr(r=>je(()=>this.free<e?zf:(this.taken+=e,Vo(r(Hp(n)),this.release(e))))));this.permits=e}get free(){return this.permits-this.taken}}const Ew=t=>new Pj(t),$j=t=>he(()=>Ew(t));class Lj extends Bf{constructor(n){super();g(this,"isOpen");g(this,"waiters",[]);g(this,"scheduled",!1);g(this,"flushWaiters",()=>{this.scheduled=!1;const n=this.waiters;this.waiters=[];for(let r=0;r<n.length;r++)n[r](Dr)});g(this,"open",It(n=>this.isOpen?ft:(this.isOpen=!0,this.unsafeSchedule(n))));g(this,"release",It(n=>this.isOpen?ft:this.unsafeSchedule(n)));g(this,"await",zN(n=>this.isOpen?n(ft):(this.waiters.push(n),he(()=>{const r=this.waiters.indexOf(n);r!==-1&&this.waiters.splice(r,1)}))));g(this,"close",he(()=>{this.isOpen=!1}));g(this,"whenOpen",n=>sn(this.await,n));this.isOpen=n}commit(){return this.await}unsafeSchedule(n){return this.scheduled||this.waiters.length===0||(this.scheduled=!0,n.currentScheduler.scheduleTask(this.flushWaiters,n.getFiberRef(Nl))),ft}}const Tq=t=>new Lj(t??!1),Mj=t=>he(()=>Tq(t)),Dj=t=>vw(t,PU),Wj=w(2,(t,e)=>qe(Aq(t,e),n=>n[0])),Aq=w(2,(t,e)=>{const n=Or(e);return U($o(),r=>qe(bm(ce()),s=>[Mo(Bj(t,n,s),r),Uj(s)]))}),Cq=(t,e,n)=>{const r=Gc(Or(e));return I(oi(),Fo(s=>El(t,s)),qe(s=>de([n+r,s])))},Bj=(t,e,n)=>tr(r=>I(Za(s=>s.currentTimeMillis),U(s=>n8(n,i=>{switch(i._tag){case"None":return de(Cq(t,e,s));case"Some":{const[o]=i.value;return o-s<=0?de(Cq(t,e,s)):ce()}}})),U(s=>tn(s)?mp("BUG: Effect.cachedInvalidate - please report an issue at https://github.com/Effect-TS/effect/issues"):r(Ar(s.value[1]))))),Uj=t=>$l(t,ce()),jj=w(2,(t,e)=>vw(t,n=>e(X3(n)))),vw=w(2,(t,e)=>U(L6,n=>I($q(t,n),Vo(U(n.value,e))))),zj=w(t=>Ti(t[0]),(t,e)=>e!=null&&e.discard?Co(t,Qi):qe(Gr(t,Qi),X3)),Fq=w(2,(t,e)=>tr(n=>U(e.fork(Cl),r=>I(n(t),si(s=>r.close(s)),nd,Fo(s=>r.addFinalizer(()=>Li(i=>ot(i,s.id())?ft:er(Ff(s))))))))),Rq=t=>rd(e=>Fq(t,e)),Vj=t=>ai(t),Kj=t=>je(()=>U(t,ai)),Nw=Symbol.for("effect/Effect/memoizeFunction.key");class Pq{constructor(e,n){g(this,"a");g(this,"eq");g(this,Lne,Nw);this.a=e,this.eq=n}[(Lne=Nw,yt)](e){return it(e,Nw)?this.eq?this.eq(this.a,e.a):ot(this.a,e.a):!1}[_t](){return this.eq?0:hn(this,Qe(this.a))}}const Qj=(t,e)=>I(he(()=>sm()),U(bm),qe(n=>r=>I(n.modifyEffect(s=>{const i=I(s,nr(new Pq(r,e)));return tn(i)?I(oi(),Fo(o=>I(Fb(t(r)),El(o),Qi)),qe(o=>[o,I(s,Ps(new Pq(r,e),o))])):se([i.value,s])}),U(Ar),U(([s,i])=>I(Xp(s),wn(i)))))),Hj=w(2,(t,e)=>I(fr(t),eq(fr(e)),n=>ni(n))),Jj=w(2,(t,e)=>I(t,qq(e),Rq)),$q=w(2,(t,e)=>Yr(Y3,r=>r.zip(e))(t)),Gj=w(2,(t,e)=>Lq(t,{onTimeout:()=>jL(e),duration:e})),Lq=w(2,(t,{duration:e,onTimeout:n})=>ni(ym(t,{onTimeout:()=>As(n),onSuccess:se,duration:e}))),Yj=w(2,(t,{duration:e,onTimeout:n})=>ni(ym(t,{onTimeout:()=>_p(n),onSuccess:se,duration:e}))),Xj=w(2,(t,e)=>ym(t,{duration:e,onSuccess:de,onTimeout:ce})),ym=w(2,(t,{duration:e,onSuccess:n,onTimeout:r})=>Li(s=>tq(t,Va(Pb(e)),{onSelfWin:(i,o)=>U(i.await,l=>l._tag==="Success"?U(i.inheritAll,()=>wn(Di(o,s),n(l.value))):U(Di(o,s),()=>Qt(l.cause))),onOtherWin:(i,o)=>U(i.await,l=>l._tag==="Success"?U(i.inheritAll,()=>wn(Di(o,s),r())):U(Di(o,s),()=>Qt(l.cause))),otherScope:Kf}))),Zj=Symbol.for("effect/Ref/SynchronizedRef"),e8={_A:t=>t};class t8 extends Bf{constructor(n,r){super();g(this,"ref");g(this,"withLock");g(this,Mne,e8);g(this,Dne,wx);g(this,Wne,Up);g(this,"get");this.ref=n,this.withLock=r,this.get=Ui(this.ref)}commit(){return this.get}modify(n){return this.modifyEffect(r=>se(n(r)))}modifyEffect(n){return this.withLock(I(U(Ui(this.ref),n),U(([r,s])=>wn($l(this.ref,s),r))))}}Mne=Zj,Dne=bx,Wne=Up;const bm=t=>he(()=>Mq(t)),Mq=t=>{const e=Sx(t),n=Ew(1);return new t8(e,n.withPermits(1))},n8=w(2,(t,e)=>t.modifyEffect(n=>{const r=e(n);switch(r._tag){case"None":return se([n,n]);case"Some":return qe(r.value,s=>[s,s])}})),r8=w(t=>rn(t[0]),(t,e,n)=>U(t,r=>Bl(e(r),n).pipe(qe(s=>Object.assign({},r,s))))),kw=Symbol.for("effect/ManagedRuntime"),s8="Fold",i8="Fresh",o8="FromEffect",a8="Scoped",c8="Suspend",l8="Provide",u8="ProvideMerge",f8="ZipWith",d8=Hb,Vl=Ff,h8=Di,Dq=ai,Kl=t=>(e,n)=>{const r=Xv(),s=[[_s,[[r,t.context]]]];n!=null&&n.scheduler&&s.push([Vp,[[r,n.scheduler]]]);let i=ND(t.fiberRefs,{entries:s,forkAs:r});n!=null&&n.updateRefs&&(i=n.updateRefs(i,r));const o=new P3(r,i,t.runtimeFlags);let l=e;n!=null&&n.scope&&(l=U(yj(n.scope,Cl),m=>sn(ak(m,Li(S=>ot(S,o.id())?ft:Di(o,S))),si(e,S=>zl(m,S)))));const f=o.currentSupervisor;return f!==am&&(f.onStart(t.context,l,ce(),o),o.addObserver(m=>f.onEnd(m,o))),Kf.add(t.runtimeFlags,o),(n==null?void 0:n.immediate)===!1?o.resume(l):o.start(l),o},od=t=>(e,n={})=>{const r=Kl(t)(e,n);return n.onExit&&r.addObserver(s=>{n.onExit(s)}),(s,i)=>od(t)(I(r,h8(s??qo)),{...i,onExit:i!=null&&i.onExit?o=>i.onExit(d4(o)):void 0})},xw=t=>e=>{const n=Iw(t)(e);if(n._tag==="Failure")throw Wq(n.effect_instruction_i0);return n.effect_instruction_i0};class p8 extends Error{constructor(n){super(`Fiber #${n.id().id} cannot be resolved synchronously. This is caused by using runSync on an effect that performs async work`);g(this,"fiber");g(this,"_tag","AsyncFiberException");this.fiber=n,this.name=this._tag,this.stack=this.message}}const m8=t=>{const e=Error.stackTraceLimit;Error.stackTraceLimit=0;const n=new p8(t);return Error.stackTraceLimit=e,n},qw=Symbol.for("effect/Runtime/FiberFailure"),Ow=Symbol.for("effect/Runtime/FiberFailure/Cause");class g8 extends Error{constructor(n){super();g(this,Bne);g(this,Une);this[qw]=qw,this[Ow]=n;const r=DN(n);if(r.length>0){const s=r[0];this.name=s.name,this.message=s.message,this.stack=s.stack}this.name=`(FiberFailure) ${this.name}`,(this.message===void 0||this.message.length===0)&&(this.message="An error has occurred")}toJSON(){return{_id:"FiberFailure",cause:this[Ow].toJSON()}}toString(){return"(FiberFailure) "+(this.stack??this.message)}[(Bne=qw,Une=Ow,Zt)](){return this.toString()}}const Wq=t=>{const e=Error.stackTraceLimit;Error.stackTraceLimit=0;const n=new g8(t);return Error.stackTraceLimit=e,n},Bq=t=>{const e=t;switch(e._op){case"Failure":case"Success":return e;case"Left":return fb(e.left);case"Right":return pn(e.right);case"Some":return pn(e.value);case"None":return fb(Po())}},Iw=t=>e=>{const n=Bq(e);if(n)return n;const r=new uW,s=Kl(t)(e,{scheduler:r});r.flush();const i=s.unsafePoll();return i||ql(Xy(m8(s),pb(s)))},Uq=t=>(e,n)=>Tw(t)(e,n).then(r=>{switch(r._tag){case Yn:return r.effect_instruction_i0;case Gn:throw Wq(r.effect_instruction_i0)}}),Tw=t=>(e,n)=>new Promise(r=>{const s=Bq(e);s&&r(s);const i=Kl(t)(e);i.addObserver(o=>{r(o)}),(n==null?void 0:n.signal)!==void 0&&(n.signal.aborted?i.unsafeInterruptAsFork(i.id()):n.signal.addEventListener("abort",()=>{i.unsafeInterruptAsFork(i.id())},{once:!0}))});class jq{constructor(e,n,r){g(this,"context");g(this,"runtimeFlags");g(this,"fiberRefs");this.context=e,this.runtimeFlags=n,this.fiberRefs=r}pipe(){return et(this,arguments)}}const _8=t=>new jq(t.context,t.runtimeFlags,t.fiberRefs),Aw=()=>It((t,e)=>se(new jq(t.getFiberRef(_s),e.runtimeFlags,t.getFiberRefs()))),Ji=_8({context:Ns(),runtimeFlags:mN($a,pN,hN),fiberRefs:kD()}),y8=od(Ji),zq=Kl(Ji),wm=Uq(Ji),Vq=Tw(Ji),Sm=xw(Ji),Kq=Iw(Ji),b8=t=>je(()=>{let e;return U(oi(),n=>U(Aw(),r=>tr(s=>sn(Qi(s(Ln(t(i=>od(r)(El(i,n))),{onFailure:i=>Ap(n,i),onSuccess:i=>(e=i,ft)}))),s(Mi(Ar(n),()=>e??ft))))))}),w8=w(2,(t,e)=>t.modifyEffect(n=>qe(e(n),r=>[n,r]))),S8=w(2,(t,e)=>t.modifyEffect(e)),Qq=Symbol.for("effect/Layer"),E8={_RIn:t=>t,_E:t=>t,_ROut:t=>t},nc={[Qq]:E8,pipe(){return et(this,arguments)}},Cw=Symbol.for("effect/Layer/MemoMap"),v8=t=>it(t,Qq),N8=t=>t._op_layer===i8;class Hq{constructor(e){g(this,"ref");g(this,jne);this.ref=e,this[Cw]=Cw}getOrElseMemoize(e,n){return I(S8(this.ref,r=>{const s=r.get(e);if(s!==void 0){const[i,o]=s,l=I(i,U(([f,m])=>I(Xp(f),wn(m))),si(Ip({onFailure:()=>ft,onSuccess:()=>xp(n,o)})));return se([l,r])}return I(jp(0),U(i=>I(oi(),U(o=>I(jp(()=>ft),qe(l=>{const f=tr(S=>I(jl(),U(N=>I(S(U(Fw(e,N,!0),O=>Fb(O(this)))),fr,U(O=>{switch(O._tag){case Gn:return I(Ap(o,O.effect_instruction_i0),sn(xl(N,O)),sn(At(O.effect_instruction_i0)));case Yn:return I($l(l,M=>I(xl(N,M),wp(Ex(i,z=>[z===1,z-1])),er)),sn(Tb(i,M=>M+1)),sn(xp(n,M=>I(he(()=>r.delete(e)),sn(Ui(l)),U(z=>z(M))))),sn(Cp(o,O.effect_instruction_i0)),wn(O.effect_instruction_i0[1]))}}))))),m=[I(Ar(o),si(Tp({onFailure:()=>ft,onSuccess:()=>Tb(i,S=>S+1)}))),S=>I(Ui(l),U(N=>N(S)))];return[f,N8(e)?r:r.set(e,m)]}))))))}),ni)}}jne=Cw;const k8=je(()=>qe(bm(new Map),t=>new Hq(t))),x8=()=>new Hq(Mq(new Map)),Jq=w(2,(t,e)=>U(k8,n=>U(Fw(t,e),r=>r(n)))),q8=w(3,(t,e,n)=>U(Fw(t,n),r=>r(e))),Fw=(t,e,n=!1)=>{const r=t;switch(r._op_layer){case"Locally":return he(()=>s=>r.f(s.getOrElseMemoize(r.self,e)));case"ExtendScope":return he(()=>s=>rd(i=>s.getOrElseMemoize(r.layer,i)));case"Fold":return he(()=>s=>I(s.getOrElseMemoize(r.layer,e),Ln({onFailure:i=>s.getOrElseMemoize(r.failureK(i),e),onSuccess:i=>s.getOrElseMemoize(r.successK(i),e)})));case"Fresh":return he(()=>s=>I(r.layer,Jq(e)));case"FromEffect":return he(n?()=>s=>r.effect:()=>s=>s.getOrElseMemoize(t,e));case"Provide":return he(()=>s=>I(s.getOrElseMemoize(r.first,e),U(i=>I(s.getOrElseMemoize(r.second,e),Mo(i)))));case"Scoped":return he(n?()=>s=>zo(r.effect,e):()=>s=>s.getOrElseMemoize(t,e));case"Suspend":return he(()=>s=>s.getOrElseMemoize(r.evaluate(),e));case"ProvideMerge":return he(()=>s=>I(s.getOrElseMemoize(r.first,e),Cf(s.getOrElseMemoize(r.second,e),r.zipK)));case"ZipWith":return he(()=>s=>I(s.getOrElseMemoize(r.first,e),Ul(s.getOrElseMemoize(r.second,e),r.zipK,{concurrent:!0})))}},O8=()=>ad($o()),I8=t=>Gq(rq(t)),Gq=t=>ad(At(t)),T8=w(2,(t,e)=>C8(t,{onFailure:I8,onSuccess:e})),Yq=w(2,(t,e)=>{const n=Rh(t),r=n?t:e;return ad(qe(n?e:t,i=>lf(r,i)))});function ad(t){const e=Object.create(nc);return e._op_layer=o8,e.effect=t,e}const A8=w(2,(t,{onFailure:e,onSuccess:n})=>{const r=Object.create(nc);return r._op_layer=s8,r.layer=t,r.failureK=e,r.successK=n,r}),C8=w(2,(t,{onFailure:e,onSuccess:n})=>A8(t,{onFailure:r=>{const s=sq(r);switch(s._tag){case"Left":return e(s.left);case"Right":return Gq(s.right)}},onSuccess:n})),F8=w(2,(t,e)=>L8(t,e,(n,r)=>Jc(n,r))),Rw=(...t)=>{let e=t[0];for(let n=1;n<t.length;n++)e=F8(e,t[n]);return e},R8=w(2,(t,e)=>{const n=Rh(t),r=n?t:e;return Xq(qe(n?e:t,i=>lf(r,i)))}),Pw=t=>Xq(I(t,wn(Ns()))),Xq=t=>{const e=Object.create(nc);return e._op_layer=a8,e.effect=t,e},Zq=w(2,(t,e)=>{const n=Rh(t);return ad(se(lf(n?t:e,n?e:t)))}),eO=t=>{const e=Object.create(nc);return e._op_layer=c8,e.evaluate=t,e},P8=w(2,(t,e)=>{const n=Rh(t),r=n?t:e,s=n?e:t;return ad(he(()=>lf(r,s())))}),$8=w(2,(t,e)=>U(rd(n=>q8(t,e,n)),n=>I(Aw(),Mo(n)))),tO=w(2,(t,e)=>eO(()=>{const n=Object.create(nc);return n._op_layer=l8,n.first=Object.create(nc,{_op_layer:{value:u8,enumerable:!0},first:{value:O8(),enumerable:!0},second:{value:Array.isArray(e)?Rw(...e):e},zipK:{value:(r,s)=>I(r,Jc(s))}}),n.second=t,n})),L8=w(3,(t,e,n)=>eO(()=>{const r=Object.create(nc);return r._op_layer=f8,r.first=t,r.second=e,r.zipK=n,r})),nO=w(2,(t,e)=>dp(jl(),n=>U(Jq(e,n),r=>db(t,r)),(n,r)=>xl(n,r))),rO=w(2,(t,e)=>{const n=Uf(Ji.fiberRefs,e.fiberRefs),r=$i(Ji.runtimeFlags,e.runtimeFlags);return tr(s=>It(i=>{const o=i.getFiberRef(_s),l=i.getFiberRefs(),f=jf(i.id(),l)(n),m=i.currentRuntimeFlags,S=La(r)(m),N=Uf(f,l),O=$i(S,m);return i.setFiberRefs(f),i.currentRuntimeFlags=S,Vo(db(s(t),Jc(o,e.context)),It(M=>(M.setFiberRefs(jf(M.id(),M.getFiberRefs())(N)),M.currentRuntimeFlags=La(O)(M.currentRuntimeFlags),ft)))}))}),M8=w(2,(t,e)=>Array.isArray(e)?nO(t,Rw(...e)):v8(e)?nO(t,e):l2(e)?db(t,e):kw in e?U(e.runtimeEffect,n=>rO(t,n)):rO(t,e)),D8=t=>Pw(dw($3,t)),W8=t=>Pw($s(cw,ol(t))),B8=t=>Pw($s(cw,Iy(t))),U8=w(2,(t,e)=>T8(B8(t),()=>W8(e))),sO=Symbol.for("effect/MutableList"),j8={[sO]:sO,[Symbol.iterator](){let t=!1,e=this.head;return{next(){if(t)return this.return();if(e==null)return t=!0,this.return();const n=e.value;return e=e.next,{done:t,value:n}},return(n){return t||(t=!0),{done:!0,value:n}}}},toString(){return vn(this.toJSON())},toJSON(){return{_id:"MutableList",values:Array.from(this).map(gn)}},[Zt](){return this.toJSON()},pipe(){return et(this,arguments)}},z8=t=>({value:t,removed:!1,prev:void 0,next:void 0}),V8=()=>{const t=Object.create(j8);return t.head=void 0,t.tail=void 0,t._length=0,t},iO=t=>$w(t)===0,$w=t=>t._length,K8=w(2,(t,e)=>{const n=z8(e);return t.head===void 0&&(t.head=n),t.tail===void 0||(t.tail.next=n,n.prev=t.tail),t.tail=n,t._length+=1,t}),Q8=t=>{const e=t.head;if(e!==void 0)return H8(t,e),e.value},H8=(t,e)=>{e.removed||(e.removed=!0,e.prev!==void 0&&e.next!==void 0?(e.prev.next=e.next,e.next.prev=e.prev):e.prev!==void 0?(t.tail=e.prev,e.prev.next=void 0):e.next!==void 0?(t.head=e.next,e.next.prev=void 0):(t.tail=void 0,t.head=void 0),t._length>0&&(t._length-=1))},oO=Symbol.for("effect/MutableQueue"),Er=Symbol.for("effect/mutable/MutableQueue/Empty"),J8={[oO]:oO,[Symbol.iterator](){return Array.from(this.queue)[Symbol.iterator]()},toString(){return vn(this.toJSON())},toJSON(){return{_id:"MutableQueue",values:Array.from(this).map(gn)}},[Zt](){return this.toJSON()},pipe(){return et(this,arguments)}},aO=t=>{const e=Object.create(J8);return e.queue=V8(),e.capacity=t,e},G8=t=>aO(t),Em=()=>aO(void 0),Lw=t=>$w(t.queue),Mw=t=>iO(t.queue),Y8=t=>t.capacity===void 0?1/0:t.capacity,Ql=w(2,(t,e)=>{const n=$w(t.queue);return t.capacity!==void 0&&n===t.capacity?!1:(K8(e)(t.queue),!0)}),cO=w(2,(t,e)=>{const n=e[Symbol.iterator]();let r,s=Jr(),i=!0;for(;i&&(r=n.next())&&!r.done;)i=Ql(r.value)(t);for(;r!=null&&!r.done;)s=lr(r.value)(s),r=n.next();return Ri(s)}),Gi=w(2,(t,e)=>iO(t.queue)?e:Q8(t.queue)),Dw=w(2,(t,e)=>{let n=Jr(),r=0;for(;r<e;){const s=Gi(Er)(t);if(s===Er)break;n=lr(s)(n),r+=1}return Ri(n)}),lO=(t,e,n,r)=>My({_tag:"Complete",key:t,exit:e,entryStats:n,timeToLiveMillis:r}),uO=(t,e)=>My({_tag:"Pending",key:t,deferred:e}),X8=(t,e)=>My({_tag:"Refreshing",deferred:t,complete:e}),Ww=Symbol.for("effect/Cache/MapKey");class Z8{constructor(e){g(this,"current");g(this,zne,Ww);g(this,"previous");g(this,"next");this.current=e}[(zne=Ww,_t)](){return I(Qe(this.current),Ot(Qe(this.previous)),Ot(Qe(this.next)),hn(this))}[yt](e){return this===e?!0:ez(e)&&ot(this.current,e.current)&&ot(this.previous,e.previous)&&ot(this.next,e.next)}}const Hl=t=>new Z8(t),ez=t=>it(t,Ww);class tz{constructor(){g(this,"head");g(this,"tail")}add(e){if(e!==this.tail)if(this.tail===void 0)this.head=e,this.tail=e;else{const n=e.previous,r=e.next;r!==void 0&&(e.next=void 0,n!==void 0?(n.next=r,r.previous=n):(this.head=r,this.head.previous=void 0)),this.tail.next=e,e.previous=this.tail,this.tail=e}}remove(){const e=this.head;if(e!==void 0){const n=e.next;n!==void 0?(e.next=void 0,this.head=n,this.head.previous=void 0):(this.head=void 0,this.tail=void 0)}return e}}const nz=()=>new tz,rz=(t,e,n,r,s,i)=>({map:t,keys:e,accesses:n,updating:r,hits:s,misses:i}),sz=()=>rz(sm(),nz(),Em(),al(!1),0,0),iz=Symbol.for("effect/Cache"),oz={_Key:t=>t,_Error:t=>t,_Value:t=>t},az=Symbol.for("effect/ConsumerCache"),cz={_Key:t=>t,_Error:t=>t,_Value:t=>t},lz=t=>t,vm=t=>({loadedMillis:t});class uz{constructor(e,n,r,s,i){g(this,"capacity");g(this,"context");g(this,"fiberId");g(this,"lookup");g(this,"timeToLive");g(this,Vne,oz);g(this,Kne,cz);g(this,"cacheState");this.capacity=e,this.context=n,this.fiberId=r,this.lookup=s,this.timeToLive=i,this.cacheState=sz()}get(e){return qe(this.getEither(e),lv)}get cacheStats(){return he(()=>lz({hits:this.cacheState.hits,misses:this.cacheState.misses,size:tw(this.cacheState.map)}))}getOption(e){return je(()=>Nn(nr(this.cacheState.map,e),{onNone:()=>{const n=Hl(e);return this.trackAccess(n),this.trackMiss(),se(ce())},onSome:n=>this.resolveMapValue(n)}))}getOptionComplete(e){return je(()=>Nn(nr(this.cacheState.map,e),{onNone:()=>{const n=Hl(e);return this.trackAccess(n),this.trackMiss(),se(ce())},onSome:n=>this.resolveMapValue(n,!0)}))}contains(e){return he(()=>zi(this.cacheState.map,e))}entryStats(e){return he(()=>{const n=nr(this.cacheState.map,e);if(pt(n))switch(n.value._tag){case"Complete":{const r=n.value.entryStats.loadedMillis;return de(vm(r))}case"Pending":return ce();case"Refreshing":{const r=n.value.complete.entryStats.loadedMillis;return de(vm(r))}}return ce()})}getEither(e){return je(()=>{const n=e;let r,s,i=qr(nr(this.cacheState.map,n));return i===void 0&&(s=Bk(this.fiberId),r=Hl(n),zi(this.cacheState.map,n)?i=qr(nr(this.cacheState.map,n)):Ps(this.cacheState.map,n,uO(r,s))),i===void 0?(this.trackAccess(r),this.trackMiss(),qe(this.lookupValueOf(e,s),Mt)):U(this.resolveMapValue(i),Nn({onNone:()=>this.getEither(e),onSome:o=>se(ut(o))}))})}invalidate(e){return he(()=>{Wl(this.cacheState.map,e)})}invalidateWhen(e,n){return he(()=>{const r=nr(this.cacheState.map,e);pt(r)&&r.value._tag==="Complete"&&r.value.exit._tag==="Success"&&n(r.value.exit.value)&&Wl(this.cacheState.map,e)})}get invalidateAll(){return he(()=>{this.cacheState.map=sm()})}refresh(e){return Za(n=>je(()=>{const r=e,s=Bk(this.fiberId);let i=qr(nr(this.cacheState.map,r));if(i===void 0&&(zi(this.cacheState.map,r)?i=qr(nr(this.cacheState.map,r)):Ps(this.cacheState.map,r,uO(Hl(r),s))),i===void 0)return er(this.lookupValueOf(e,s));switch(i._tag){case"Complete":{if(this.hasExpired(n,i.timeToLiveMillis)){const o=qr(nr(this.cacheState.map,r));return ot(o,i)&&Wl(this.cacheState.map,r),er(this.get(e))}return I(this.lookupValueOf(e,s),Jx(()=>{const o=qr(nr(this.cacheState.map,r));if(ot(o,i)){const l=X8(s,i);return Ps(this.cacheState.map,r,l),!0}return!1}),er)}case"Pending":return Qn(i.deferred);case"Refreshing":return Qn(i.deferred)}}))}set(e,n){return Za(r=>he(()=>{const s=r.unsafeCurrentTimeMillis(),i=e,o=Rs(n),l=lO(Hl(i),o,vm(s),s+Gc(Or(this.timeToLive(o))));Ps(this.cacheState.map,i,l)}))}get size(){return he(()=>tw(this.cacheState.map))}get values(){return he(()=>{const e=[];for(const n of this.cacheState.map)n[1]._tag==="Complete"&&n[1].exit._tag==="Success"&&e.push(n[1].exit.value);return e})}get entries(){return he(()=>{const e=[];for(const n of this.cacheState.map)n[1]._tag==="Complete"&&n[1].exit._tag==="Success"&&e.push([n[0],n[1].exit.value]);return e})}get keys(){return he(()=>{const e=[];for(const n of this.cacheState.map)n[1]._tag==="Complete"&&n[1].exit._tag==="Success"&&e.push(n[0]);return e})}resolveMapValue(e,n=!1){return Za(r=>{switch(e._tag){case"Complete":return this.trackAccess(e.key),this.hasExpired(r,e.timeToLiveMillis)?(Wl(this.cacheState.map,e.key.current),se(ce())):(this.trackHit(),qe(e.exit,de));case"Pending":return this.trackAccess(e.key),this.trackHit(),n?se(ce()):qe(Qn(e.deferred),de);case"Refreshing":return this.trackAccess(e.complete.key),this.trackHit(),this.hasExpired(r,e.complete.timeToLiveMillis)?n?se(ce()):qe(Qn(e.deferred),de):qe(e.complete.exit,de)}})}trackHit(){this.cacheState.hits=this.cacheState.hits+1}trackMiss(){this.cacheState.misses=this.cacheState.misses+1}trackAccess(e){if(Ql(this.cacheState.accesses,e),Qv(this.cacheState.updating,!1,!0)){let n=!0;for(;n;){const s=Gi(this.cacheState.accesses,Er);s===Er?n=!1:this.cacheState.keys.add(s)}let r=tw(this.cacheState.map);for(n=r>this.capacity;n;){const s=this.cacheState.keys.remove();s!==void 0?zi(this.cacheState.map,s.current)&&(Wl(this.cacheState.map,s.current),r=r-1,n=r>this.capacity):n=!1}cl(this.cacheState.updating,!1)}}hasExpired(e,n){return e.unsafeCurrentTimeMillis()>n}lookupValueOf(e,n){return Za(r=>je(()=>{const s=e;return I(this.lookup(e),Mo(this.context),fr,U(i=>{const o=r.unsafeCurrentTimeMillis(),l=vm(o),f=lO(Hl(s),i,l,o+Gc(Or(this.timeToLive(i))));return Ps(this.cacheState.map,s,f),sn(rD(n,i),i)}),Mi(()=>sn(iD(n),he(()=>{Wl(this.cacheState.map,s)}))))}))}}Vne=iz,Kne=az;const fz=(t,e,n)=>new uz(t,Ns(),Hv,e,r=>Or(n(r))),Bw=gt(Symbol.for("effect/FiberRef/currentCache"),()=>Mn(fz(65536,()=>qe(oi(),t=>({listeners:new q3,handle:t})),()=>iy(60)))),Uw=gt(Symbol.for("effect/FiberRef/currentCacheEnabled"),()=>Mn(!1)),dz=(t,e)=>U(rn(e)?e:se(e),n=>Li(r=>{const s=new Proxy(t,{});return Cs(Uw,i=>{if(i){const l=Cs(Bw,f=>U(f.getEither(s),m=>{switch(m._tag){case"Left":return m.left.listeners.interrupted?U(f.invalidateWhen(s,S=>S.handle===m.left.handle),()=>l):(m.left.listeners.increment(),tr(S=>U(fr(wl(x$,S(Ar(m.left.handle)))),N=>(m.left.listeners.decrement(),N))));case"Right":return m.right.listeners.increment(),tr(S=>U(fr(wl(EN(n,vN({request:s,result:m.right.handle,listeners:m.right.listeners,ownerId:r,state:{completed:!1}})),S(Ar(m.right.handle)))),()=>(m.right.listeners.decrement(),Ar(m.right.handle))))}}));return l}const o=new q3;return o.increment(),U(oi(),l=>Vo(wl(EN(n,vN({request:s,result:l,listeners:o,ownerId:r,state:{completed:!1}})),Ar(l)),he(()=>o.decrement())))})})),hz=(t,e)=>Cs(Uw,n=>n?Cs(Bw,r=>U(r.getEither(t),s=>{switch(s._tag){case"Left":return ft;case"Right":return YL(s.right.handle,e)}})):ft),pz=w(2,(t,e)=>Sr(t,Uw,e)),mz=w(2,(t,e)=>Sr(t,Bw,e)),Nm=Yq,fO=Rw,rc=Zq,dO=tO,gz=rm,_z=U8,yz=L3,bz=D8;function Jl(t,e){return U(t.runtimeEffect,n=>It(r=>(r.setFiberRefs(n.fiberRefs),r.currentRuntimeFlags=n.runtimeFlags,Mo(e,n.context))))}const wz={..._b,[kw]:kw,pipe(){return et(this,arguments)},commit(){return this.runtimeEffect}},Sz=(t,e)=>{e=e??x8();const n=Sm(jl()),r=Sm(Wx(Fo(gw($8(t,e),n),i=>{s.cachedRuntime=i}))),s=Object.assign(Object.create(wz),{memoMap:e,scope:n,runtimeEffect:r,cachedRuntime:void 0,runtime(){return s.cachedRuntime===void 0?wm(s.runtimeEffect):Promise.resolve(s.cachedRuntime)},dispose(){return wm(s.disposeEffect)},disposeEffect:je(()=>(s.runtime=Ua("ManagedRuntime disposed"),s.cachedRuntime=void 0,zl(s.scope,Dr))),runFork(i,o){return s.cachedRuntime===void 0?zq(Jl(s,i),o):Kl(s.cachedRuntime)(i,o)},runSyncExit(i){return s.cachedRuntime===void 0?Kq(Jl(s,i)):Iw(s.cachedRuntime)(i)},runSync(i){return s.cachedRuntime===void 0?Sm(Jl(s,i)):xw(s.cachedRuntime)(i)},runPromiseExit(i,o){return s.cachedRuntime===void 0?Vq(Jl(s,i),o):Tw(s.cachedRuntime)(i,o)},runCallback(i,o){return s.cachedRuntime===void 0?od(Ji)(Jl(s,i),o):od(s.cachedRuntime)(i,o)},runPromise(i,o){return s.cachedRuntime===void 0?wm(Jl(s,i),o):Uq(s.cachedRuntime)(i,o)}});return s},Ez={[Symbol.for("@effect/matcher/Matcher")]:{_input:Ke,_filters:Ke,_result:Ke,_return:Ke},_tag:"ValueMatcher",add(t){return this.value._tag==="Right"?this:t._tag==="When"&&t.guard(this.provided)===!0?jw(this.provided,Mt(t.evaluate(this.provided))):t._tag==="Not"&&t.guard(this.provided)===!1?jw(this.provided,Mt(t.evaluate(this.provided))):this},pipe(){return et(this,arguments)}};function jw(t,e){const n=Object.create(Ez);return n.provided=t,n.value=e,n}const vz=(t,e)=>({_tag:"When",guard:t,evaluate:e}),zw=t=>{if(typeof t=="function")return t;if(Array.isArray(t)){const e=t.map(zw),n=e.length;return r=>{if(!Array.isArray(r))return!1;for(let s=0;s<n;s++)if(e[s](r[s])===!1)return!1;return!0}}else if(t!==null&&typeof t=="object"){const e=Object.entries(t).map(([r,s])=>[r,zw(s)]),n=e.length;return r=>{if(typeof r!="object"||r===null)return!1;for(let s=0;s<n;s++){const[i,o]=e[s];if(!(i in r)||o(r[i])===!1)return!1}return!0}}return e=>e===t},Nz=t=>jw(t,ut(t)),kz=(t,e)=>n=>n.add(vz(zw(t),e)),xz=t=>{if(t._tag==="ValueMatcher")return t.value;const e=t.cases.length;if(e===1){const n=t.cases[0];return r=>n._tag==="When"&&n.guard(r)===!0||n._tag==="Not"&&n.guard(r)===!1?Mt(n.evaluate(r)):ut(r)}return n=>{for(let r=0;r<e;r++){const s=t.cases[r];if(s._tag==="When"&&s.guard(n)===!0)return Mt(s.evaluate(n));if(s._tag==="Not"&&s.guard(n)===!1)return Mt(s.evaluate(n))}return ut(n)}},hO="effect/Match/exhaustive: absurd",qz=t=>{const e=xz(t);if(z2(e)){if(e._tag==="Right")return e.right;throw new Error(hO)}return n=>{const r=e(n);if(r._tag==="Right")return r.right;throw new Error(hO)}},Oz=Nz,km=kz,Iz=qz,Ko=xr("Config"),pO={reloadUrl:"/",syncUrl:"https://evolu.world",name:"Evolu",maxDrift:5*60*1e3,minimumLogLevel:"none"},Vw=t=>{const e={...pO,...t},n=rc(Ko,e),r=Oz(e.minimumLogLevel).pipe(km("debug",()=>qb),km("none",()=>cx),km("trace",()=>Ob),km("warning",()=>xb),Iz),s=e.minimumLogLevel==="none"?n:fO(n,bz(r),_z(yz,Tz(e.name)));return Sz(s)},Tz=t=>gz(({logLevel:e,message:n,date:r})=>{const s=e._tag==="Warning"?"warn":e._tag==="Error"?"error":"log",i=r.getHours().toString().padStart(2,"0"),o=r.getMinutes().toString().padStart(2,"0"),l=r.getSeconds().toString().padStart(2,"0"),f=r.getMilliseconds().toString().padStart(3,"0"),m=`${i}:${o}:${l}:${f}`,S=Array.isArray(n)?n:[n];globalThis.console[s](`${m} [${t}]`,...S)}),mO="effect/Redacted",xm=gt("effect/Redacted/redactedRegistry",()=>new WeakMap),gO=Symbol.for(mO),Az={[gO]:{_A:t=>t},pipe(){return et(this,arguments)},toString(){return"<redacted>"},toJSON(){return"<redacted>"},[_t](){return I(Qe(mO),Ot(Qe(xm.get(this))),hn(this))},[yt](t){return Cz(t)&&ot(xm.get(this),xm.get(t))}},Cz=t=>it(t,gO),Fz=t=>{const e=Object.create(Az);return xm.set(e,t),e},_O=function(){const t=Symbol.for("effect/Data/Error/plainArgs");return class extends ab{constructor(n){super(n==null?void 0:n.message,n!=null&&n.cause?{cause:n.cause}:void 0),n&&(Object.assign(this,n),Object.defineProperty(this,t,{value:n,enumerable:!1}))}toJSON(){return{...this[t],...this}}}}(),Rz=t=>{class e extends _O{constructor(){super(...arguments);g(this,"_tag",t)}}return e.prototype.name=t,e},Pz=qe(ii(Kn),Eo(Tl)),yO=t=>Cs(Kn,e=>t(Eo(e,Tl))),$z=w(2,(t,e)=>Yr(t,Kn,zt(Tl,e))),Lz=t=>$s(Kn,zt(Tl,t)),Mz=(...t)=>yO(e=>e.log(...t)),Dz=F6,Wz=Wa,Gl=rn,Bz=Wj,Uz=Aq,qm=Wx,jz=Qj,zz=Ux,Om=Bl,Vz=aU,Kz=cU,Qz=WW,Hz=BW,Jz=YW,Gz=nU,Yz=rU,Xz=jW,Zz=HW,eV=JW,Wr=bs,tV=eB,nV=j3,rV=z3,bO=NB,sV=gU,iV=kB,oV=xB,aV=B3,cV=lU,lV=CB,uV=FB,fV=hU,dV=EU,sc=ur,hV=b8,pV=hp,wO=It,dr=vt,mV=As,Yl=At,gV=_p,Kw=Ua,SO=mp,_V=gp,Wt=ZW,yV=vp,bV=gB,Im=SB,Tt=se,wV=zf,SV=TB,Hn=je,Rt=he,Dt=ft,EV=Ka,vV=NW,ic=Ao,Qw=Ba,Tm=kW,NV=Yy,kV=hL,xV=xW,EO=qW,Xl=OW,vO=IW,qV=TW,OV=Cx,NO=Px,IV=tB,TV=wB,AV=OB,CV=Rj,FV=kq,Hw=Ax,kO=WB,RV=BB,Zl=Hx,PV=zB,$V=FW,LV=pL,MV=$U,oc=ri,DV=yp,Qo=Va,WV=mL,BV=Mi,cd=Ro,xO=tr,UV=KW,Am=wn,jV=Hp,zV=vW,Jw=er,VV=qf,KV=GW,Me=qe,qO=pB,QV=eb,Cm=Of,HV=Yp,JV=mB,GV=Bx,eu=M3,YV=eU,Gw=dp,XV=fm,ld=Vo,ZV=HN,eK=si,tK=uw,nK=_U,rK=fw,OO=H3,sK=rd,ud=yU,iK=wU,oK=xU,aK=Dj,cK=tU,lK=RW,uK=Cb,fK=Fb,dK=jj,hK=vw,pK=Sl,IO=Li,mK=Qi,Fm=nd,gK=zj,Yw=Fq,Rm=Rq,_K=uU,yK=Vj,bK=Kj,wK=$q,SK=GN,EK=yL,vK=fW,NK=nk,kK=PL,xK=AW,qK=Za,OK=vU,IK=YM,TK=Pz,AK=yO,CK=Lz,FK=$z,RK=CW,PK=Pb,$K=MB,LK=Qx,MK=Gj,DK=Xj,WK=Lq,BK=Yj,UK=ym,jK=ZM,zK=XM,VK=kU,TO=$o,KK=UW,QK=Lo,AO=hb,ci=M8,Xw=Zp,HK=EB,JK=GB,GK=JB,YK=Gx,XK=Yx,ZK=YB,CO=XB,e5=Xx,t5=VB,FO=$W,RO=LW,n5=r8,r5=MW,Zw=DW,Ho=ja,Xr=fr,s5=El,PO=_B,i5=QN,o5=zW,a5=VW,c5=Jp,l5=QW,u5=UB,f5=jB,$O=Jx,d5=wp,h5=KB,p5=QB,Te=U,m5=za,ac=ni,g5=pU,Pm=eq,_5=Hj,eS=Z3,y5=em,on=Fo,b5=RB,w5=PB,tS=Kx,S5=$B,nS=LB,E5=XW,v5=$x,N5=hB,$m=Fj,k5=qB,x5=Eq,q5=qq,O5=Jj,I5=Oq,T5=Sp,A5=Rb,C5=nB,F5=Sr,R5=Yr,P5=dw,$5=$s,L5=Xp,M5=IB,D5=$b,W5=rB,B5=sB,rS=Gp,Lm=Zy,li=Ln,sS=Tr,U5=iB,j5=(t,...e)=>Uo(t)(...e),rr=oB,Br=Lx,z5=aB,V5=cB,LO=lB,K5=uB,Q5=fB,H5=EW,J5=Z6,G5=dB,Y5=$L,X5=bp,Z5=JN,MO=If,eQ=yB,tQ=bB,nQ=vB,rQ=Mk,sQ=eD,iQ=NU,DO=Aw,oQ=tb,aQ=Tf,cQ=YN,lQ=TU,uQ=AB,fQ=Vx,dQ=bU,hQ=K3,pQ=LL,mQ=HB,gQ=Ew,WO=$j,_Q=Tq,yQ=Mj,bQ=zq,wQ=y8,SQ=wm,EQ=Vq,ui=Sm,vQ=Kq,NQ=SU,kQ=Q3,iS=qU,xQ=OU,an=IU,tu=Ul,qQ=w(2,(t,e)=>tu(t,e,(n,r)=>n(r))),OQ=wl,IQ=BN,TQ=KN,AQ=w(t=>Dz(t[0]),dz),CQ=hz,FQ=bL,RQ=pz,PQ=mz,$Q=DB,LQ=Dk,MQ=tD,DQ=MU,WQ=wL,BQ=SL,UQ=e4,jQ=ZB,zQ=Zx,VQ=t4,KQ=s4,QQ=i4,HQ=n4,JQ=r4,GQ=hw,BO=Mb,YQ=n3,XQ=o4,ZQ=DU,UO=Db,eH=a4,tH=c4,jO=t=>{const e=new Map;return new Proxy(t,{get(n,r,s){if(r in n)return Reflect.get(n,r,s);if(e.has(r))return e.get(r);const i=(...l)=>za(n,f=>typeof f[r]=="function"?(e.set(r,(...m)=>za(n,S=>S[r](...m))),f[r](...l)):(e.set(r,za(n,m=>m[r])),f[r])),o=za(n,l=>l[r]);return Object.assign(i,o),Object.setPrototypeOf(i,Object.getPrototypeOf(o)),e.set(r,i),i}})};var nH=Object.freeze({__proto__:null,Do:FO,EffectTypeId:Wz,Service:function(){return function(){const[t,e]=arguments,n="accessors"in e?e.accessors:!1,r=Error.stackTraceLimit;Error.stackTraceLimit=2;const s=new Error;Error.stackTraceLimit=r;let i="unchecked";const o=function(S){if(i==="unchecked"){const N=Object.getPrototypeOf(S);if(N===Object.prototype||N===null)i="plain";else{const O=Object.getPrototypeOf(this);Object.setPrototypeOf(O,N),i="patched"}}if(i==="plain")Object.assign(this,S);else if(i==="patched")return Object.setPrototypeOf(S,Object.getPrototypeOf(this)),S};o.prototype._tag=t,Object.defineProperty(o,"make",{get(){return S=>new this(S)}}),Object.defineProperty(o,"use",{get(){return S=>za(this,S)}}),o.key=t,Object.assign(o,Fh),Object.defineProperty(o,"stack",{get(){return s.stack}});const l="dependencies"in e&&e.dependencies.length>0,f=l?"DefaultWithoutDependencies":"Default";let m;if("effect"in e?Object.defineProperty(o,f,{get(){return m??(m=Yq(o,Me(e.effect,S=>new this(S))))}}):"scoped"in e?Object.defineProperty(o,f,{get(){return m??(m=R8(o,Me(e.scoped,S=>new this(S))))}}):"sync"in e?Object.defineProperty(o,f,{get(){return m??(m=P8(o,()=>new this(e.sync())))}}):Object.defineProperty(o,f,{get(){return m??(m=Zq(o,new this(e.succeed)))}}),l){let S;Object.defineProperty(o,"Default",{get(){return S??(S=tO(this.DefaultWithoutDependencies,e.dependencies))}})}return n===!0?jO(o):o}},Tag:t=>()=>{const e=Error.stackTraceLimit;Error.stackTraceLimit=2;const n=new Error;Error.stackTraceLimit=e;function r(){}return Object.setPrototypeOf(r,Fh),r.key=t,Object.defineProperty(r,"use",{get(){return s=>za(this,s)}}),Object.defineProperty(r,"stack",{get(){return n.stack}}),jO(r)},acquireRelease:eu,acquireReleaseInterruptible:YV,acquireUseRelease:Gw,addFinalizer:XV,all:Om,allSuccesses:Kz,allWith:Vz,allowInterrupt:$V,andThen:m5,annotateCurrentSpan:jQ,annotateLogs:H5,annotateLogsScoped:J5,annotateSpans:UQ,ap:qQ,as:Am,asSome:jV,asSomeError:zV,asVoid:Jw,async:sc,asyncEffect:hV,awaitAllChildren:aK,bind:RO,bindAll:n5,bindTo:r5,blocked:OQ,cacheRequestResult:CQ,cached:qm,cachedFunction:jz,cachedInvalidateWithTTL:Uz,cachedWithTTL:Bz,catch:vV,catchAll:ic,catchAllCause:Qw,catchAllDefect:Tm,catchIf:NV,catchSome:kV,catchSomeCause:xV,catchSomeDefect:EO,catchTag:Xl,catchTags:vO,cause:qV,checkInterruptible:LV,clock:xK,clockWith:qK,configProviderWith:jK,console:TK,consoleWith:AK,context:TO,contextWith:KK,contextWithEffect:QK,currentParentSpan:VQ,currentSpan:zQ,custom:pV,daemonChildren:cK,delay:RK,descriptor:lK,descriptorWith:uK,die:Kw,dieMessage:SO,dieSync:_V,diffFiberRefs:fK,disconnect:MV,dropUntil:Qz,dropWhile:Hz,either:Ho,ensuring:ld,ensuringChild:dK,ensuringChildren:hK,eventually:OV,every:Jz,exists:Gz,exit:Xr,fail:dr,failCause:Yl,failCauseSync:gV,failSync:mV,fiberId:pK,fiberIdWith:IO,filter:Yz,filterMap:Xz,filterOrDie:o5,filterOrDieMessage:a5,filterOrElse:c5,filterOrFail:l5,finalizersMask:nK,findFirst:Zz,firstSuccessOf:eV,flatMap:Te,flatten:ac,flip:VV,flipWith:KV,forEach:Wr,forever:E5,fork:mK,forkAll:gK,forkDaemon:Fm,forkIn:Yw,forkScoped:Rm,forkWithErrorHandler:_K,fromFiber:yK,fromFiberEffect:bK,fromNullable:eH,functionWithSpan:XQ,gen:Wt,getFiberRefs:A5,getRuntimeFlags:oQ,head:tV,if:i5,ignore:NO,ignoreLogged:IV,inheritFiberRefs:C5,interrupt:oc,interruptWith:DV,interruptible:Qo,interruptibleMask:WV,intoDeferred:s5,isEffect:Gl,isFailure:W5,isSuccess:B5,iterate:v5,labelMetrics:fQ,labelMetricsScoped:hQ,let:Zw,liftPredicate:UV,linkSpans:HQ,locally:F5,locallyScoped:P5,locallyScopedWith:$5,locallyWith:R5,log:U5,logAnnotations:G5,logDebug:Br,logError:LO,logFatal:K5,logInfo:z5,logTrace:rr,logWarning:V5,logWithLevel:j5,loop:N5,makeLatch:yQ,makeSemaphore:WO,makeSpan:JQ,makeSpanScoped:GQ,map:Me,mapAccum:qO,mapBoth:QV,mapError:Cm,mapErrorCause:HV,mapInputContext:AO,match:rS,matchCause:Lm,matchCauseEffect:li,matchEffect:sS,merge:JV,mergeAll:nV,metricLabels:pQ,negate:GV,never:yV,none:bV,onError:ZV,onExit:eK,onInterrupt:BV,once:zz,option:PO,optionFromOptional:tH,orDie:X5,orDieWith:Z5,orElse:MO,orElseFail:eQ,orElseSucceed:tQ,parallelErrors:TV,parallelFinalizers:tK,partition:rV,patchFiberRefs:L5,patchRuntimeFlags:aQ,promise:Im,provide:ci,provideService:Xw,provideServiceEffect:HK,race:Pm,raceAll:g5,raceFirst:_5,raceWith:eS,random:nQ,randomWith:rQ,reduce:bO,reduceEffect:sV,reduceRight:iV,reduceWhile:oV,repeat:$m,repeatN:k5,repeatOrElse:x5,replicate:aV,replicateEffect:cV,request:AQ,retry:CV,retryOrElse:FV,runCallback:wQ,runFork:bQ,runPromise:SQ,runPromiseExit:EQ,runRequestBlock:IQ,runSync:ui,runSyncExit:vQ,runtime:DO,sandbox:AV,schedule:q5,scheduleForked:O5,scheduleFrom:I5,scope:OO,scopeWith:sK,scoped:ud,sequentialFinalizers:rK,serviceConstants:XK,serviceFunction:JK,serviceFunctionEffect:GK,serviceFunctions:YK,serviceMembers:ZK,serviceOption:CO,serviceOptional:e5,setFiberRefs:M5,sleep:PK,spanAnnotations:KQ,spanLinks:QQ,step:TQ,succeed:Tt,succeedNone:wV,succeedSome:SV,summarized:y5,supervised:wK,suspend:Hn,sync:Rt,tagMetrics:uQ,tagMetricsScoped:dQ,takeUntil:lV,takeWhile:uV,tap:on,tapBoth:b5,tapDefect:w5,tapError:tS,tapErrorCause:nS,tapErrorTag:S5,timed:$K,timedWith:LK,timeout:MK,timeoutFail:WK,timeoutFailCause:BK,timeoutOption:DK,timeoutTo:UK,tracer:$Q,tracerWith:LQ,transplant:SK,try:Hw,tryMap:kO,tryMapPromise:RV,tryPromise:Zl,uninterruptible:cd,uninterruptibleMask:xO,unless:u5,unlessEffect:f5,unsafeMakeLatch:_Q,unsafeMakeSemaphore:gQ,unsandbox:PV,updateFiberRefs:D5,updateService:t5,useSpan:BO,using:iK,validate:NQ,validateAll:fV,validateFirst:dV,validateWith:kQ,void:Dt,when:$O,whenEffect:d5,whenFiberRef:h5,whenRef:p5,whileLoop:T5,withClock:IK,withClockScoped:OK,withConcurrency:EK,withConfigProvider:zK,withConfigProviderScoped:VK,withConsole:FK,withConsoleScoped:CK,withEarlyRelease:oK,withFiberRuntime:wO,withLogSpan:Q5,withMaxOpsBeforeYield:kK,withMetric:mQ,withParentSpan:UO,withRandom:sQ,withRandomScoped:iQ,withRequestBatching:FQ,withRequestCache:PQ,withRequestCaching:RQ,withRuntimeFlagsPatch:cQ,withRuntimeFlagsPatchScoped:lQ,withScheduler:vK,withSchedulingPriority:NK,withSpan:YQ,withSpanScoped:ZQ,withTracer:MQ,withTracerEnabled:WQ,withTracerScoped:DQ,withTracerTiming:BQ,withUnhandledErrorLogLevel:Y5,yieldNow:EV,zip:iS,zipLeft:xQ,zipRight:an,zipWith:tu});const zO=Fz,rH=w(t=>So(t[0]),(t,...e)=>{const n={};for(const r of e)r in t&&(n[r]=t[r]);return n}),sH=w(t=>So(t[0]),(t,...e)=>{const n={...t};for(const r of e)delete n[r];return n}),VO=(t,e)=>{switch(e._tag){case"StringKeyword":case"TemplateLiteral":return Object.keys(t);case"SymbolKeyword":return Object.getOwnPropertySymbols(t);case"Refinement":return VO(t,e.from)}},nu=t=>Object.keys(t).concat(Object.getOwnPropertySymbols(t)),KO=t=>{let e=!1,n;return()=>(e||(n=t(),e=!0),n)},iH=t=>{try{return t.toISOString()}catch{return String(t)}},Yi=t=>{if(Hr(t))return JSON.stringify(t);if(wo(t)||t==null||tf(t)||wh(t))return String(t);if(NF(t))return iH(t);if(bh(t))return String(t)+"n";if(!Yc(t)&&it(t,"toString")&&Uc(t.toString)&&t.toString!==Object.prototype.toString)return t.toString();try{return JSON.stringify(t),Yc(t)?`[${t.map(Yi).join(",")}]`:`{${nu(t).map(e=>`${Hr(e)?JSON.stringify(e):String(e)}:${Yi(t[e])}`).join(",")}}`}catch{return String(t)}},oH=t=>typeof t=="string"?JSON.stringify(t):String(t),QO=t=>Array.isArray(t),aH=t=>!Array.isArray(t),HO=t=>`[${oH(t)}]`,cH=t=>QO(t)?t.map(HO).join(""):HO(t),cc=(t,e,n,r)=>{let s=t;return e!==void 0&&(s+=`
details: ${e}`),r&&(s+=`
schema (${r._tag}): ${r}`),s},lH=t=>cc("Unsupported key schema",void 0,void 0,t),uH=t=>cc("Unsupported literal",`literal value: ${Yi(t)}`),JO=t=>cc("Duplicate index signature",`${t} index signature`),fH=cc("Unsupported index signature parameter","An index signature parameter type must be `string`, `symbol`, a template literal type or a refinement of the previous types"),dH=cc("Invalid element","A required element cannot follow an optional element. ts(1257)"),GO=t=>cc("Duplicate property signature transformation",`Duplicate key ${Yi(t)}`),hH=t=>cc("Duplicate property signature",`Duplicate key ${Yi(t)}`),YO=Symbol.for("@effect/schema/annotation/Brand"),XO=Symbol.for("@effect/schema/annotation/Type"),ZO=Symbol.for("@effect/schema/annotation/Message"),eI=Symbol.for("@effect/schema/annotation/MissingMessage"),tI=Symbol.for("@effect/schema/annotation/Identifier"),Xi=Symbol.for("@effect/schema/annotation/Title"),Mm=Symbol.for("@effect/schema/annotation/Description"),pH=Symbol.for("@effect/schema/annotation/Examples"),mH=Symbol.for("@effect/schema/annotation/Default"),gH=Symbol.for("@effect/schema/annotation/JSONSchema"),_H=Symbol.for("@effect/schema/annotation/Documentation"),nI=Symbol.for("@effect/schema/annotation/Concurrency"),rI=Symbol.for("@effect/schema/annotation/Batching"),sI=Symbol.for("@effect/schema/annotation/ParseIssueTitle"),iI=Symbol.for("@effect/schema/annotation/ParseOptions"),oI=Symbol.for("@effect/schema/annotation/DecodingFallback"),yH=Symbol.for("@effect/schema/annotation/Surrogate"),bH=Symbol.for("@effect/schema/annotation/StableFilter"),Ur=w(2,(t,e)=>Object.prototype.hasOwnProperty.call(t.annotations,e)?de(t.annotations[e]):ce()),wH=Ur(YO),SH=Ur(ZO),EH=Ur(eI),vH=Ur(Xi),aI=Ur(tI),NH=Ur(Mm),kH=Ur(nI),xH=Ur(rI),qH=Ur(sI),OH=Ur(iI),IH=Ur(oI),Dm=Ur(yH),TH=Ur(bH),AH=t=>x2(TH(t),e=>e===!0),cI=Symbol.for("@effect/schema/annotation/JSONIdentifier"),CH=Ur(cI);class lI{constructor(e,n,r,s={}){g(this,"typeParameters");g(this,"decodeUnknown");g(this,"encodeUnknown");g(this,"annotations");g(this,"_tag","Declaration");this.typeParameters=e,this.decodeUnknown=n,this.encodeUnknown=r,this.annotations=s}toString(){return nn(Ls(this),()=>"<declaration schema>")}toJSON(){return{_tag:this._tag,typeParameters:this.typeParameters.map(e=>e.toJSON()),annotations:hr(this.annotations)}}}const ru=t=>e=>e._tag===t;class FH{constructor(e,n={}){g(this,"literal");g(this,"annotations");g(this,"_tag","Literal");this.literal=e,this.annotations=n}toString(){return nn(Ls(this),()=>Yi(this.literal))}toJSON(){return{_tag:this._tag,literal:bh(this.literal)?String(this.literal):this.literal,annotations:hr(this.annotations)}}}const uI=ru("Literal");class RH{constructor(e,n={}){g(this,"symbol");g(this,"annotations");g(this,"_tag","UniqueSymbol");this.symbol=e,this.annotations=n}toString(){return nn(Ls(this),()=>Yi(this.symbol))}toJSON(){return{_tag:this._tag,symbol:String(this.symbol),annotations:hr(this.annotations)}}}class PH{constructor(e={}){g(this,"annotations");g(this,"_tag","NeverKeyword");this.annotations=e}toString(){return dd(this)}toJSON(){return{_tag:this._tag,annotations:hr(this.annotations)}}}const oS=new PH({[Xi]:"never"});class $H{constructor(e={}){g(this,"annotations");g(this,"_tag","UnknownKeyword");this.annotations=e}toString(){return dd(this)}toJSON(){return{_tag:this._tag,annotations:hr(this.annotations)}}}const LH=new $H({[Xi]:"unknown"});class MH{constructor(e={}){g(this,"annotations");g(this,"_tag","AnyKeyword");this.annotations=e}toString(){return dd(this)}toJSON(){return{_tag:this._tag,annotations:hr(this.annotations)}}}const DH=new MH({[Xi]:"any"});class WH{constructor(e={}){g(this,"annotations");g(this,"_tag","StringKeyword");this.annotations=e}toString(){return dd(this)}toJSON(){return{_tag:this._tag,annotations:hr(this.annotations)}}}const BH=new WH({[Xi]:"string",[Mm]:"a string"}),fI=ru("StringKeyword");class UH{constructor(e={}){g(this,"annotations");g(this,"_tag","NumberKeyword");this.annotations=e}toString(){return dd(this)}toJSON(){return{_tag:this._tag,annotations:hr(this.annotations)}}}const jH=new UH({[Xi]:"number",[Mm]:"a number"}),zH=ru("NumberKeyword"),dI=ru("SymbolKeyword");let aS=class{constructor(e,n={}){g(this,"type");g(this,"annotations");this.type=e,this.annotations=n}toJSON(){return{type:this.type.toJSON(),annotations:hr(this.annotations)}}toString(){return String(this.type)}};class cS extends aS{constructor(n,r,s={}){super(n,s);g(this,"isOptional");this.isOptional=r}toJSON(){return{type:this.type.toJSON(),isOptional:this.isOptional,annotations:hr(this.annotations)}}toString(){return String(this.type)+(this.isOptional?"?":"")}}const hI=t=>t.map(e=>e.type);class pI{constructor(e,n,r,s={}){g(this,"elements");g(this,"rest");g(this,"isReadonly");g(this,"annotations");g(this,"_tag","TupleType");this.elements=e,this.rest=n,this.isReadonly=r,this.annotations=s;let i=!1,o=!1;for(const l of e)if(l.isOptional)i=!0;else if(i){o=!0;break}if(o||i&&n.length>1)throw new Error(dH)}toString(){return nn(Ls(this),()=>VH(this))}toJSON(){return{_tag:this._tag,elements:this.elements.map(e=>e.toJSON()),rest:this.rest.map(e=>e.toJSON()),isReadonly:this.isReadonly,annotations:hr(this.annotations)}}}const VH=t=>{const e=t.elements.map(String).join(", ");return X2(t.rest,{onEmpty:()=>`readonly [${e}]`,onNonEmpty:(n,r)=>{const s=String(n),i=s.includes(" | ")?`(${s})`:s;if(r.length>0){const o=r.map(String).join(", ");return t.elements.length>0?`readonly [${e}, ...${i}[], ${o}]`:`readonly [...${i}[], ${o}]`}else return t.elements.length>0?`readonly [${e}, ...${i}[]]`:`ReadonlyArray<${s}>`}})};class qn extends cS{constructor(n,r,s,i,o){super(r,s,o);g(this,"name");g(this,"isReadonly");this.name=n,this.isReadonly=i}toString(){return(this.isReadonly?"readonly ":"")+String(this.name)+(this.isOptional?"?":"")+": "+this.type}toJSON(){return{name:String(this.name),type:this.type.toJSON(),isOptional:this.isOptional,isReadonly:this.isReadonly,annotations:hr(this.annotations)}}}const mI=t=>{switch(t._tag){case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":return!0;case"Refinement":return mI(t.from)}return!1};class Wm{constructor(e,n,r){g(this,"type");g(this,"isReadonly");g(this,"parameter");if(this.type=n,this.isReadonly=r,mI(e))this.parameter=e;else throw new Error(fH)}toString(){return(this.isReadonly?"readonly ":"")+`[x: ${this.parameter}]: ${this.type}`}toJSON(){return{parameter:this.parameter.toJSON(),type:this.type.toJSON(),isReadonly:this.isReadonly}}}class lc{constructor(e,n,r={}){g(this,"annotations");g(this,"_tag","TypeLiteral");g(this,"propertySignatures");g(this,"indexSignatures");this.annotations=r;const s={};for(let o=0;o<e.length;o++){const l=e[o].name;if(Object.prototype.hasOwnProperty.call(s,l))throw new Error(hH(l));s[l]=null}const i={string:!1,symbol:!1};for(let o=0;o<n.length;o++){const l=Um(n[o].parameter);if(fI(l)){if(i.string)throw new Error(JO("string"));i.string=!0}else if(dI(l)){if(i.symbol)throw new Error(JO("symbol"));i.symbol=!0}}this.propertySignatures=e,this.indexSignatures=n}toString(){return nn(Ls(this),()=>KH(this))}toJSON(){return{_tag:this._tag,propertySignatures:this.propertySignatures.map(e=>e.toJSON()),indexSignatures:this.indexSignatures.map(e=>e.toJSON()),annotations:hr(this.annotations)}}}const gI=t=>t.map(String).join("; "),KH=t=>{if(t.propertySignatures.length>0){const e=t.propertySignatures.map(String).join("; ");return t.indexSignatures.length>0?`{ ${e}; ${gI(t.indexSignatures)} }`:`{ ${e} }`}else return t.indexSignatures.length>0?`{ ${gI(t.indexSignatures)} }`:"{}"},QH=pf(ZE(Ol,t=>{switch(t._tag){case"AnyKeyword":return 0;case"UnknownKeyword":return 1;case"ObjectKeyword":return 2;case"StringKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"SymbolKeyword":return 3}return 4})),HH={string:"StringKeyword",number:"NumberKeyword",boolean:"BooleanKeyword",bigint:"BigIntKeyword"},_I=t=>wv(t,e=>GH(e)?_I(e.types):[e]),JH=t=>{const e=QH(t),n=[],r={},s=[];for(const i of e)switch(i._tag){case"NeverKeyword":break;case"AnyKeyword":return[DH];case"UnknownKeyword":return[LH];case"ObjectKeyword":case"UndefinedKeyword":case"VoidKeyword":case"StringKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"SymbolKeyword":{r[i._tag]||(r[i._tag]=i,n.push(i));break}case"Literal":{const o=typeof i.literal;switch(o){case"string":case"number":case"bigint":case"boolean":{const l=HH[o];!r[l]&&!s.includes(i.literal)&&(s.push(i.literal),n.push(i));break}case"object":{s.includes(i.literal)||(s.push(i.literal),n.push(i));break}}break}case"UniqueSymbol":{!r.SymbolKeyword&&!s.includes(i.symbol)&&(s.push(i.symbol),n.push(i));break}case"TupleType":{r.ObjectKeyword||n.push(i);break}case"TypeLiteral":{i.propertySignatures.length===0&&i.indexSignatures.length===0?r["{}"]||(r["{}"]=i,n.push(i)):r.ObjectKeyword||n.push(i);break}default:n.push(i)}return n};let uc=(pa=class{constructor(e,n={}){g(this,"types");g(this,"annotations");g(this,"_tag","Union");this.types=e,this.annotations=n}toString(){return nn(Ls(this),()=>this.types.map(String).join(" | "))}toJSON(){return{_tag:this._tag,types:this.types.map(e=>e.toJSON()),annotations:hr(this.annotations)}}},g(pa,"make",(e,n)=>yI(e)?new pa(e,n):e.length===1?e[0]:oS),g(pa,"unify",(e,n)=>pa.make(JH(_I(e)),n)),pa);const yI=t=>t.length>1,GH=ru("Union"),lS=gt(Symbol.for("@effect/schema/AST/toJSONMemoMap"),()=>new WeakMap);class bI{constructor(e,n={}){g(this,"f");g(this,"annotations");g(this,"_tag","Suspend");this.f=e,this.annotations=n,this.f=KO(e)}toString(){return Ls(this).pipe(Ph(()=>$h(v2(this.f)(),e=>Ls(e))),nn(()=>"<suspended schema>"))}toJSON(){const e=this.f();let n=lS.get(e);return n||(lS.set(e,{_tag:this._tag}),n={_tag:this._tag,ast:e.toJSON(),annotations:hr(this.annotations)},lS.set(e,n),n)}}let wI=class{constructor(e,n,r={}){g(this,"from");g(this,"filter");g(this,"annotations");g(this,"_tag","Refinement");this.from=e,this.filter=n,this.annotations=r}toString(){return nn(Ls(this),()=>`{ ${this.from} | filter }`)}toJSON(){return{_tag:this._tag,from:this.from.toJSON(),annotations:hr(this.annotations)}}};const YH=ru("Refinement"),uS={};let SI=class{constructor(e,n,r,s={}){g(this,"from");g(this,"to");g(this,"transformation");g(this,"annotations");g(this,"_tag","Transformation");this.from=e,this.to=n,this.transformation=r,this.annotations=s}toString(){return nn(Ls(this),()=>`(${String(this.from)} <-> ${String(this.to)})`)}toJSON(){return{_tag:this._tag,from:this.from.toJSON(),to:this.to.toJSON(),annotations:hr(this.annotations)}}};class XH{constructor(e,n){g(this,"decode");g(this,"encode");g(this,"_tag","FinalTransformation");this.decode=e,this.encode=n}}class ZH{constructor(e,n,r,s){g(this,"from");g(this,"to");g(this,"decode");g(this,"encode");this.from=e,this.to=n,this.decode=r,this.encode=s}}class eJ{constructor(e){g(this,"propertySignatureTransformations");g(this,"_tag","TypeLiteralTransformation");this.propertySignatureTransformations=e;const n={},r={};for(const s of e){const i=s.from;if(n[i])throw new Error(GO(i));n[i]=!0;const o=s.to;if(r[o])throw new Error(GO(o));r[o]=!0}}}const fS=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t);return n.annotations.value={...t.annotations,...e},Object.create(Object.getPrototypeOf(t),n)},tJ=".*",nJ="[+-]?\\d*\\.?\\d+(?:[Ee][+-]?\\d+)?",EI=t=>{let e=`^${mb(t.head)}`;for(const n of t.spans)fI(n.type)?e+=tJ:zH(n.type)&&(e+=nJ),e+=mb(n.literal);return e+="$",new RegExp(e)},dS=t=>{switch(t._tag){case"Declaration":{const e=Dm(t);if(pt(e))return dS(e.value);break}case"TypeLiteral":return t.propertySignatures.slice();case"Suspend":return dS(t.f())}return su(t).map(e=>fd(t,e))},rJ=(t,e)=>{const n=aR(t.propertySignatures,r=>r.name===e);if(pt(n))return n.value;if(Hr(e)){let r;for(const s of t.indexSignatures){const i=Um(s.parameter);switch(i._tag){case"TemplateLiteral":{if(EI(i).test(e))return new qn(e,s.type,!1,!0);break}case"StringKeyword":r===void 0&&(r=new qn(e,s.type,!1,!0))}}if(r)return r}else if(wh(e))for(const r of t.indexSignatures){const s=Um(r.parameter);if(dI(s))return new qn(e,r.type,!1,!0)}},fd=(t,e)=>{const n=Dm(t);if(pt(n))return fd(n.value,e);switch(t._tag){case"TypeLiteral":{const r=rJ(t,e);if(r)return r;break}case"Union":return new qn(e,uc.make(t.types.map(r=>fd(r,e).type)),!1,!0);case"Suspend":return fd(t.f(),e);case"Refinement":return fd(t.from,e)}return new qn(e,oS,!1,!0)},su=t=>{switch(t._tag){case"Declaration":{const e=Dm(t);if(pt(e))return su(e.value);break}case"TypeLiteral":return t.propertySignatures.map(e=>e.name);case"Suspend":return su(t.f());case"Union":return t.types.slice(1).reduce((e,n)=>mR(e,su(n)),su(t.types[0]));case"Transformation":return su(t.to)}return[]},vI=(t,e)=>{const n=[],r=[],s=i=>{switch(i._tag){case"NeverKeyword":break;case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":case"Refinement":r.push(new Wm(i,e,!0));break;case"Literal":if(Hr(i.literal)||wo(i.literal))n.push(new qn(i.literal,e,!1,!0));else throw new Error(uH(i.literal));break;case"Enums":{for(const[o,l]of i.enums)n.push(new qn(l,e,!1,!0));break}case"UniqueSymbol":n.push(new qn(i.symbol,e,!1,!0));break;case"Union":i.types.forEach(s);break;default:throw new Error(lH(i))}};return s(t),{propertySignatures:n,indexSignatures:r}},sr=t=>{switch(t._tag){case"Declaration":{const e=ws(t.typeParameters,sr);return e===t.typeParameters?t:new lI(e,t.decodeUnknown,t.encodeUnknown,t.annotations)}case"TupleType":{const e=ws(t.elements,s=>{const i=sr(s.type);return i===s.type?s:new cS(i,s.isOptional)}),n=hI(t.rest),r=ws(n,sr);return e===t.elements&&r===n?t:new pI(e,r.map(s=>new aS(s)),t.isReadonly,t.annotations)}case"TypeLiteral":{const e=ws(t.propertySignatures,r=>{const s=sr(r.type);return s===r.type?r:new qn(r.name,s,r.isOptional,r.isReadonly)}),n=ws(t.indexSignatures,r=>{const s=sr(r.type);return s===r.type?r:new Wm(r.parameter,s,r.isReadonly)});return e===t.propertySignatures&&n===t.indexSignatures?t:new lc(e,n,t.annotations)}case"Union":{const e=ws(t.types,sr);return e===t.types?t:uc.make(e,t.annotations)}case"Suspend":return new bI(()=>sr(t.f()),t.annotations);case"Refinement":{const e=sr(t.from);return e===t.from?t:new wI(e,t.filter,t.annotations)}case"Transformation":return sr(t.to)}return t},sJ=t=>Ph(CH(t),()=>aI(t)),Bm=t=>Nn(sJ(t),{onNone:()=>{},onSome:e=>({[cI]:e})});function ws(t,e){let n=!1;const r=Wh(t.length);for(let s=0;s<t.length;s++){const i=t[s],o=e(i);o!==i&&(n=!0),r[s]=o}return n?r:t}const fi=(t,e)=>{switch(t._tag){case"Declaration":{const n=ws(t.typeParameters,r=>fi(r));return n===t.typeParameters?t:new lI(n,t.decodeUnknown,t.encodeUnknown,t.annotations)}case"TupleType":{const n=ws(t.elements,i=>{const o=fi(i.type);return o===i.type?i:new cS(o,i.isOptional)}),r=hI(t.rest),s=ws(r,i=>fi(i));return n===t.elements&&s===r?t:new pI(n,s.map(i=>new aS(i)),t.isReadonly,Bm(t))}case"TypeLiteral":{const n=ws(t.propertySignatures,s=>{const i=fi(s.type);return i===s.type?s:new qn(s.name,i,s.isOptional,s.isReadonly)}),r=ws(t.indexSignatures,s=>{const i=fi(s.type);return i===s.type?s:new Wm(s.parameter,i,s.isReadonly)});return n===t.propertySignatures&&r===t.indexSignatures?t:new lc(n,r,Bm(t))}case"Union":{const n=ws(t.types,r=>fi(r));return n===t.types?t:uc.make(n,Bm(t))}case"Suspend":return new bI(()=>fi(t.f()),Bm(t));case"Refinement":return fi(t.from);case"Transformation":return fi(t.from)}return t},NI=t=>fi(t),hr=t=>{const e={};for(const n of Object.getOwnPropertySymbols(t))e[String(n)]=t[n];return e},Um=t=>{switch(t._tag){case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":return t;case"Refinement":return Um(t.from)}},dd=t=>nn(Ls(t),()=>t._tag),Ls=t=>aI(t).pipe(Ph(()=>vH(t)),Ph(()=>NH(t))),iJ=Symbol.for("@effect/schema/TypeId/GreaterThan"),oJ=Symbol.for("@effect/schema/TypeId/LessThan"),aJ=Symbol.for("@effect/schema/TypeId/Int"),cJ=Symbol.for("@effect/schema/TypeId/Between"),lJ=Symbol.for("@effect/schema/TypeId/MinLength"),uJ=Symbol.for("@effect/schema/TypeId/MaxLength"),fJ=Symbol.for("@effect/schema/ArbitraryHookId"),Zr=(t,e=[])=>({value:t,forest:e}),dJ=t=>Me(iu(t),e=>pJ(e)),hJ=t=>ui(dJ(t)),pJ=t=>t.value+kI(`
`,t.forest),kI=(t,e)=>{let n="";const r=e.length;let s;for(let i=0;i<r;i++){s=e[i];const o=i===r-1;n+=t+(o?"└":"├")+"─ "+s.value,n+=kI(t+(r>1&&!o?"│  ":"   "),s.forest)}return n},mJ=t=>{switch(t){case"Encoded":return"Encoded side transformation failure";case"Transformation":return"Transformation process failure";case"Type":return"Type side transformation failure"}},gJ=t=>{switch(t){case"From":return"From side refinement failure";case"Predicate":return"Predicate refinement failure"}},xI=t=>"ast"in t?de(t.ast):ce(),_J=t=>xI(t).pipe($h(SH),Te(e=>{const n=e(t);return Hr(n)?Tt({message:n,override:!1}):Gl(n)?Me(n,r=>({message:r,override:!1})):Hr(n.message)?Tt({message:n.message,override:n.override}):Me(n.message,r=>({message:r,override:n.override}))})),hS=t=>e=>e._tag===t,yJ=hS("Composite"),qI=hS("Refinement"),OI=hS("Transformation"),pS=t=>_J(t).pipe(Te(e=>!e.override&&(yJ(t)||qI(t)&&t.kind==="From"||OI(t)&&t.kind!=="Transformation")?OI(t)||qI(t)?pS(t.issue):ce():Tt(e.message))),II=t=>xI(t).pipe($h(qH),N2(e=>ff(e(t)))),bJ=t=>pS(t).pipe(MO(()=>II(t)),ic(()=>Tt(t.message??`Expected ${String(t.ast)}, actual ${Yi(t.actual)}`))),jm=t=>nn(II(t),()=>String(t.ast)),wJ=t=>t.message??"is forbidden",SJ=t=>t.message??"is unexpected",EJ=t=>EH(t.ast).pipe(Te(e=>{const n=e();return Hr(n)?Tt(n):n}),ic(()=>Tt(t.message??"is missing"))),mS=(t,e)=>sS(pS(t),{onFailure:e,onSuccess:n=>Tt(Zr(n))}),iu=t=>{switch(t._tag){case"Type":return Me(bJ(t),Zr);case"Forbidden":return Tt(Zr(jm(t),[Zr(wJ(t))]));case"Unexpected":return Tt(Zr(SJ(t)));case"Missing":return Me(EJ(t),Zr);case"Transformation":return mS(t,()=>Me(iu(t.issue),e=>Zr(jm(t),[Zr(mJ(t.kind),[e])])));case"Refinement":return mS(t,()=>Me(iu(t.issue),e=>Zr(jm(t),[Zr(gJ(t.kind),[e])])));case"Pointer":return Me(iu(t.issue),e=>Zr(cH(t.path),[e]));case"Composite":{const e=jm(t);return mS(t,()=>QO(t.issues)?Me(Wr(t.issues,iu),n=>Zr(e,n)):Me(iu(t.issues),n=>Zr(e,[n])))}}};class pr{constructor(e,n,r){g(this,"path");g(this,"actual");g(this,"issue");g(this,"_tag","Pointer");this.path=e,this.actual=n,this.issue=r}}class TI{constructor(e,n){g(this,"actual");g(this,"message");g(this,"_tag","Unexpected");this.actual=e,this.message=n}}class hd{constructor(e,n){g(this,"ast");g(this,"message");g(this,"_tag","Missing");g(this,"actual");this.ast=e,this.message=n}}class On{constructor(e,n,r,s){g(this,"ast");g(this,"actual");g(this,"issues");g(this,"output");g(this,"_tag","Composite");this.ast=e,this.actual=n,this.issues=r,this.output=s}}class gS{constructor(e,n,r,s){g(this,"ast");g(this,"actual");g(this,"kind");g(this,"issue");g(this,"_tag","Refinement");this.ast=e,this.actual=n,this.kind=r,this.issue=s}}class _S{constructor(e,n,r,s){g(this,"ast");g(this,"actual");g(this,"kind");g(this,"issue");g(this,"_tag","Transformation");this.ast=e,this.actual=n,this.kind=r,this.issue=s}}class di{constructor(e,n,r){g(this,"ast");g(this,"actual");g(this,"message");g(this,"_tag","Type");this.ast=e,this.actual=n,this.message=r}}class vJ{constructor(e,n,r){g(this,"ast");g(this,"actual");g(this,"message");g(this,"_tag","Forbidden");this.ast=e,this.actual=n,this.message=r}}const AI=Symbol.for("@effect/schema/ParseErrorTypeId");class NJ extends Rz("ParseError"){constructor(){super(...arguments);g(this,Qne,AI)}get message(){return this.toString()}toString(){return hJ(this.issue)}toJSON(){return{_id:"ParseError",message:this.toString()}}[(Qne=AI,Zt)](){return this.toJSON()}}const yS=t=>new NJ({issue:t}),kJ=Mt,xJ=j2,zm=w(2,(t,e)=>{const n=t;return n._tag==="Left"?n:n._tag==="Right"?e(n.right):Te(t,e)}),qJ=w(2,(t,e)=>{const n=t;return n._tag==="Left"?n:n._tag==="Right"?Mt(e(n.right)):Me(t,e)}),Vm=w(2,(t,e)=>{const n=t;return n._tag==="Left"?ut(e(n.left)):n._tag==="Right"?n:Cm(t,e)}),Zi=t=>{const e=t;if(e._tag==="Left"||e._tag==="Right")return e},CI=w(2,(t,e)=>{const n=t;return n._tag==="Left"?e(n.left):n._tag==="Right"?n:ic(t,e)}),Km=(t,e)=>e===void 0||wo(e)?t:t===void 0?e:{...t,...e},FI=(t,e,n)=>{const r=ir(t,e);return(s,i)=>r(s,Km(n,i))},bS=(t,e,n)=>{const r=FI(t,e,n);return(s,i)=>V2(r(s,i),yS)},OJ=(t,e,n)=>{const r=ir(t,e);return(s,i)=>r(s,{...Km(n,i),isEffectAllowed:!0})},IJ=(t,e)=>bS(t.ast,!0,e),TJ=(t,e)=>FI(t.ast,!0,e),AJ=(t,e)=>OJ(t.ast,!0,e),CJ=(t,e)=>bS(t.ast,!1,e),pd=IJ,wS=(t,e)=>bS(sr(t.ast),!0,e),FJ=(t,e)=>{const n=ir(sr(t.ast),!0);return(r,s)=>Fi(n(r,{exact:!0,...Km(e,s)}))},RJ=CJ,PJ=gt(Symbol.for("@effect/schema/Parser/decodeMemoMap"),()=>new WeakMap),$J=gt(Symbol.for("@effect/schema/Parser/encodeMemoMap"),()=>new WeakMap),ir=(t,e)=>{const n=e?PJ:$J,r=n.get(t);if(r)return r;const s=LJ(t,e),i=OH(t),o=pt(i)?(m,S)=>s(m,Km(S,i.value)):s,l=IH(t),f=e&&pt(l)?(m,S)=>gd(CI(o(m,S),l.value),t,m,S):o;return n.set(t,f),f},SS=t=>qr(kH(t)),ES=t=>qr(xH(t)),LJ=(t,e)=>{switch(t._tag){case"Refinement":if(e){const n=ir(t.from,!0);return(r,s)=>{s=s??uS;const i=(s==null?void 0:s.errors)==="all",o=zm(CI(n(r,s),l=>{const f=new gS(t,r,"From",l);return i&&AH(t)?Nn(t.filter(r,s,t),{onNone:()=>ut(f),onSome:m=>ut(new On(t,r,[f,new gS(t,r,"Predicate",m)]))}):ut(f)}),l=>Nn(t.filter(l,s,t),{onNone:()=>Mt(l),onSome:f=>ut(new gS(t,r,"Predicate",f))}));return gd(o,t,r,s)}}else{const n=ir(sr(t),!0),r=ir(RI(t.from),!1);return(s,i)=>gd(zm(n(s,i),o=>r(o,i)),t,s,i)}case"Transformation":{const n=BJ(t.transformation,e),r=e?ir(t.from,!0):ir(t.to,!1),s=e?ir(t.to,!0):ir(t.from,!1);return(i,o)=>gd(zm(Vm(r(i,o),l=>new _S(t,i,e?"Encoded":"Type",l)),l=>zm(Vm(n(l,o??uS,t,i),f=>new _S(t,i,"Transformation",f)),f=>Vm(s(f,o),m=>new _S(t,i,e?"Type":"Encoded",m)))),t,i,o)}case"Declaration":{const n=e?t.decodeUnknown(...t.typeParameters):t.encodeUnknown(...t.typeParameters);return(r,s)=>gd(n(r,s??uS,t),t,r,s)}case"Literal":return es(t,n=>n===t.literal);case"UniqueSymbol":return es(t,n=>n===t.symbol);case"UndefinedKeyword":return es(t,wF);case"NeverKeyword":return es(t,EF);case"UnknownKeyword":case"AnyKeyword":case"VoidKeyword":return Mt;case"StringKeyword":return es(t,Hr);case"NumberKeyword":return es(t,wo);case"BooleanKeyword":return es(t,tf);case"BigIntKeyword":return es(t,bh);case"SymbolKeyword":return es(t,wh);case"ObjectKeyword":return es(t,So);case"Enums":return es(t,n=>t.enums.some(([r,s])=>s===n));case"TemplateLiteral":{const n=EI(t);return es(t,r=>Hr(r)&&n.test(r))}case"TupleType":{const n=t.elements.map(m=>ir(m.type,e)),r=t.rest.map(m=>ir(m.type,e));let s=t.elements.filter(m=>!m.isOptional);t.rest.length>0&&(s=s.concat(t.rest.slice(1)));const i=s.length,o=t.elements.length>0?t.elements.map((m,S)=>S).join(" | "):"never",l=SS(t),f=ES(t);return(m,S)=>{if(!Yc(m))return ut(new di(t,m));const N=(S==null?void 0:S.errors)==="all",O=[];let M=0;const z=[],Z=m.length;for(let ye=Z;ye<=i-1;ye++){const Fe=new pr(ye,m,new hd(s[ye-Z]));if(N){O.push([M++,Fe]);continue}else return ut(new On(t,m,Fe,z))}if(t.rest.length===0)for(let ye=t.elements.length;ye<=Z-1;ye++){const Fe=new pr(ye,m,new TI(m[ye],`is unexpected, expected: ${o}`));if(N){O.push([M++,Fe]);continue}else return ut(new On(t,m,Fe,z))}let J=0,ee;for(;J<n.length;J++)if(Z<J+1){if(t.elements[J].isOptional)continue}else{const ye=n[J],Fe=ye(m[J],S),Je=Zi(Fe);if(Je){if(Xn(Je)){const Xe=new pr(J,m,Je.left);if(N){O.push([M++,Xe]);continue}else return ut(new On(t,m,Xe,Ms(z)))}z.push([M++,Je.right])}else{const Xe=M++,We=J;ee||(ee=[]),ee.push(({es:Re,output:Be})=>Te(Ho(Fe),ze=>{if(Xn(ze)){const Le=new pr(We,m,ze.left);return N?(Re.push([Xe,Le]),Dt):ut(new On(t,m,Le,Ms(Be)))}return Be.push([Xe,ze.right]),Dt}))}}if(xn(r)){const[ye,...Fe]=r;for(;J<Z-Fe.length;J++){const Je=ye(m[J],S),Xe=Zi(Je);if(Xe)if(Xn(Xe)){const We=new pr(J,m,Xe.left);if(N){O.push([M++,We]);continue}else return ut(new On(t,m,We,Ms(z)))}else z.push([M++,Xe.right]);else{const We=M++,Re=J;ee||(ee=[]),ee.push(({es:Be,output:ze})=>Te(Ho(Je),Le=>{if(Xn(Le)){const He=new pr(Re,m,Le.left);return N?(Be.push([We,He]),Dt):ut(new On(t,m,He,Ms(ze)))}else return ze.push([We,Le.right]),Dt}))}}for(let Je=0;Je<Fe.length;Je++)if(J+=Je,!(Z<J+1)){const Xe=Fe[Je](m[J],S),We=Zi(Xe);if(We){if(Xn(We)){const Re=new pr(J,m,We.left);if(N){O.push([M++,Re]);continue}else return ut(new On(t,m,Re,Ms(z)))}z.push([M++,We.right])}else{const Re=M++,Be=J;ee||(ee=[]),ee.push(({es:ze,output:Le})=>Te(Ho(Xe),He=>{if(Xn(He)){const Ze=new pr(Be,m,He.left);return N?(ze.push([Re,Ze]),Dt):ut(new On(t,m,Ze,Ms(Le)))}return Le.push([Re,He.right]),Dt}))}}}const ve=({es:ye,output:Fe})=>Uh(ye)?ut(new On(t,m,Ms(ye),Ms(Fe))):Mt(Ms(Fe));if(ee&&ee.length>0){const ye=ee;return Hn(()=>{const Fe={es:mf(O),output:mf(z)};return Te(Wr(ye,Je=>Je(Fe),{concurrency:l,batching:f,discard:!0}),()=>ve(Fe))})}return ve({output:z,es:O})}}case"TypeLiteral":{if(t.propertySignatures.length===0&&t.indexSignatures.length===0)return es(t,vF);const n=[],r={},s=[];for(const S of t.propertySignatures)n.push([ir(S.type,e),S]),r[S.name]=null,s.push(S.name);const i=t.indexSignatures.map(S=>[ir(S.parameter,e),ir(S.type,e),S.parameter]),o=uc.make(t.indexSignatures.map(S=>S.parameter).concat(s.map(S=>wh(S)?new RH(S):new FH(S)))),l=ir(o,e),f=SS(t),m=ES(t);return(S,N)=>{if(!kF(S))return ut(new di(t,S));const O=(N==null?void 0:N.errors)==="all",M=[];let z=0;const Z=(N==null?void 0:N.onExcessProperty)==="error",J=(N==null?void 0:N.onExcessProperty)==="preserve",ee={};let ve;if(Z||J){ve=nu(S);for(const Xe of ve){const We=Zi(l(Xe,N));if(Xn(We))if(Z){const Re=new pr(Xe,S,new TI(S[Xe],`is unexpected, expected: ${String(o)}`));if(O){M.push([z++,Re]);continue}else return ut(new On(t,S,Re,ee))}else ee[Xe]=S[Xe]}}let ye;const Fe=(N==null?void 0:N.exact)===!0;for(let Xe=0;Xe<n.length;Xe++){const We=n[Xe][1],Re=We.name,Be=Object.prototype.hasOwnProperty.call(S,Re);if(!Be){if(We.isOptional)continue;if(Fe){const Ze=new pr(Re,S,new hd(We));if(O){M.push([z++,Ze]);continue}else return ut(new On(t,S,Ze,ee))}}const ze=n[Xe][0],Le=ze(S[Re],N),He=Zi(Le);if(He){if(Xn(He)){const Ze=new pr(Re,S,Be?He.left:new hd(We));if(O){M.push([z++,Ze]);continue}else return ut(new On(t,S,Ze,ee))}ee[Re]=He.right}else{const Ze=z++,ht=Re;ye||(ye=[]),ye.push(({es:qt,output:Ae})=>Te(Ho(Le),Ue=>{if(Xn(Ue)){const ke=new pr(ht,S,Be?Ue.left:new hd(We));return O?(qt.push([Ze,ke]),Dt):ut(new On(t,S,ke,Ae))}return Ae[ht]=Ue.right,Dt}))}}for(let Xe=0;Xe<i.length;Xe++){const We=i[Xe],Re=We[0],Be=We[1],ze=VO(S,We[2]);for(const Le of ze){const He=Zi(Re(Le,N));if(He&&Fi(He)){const Ze=Be(S[Le],N),ht=Zi(Ze);if(ht)if(Xn(ht)){const qt=new pr(Le,S,ht.left);if(O){M.push([z++,qt]);continue}else return ut(new On(t,S,qt,ee))}else Object.prototype.hasOwnProperty.call(r,Le)||(ee[Le]=ht.right);else{const qt=z++,Ae=Le;ye||(ye=[]),ye.push(({es:Ue,output:ke})=>Te(Ho(Ze),Ne=>{if(Xn(Ne)){const Ve=new pr(Ae,S,Ne.left);return O?(Ue.push([qt,Ve]),Dt):ut(new On(t,S,Ve,ke))}else return Object.prototype.hasOwnProperty.call(r,Le)||(ke[Le]=Ne.right),Dt}))}}}}const Je=({es:Xe,output:We})=>{if(Uh(Xe))return ut(new On(t,S,Ms(Xe),We));if((N==null?void 0:N.propertyOrder)==="original"){const Re=ve||nu(S);for(const ze of s)Re.indexOf(ze)===-1&&Re.push(ze);const Be={};for(const ze of Re)Object.prototype.hasOwnProperty.call(We,ze)&&(Be[ze]=We[ze]);return Mt(Be)}return Mt(We)};if(ye&&ye.length>0){const Xe=ye;return Hn(()=>{const We={es:mf(M),output:Object.assign({},ee)};return Te(Wr(Xe,Re=>Re(We),{concurrency:f,batching:m,discard:!0}),()=>Je(We))})}return Je({es:M,output:ee})}}case"Union":{const n=DJ(t.types,e),r=nu(n.keys),s=r.length,i=new Map;for(let f=0;f<t.types.length;f++)i.set(t.types[f],ir(t.types[f],e));const o=SS(t)??1,l=ES(t);return(f,m)=>{const S=[];let N=0,O=[];if(s>0)if(MJ(f))for(let Z=0;Z<s;Z++){const J=r[Z],ee=n.keys[J].buckets;if(Object.prototype.hasOwnProperty.call(f,J)){const ve=String(f[J]);if(Object.prototype.hasOwnProperty.call(ee,ve))O=O.concat(ee[ve]);else{const ye=uc.make(n.keys[J].literals);S.push([N++,new On(new lc([new qn(J,ye,!1,!0)],[]),f,new pr(J,f,new di(ye,f[J])))])}}else{const ve=uc.make(n.keys[J].literals),ye=new qn(J,ve,!1,!0);S.push([N++,new On(new lc([ye],[]),f,new pr(J,f,new hd(ye)))])}}else S.push([N++,new di(t,f)]);n.otherwise.length>0&&(O=O.concat(n.otherwise));let M;for(let Z=0;Z<O.length;Z++){const J=O[Z],ee=i.get(J)(f,m),ve=!M||M.length===0?Zi(ee):void 0;if(ve){if(Fi(ve))return ve;S.push([N++,ve.left])}else{const ye=N++;M||(M=[]),M.push(Fe=>Hn(()=>"finalResult"in Fe?Dt:Te(Ho(ee),Je=>(Fi(Je)?Fe.finalResult=Je:Fe.es.push([ye,Je.left]),Dt))))}}const z=Z=>Uh(Z)?Z.length===1&&Z[0][1]._tag==="Type"?ut(Z[0][1]):ut(new On(t,f,Ms(Z))):ut(new di(t,f));if(M&&M.length>0){const Z=M;return Hn(()=>{const J={es:mf(S)};return Te(Wr(Z,ee=>ee(J),{concurrency:o,batching:l,discard:!0}),()=>"finalResult"in J?J.finalResult:z(J.es))})}return z(S)}}case"Suspend":{const n=KO(()=>ir(fS(t.f(),t.annotations),e));return(r,s)=>n()(r,s)}}},MJ=t=>typeof t=="object"&&t!==null,es=(t,e)=>n=>e(n)?Mt(n):ut(new di(t,n)),md=(t,e)=>{switch(t._tag){case"Declaration":{const n=Dm(t);if(pt(n))return md(n.value,e);break}case"TypeLiteral":{const n=[];for(let r=0;r<t.propertySignatures.length;r++){const s=t.propertySignatures[r],i=e?NI(s.type):sr(s.type);uI(i)&&!s.isOptional&&n.push([s.name,i])}return n}case"TupleType":{const n=[];for(let r=0;r<t.elements.length;r++){const s=t.elements[r],i=e?NI(s.type):sr(s.type);uI(i)&&!s.isOptional&&n.push([r,i])}return n}case"Refinement":return md(t.from,e);case"Suspend":return md(t.f(),e);case"Transformation":return md(e?t.from:t.to,e)}return[]},DJ=(t,e)=>{const n={},r=[];for(let s=0;s<t.length;s++){const i=t[s],o=md(i,e);if(o.length>0)for(let l=0;l<o.length;l++){const[f,m]=o[l],S=String(m.literal);n[f]=n[f]||{buckets:{},literals:[]};const N=n[f].buckets;if(Object.prototype.hasOwnProperty.call(N,S)){if(l<o.length-1)continue;N[S].push(i),n[f].literals.push(m)}else{N[S]=[i],n[f].literals.push(m);break}}else r.push(i)}return{keys:n,otherwise:r}},RI=t=>YH(t)?RI(t.from):t,gd=(t,e,n,r)=>{const s=Zi(t);if(s)return s;if((r==null?void 0:r.isEffectAllowed)===!0)return t;try{return ui(Ho(t))}catch{return ut(new vJ(e,n,"cannot be be resolved synchronously, this is caused by using runSync on an effect that performs async work"))}},WJ=([t],[e])=>t>e?1:t<e?-1:0;function Ms(t){return t.sort(WJ).map(e=>e[1])}const BJ=(t,e)=>{switch(t._tag){case"FinalTransformation":return e?t.decode:t.encode;case"ComposeTransformation":return Mt;case"TypeLiteralTransformation":return n=>{let r=Mt(n);for(const s of t.propertySignatureTransformations){const[i,o]=e?[s.from,s.to]:[s.to,s.from],l=e?s.decode:s.encode;r=qJ(r,m=>{const S=l(Object.prototype.hasOwnProperty.call(m,i)?de(m[i]):ce());return delete m[i],pt(S)&&(m[o]=S.value),m})}return r}}},UJ=Symbol.for("@effect/schema/EquivalenceHookId"),jJ=Symbol.for("@effect/schema/PrettyHookId"),Qm=Symbol.for("@effect/schema/Schema"),hi=t=>{var e,n,r;return n=class{constructor(){g(this,e,PI)}static annotations(i){return hi(ou(this.ast,i))}static pipe(){return et(this,arguments)}static toString(){return String(t)}},e=Qm,r=Qm,g(n,"Type"),g(n,"Encoded"),g(n,"Context"),g(n,r,PI),g(n,"ast",t),n},PI={_A:t=>t,_I:t=>t,_R:t=>t},vS=t=>{if(!t)return{};const e={},n=Object.getOwnPropertySymbols(t);for(const s of n)e[s]=t[s];if(t.typeId!==void 0){const s=t.typeId;typeof s=="object"?(e[XO]=s.id,e[s.id]=s.annotation):e[XO]=s}const r=(s,i)=>{t[s]!==void 0&&(e[i]=t[s])};return r("message",ZO),r("missingMessage",eI),r("identifier",tI),r("title",Xi),r("description",Mm),r("examples",pH),r("default",mH),r("documentation",_H),r("jsonSchema",gH),r("arbitrary",fJ),r("pretty",jJ),r("equivalence",UJ),r("concurrency",nI),r("batching",rI),r("parseIssueTitle",sI),r("parseOptions",iI),r("decodingFallback",oI),e},ou=(t,e)=>fS(t,vS(e)),zJ=(t,e)=>{const n=AJ(t,e);return(r,s)=>Vm(n(r,s),yS)},VJ=(t,e)=>{const n=TJ(t,e);return(r,s)=>cv(n(r,s),yS)},KJ=zJ,QJ=VJ,$I=t=>it(t,Qm)&&So(t[Qm]);class HJ extends hi(oS){}class pi extends hi(BH){}class _d extends hi(jH){}const JJ=t=>uc.make(t.map(e=>e.ast)),LI=(t,e=JJ(t))=>{var n;return n=class extends hi(e){static annotations(s){return LI(this.members,ou(this.ast,s))}},g(n,"members",[...t]),n};function GJ(...t){return yI(t)?LI(t):xn(t)?t[0]:HJ}const YJ=Symbol.for("@effect/schema/PropertySignature"),MI=t=>it(t,YJ),XJ=(t,e)=>{const n=nu(t),r=[];if(n.length>0){const i=[],o=[],l=[];for(let f=0;f<n.length;f++){const m=n[f],S=t[m];if(MI(S)){const N=S.ast;switch(N._tag){case"PropertySignatureDeclaration":{const O=N.type,M=N.isOptional,z=N.annotations;i.push(new qn(m,O,M,!0)),o.push(new qn(m,sr(O),M,!0,z)),r.push(new qn(m,O,M,!0,z));break}case"PropertySignatureTransformation":{const O=N.from.fromKey??m;i.push(new qn(O,N.from.type,N.from.isOptional,!0,N.from.annotations)),o.push(new qn(m,N.to.type,N.to.isOptional,!0,N.to.annotations)),l.push(new ZH(O,m,N.decode,N.encode));break}}}else i.push(new qn(m,S.ast,!1,!0)),o.push(new qn(m,sr(S.ast),!1,!0)),r.push(new qn(m,S.ast,!1,!0))}if(xn(l)){const f=[],m=[];for(const S of e){const{indexSignatures:N,propertySignatures:O}=vI(S.key.ast,S.value.ast);O.forEach(M=>{i.push(M),o.push(new qn(M.name,sr(M.type),M.isOptional,M.isReadonly,M.annotations))}),N.forEach(M=>{f.push(M),m.push(new Wm(M.parameter,sr(M.type),M.isReadonly))})}return new SI(new lc(i,f,{[Xi]:"Struct (Encoded side)"}),new lc(o,m,{[Xi]:"Struct (Type side)"}),new eJ(l))}}const s=[];for(const i of e){const{indexSignatures:o,propertySignatures:l}=vI(i.key.ast,i.value.ast);l.forEach(f=>r.push(f)),o.forEach(f=>s.push(f))}return new lc(r,s)},ZJ=(t,e)=>{const n=nu(t);for(const r of n){const s=t[r];if(e[r]===void 0&&MI(s)){const i=s.ast,o=i._tag==="PropertySignatureDeclaration"?i.defaultValue:i.to.defaultValue;o!==void 0&&(e[r]=o())}}return e},DI=(t,e,n=XJ(t,e))=>{var r;return r=class extends hi(n){static annotations(i){return DI(this.fields,this.records,ou(this.ast,i))}static pick(...i){return yd(rH(t,...i))}static omit(...i){return yd(sH(t,...i))}},g(r,"fields",{...t}),g(r,"records",[...e]),g(r,"make",(i,o)=>{const l=ZJ(t,{...i});return kS(o)?l:wS(r)(l)}),r};function yd(t,...e){return DI(t,e)}const WI=t=>{var e;return e=class extends hi(t){static annotations(r){return WI(ou(this.ast,r))}},g(e,"make",(r,s)=>kS(s)?r:wS(e)(r)),e},mi=(t,e)=>n=>{const r=Nn(wH(n.ast),{onNone:()=>[t],onSome:i=>[...i,t]}),s=fS(n.ast,vS({title:String(n.ast)+` & Brand<${Yi(t)}>`,...e,[YO]:r}));return WI(s)},e7=Symbol.for("@effect/schema/refine"),BI=(t,e,n)=>{var r,s;return s=class extends hi(n){static annotations(o){return BI(this.from,this.filter,ou(this.ast,o))}},r=e7,g(s,r,t),g(s,"from",t),g(s,"filter",e),g(s,"make",(o,l)=>kS(l)?o:wS(s)(o)),s},UI=(t,e,n)=>{if(tf(t))return t?ce():de(new di(e,n));if(Hr(t))return de(new di(e,n,t));if(t!==void 0){if("_tag"in t)return de(t);const r=new di(e,n,t.message);return de(xn(t.path)?new pr(t.path,n,r):r)}return ce()},t7=(t,e,n)=>{if(aH(t))return UI(t,e,n);if(xn(t)){const r=Zc(t,s=>UI(s,e,n));if(xn(r))return de(r.length===1?r[0]:new On(e,n,r))}return ce()};function Ds(t,e){return n=>{function r(i,o,l){return t7(t(i,o,l),l,i)}const s=new wI(n.ast,r,vS(e));return BI(n,r,s)}}const jI=(t,e,n)=>{var r;return r=class extends hi(n){static annotations(i){return jI(this.from,this.to,ou(this.ast,i))}},g(r,"from",t),g(r,"to",e),r},n7=w(t=>$I(t[0])&&$I(t[1]),(t,e,n)=>jI(t,e,new SI(t.ast,e.ast,new XH(n.decode,n.encode)))),r7=uJ,zI=(t,e)=>n=>n.pipe(Ds(r=>r.length<=t,{typeId:r7,description:`a string at most ${t} character(s) long`,jsonSchema:{maxLength:t},...e})),s7=lJ,i7=(t,e)=>n=>n.pipe(Ds(r=>r.length>=t,{typeId:s7,description:`a string at least ${t} character(s) long`,jsonSchema:{minLength:t},...e})),o7=Symbol.for("@effect/schema/TypeId/Pattern"),VI=(t,e)=>n=>{const r=t.source;return n.pipe(Ds(s=>(t.lastIndex=0,t.test(s)),{typeId:{id:o7,annotation:{regex:t}},description:`a string matching the pattern ${r}`,jsonSchema:{pattern:r},arbitrary:()=>s=>s.stringMatching(t),...e}))},a7=Symbol.for("@effect/schema/TypeId/Includes"),NS=(t,e)=>n=>n.pipe(Ds(r=>r.includes(t),{typeId:{id:a7,annotation:{includes:t}},description:`a string including ${JSON.stringify(t)}`,jsonSchema:{pattern:`.*${t}.*`},...e})),c7=iJ,KI=(t,e)=>n=>n.pipe(Ds(r=>r>t,{typeId:c7,description:t===0?"a positive number":`a number greater than ${t}`,jsonSchema:{exclusiveMinimum:t},...e})),l7=aJ,QI=t=>e=>e.pipe(Ds(n=>Number.isSafeInteger(n),{typeId:l7,title:"integer",description:"an integer",jsonSchema:{type:"integer"},...t})),u7=oJ,f7=(t,e)=>n=>n.pipe(Ds(r=>r<t,{typeId:u7,description:`a number less than ${t}`,jsonSchema:{exclusiveMaximum:t},...e})),d7=cJ,h7=(t,e,n)=>r=>r.pipe(Ds(s=>s>=t&&s<=e,{typeId:d7,description:`a number between ${t} and ${e}`,jsonSchema:{maximum:e,minimum:t},...n})),p7=t=>KI(0,t),m7=t=>n7(t,_d,{strict:!1,decode:(e,n,r)=>xJ(lM(e),()=>new di(r,e)),encode:e=>kJ(String(e))});class HI extends m7(pi.annotations({description:"a string that will be parsed into a number"})).annotations({identifier:"NumberFromString"}){}const kS=t=>tf(t)?t:(t==null?void 0:t.disableValidation)??!1;function xS(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function JI(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function GI(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function ts(t,...e){if(!GI(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function YI(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function g7(t,e){ts(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const Jo=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4));if(!(new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68))throw new Error("Non little-endian hardware is not supported");function _7(t){if(typeof t!="string")throw new Error(`string expected, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function qS(t){if(typeof t=="string")t=_7(t);else if(GI(t))t=OS(t);else throw new Error(`Uint8Array expected, got ${typeof t}`);return t}function XI(...t){let e=0;for(let r=0;r<t.length;r++){const s=t[r];ts(s),e+=s.length}const n=new Uint8Array(e);for(let r=0,s=0;r<t.length;r++){const i=t[r];n.set(i,s),s+=i.length}return n}function y7(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function b7(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}const w7=(t,e)=>(Object.assign(e,t),e);function OS(t){return Uint8Array.from(t)}function au(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}const ZI=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),S7=ZI("expand 16-byte k"),E7=ZI("expand 32-byte k"),v7=Jo(S7),e1=Jo(E7);e1.slice();function De(t,e){return t<<e|t>>>32-e}function IS(t){return t.byteOffset%4===0}const Hm=64,N7=16,t1=2**32-1,n1=new Uint32Array;function k7(t,e,n,r,s,i,o,l){const f=s.length,m=new Uint8Array(Hm),S=Jo(m),N=IS(s)&&IS(i),O=N?Jo(s):n1,M=N?Jo(i):n1;for(let z=0;z<f;o++){if(t(e,n,r,S,o,l),o>=t1)throw new Error("arx: counter overflow");const Z=Math.min(Hm,f-z);if(N&&Z===Hm){const J=z/4;if(z%4!==0)throw new Error("arx: invalid block position");for(let ee=0,ve;ee<N7;ee++)ve=J+ee,M[ve]=O[ve]^S[ee];z+=Hm;continue}for(let J=0,ee;J<Z;J++)ee=z+J,i[ee]=s[ee]^m[J];z+=Z}}function x7(t,e){const{allowShortKeys:n,extendNonceFn:r,counterLength:s,counterRight:i,rounds:o}=y7({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return xS(s),xS(o),JI(i),JI(n),(l,f,m,S,N=0)=>{ts(l),ts(f),ts(m);const O=m.length;if(S===void 0&&(S=new Uint8Array(O)),ts(S),xS(N),N<0||N>=t1)throw new Error("arx: counter overflow");if(S.length<O)throw new Error(`arx: output (${S.length}) is shorter than data (${O})`);const M=[];let z=l.length,Z,J;if(z===32)M.push(Z=OS(l)),J=e1;else if(z===16&&n)Z=new Uint8Array(32),Z.set(l),Z.set(l,16),J=v7,M.push(Z);else throw new Error(`arx: invalid 32-byte key, got length=${z}`);IS(f)||M.push(f=OS(f));const ee=Jo(Z);if(r){if(f.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(J,ee,Jo(f.subarray(0,16)),ee),f=f.subarray(16)}const ve=16-s;if(ve!==f.length)throw new Error(`arx: nonce must be ${ve} or 16 bytes`);if(ve!==12){const Fe=new Uint8Array(12);Fe.set(f,i?0:12-f.length),f=Fe,M.push(f)}const ye=Jo(f);return k7(t,J,ee,ye,m,S,N,o),au(...M),S}}const mr=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class q7{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=qS(e),ts(e,32);const n=mr(e,0),r=mr(e,2),s=mr(e,4),i=mr(e,6),o=mr(e,8),l=mr(e,10),f=mr(e,12),m=mr(e,14);this.r[0]=n&8191,this.r[1]=(n>>>13|r<<3)&8191,this.r[2]=(r>>>10|s<<6)&7939,this.r[3]=(s>>>7|i<<9)&8191,this.r[4]=(i>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|l<<2)&8191,this.r[7]=(l>>>11|f<<5)&8065,this.r[8]=(f>>>8|m<<8)&8191,this.r[9]=m>>>5&127;for(let S=0;S<8;S++)this.pad[S]=mr(e,16+2*S)}process(e,n,r=!1){const s=r?0:2048,{h:i,r:o}=this,l=o[0],f=o[1],m=o[2],S=o[3],N=o[4],O=o[5],M=o[6],z=o[7],Z=o[8],J=o[9],ee=mr(e,n+0),ve=mr(e,n+2),ye=mr(e,n+4),Fe=mr(e,n+6),Je=mr(e,n+8),Xe=mr(e,n+10),We=mr(e,n+12),Re=mr(e,n+14);let Be=i[0]+(ee&8191),ze=i[1]+((ee>>>13|ve<<3)&8191),Le=i[2]+((ve>>>10|ye<<6)&8191),He=i[3]+((ye>>>7|Fe<<9)&8191),Ze=i[4]+((Fe>>>4|Je<<12)&8191),ht=i[5]+(Je>>>1&8191),qt=i[6]+((Je>>>14|Xe<<2)&8191),Ae=i[7]+((Xe>>>11|We<<5)&8191),Ue=i[8]+((We>>>8|Re<<8)&8191),ke=i[9]+(Re>>>5|s),Ne=0,Ve=Ne+Be*l+ze*(5*J)+Le*(5*Z)+He*(5*z)+Ze*(5*M);Ne=Ve>>>13,Ve&=8191,Ve+=ht*(5*O)+qt*(5*N)+Ae*(5*S)+Ue*(5*m)+ke*(5*f),Ne+=Ve>>>13,Ve&=8191;let kt=Ne+Be*f+ze*l+Le*(5*J)+He*(5*Z)+Ze*(5*z);Ne=kt>>>13,kt&=8191,kt+=ht*(5*M)+qt*(5*O)+Ae*(5*N)+Ue*(5*S)+ke*(5*m),Ne+=kt>>>13,kt&=8191;let Ut=Ne+Be*m+ze*f+Le*l+He*(5*J)+Ze*(5*Z);Ne=Ut>>>13,Ut&=8191,Ut+=ht*(5*z)+qt*(5*M)+Ae*(5*O)+Ue*(5*N)+ke*(5*S),Ne+=Ut>>>13,Ut&=8191;let kr=Ne+Be*S+ze*m+Le*f+He*l+Ze*(5*J);Ne=kr>>>13,kr&=8191,kr+=ht*(5*Z)+qt*(5*z)+Ae*(5*M)+Ue*(5*O)+ke*(5*N),Ne+=kr>>>13,kr&=8191;let xi=Ne+Be*N+ze*S+Le*m+He*f+Ze*l;Ne=xi>>>13,xi&=8191,xi+=ht*(5*J)+qt*(5*Z)+Ae*(5*z)+Ue*(5*M)+ke*(5*O),Ne+=xi>>>13,xi&=8191;let qi=Ne+Be*O+ze*N+Le*S+He*m+Ze*f;Ne=qi>>>13,qi&=8191,qi+=ht*l+qt*(5*J)+Ae*(5*Z)+Ue*(5*z)+ke*(5*M),Ne+=qi>>>13,qi&=8191;let Zs=Ne+Be*M+ze*O+Le*N+He*S+Ze*m;Ne=Zs>>>13,Zs&=8191,Zs+=ht*f+qt*l+Ae*(5*J)+Ue*(5*Z)+ke*(5*z),Ne+=Zs>>>13,Zs&=8191;let Oi=Ne+Be*z+ze*M+Le*O+He*N+Ze*S;Ne=Oi>>>13,Oi&=8191,Oi+=ht*m+qt*f+Ae*l+Ue*(5*J)+ke*(5*Z),Ne+=Oi>>>13,Oi&=8191;let Na=Ne+Be*Z+ze*z+Le*M+He*O+Ze*N;Ne=Na>>>13,Na&=8191,Na+=ht*S+qt*m+Ae*f+Ue*l+ke*(5*J),Ne+=Na>>>13,Na&=8191;let Qr=Ne+Be*J+ze*Z+Le*z+He*M+Ze*O;Ne=Qr>>>13,Qr&=8191,Qr+=ht*N+qt*S+Ae*m+Ue*f+ke*l,Ne+=Qr>>>13,Qr&=8191,Ne=(Ne<<2)+Ne|0,Ne=Ne+Ve|0,Ve=Ne&8191,Ne=Ne>>>13,kt+=Ne,i[0]=Ve,i[1]=kt,i[2]=Ut,i[3]=kr,i[4]=xi,i[5]=qi,i[6]=Zs,i[7]=Oi,i[8]=Na,i[9]=Qr}finalize(){const{h:e,pad:n}=this,r=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let l=2;l<10;l++)e[l]+=s,s=e[l]>>>13,e[l]&=8191;e[0]+=s*5,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,r[0]=e[0]+5,s=r[0]>>>13,r[0]&=8191;for(let l=1;l<10;l++)r[l]=e[l]+s,s=r[l]>>>13,r[l]&=8191;r[9]-=8192;let i=(s^1)-1;for(let l=0;l<10;l++)r[l]&=i;i=~i;for(let l=0;l<10;l++)e[l]=e[l]&i|r[l];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+n[0];e[0]=o&65535;for(let l=1;l<8;l++)o=(e[l]+n[l]|0)+(o>>>16)|0,e[l]=o&65535;au(r)}update(e){YI(this);const{buffer:n,blockLen:r}=this;e=qS(e);const s=e.length;for(let i=0;i<s;){const o=Math.min(r-this.pos,s-i);if(o===r){for(;r<=s-i;i+=r)this.process(e,i);continue}n.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===r&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){au(this.h,this.r,this.buffer,this.pad)}digestInto(e){YI(this),g7(e,this),this.finished=!0;const{buffer:n,h:r}=this;let{pos:s}=this;if(s){for(n[s++]=1;s<16;s++)n[s]=0;this.process(n,0,!0)}this.finalize();let i=0;for(let o=0;o<8;o++)e[i++]=r[o]>>>0,e[i++]=r[o]>>>8;return e}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}}function O7(t){const e=(r,s)=>t(s).update(qS(r)).digest(),n=t(new Uint8Array(32));return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e}const r1=O7(t=>new q7(t));function I7(t,e,n,r,s,i=20){let o=t[0],l=e[0],f=e[1],m=e[2],S=e[3],N=t[1],O=n[0],M=n[1],z=s,Z=0,J=t[2],ee=e[4],ve=e[5],ye=e[6],Fe=e[7],Je=t[3],Xe=o,We=l,Re=f,Be=m,ze=S,Le=N,He=O,Ze=M,ht=z,qt=Z,Ae=J,Ue=ee,ke=ve,Ne=ye,Ve=Fe,kt=Je;for(let kr=0;kr<i;kr+=2)ze^=De(Xe+ke|0,7),ht^=De(ze+Xe|0,9),ke^=De(ht+ze|0,13),Xe^=De(ke+ht|0,18),qt^=De(Le+We|0,7),Ne^=De(qt+Le|0,9),We^=De(Ne+qt|0,13),Le^=De(We+Ne|0,18),Ve^=De(Ae+He|0,7),Re^=De(Ve+Ae|0,9),He^=De(Re+Ve|0,13),Ae^=De(He+Re|0,18),Be^=De(kt+Ue|0,7),Ze^=De(Be+kt|0,9),Ue^=De(Ze+Be|0,13),kt^=De(Ue+Ze|0,18),We^=De(Xe+Be|0,7),Re^=De(We+Xe|0,9),Be^=De(Re+We|0,13),Xe^=De(Be+Re|0,18),He^=De(Le+ze|0,7),Ze^=De(He+Le|0,9),ze^=De(Ze+He|0,13),Le^=De(ze+Ze|0,18),Ue^=De(Ae+qt|0,7),ht^=De(Ue+Ae|0,9),qt^=De(ht+Ue|0,13),Ae^=De(qt+ht|0,18),ke^=De(kt+Ve|0,7),Ne^=De(ke+kt|0,9),Ve^=De(Ne+ke|0,13),kt^=De(Ve+Ne|0,18);let Ut=0;r[Ut++]=o+Xe|0,r[Ut++]=l+We|0,r[Ut++]=f+Re|0,r[Ut++]=m+Be|0,r[Ut++]=S+ze|0,r[Ut++]=N+Le|0,r[Ut++]=O+He|0,r[Ut++]=M+Ze|0,r[Ut++]=z+ht|0,r[Ut++]=Z+qt|0,r[Ut++]=J+Ae|0,r[Ut++]=ee+Ue|0,r[Ut++]=ve+ke|0,r[Ut++]=ye+Ne|0,r[Ut++]=Fe+Ve|0,r[Ut++]=Je+kt|0}function T7(t,e,n,r){let s=t[0],i=e[0],o=e[1],l=e[2],f=e[3],m=t[1],S=n[0],N=n[1],O=n[2],M=n[3],z=t[2],Z=e[4],J=e[5],ee=e[6],ve=e[7],ye=t[3];for(let Je=0;Je<20;Je+=2)f^=De(s+J|0,7),O^=De(f+s|0,9),J^=De(O+f|0,13),s^=De(J+O|0,18),M^=De(m+i|0,7),ee^=De(M+m|0,9),i^=De(ee+M|0,13),m^=De(i+ee|0,18),ve^=De(z+S|0,7),o^=De(ve+z|0,9),S^=De(o+ve|0,13),z^=De(S+o|0,18),l^=De(ye+Z|0,7),N^=De(l+ye|0,9),Z^=De(N+l|0,13),ye^=De(Z+N|0,18),i^=De(s+l|0,7),o^=De(i+s|0,9),l^=De(o+i|0,13),s^=De(l+o|0,18),S^=De(m+f|0,7),N^=De(S+m|0,9),f^=De(N+S|0,13),m^=De(f+N|0,18),Z^=De(z+M|0,7),O^=De(Z+z|0,9),M^=De(O+Z|0,13),z^=De(M+O|0,18),J^=De(ye+ve|0,7),ee^=De(J+ye|0,9),ve^=De(ee+J|0,13),ye^=De(ve+ee|0,18);let Fe=0;r[Fe++]=s,r[Fe++]=m,r[Fe++]=z,r[Fe++]=ye,r[Fe++]=S,r[Fe++]=N,r[Fe++]=O,r[Fe++]=M}const TS=x7(I7,{counterRight:!0,extendNonceFn:T7}),A7=w7({blockSize:64,nonceLength:24,tagLength:16},(t,e)=>(ts(t,32),ts(e,24),{encrypt(r,s){ts(r);const i=r.length+32;s?ts(s,i):s=new Uint8Array(i),s.set(r,32),TS(t,e,s,s);const o=s.subarray(0,32),l=r1(s.subarray(32),o);return s.set(l,16),au(s.subarray(0,16),l),s.subarray(16)},decrypt(r,s){if(ts(r),r.length<16)throw new Error("encrypted data should be at least 16 bytes");const i=r.length+32;s?ts(s,i):s=new Uint8Array(i),s.set(r,32);const o=s.subarray(0,32);au(o);const l=TS(t,e,o,o),f=r1(s.subarray(48),l);if(!b7(s.subarray(32,48),f))throw new Error("invalid tag");return TS(t,e,s.subarray(16),s.subarray(16)),au(s.subarray(0,48),f),s.subarray(48)}}));function s1(t,e){const n=A7(t,e);return{seal:n.encrypt,open:n.decrypt}}function cu(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function C7(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function Jm(t,...e){if(!C7(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function i1(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");cu(t.outputLen),cu(t.blockLen)}function Gm(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function F7(t,e){Jm(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const lu=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ym=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),gi=(t,e)=>t<<32-e|t>>>e;new Uint8Array(new Uint32Array([287454020]).buffer)[0];function R7(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function bd(t){return typeof t=="string"&&(t=R7(t)),Jm(t),t}class o1{clone(){return this._cloneInto()}}const P7={}.toString;function $7(t,e){if(e!==void 0&&P7.call(e)!=="[object Object]")throw new Error("Options should be object or undefined");return Object.assign(t,e)}function a1(t){const e=r=>t().update(bd(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function c1(t=32){if(lu&&typeof lu.getRandomValues=="function")return lu.getRandomValues(new Uint8Array(t));if(lu&&typeof lu.randomBytes=="function")return lu.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}class l1 extends o1{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,i1(e);const r=bd(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,i=new Uint8Array(s);i.set(r.length>s?e.create().update(r).digest():r);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),i.fill(0)}update(e){return Gm(this),this.iHash.update(e),this}digestInto(e){Gm(this),Jm(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:s,destroyed:i,blockLen:o,outputLen:l}=this;return e=e,e.finished=s,e.destroyed=i,e.blockLen=o,e.outputLen=l,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Xm=(t,e,n)=>new l1(t,e).update(n).digest();Xm.create=(t,e)=>new l1(t,e);function L7(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const s=BigInt(32),i=BigInt(4294967295),o=Number(n>>s&i),l=Number(n&i),f=r?4:0,m=r?0:4;t.setUint32(e+f,o,r),t.setUint32(e+m,l,r)}const M7=(t,e,n)=>t&e^~t&n,D7=(t,e,n)=>t&e^t&n^e&n;class u1 extends o1{constructor(e,n,r,s){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Ym(this.buffer)}update(e){Gm(this);const{view:n,buffer:r,blockLen:s}=this;e=bd(e);const i=e.length;for(let o=0;o<i;){const l=Math.min(s-this.pos,i-o);if(l===s){const f=Ym(e);for(;s<=i-o;o+=s)this.process(f,o);continue}r.set(e.subarray(o,o+l),this.pos),this.pos+=l,o+=l,this.pos===s&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Gm(this),F7(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:s,isLE:i}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(r,0),o=0);for(let N=o;N<s;N++)n[N]=0;L7(r,s-8,BigInt(this.length*8),i),this.process(r,0);const l=Ym(e),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const m=f/4,S=this.get();if(m>S.length)throw new Error("_sha2: outputLen bigger than state");for(let N=0;N<m;N++)l.setUint32(4*N,S[N],i)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:s,finished:i,destroyed:o,pos:l}=this;return e.length=s,e.pos=l,e.finished=i,e.destroyed=o,s%n&&e.buffer.set(r),e}}const Zm=BigInt(2**32-1),AS=BigInt(32);function f1(t,e=!1){return e?{h:Number(t&Zm),l:Number(t>>AS&Zm)}:{h:Number(t>>AS&Zm)|0,l:Number(t&Zm)|0}}function W7(t,e=!1){let n=new Uint32Array(t.length),r=new Uint32Array(t.length);for(let s=0;s<t.length;s++){const{h:i,l:o}=f1(t[s],e);[n[s],r[s]]=[i,o]}return[n,r]}const B7=(t,e)=>BigInt(t>>>0)<<AS|BigInt(e>>>0),U7=(t,e,n)=>t>>>n,j7=(t,e,n)=>t<<32-n|e>>>n,z7=(t,e,n)=>t>>>n|e<<32-n,V7=(t,e,n)=>t<<32-n|e>>>n,K7=(t,e,n)=>t<<64-n|e>>>n-32,Q7=(t,e,n)=>t>>>n-32|e<<64-n,H7=(t,e)=>e,J7=(t,e)=>t,G7=(t,e,n)=>t<<n|e>>>32-n,Y7=(t,e,n)=>e<<n|t>>>32-n,X7=(t,e,n)=>e<<n-32|t>>>64-n,Z7=(t,e,n)=>t<<n-32|e>>>64-n;function e9(t,e,n,r){const s=(e>>>0)+(r>>>0);return{h:t+n+(s/2**32|0)|0,l:s|0}}const Nt={fromBig:f1,split:W7,toBig:B7,shrSH:U7,shrSL:j7,rotrSH:z7,rotrSL:V7,rotrBH:K7,rotrBL:Q7,rotr32H:H7,rotr32L:J7,rotlSH:G7,rotlSL:Y7,rotlBH:X7,rotlBL:Z7,add:e9,add3L:(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),add3H:(t,e,n,r)=>e+n+r+(t/2**32|0)|0,add4L:(t,e,n,r)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0),add4H:(t,e,n,r,s)=>e+n+r+s+(t/2**32|0)|0,add5H:(t,e,n,r,s,i)=>e+n+r+s+i+(t/2**32|0)|0,add5L:(t,e,n,r,s)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0)+(s>>>0)},[t9,n9]=Nt.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),Go=new Uint32Array(80),Yo=new Uint32Array(80);class r9 extends u1{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:n,Bh:r,Bl:s,Ch:i,Cl:o,Dh:l,Dl:f,Eh:m,El:S,Fh:N,Fl:O,Gh:M,Gl:z,Hh:Z,Hl:J}=this;return[e,n,r,s,i,o,l,f,m,S,N,O,M,z,Z,J]}set(e,n,r,s,i,o,l,f,m,S,N,O,M,z,Z,J){this.Ah=e|0,this.Al=n|0,this.Bh=r|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=l|0,this.Dl=f|0,this.Eh=m|0,this.El=S|0,this.Fh=N|0,this.Fl=O|0,this.Gh=M|0,this.Gl=z|0,this.Hh=Z|0,this.Hl=J|0}process(e,n){for(let ye=0;ye<16;ye++,n+=4)Go[ye]=e.getUint32(n),Yo[ye]=e.getUint32(n+=4);for(let ye=16;ye<80;ye++){const Fe=Go[ye-15]|0,Je=Yo[ye-15]|0,Xe=Nt.rotrSH(Fe,Je,1)^Nt.rotrSH(Fe,Je,8)^Nt.shrSH(Fe,Je,7),We=Nt.rotrSL(Fe,Je,1)^Nt.rotrSL(Fe,Je,8)^Nt.shrSL(Fe,Je,7),Re=Go[ye-2]|0,Be=Yo[ye-2]|0,ze=Nt.rotrSH(Re,Be,19)^Nt.rotrBH(Re,Be,61)^Nt.shrSH(Re,Be,6),Le=Nt.rotrSL(Re,Be,19)^Nt.rotrBL(Re,Be,61)^Nt.shrSL(Re,Be,6),He=Nt.add4L(We,Le,Yo[ye-7],Yo[ye-16]),Ze=Nt.add4H(He,Xe,ze,Go[ye-7],Go[ye-16]);Go[ye]=Ze|0,Yo[ye]=He|0}let{Ah:r,Al:s,Bh:i,Bl:o,Ch:l,Cl:f,Dh:m,Dl:S,Eh:N,El:O,Fh:M,Fl:z,Gh:Z,Gl:J,Hh:ee,Hl:ve}=this;for(let ye=0;ye<80;ye++){const Fe=Nt.rotrSH(N,O,14)^Nt.rotrSH(N,O,18)^Nt.rotrBH(N,O,41),Je=Nt.rotrSL(N,O,14)^Nt.rotrSL(N,O,18)^Nt.rotrBL(N,O,41),Xe=N&M^~N&Z,We=O&z^~O&J,Re=Nt.add5L(ve,Je,We,n9[ye],Yo[ye]),Be=Nt.add5H(Re,ee,Fe,Xe,t9[ye],Go[ye]),ze=Re|0,Le=Nt.rotrSH(r,s,28)^Nt.rotrBH(r,s,34)^Nt.rotrBH(r,s,39),He=Nt.rotrSL(r,s,28)^Nt.rotrBL(r,s,34)^Nt.rotrBL(r,s,39),Ze=r&i^r&l^i&l,ht=s&o^s&f^o&f;ee=Z|0,ve=J|0,Z=M|0,J=z|0,M=N|0,z=O|0,{h:N,l:O}=Nt.add(m|0,S|0,Be|0,ze|0),m=l|0,S=f|0,l=i|0,f=o|0,i=r|0,o=s|0;const qt=Nt.add3L(ze,He,ht);r=Nt.add3H(qt,Be,Le,Ze),s=qt|0}({h:r,l:s}=Nt.add(this.Ah|0,this.Al|0,r|0,s|0)),{h:i,l:o}=Nt.add(this.Bh|0,this.Bl|0,i|0,o|0),{h:l,l:f}=Nt.add(this.Ch|0,this.Cl|0,l|0,f|0),{h:m,l:S}=Nt.add(this.Dh|0,this.Dl|0,m|0,S|0),{h:N,l:O}=Nt.add(this.Eh|0,this.El|0,N|0,O|0),{h:M,l:z}=Nt.add(this.Fh|0,this.Fl|0,M|0,z|0),{h:Z,l:J}=Nt.add(this.Gh|0,this.Gl|0,Z|0,J|0),{h:ee,l:ve}=Nt.add(this.Hh|0,this.Hl|0,ee|0,ve|0),this.set(r,s,i,o,l,f,m,S,N,O,M,z,Z,J,ee,ve)}roundClean(){Go.fill(0),Yo.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const CS=a1(()=>new r9);function s9(t,e,n,r){i1(t);const s=$7({dkLen:32,asyncTick:10},r),{c:i,dkLen:o,asyncTick:l}=s;if(cu(i),cu(o),cu(l),i<1)throw new Error("PBKDF2: iterations (c) should be >= 1");const f=bd(e),m=bd(n),S=new Uint8Array(o),N=Xm.create(t,f),O=N._cloneInto().update(m);return{c:i,dkLen:o,asyncTick:l,DK:S,PRF:N,PRFSalt:O}}function i9(t,e,n,r,s){return t.destroy(),e.destroy(),r&&r.destroy(),s.fill(0),n}function o9(t,e,n,r){const{c:s,dkLen:i,DK:o,PRF:l,PRFSalt:f}=s9(t,e,n,r);let m;const S=new Uint8Array(4),N=Ym(S),O=new Uint8Array(l.outputLen);for(let M=1,z=0;z<i;M++,z+=l.outputLen){const Z=o.subarray(z,z+l.outputLen);N.setInt32(0,M,!1),(m=f._cloneInto(m)).update(S).digestInto(O),Z.set(O.subarray(0,Z.length));for(let J=1;J<s;J++){l._cloneInto(m).update(O).digestInto(O);for(let ee=0;ee<Z.length;ee++)Z[ee]^=O[ee]}}return i9(l,f,o,m,O)}const a9=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Xo=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Zo=new Uint32Array(64);class c9 extends u1{constructor(){super(64,32,8,!1),this.A=Xo[0]|0,this.B=Xo[1]|0,this.C=Xo[2]|0,this.D=Xo[3]|0,this.E=Xo[4]|0,this.F=Xo[5]|0,this.G=Xo[6]|0,this.H=Xo[7]|0}get(){const{A:e,B:n,C:r,D:s,E:i,F:o,G:l,H:f}=this;return[e,n,r,s,i,o,l,f]}set(e,n,r,s,i,o,l,f){this.A=e|0,this.B=n|0,this.C=r|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=l|0,this.H=f|0}process(e,n){for(let N=0;N<16;N++,n+=4)Zo[N]=e.getUint32(n,!1);for(let N=16;N<64;N++){const O=Zo[N-15],M=Zo[N-2],z=gi(O,7)^gi(O,18)^O>>>3,Z=gi(M,17)^gi(M,19)^M>>>10;Zo[N]=Z+Zo[N-7]+z+Zo[N-16]|0}let{A:r,B:s,C:i,D:o,E:l,F:f,G:m,H:S}=this;for(let N=0;N<64;N++){const O=gi(l,6)^gi(l,11)^gi(l,25),M=S+O+M7(l,f,m)+a9[N]+Zo[N]|0,Z=(gi(r,2)^gi(r,13)^gi(r,22))+D7(r,s,i)|0;S=m,m=f,f=l,l=o+M|0,o=i,i=s,s=r,r=M+Z|0}r=r+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,l=l+this.E|0,f=f+this.F|0,m=m+this.G|0,S=S+this.H|0,this.set(r,s,i,o,l,f,m,S)}roundClean(){Zo.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const l9=a1(()=>new c9);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function eg(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function u9(...t){const e=i=>i,n=(i,o)=>l=>i(o(l)),r=t.map(i=>i.encode).reduceRight(n,e),s=t.map(i=>i.decode).reduce(n,e);return{encode:r,decode:s}}function f9(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(n=>{if(n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r})}}}function d9(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}function h9(t,e="="){if(typeof e!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let s of n)if(typeof s!="string")throw new Error(`padding.decode: non-string input=${s}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function FS(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0;const s=[],i=Array.from(t);for(i.forEach(o=>{if(o<0||o>=e)throw new Error(`Wrong integer: ${o}`)});;){let o=0,l=!0;for(let f=r;f<i.length;f++){const m=i[f],S=e*o+m;if(!Number.isSafeInteger(S)||e*o/e!==o||S-m!==e*o)throw new Error("convertRadix: carry overflow");o=S%n;const N=Math.floor(S/n);if(i[f]=N,!Number.isSafeInteger(N)||N*n+o!==S)throw new Error("convertRadix: carry overflow");if(l)N?l=!1:r=f;else continue}if(s.push(o),l)break}for(let o=0;o<t.length-1&&t[o]===0;o++)s.push(0);return s.reverse()}const d1=(t,e)=>e?d1(e,t%e):t,tg=(t,e)=>t+(e-d1(t,e));function RS(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(tg(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${tg(e,n)}`);let s=0,i=0;const o=2**n-1,l=[];for(const f of t){if(f>=2**e)throw new Error(`convertRadix2: invalid data word=${f} from=${e}`);if(s=s<<e|f,i+e>32)throw new Error(`convertRadix2: carry overflow pos=${i} from=${e}`);for(i+=e;i>=n;i-=n)l.push((s>>i-n&o)>>>0);s&=2**i-1}if(s=s<<n-i&o,!r&&i>=e)throw new Error("Excess padding");if(!r&&s)throw new Error(`Non-zero padding: ${s}`);return r&&i>0&&l.push(s>>>0),l}function p9(t){return{encode:e=>{if(!eg(e))throw new Error("radix.encode input should be Uint8Array");return FS(Array.from(e),2**8,t)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of numbers");return Uint8Array.from(FS(e,t,2**8))}}}function m9(t,e=!1){if(t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(tg(8,t)>32||tg(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!eg(n))throw new Error("radix2.encode input should be Uint8Array");return RS(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of numbers");return Uint8Array.from(RS(n,t,8,e))}}}function g9(t,e){if(typeof e!="function")throw new Error("checksum fn should be function");return{encode(n){if(!eg(n))throw new Error("checksum.encode: input should be Uint8Array");const r=e(n).slice(0,t),s=new Uint8Array(n.length+t);return s.set(n),s.set(r,n.length),s},decode(n){if(!eg(n))throw new Error("checksum.decode: input should be Uint8Array");const r=n.slice(0,-t),s=e(r).slice(0,t),i=n.slice(-t);for(let o=0;o<t;o++)if(s[o]!==i[o])throw new Error("Invalid checksum");return r}}}const ng={alphabet:f9,chain:u9,checksum:g9,convertRadix:FS,convertRadix2:RS,radix:p9,radix2:m9,join:d9,padding:h9};/*! scure-bip39 - MIT License (c) 2022 Patricio Palladino, Paul Miller (paulmillr.com) */const _9=t=>t[0]==="あいこくしん";function h1(t){if(typeof t!="string")throw new TypeError(`Invalid mnemonic type: ${typeof t}`);return t.normalize("NFKD")}function y9(t){const e=h1(t),n=e.split(" ");if(![12,15,18,21,24].includes(n.length))throw new Error("Invalid mnemonic");return{nfkd:e,words:n}}function b9(t){Jm(t,16,20,24,28,32)}function w9(t,e=128){if(cu(e),e%32!==0||e>256)throw new TypeError("Invalid entropy");return v9(c1(e/8),t)}const S9=t=>{const e=8-t.length/4;return new Uint8Array([l9(t)[0]>>e<<e])};function E9(t){if(!Array.isArray(t)||t.length!==2048||typeof t[0]!="string")throw new Error("Wordlist: expected array of 2048 strings");return t.forEach(e=>{if(typeof e!="string")throw new Error(`Wordlist: non-string element: ${e}`)}),ng.chain(ng.checksum(1,S9),ng.radix2(11,!0),ng.alphabet(t))}function v9(t,e){return b9(t),E9(e).encode(t).join(_9(e)?"　":" ")}const N9=t=>h1(`mnemonic${t}`);function k9(t,e=""){return o9(CS,y9(t).nfkd,N9(e),{c:2048,dkLen:64})}const x9=`abandon
ability
able
about
above
absent
absorb
abstract
absurd
abuse
access
accident
account
accuse
achieve
acid
acoustic
acquire
across
act
action
actor
actress
actual
adapt
add
addict
address
adjust
admit
adult
advance
advice
aerobic
affair
afford
afraid
again
age
agent
agree
ahead
aim
air
airport
aisle
alarm
album
alcohol
alert
alien
all
alley
allow
almost
alone
alpha
already
also
alter
always
amateur
amazing
among
amount
amused
analyst
anchor
ancient
anger
angle
angry
animal
ankle
announce
annual
another
answer
antenna
antique
anxiety
any
apart
apology
appear
apple
approve
april
arch
arctic
area
arena
argue
arm
armed
armor
army
around
arrange
arrest
arrive
arrow
art
artefact
artist
artwork
ask
aspect
assault
asset
assist
assume
asthma
athlete
atom
attack
attend
attitude
attract
auction
audit
august
aunt
author
auto
autumn
average
avocado
avoid
awake
aware
away
awesome
awful
awkward
axis
baby
bachelor
bacon
badge
bag
balance
balcony
ball
bamboo
banana
banner
bar
barely
bargain
barrel
base
basic
basket
battle
beach
bean
beauty
because
become
beef
before
begin
behave
behind
believe
below
belt
bench
benefit
best
betray
better
between
beyond
bicycle
bid
bike
bind
biology
bird
birth
bitter
black
blade
blame
blanket
blast
bleak
bless
blind
blood
blossom
blouse
blue
blur
blush
board
boat
body
boil
bomb
bone
bonus
book
boost
border
boring
borrow
boss
bottom
bounce
box
boy
bracket
brain
brand
brass
brave
bread
breeze
brick
bridge
brief
bright
bring
brisk
broccoli
broken
bronze
broom
brother
brown
brush
bubble
buddy
budget
buffalo
build
bulb
bulk
bullet
bundle
bunker
burden
burger
burst
bus
business
busy
butter
buyer
buzz
cabbage
cabin
cable
cactus
cage
cake
call
calm
camera
camp
can
canal
cancel
candy
cannon
canoe
canvas
canyon
capable
capital
captain
car
carbon
card
cargo
carpet
carry
cart
case
cash
casino
castle
casual
cat
catalog
catch
category
cattle
caught
cause
caution
cave
ceiling
celery
cement
census
century
cereal
certain
chair
chalk
champion
change
chaos
chapter
charge
chase
chat
cheap
check
cheese
chef
cherry
chest
chicken
chief
child
chimney
choice
choose
chronic
chuckle
chunk
churn
cigar
cinnamon
circle
citizen
city
civil
claim
clap
clarify
claw
clay
clean
clerk
clever
click
client
cliff
climb
clinic
clip
clock
clog
close
cloth
cloud
clown
club
clump
cluster
clutch
coach
coast
coconut
code
coffee
coil
coin
collect
color
column
combine
come
comfort
comic
common
company
concert
conduct
confirm
congress
connect
consider
control
convince
cook
cool
copper
copy
coral
core
corn
correct
cost
cotton
couch
country
couple
course
cousin
cover
coyote
crack
cradle
craft
cram
crane
crash
crater
crawl
crazy
cream
credit
creek
crew
cricket
crime
crisp
critic
crop
cross
crouch
crowd
crucial
cruel
cruise
crumble
crunch
crush
cry
crystal
cube
culture
cup
cupboard
curious
current
curtain
curve
cushion
custom
cute
cycle
dad
damage
damp
dance
danger
daring
dash
daughter
dawn
day
deal
debate
debris
decade
december
decide
decline
decorate
decrease
deer
defense
define
defy
degree
delay
deliver
demand
demise
denial
dentist
deny
depart
depend
deposit
depth
deputy
derive
describe
desert
design
desk
despair
destroy
detail
detect
develop
device
devote
diagram
dial
diamond
diary
dice
diesel
diet
differ
digital
dignity
dilemma
dinner
dinosaur
direct
dirt
disagree
discover
disease
dish
dismiss
disorder
display
distance
divert
divide
divorce
dizzy
doctor
document
dog
doll
dolphin
domain
donate
donkey
donor
door
dose
double
dove
draft
dragon
drama
drastic
draw
dream
dress
drift
drill
drink
drip
drive
drop
drum
dry
duck
dumb
dune
during
dust
dutch
duty
dwarf
dynamic
eager
eagle
early
earn
earth
easily
east
easy
echo
ecology
economy
edge
edit
educate
effort
egg
eight
either
elbow
elder
electric
elegant
element
elephant
elevator
elite
else
embark
embody
embrace
emerge
emotion
employ
empower
empty
enable
enact
end
endless
endorse
enemy
energy
enforce
engage
engine
enhance
enjoy
enlist
enough
enrich
enroll
ensure
enter
entire
entry
envelope
episode
equal
equip
era
erase
erode
erosion
error
erupt
escape
essay
essence
estate
eternal
ethics
evidence
evil
evoke
evolve
exact
example
excess
exchange
excite
exclude
excuse
execute
exercise
exhaust
exhibit
exile
exist
exit
exotic
expand
expect
expire
explain
expose
express
extend
extra
eye
eyebrow
fabric
face
faculty
fade
faint
faith
fall
false
fame
family
famous
fan
fancy
fantasy
farm
fashion
fat
fatal
father
fatigue
fault
favorite
feature
february
federal
fee
feed
feel
female
fence
festival
fetch
fever
few
fiber
fiction
field
figure
file
film
filter
final
find
fine
finger
finish
fire
firm
first
fiscal
fish
fit
fitness
fix
flag
flame
flash
flat
flavor
flee
flight
flip
float
flock
floor
flower
fluid
flush
fly
foam
focus
fog
foil
fold
follow
food
foot
force
forest
forget
fork
fortune
forum
forward
fossil
foster
found
fox
fragile
frame
frequent
fresh
friend
fringe
frog
front
frost
frown
frozen
fruit
fuel
fun
funny
furnace
fury
future
gadget
gain
galaxy
gallery
game
gap
garage
garbage
garden
garlic
garment
gas
gasp
gate
gather
gauge
gaze
general
genius
genre
gentle
genuine
gesture
ghost
giant
gift
giggle
ginger
giraffe
girl
give
glad
glance
glare
glass
glide
glimpse
globe
gloom
glory
glove
glow
glue
goat
goddess
gold
good
goose
gorilla
gospel
gossip
govern
gown
grab
grace
grain
grant
grape
grass
gravity
great
green
grid
grief
grit
grocery
group
grow
grunt
guard
guess
guide
guilt
guitar
gun
gym
habit
hair
half
hammer
hamster
hand
happy
harbor
hard
harsh
harvest
hat
have
hawk
hazard
head
health
heart
heavy
hedgehog
height
hello
helmet
help
hen
hero
hidden
high
hill
hint
hip
hire
history
hobby
hockey
hold
hole
holiday
hollow
home
honey
hood
hope
horn
horror
horse
hospital
host
hotel
hour
hover
hub
huge
human
humble
humor
hundred
hungry
hunt
hurdle
hurry
hurt
husband
hybrid
ice
icon
idea
identify
idle
ignore
ill
illegal
illness
image
imitate
immense
immune
impact
impose
improve
impulse
inch
include
income
increase
index
indicate
indoor
industry
infant
inflict
inform
inhale
inherit
initial
inject
injury
inmate
inner
innocent
input
inquiry
insane
insect
inside
inspire
install
intact
interest
into
invest
invite
involve
iron
island
isolate
issue
item
ivory
jacket
jaguar
jar
jazz
jealous
jeans
jelly
jewel
job
join
joke
journey
joy
judge
juice
jump
jungle
junior
junk
just
kangaroo
keen
keep
ketchup
key
kick
kid
kidney
kind
kingdom
kiss
kit
kitchen
kite
kitten
kiwi
knee
knife
knock
know
lab
label
labor
ladder
lady
lake
lamp
language
laptop
large
later
latin
laugh
laundry
lava
law
lawn
lawsuit
layer
lazy
leader
leaf
learn
leave
lecture
left
leg
legal
legend
leisure
lemon
lend
length
lens
leopard
lesson
letter
level
liar
liberty
library
license
life
lift
light
like
limb
limit
link
lion
liquid
list
little
live
lizard
load
loan
lobster
local
lock
logic
lonely
long
loop
lottery
loud
lounge
love
loyal
lucky
luggage
lumber
lunar
lunch
luxury
lyrics
machine
mad
magic
magnet
maid
mail
main
major
make
mammal
man
manage
mandate
mango
mansion
manual
maple
marble
march
margin
marine
market
marriage
mask
mass
master
match
material
math
matrix
matter
maximum
maze
meadow
mean
measure
meat
mechanic
medal
media
melody
melt
member
memory
mention
menu
mercy
merge
merit
merry
mesh
message
metal
method
middle
midnight
milk
million
mimic
mind
minimum
minor
minute
miracle
mirror
misery
miss
mistake
mix
mixed
mixture
mobile
model
modify
mom
moment
monitor
monkey
monster
month
moon
moral
more
morning
mosquito
mother
motion
motor
mountain
mouse
move
movie
much
muffin
mule
multiply
muscle
museum
mushroom
music
must
mutual
myself
mystery
myth
naive
name
napkin
narrow
nasty
nation
nature
near
neck
need
negative
neglect
neither
nephew
nerve
nest
net
network
neutral
never
news
next
nice
night
noble
noise
nominee
noodle
normal
north
nose
notable
note
nothing
notice
novel
now
nuclear
number
nurse
nut
oak
obey
object
oblige
obscure
observe
obtain
obvious
occur
ocean
october
odor
off
offer
office
often
oil
okay
old
olive
olympic
omit
once
one
onion
online
only
open
opera
opinion
oppose
option
orange
orbit
orchard
order
ordinary
organ
orient
original
orphan
ostrich
other
outdoor
outer
output
outside
oval
oven
over
own
owner
oxygen
oyster
ozone
pact
paddle
page
pair
palace
palm
panda
panel
panic
panther
paper
parade
parent
park
parrot
party
pass
patch
path
patient
patrol
pattern
pause
pave
payment
peace
peanut
pear
peasant
pelican
pen
penalty
pencil
people
pepper
perfect
permit
person
pet
phone
photo
phrase
physical
piano
picnic
picture
piece
pig
pigeon
pill
pilot
pink
pioneer
pipe
pistol
pitch
pizza
place
planet
plastic
plate
play
please
pledge
pluck
plug
plunge
poem
poet
point
polar
pole
police
pond
pony
pool
popular
portion
position
possible
post
potato
pottery
poverty
powder
power
practice
praise
predict
prefer
prepare
present
pretty
prevent
price
pride
primary
print
priority
prison
private
prize
problem
process
produce
profit
program
project
promote
proof
property
prosper
protect
proud
provide
public
pudding
pull
pulp
pulse
pumpkin
punch
pupil
puppy
purchase
purity
purpose
purse
push
put
puzzle
pyramid
quality
quantum
quarter
question
quick
quit
quiz
quote
rabbit
raccoon
race
rack
radar
radio
rail
rain
raise
rally
ramp
ranch
random
range
rapid
rare
rate
rather
raven
raw
razor
ready
real
reason
rebel
rebuild
recall
receive
recipe
record
recycle
reduce
reflect
reform
refuse
region
regret
regular
reject
relax
release
relief
rely
remain
remember
remind
remove
render
renew
rent
reopen
repair
repeat
replace
report
require
rescue
resemble
resist
resource
response
result
retire
retreat
return
reunion
reveal
review
reward
rhythm
rib
ribbon
rice
rich
ride
ridge
rifle
right
rigid
ring
riot
ripple
risk
ritual
rival
river
road
roast
robot
robust
rocket
romance
roof
rookie
room
rose
rotate
rough
round
route
royal
rubber
rude
rug
rule
run
runway
rural
sad
saddle
sadness
safe
sail
salad
salmon
salon
salt
salute
same
sample
sand
satisfy
satoshi
sauce
sausage
save
say
scale
scan
scare
scatter
scene
scheme
school
science
scissors
scorpion
scout
scrap
screen
script
scrub
sea
search
season
seat
second
secret
section
security
seed
seek
segment
select
sell
seminar
senior
sense
sentence
series
service
session
settle
setup
seven
shadow
shaft
shallow
share
shed
shell
sheriff
shield
shift
shine
ship
shiver
shock
shoe
shoot
shop
short
shoulder
shove
shrimp
shrug
shuffle
shy
sibling
sick
side
siege
sight
sign
silent
silk
silly
silver
similar
simple
since
sing
siren
sister
situate
six
size
skate
sketch
ski
skill
skin
skirt
skull
slab
slam
sleep
slender
slice
slide
slight
slim
slogan
slot
slow
slush
small
smart
smile
smoke
smooth
snack
snake
snap
sniff
snow
soap
soccer
social
sock
soda
soft
solar
soldier
solid
solution
solve
someone
song
soon
sorry
sort
soul
sound
soup
source
south
space
spare
spatial
spawn
speak
special
speed
spell
spend
sphere
spice
spider
spike
spin
spirit
split
spoil
sponsor
spoon
sport
spot
spray
spread
spring
spy
square
squeeze
squirrel
stable
stadium
staff
stage
stairs
stamp
stand
start
state
stay
steak
steel
stem
step
stereo
stick
still
sting
stock
stomach
stone
stool
story
stove
strategy
street
strike
strong
struggle
student
stuff
stumble
style
subject
submit
subway
success
such
sudden
suffer
sugar
suggest
suit
summer
sun
sunny
sunset
super
supply
supreme
sure
surface
surge
surprise
surround
survey
suspect
sustain
swallow
swamp
swap
swarm
swear
sweet
swift
swim
swing
switch
sword
symbol
symptom
syrup
system
table
tackle
tag
tail
talent
talk
tank
tape
target
task
taste
tattoo
taxi
teach
team
tell
ten
tenant
tennis
tent
term
test
text
thank
that
theme
then
theory
there
they
thing
this
thought
three
thrive
throw
thumb
thunder
ticket
tide
tiger
tilt
timber
time
tiny
tip
tired
tissue
title
toast
tobacco
today
toddler
toe
together
toilet
token
tomato
tomorrow
tone
tongue
tonight
tool
tooth
top
topic
topple
torch
tornado
tortoise
toss
total
tourist
toward
tower
town
toy
track
trade
traffic
tragic
train
transfer
trap
trash
travel
tray
treat
tree
trend
trial
tribe
trick
trigger
trim
trip
trophy
trouble
truck
true
truly
trumpet
trust
truth
try
tube
tuition
tumble
tuna
tunnel
turkey
turn
turtle
twelve
twenty
twice
twin
twist
two
type
typical
ugly
umbrella
unable
unaware
uncle
uncover
under
undo
unfair
unfold
unhappy
uniform
unique
unit
universe
unknown
unlock
until
unusual
unveil
update
upgrade
uphold
upon
upper
upset
urban
urge
usage
use
used
useful
useless
usual
utility
vacant
vacuum
vague
valid
valley
valve
van
vanish
vapor
various
vast
vault
vehicle
velvet
vendor
venture
venue
verb
verify
version
very
vessel
veteran
viable
vibrant
vicious
victory
video
view
village
vintage
violin
virtual
virus
visa
visit
visual
vital
vivid
vocal
voice
void
volcano
volume
vote
voyage
wage
wagon
wait
walk
wall
walnut
want
warfare
warm
warrior
wash
wasp
waste
water
wave
way
wealth
weapon
wear
weasel
weather
web
wedding
weekend
weird
welcome
west
wet
whale
what
wheat
wheel
when
where
whip
whisper
wide
width
wife
wild
will
win
window
wine
wing
wink
winner
winter
wire
wisdom
wise
wish
witness
wolf
woman
wonder
wood
wool
word
work
world
worry
worth
wrap
wreck
wrestle
wrist
write
wrong
yard
year
yellow
you
young
youth
zebra
zero
zone
zoo`.split(`
`),q9=()=>w9(x9,128),O9=t=>k9(t);class Ws extends Ai("NanoIdGenerator")(){}const I9=(t,e)=>{const n=t("0123456789abcdef",16);return rc(Ws,Ws.of({nanoid:Rt(()=>e()),nodeId:Rt(()=>n()),rowId:Rt(()=>e())}))},T9=pi.pipe(VI(/^[\w-]{16}$/),mi("NodeId")),p1=(t,e)=>Rt(()=>{let n=Xm(CS,"Symmetric key seed",t);for(let r=0;r<e.length;r++){const s=new TextEncoder().encode(e[r]),i=new Uint8Array(s.byteLength+1);i[0]=0,i.set(s,1),n=Xm(CS,n.slice(0,32),i)}return n.slice(32,64)});class uu extends Ai("SecretBox")(){}uu.Live=rc(uu,uu.of({seal:(t,e)=>Rt(()=>{const n=c1(24),r=s1(t,n).seal(e);return XI(n,r)}),open:(t,e)=>Rt(()=>{const n=e.subarray(0,24),r=e.subarray(24);return s1(t,n).open(r)})}));const A9=(t,e=0)=>{let n,r,s,i;const o=t.length&3,l=t.length-o;n=e;const f=3432918353,m=461845907;for(i=0;i<l;)s=t.charCodeAt(i)&255|(t.charCodeAt(++i)&255)<<8|(t.charCodeAt(++i)&255)<<16|(t.charCodeAt(++i)&255)<<24,++i,s=(s&65535)*f+(((s>>>16)*f&65535)<<16)&4294967295,s=s<<15|s>>>17,s=(s&65535)*m+(((s>>>16)*m&65535)<<16)&4294967295,n^=s,n=n<<13|n>>>19,r=(n&65535)*5+(((n>>>16)*5&65535)<<16)&4294967295,n=(r&65535)+27492+(((r>>>16)+58964&65535)<<16);switch(s=0,o){case 3:s^=(t.charCodeAt(i+2)&255)<<16;case 2:s^=(t.charCodeAt(i+1)&255)<<8;case 1:s^=t.charCodeAt(i)&255,s=(s&65535)*f+(((s>>>16)*f&65535)<<16)&4294967295,s=s<<15|s>>>17,s=(s&65535)*m+(((s>>>16)*m&65535)<<16)&4294967295,n^=s}return n^=t.length,n^=n>>>16,n=(n&65535)*2246822507+(((n>>>16)*2246822507&65535)<<16)&4294967295,n^=n>>>13,n=(n&65535)*3266489909+(((n>>>16)*3266489909&65535)<<16)&4294967295,n^=n>>>16,n>>>0},PS={greaterThan:860934419999,lessThan:258280326e4},m1=_d.pipe(KI(PS.greaterThan),f7(PS.lessThan),mi("Millis")),$S=pd(m1)(PS.greaterThan+1),LS=_d.pipe(h7(0,65535),mi("Counter")),g1=pd(LS)(0),wd=t=>[new Date(t.millis).toISOString(),t.counter.toString(16).toUpperCase().padStart(4,"0"),t.node].join("-"),MS=t=>{const e=t.split("-");return{millis:Date.parse(e.slice(0,3).join("-")).valueOf(),counter:parseInt(e[3],16),node:e[4]}},C9=t=>A9(wd(t)),F9=pd(T9)("0000000000000000"),R9=(t=$S)=>({millis:t,counter:g1,node:F9}),P9=Ws.pipe(Te(({nodeId:t})=>t),Me(t=>({millis:$S,counter:g1,node:t})));class ea extends Ai("Time")(){}ea.Live=rc(ea,{now:Hn(()=>KJ(m1)(Date.now())).pipe(Xl("ParseError",()=>dr({_tag:"TimestampTimeOutOfRangeError"})))});const _1=t=>Wt(function*(){const e=yield*ea,n=yield*Ko,r=yield*e.now,s=Math.max(r,...t);return s-r>n.maxDrift&&(yield*dr({_tag:"TimestampDriftError",now:r,next:s})),s}),rg=t=>I(Sk(t),QJ(LS),cv(()=>({_tag:"TimestampCounterOverflowError"}))),y1=pd(LS)(0),$9=t=>Wt(function*(){const e=yield*_1([t.millis]),n=e===t.millis?yield*rg(t.counter):y1;return{...t,millis:e,counter:n}}),L9=({local:t,remote:e})=>Wt(function*(n){t.node===e.node&&(yield*dr({_tag:"TimestampDuplicateNodeError",node:t.node}));const r=yield*_1([t.millis,e.millis]),s=yield*r===t.millis&&r===e.millis?rg(Math.max(t.counter,e.counter)):r===t.millis?rg(t.counter):r===e.millis?rg(e.counter):Mt(y1);return{...t,millis:r,counter:s}}),DS=Object.create(null),M9=t=>Math.floor(t/1e3/60).toString(3).split(""),D9=t=>t.length===0?$S:parseInt(t.join("").padEnd(16,"0"),3)*1e3*60,b1=(t,e)=>(t||0)^e,w1=(t,e,n)=>{if(e.length===0)return t;const r=e[0],s=t[r]||{};return{...t,[r]:{...s,...w1(s,e.slice(1),n),hash:b1(s.hash,n)}}},W9=(t,e)=>{const n=M9(e.millis),r=C9(e);return w1({...t,hash:b1(t.hash,r)},n,r)},B9=["0","1","2"],S1=t=>B9.filter(e=>e in t),U9=(t,e)=>{if(t.hash===e.hash)return ce();let n=t,r=e,s=[];for(;;){const i=fy(S1(n).concat(S1(r)),pq);let o=null;for(let l=0;l<i.length;l++){const f=i[l],m=n[f],S=r[f];if(!m||!S)break;if(m.hash!==S.hash){o=f;break}}if(!o)return de(D9(s));s=[...s,o],n=n[o]||DS,r=r[o]||DS}return ce()},WS=t=>JSON.stringify(t),j9=t=>JSON.parse(t),BS=Mz,z9=ww,V9=bm,K9=Ui,Q9=w8,H9=(t,e)=>t.reduce((n,r)=>{switch(r.op){case"replaceAll":return r.value;case"replaceAt":return cR(n,r.index,r.value)}},e),J9=(t,e)=>{if(t===void 0)return[{op:"replaceAll",value:e}];if(t.length!==e.length)return[{op:"replaceAll",value:e}];const n=t.length,r=[];for(let s=0;s<n;s++){const i=t[s],o=e[s];for(const l in i)if(!US(i[l],o[l])){r.push({op:"replaceAt",value:o,index:s});break}}return n>0&&r.length===n?[{op:"replaceAll",value:e}]:r},US=(t,e)=>{if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="object"&&t!==null&&e!==null){const n=zc(t),r=zc(e);if(n&&r){if(t.length!==e.length)return!1;for(let o=0;o<t.length;o++)if(t[o]!==e[o])return!1;return!0}const s=Yc(t),i=Yc(e);if(s&&i){if(t.length!==e.length)return!1;for(let o=0;o<t.length;o++)if(!US(t[o],e[o]))return!1;return!0}if(!n&&!r&&!s&&!i){const o=Object.keys(t),l=Object.keys(e);if(o.length!==l.length)return!1;for(const f of o)if(!US(t[f],e[f]))return!1;return!0}}return!1},E1=t=>({_tag:"UnexpectedError",error:t}),jS=t=>t instanceof Error?{message:t.message,name:t.name,stack:t.stack}:t,Jn=xr("Sqlite");class fc extends Ai("SqliteFactory")(){}fc.Common=Nm(fc,Me(fc,t=>({createSqlite:rr("SqliteFactory createSqlite").pipe(an(t.createSqlite),Me(e=>({...e,exec:n=>e.exec(n).pipe(on(r=>{Y9(r.rows)}),on(r=>["begin","rollback","commit"].includes(n.sql)?Br(`SQLiteCommon ${n.sql} transaction`):Br(["SQLiteCommon exec",n,r]))),transaction:n=>r=>n==="shared"?e.transaction(n)(r):Te(Jn,s=>Gw(s.exec({sql:"begin"}),()=>r,(i,o)=>r3(o)?s.exec({sql:"rollback"}):s.exec({sql:"commit"}))).pipe(e.transaction(n))})))})));const v1=t=>t!==null&&typeof t=="object"&&!zc(t),G9=t=>t.map(e=>v1(e)?JSON.stringify(e):e),Y9=t=>{N1(t)},N1=t=>{for(let e=0;e<t.length;++e)t[e]=zS(t[e]);return t},zS=t=>Hr(t)?X9(t):Array.isArray(t)?N1(t):typeof t=="object"&&t!==null&&!zc(t)?Z9(t):t,X9=t=>{if(k1(t))try{return zS(JSON.parse(t))}catch{}return t},k1=t=>t.match(/^[[{]/)!=null,Z9=t=>{for(const e in t)t[e]=zS(t[e]);return t},eG=new RegExp(`\\b(${["alter","create","delete","drop","insert","replace","update"].join("|")})\\b`),tG=t=>eG.test(t),nG=t=>e=>{var n;return(n=t.options)!=null&&n.logQueryExecutionTime?FO.pipe(Zw("start",()=>performance.now()),RO("result",()=>e),Zw("elapsed",({start:r})=>performance.now()-r),on(({elapsed:r})=>BS(`QueryExecutionTime: ${r}ms`,t)),Me(({result:r})=>r)):e},rG=t=>t.map(e=>{let n=e.parent,r=0;do{const s=t.find(i=>i.id===n);if(!s)break;n=s.parent,r++}while(!0);return`${"  ".repeat(r)}${e.detail}`}).join(`
`);pi.pipe(VI(/^[\w-]{21}$/),mi("Id"));const x1=pi.pipe(Ds(t=>!isNaN(Date.parse(t))),mi("SqliteDate")),sG=_d.pipe(QI(),Ds(t=>t===0||t===1),mi("SqliteBoolean"));function VS(t){return typeof t=="boolean"?t===!0?1:0:typeof t=="number"?t===1:t instanceof Date?t.toISOString():new Date(t)}yd({createdAt:x1,updatedAt:x1,isDeleted:sG});const q1=pi.pipe(Ds(t=>{if(!k1(t))return!0;try{JSON.parse(t)}catch{return!0}return!1},{message:()=>"a string that is not stringified JSON"}),mi("String"));q1.pipe(zI(1e3),mi("String1000")),q1.pipe(i7(1),zI(1e3),mi("NonEmptyString1000")),_d.pipe(QI(),p7(),mi("PositiveInt"));const KS=xr("Owner"),iG=t=>Wt(function*(e){t==null&&(t=q9());const n=O9(t),r=yield*Me(p1(n,["Evolu","Owner Id"]),i=>{let o="";for(let l=0;l<21;l++)o+=oG[i[l]&63];return o}),s=yield*p1(n,["Evolu","Encryption Key"]);return{mnemonic:t,id:r,encryptionKey:s}}),oG="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",QS=xr("FlushSync");class sg extends Ai("AppState")(){}class ig extends Ai("SyncLock")(){}class aG{constructor(){this._tag="SyncLockAlreadySyncingError"}}const cG={sql:'select "id", "mnemonic", "encryptionKey" from "evolu_owner"'},lG={sql:'create table "evolu_message" ("timestamp" blob primary key, "table" blob, "row" blob, "column" blob, "value" blob)'},uG={sql:'create index "index_evolu_message" on "evolu_message" ("table", "row", "column", "timestamp" desc)'},fG={sql:'create table "evolu_owner" ("id" blob, "mnemonic" blob, "encryptionKey" blob, "timestamp" blob, "merkleTree" blob)'},dG={sql:'insert into "evolu_owner" ("id", "mnemonic", "encryptionKey", "timestamp", "merkleTree") values (?, ?, ?, ?, ?)'},hG={sql:'select "timestamp", "merkleTree" from "evolu_owner"'},pG={sql:'select "timestamp" from "evolu_message" where "table" = ? and "row" = ? and "column" = ? order by "timestamp" desc limit ?'},mG={sql:'insert into "evolu_message" ("timestamp", "table", "row", "column", "value") values (?, ?, ?, ?, ?) on conflict do nothing'},gG={sql:'update "evolu_owner" set "merkleTree" = ?, "timestamp" = ?'},_G={sql:'select * from "evolu_message" where "timestamp" >= ? order by "timestamp"'},yG=Symbol.for("effect/QueueEnqueue"),bG=Symbol.for("effect/QueueDequeue"),O1=Symbol.for("effect/QueueStrategy"),wG=Symbol.for("effect/BackingQueue"),I1={_A:t=>t},SG={_A:t=>t},EG={_In:t=>t},vG={_Out:t=>t};class NG extends Bf{constructor(n,r,s,i,o){super();g(this,"queue");g(this,"takers");g(this,"shutdownHook");g(this,"shutdownFlag");g(this,"strategy");g(this,Hne,EG);g(this,Jne,vG);this.queue=n,this.takers=r,this.shutdownHook=s,this.shutdownFlag=i,this.strategy=o}pipe(){return et(this,arguments)}commit(){return this.take}capacity(){return this.queue.capacity()}get size(){return je(()=>Ao(this.unsafeSize(),()=>ri))}unsafeSize(){return jn(this.shutdownFlag)?ce():de(this.queue.length()-Lw(this.takers)+this.strategy.surplusSize())}get isEmpty(){return qe(this.size,n=>n<=0)}get isFull(){return qe(this.size,n=>n>=this.capacity())}get shutdown(){return Ro(It(n=>(I(this.shutdownFlag,cl(!0)),I(Ki(fu(this.takers),r=>_k(r,n.id()),!1,!1),sn(this.strategy.shutdown),wp(Cp(this.shutdownHook,void 0)),er))))}get isShutdown(){return he(()=>jn(this.shutdownFlag))}get awaitShutdown(){return Ar(this.shutdownHook)}isActive(){return!jn(this.shutdownFlag)}unsafeOffer(n){if(jn(this.shutdownFlag))return!1;let r;if(this.queue.length()===0){const i=I(this.takers,Gi(Er));i!==Er?(dc(i,n),r=!0):r=!1}else r=!1;if(r)return!0;const s=this.queue.offer(n);return du(this.strategy,this.queue,this.takers),s}offer(n){return je(()=>{if(jn(this.shutdownFlag))return ri;let r;if(this.queue.length()===0){const i=I(this.takers,Gi(Er));i!==Er?(dc(i,n),r=!0):r=!1}else r=!1;if(r)return se(!0);const s=this.queue.offer(n);return du(this.strategy,this.queue,this.takers),s?se(!0):this.strategy.handleSurplus([n],this.queue,this.takers,this.shutdownFlag)})}offerAll(n){return je(()=>{if(jn(this.shutdownFlag))return ri;const r=bt(n),s=this.queue.length()===0?bt(LG(this.takers,r.length)):No,[i,o]=I(r,yv(s.length));for(let f=0;f<s.length;f++){const m=s[f],S=i[f];dc(m,S)}if(o.length===0)return se(!0);const l=this.queue.offerAll(o);return du(this.strategy,this.queue,this.takers),my(l)?se(!0):this.strategy.handleSurplus(l,this.queue,this.takers,this.shutdownFlag)})}get take(){return It(n=>{if(jn(this.shutdownFlag))return ri;const r=this.queue.poll(Er);if(r!==Er)return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),se(r);{const s=Df(n.id());return I(je(()=>(I(this.takers,Ql(s)),du(this.strategy,this.queue,this.takers),jn(this.shutdownFlag)?ri:Ar(s))),Mi(()=>he(()=>MG(this.takers,s))))}})}get takeAll(){return je(()=>jn(this.shutdownFlag)?ri:he(()=>{const n=this.queue.pollUpTo(Number.POSITIVE_INFINITY);return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),Ia(n)}))}takeUpTo(n){return je(()=>jn(this.shutdownFlag)?ri:he(()=>{const r=this.queue.pollUpTo(n);return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),Ia(r)}))}takeBetween(n,r){return je(()=>T1(this,n,r,Jr()))}}Hne=yG,Jne=bG;const T1=(t,e,n,r)=>n<e?se(r):I(CG(t,n),U(s=>{const i=e-s.length;return i===1?I(HS(t),qe(o=>I(r,Mr(s),jh(o)))):i>1?I(HS(t),U(o=>T1(t,i-1,n-s.length-1,I(r,Mr(s),jh(o))))):se(I(r,Mr(s)))})),kG=t=>I(he(()=>G8(t)),U(e=>A1(C1(e),FG()))),xG=()=>I(he(()=>Em()),U(t=>A1(C1(t),RG()))),qG=(t,e,n,r,s)=>new NG(t,e,n,r,s),A1=(t,e)=>I(oi(),qe(n=>qG(t,Em(),n,al(!1),e)));class OG{constructor(e){g(this,"mutable");g(this,Gne,SG);this.mutable=e}poll(e){return Gi(this.mutable,e)}pollUpTo(e){return Dw(this.mutable,e)}offerAll(e){return cO(this.mutable,e)}offer(e){return Ql(this.mutable,e)}capacity(){return Y8(this.mutable)}length(){return Lw(this.mutable)}}Gne=wG;const C1=t=>new OG(t),IG=t=>t.size,TG=t=>t.shutdown,AG=w(2,(t,e)=>t.offer(e)),HS=t=>t.take,CG=w(2,(t,e)=>t.takeUpTo(e)),FG=()=>new PG,RG=()=>new $G;class PG{constructor(){g(this,Yne,I1);g(this,"putters",Em())}surplusSize(){return Lw(this.putters)}onCompleteTakersWithEmptyQueue(e){for(;!Mw(this.putters)&&!Mw(e);){const n=Gi(e,void 0),r=Gi(this.putters,void 0);r[2]&&dc(r[1],!0),dc(n,r[0])}}get shutdown(){return I(Sl,U(e=>I(he(()=>fu(this.putters)),U(n=>Ki(n,([r,s,i])=>i?I(_k(s,e),er):ft,!1,!1)))))}handleSurplus(e,n,r,s){return It(i=>{const o=Df(i.id());return I(je(()=>(this.unsafeOffer(e,o),this.unsafeOnQueueEmptySpace(n,r),du(this,n,r),jn(s)?ri:Ar(o))),Mi(()=>he(()=>this.unsafeRemove(o))))})}unsafeOnQueueEmptySpace(e,n){let r=!0;for(;r&&(e.capacity()===Number.POSITIVE_INFINITY||e.length()<e.capacity());){const s=I(this.putters,Gi(Er));if(s===Er)r=!1;else{const i=e.offer(s[0]);i&&s[2]?dc(s[1],!0):i||og(this.putters,I(fu(this.putters),lr(s))),du(this,e,n)}}}unsafeOffer(e,n){const r=bt(e);for(let s=0;s<r.length;s++){const i=r[s];s===r.length-1?I(this.putters,Ql([i,n,!0])):I(this.putters,Ql([i,n,!1]))}}unsafeRemove(e){og(this.putters,I(fu(this.putters),qv(([,n])=>n!==e)))}}Yne=O1;class $G{constructor(){g(this,Xne,I1)}surplusSize(){return 0}get shutdown(){return ft}onCompleteTakersWithEmptyQueue(){}handleSurplus(e,n,r,s){return se(!1)}unsafeOnQueueEmptySpace(e,n){}}Xne=O1;const dc=(t,e)=>Fp(t,se(e)),og=(t,e)=>I(t,cO(e)),fu=t=>I(t,Dw(Number.POSITIVE_INFINITY)),LG=(t,e)=>I(t,Dw(e)),MG=(t,e)=>{og(t,I(fu(t),qv(n=>e!==n)))},du=(t,e,n)=>{let r=!0;for(;r&&e.length()!==0;){const s=I(n,Gi(Er));if(s!==Er){const i=e.poll(Er);i!==Er?(dc(s,i),t.unsafeOnQueueEmptySpace(e,n)):og(n,I(fu(n),lr(s))),r=!0}else r=!1}r&&e.length()===0&&!Mw(n)&&t.onCompleteTakersWithEmptyQueue(n)},DG=kG,WG=xG,BG=IG,F1=TG,hu=AG,R1=HS,JS=Mn,P1=_s,UG=sb,$1="Continue",jG="Close",zG="Yield",L1=Symbol.for("effect/ChannelChildExecutorDecision"),VG={[L1]:L1},M1=t=>{const e=Object.create(VG);return e._tag=$1,e},ag="ContinuationK",KG="ContinuationFinalizer",D1=Symbol.for("effect/ChannelContinuation"),W1={_Env:t=>t,_InErr:t=>t,_InElem:t=>t,_InDone:t=>t,_OutErr:t=>t,_OutDone:t=>t,_OutErr2:t=>t,_OutElem:t=>t,_OutDone2:t=>t};class B1{constructor(e,n){g(this,"onSuccess");g(this,"onHalt");g(this,"_tag",ag);g(this,Zne,W1);this.onSuccess=e,this.onHalt=n}onExit(e){return r3(e)?this.onHalt(e.cause):this.onSuccess(e.value)}}Zne=D1;class QG{constructor(e){g(this,"finalizer");g(this,"_tag",KG);g(this,ere,W1);this.finalizer=e}}ere=D1;const U1="PullAfterNext",HG="PullAfterAllEnqueued",JG=Symbol.for("effect/ChannelUpstreamPullStrategy"),GG={_A:t=>t},YG={[JG]:GG},j1=t=>{const e=Object.create(YG);return e._tag=U1,e.emitSeparator=t,e},z1="BracketOut",V1="Bridge",GS="ConcatAll",K1="Emit",Q1="Ensuring",H1="Fail",J1="Fold",G1="FromEffect",Y1="PipeTo",XG="Provide",X1="Read",Z1="Succeed",eT="SucceedNow",tT="Suspend",nT=Symbol.for("effect/Channel"),ZG={_Env:t=>t,_InErr:t=>t,_InElem:t=>t,_InDone:t=>t,_OutErr:t=>t,_OutElem:t=>t,_OutDone:t=>t},jr={[nT]:ZG,pipe(){return et(this,arguments)}},rT=t=>it(t,nT)||Gl(t),eY=w(2,(t,e)=>{const n=Object.create(jr);return n._tag=z1,n.acquire=()=>t,n.finalizer=e,n}),tY=(t,e,n)=>{const r=Object.create(jr);return r._tag=GS,r.combineInners=e,r.combineAll=n,r.onPull=()=>j1(ce()),r.onEmit=()=>M1,r.value=()=>t,r.k=Ke,r},nY=w(4,(t,e,n,r)=>{const s=Object.create(jr);return s._tag=GS,s.combineInners=n,s.combineAll=r,s.onPull=()=>j1(ce()),s.onEmit=()=>M1,s.value=()=>t,s.k=e,s}),sT=w(2,(t,e)=>{const n=Object.create(jr);return n._tag=V1,n.input=e,n.channel=t,n}),rY=w(2,(t,e)=>{const n=Object.create(jr);return n._tag=Q1,n.channel=t,n.finalizer=e,n}),iT=t=>hc(rq(t)),hc=t=>sY(()=>t),sY=t=>{const e=Object.create(jr);return e._tag=H1,e.error=t,e},zr=w(2,(t,e)=>{const n=Object.create(jr);return n._tag=J1,n.channel=t,n.k=new B1(e,hc),n}),Bs=t=>{const e=Object.create(jr);return e._tag=G1,e.effect=()=>t,e},Sd=w(2,(t,e)=>{const n=Object.create(jr);return n._tag=Y1,n.left=()=>t,n.right=()=>e,n}),iY=t=>oY({onInput:t.onInput,onFailure:e=>ps(sq(e),{onLeft:t.onFailure,onRight:hc}),onDone:t.onDone}),oY=t=>{const e=Object.create(jr);return e._tag=X1,e.more=t.onInput,e.done=new B1(t.onDone,t.onFailure),e},aY=t=>oT(()=>t),YS=t=>{const e=Object.create(jr);return e._tag=eT,e.terminal=t,e},cY=t=>{const e=Object.create(jr);return e._tag=tT,e.channel=t,e},oT=t=>{const e=Object.create(jr);return e._tag=Z1,e.evaluate=t,e},Ed=YS(void 0),Us=t=>{const e=Object.create(jr);return e._tag=K1,e.out=t,e},cg="Done",lg="Emit",vd="FromEffect",ug="Read",lY=Symbol.for("effect/ChannelState"),uY={_E:t=>t,_R:t=>t},fg={[lY]:uY},pu=()=>{const t=Object.create(fg);return t._tag=cg,t},XS=()=>{const t=Object.create(fg);return t._tag=lg,t},Nd=t=>{const e=Object.create(fg);return e._tag=vd,e.effect=t,e},ZS=(t,e,n,r)=>{const s=Object.create(fg);return s._tag=ug,s.upstream=t,s.onEffect=e,s.onEmit=n,s.onDone=r,s},dg=t=>t._tag===vd,fY=t=>dg(t)?t.effect:Dt,aT=t=>dg(t)?NO(t.effect):void 0,cT="PullFromChild",e0="PullFromUpstream",t0="DrainChildExecutors",lT="Emit";class hg{constructor(e,n,r){g(this,"childExecutor");g(this,"parentSubexecutor");g(this,"onEmit");g(this,"_tag",cT);this.childExecutor=e,this.parentSubexecutor=n,this.onEmit=r}close(e){const n=this.childExecutor.close(e),r=this.parentSubexecutor.close(e);return n!==void 0&&r!==void 0?tu(Xr(n),Xr(r),(s,i)=>I(s,Vf(i))):n!==void 0?n:r!==void 0?r:void 0}enqueuePullFromChild(e){return this}}class pc{constructor(e,n,r,s,i,o,l,f){g(this,"upstreamExecutor");g(this,"createChild");g(this,"lastDone");g(this,"activeChildExecutors");g(this,"combineChildResults");g(this,"combineWithChildResult");g(this,"onPull");g(this,"onEmit");g(this,"_tag",e0);this.upstreamExecutor=e,this.createChild=n,this.lastDone=r,this.activeChildExecutors=s,this.combineChildResults=i,this.combineWithChildResult=o,this.onPull=l,this.onEmit=f}close(e){const n=this.upstreamExecutor.close(e),s=[...this.activeChildExecutors.map(i=>i!==void 0?i.childExecutor.close(e):void 0),n].reduce((i,o)=>i!==void 0&&o!==void 0?tu(i,Xr(o),(l,f)=>Vf(l,f)):i!==void 0?i:o!==void 0?Xr(o):void 0,void 0);return s}enqueuePullFromChild(e){return new pc(this.upstreamExecutor,this.createChild,this.lastDone,[...this.activeChildExecutors,e],this.combineChildResults,this.combineWithChildResult,this.onPull,this.onEmit)}}class mu{constructor(e,n,r,s,i,o,l){g(this,"upstreamExecutor");g(this,"lastDone");g(this,"activeChildExecutors");g(this,"upstreamDone");g(this,"combineChildResults");g(this,"combineWithChildResult");g(this,"onPull");g(this,"_tag",t0);this.upstreamExecutor=e,this.lastDone=n,this.activeChildExecutors=r,this.upstreamDone=s,this.combineChildResults=i,this.combineWithChildResult=o,this.onPull=l}close(e){const n=this.upstreamExecutor.close(e),s=[...this.activeChildExecutors.map(i=>i!==void 0?i.childExecutor.close(e):void 0),n].reduce((i,o)=>i!==void 0&&o!==void 0?tu(i,Xr(o),(l,f)=>Vf(l,f)):i!==void 0?i:o!==void 0?Xr(o):void 0,void 0);return s}enqueuePullFromChild(e){return new mu(this.upstreamExecutor,this.lastDone,[...this.activeChildExecutors,e],this.upstreamDone,this.combineChildResults,this.combineWithChildResult,this.onPull)}}class n0{constructor(e,n){g(this,"value");g(this,"next");g(this,"_tag",lT);this.value=e,this.next=n}close(e){const n=this.next.close(e);return n}enqueuePullFromChild(e){return this}}const dY="Pulled",hY="NoUpstream",pY=Symbol.for("effect/ChannelUpstreamPullRequest"),mY={_A:t=>t},uT={[pY]:mY},fT=t=>{const e=Object.create(uT);return e._tag=dY,e.value=t,e},gY=t=>{const e=Object.create(uT);return e._tag=hY,e.activeDownstreamCount=t,e};class gu{constructor(e,n,r){g(this,"_activeSubexecutor");g(this,"_cancelled");g(this,"_closeLastSubstream");g(this,"_currentChannel");g(this,"_done");g(this,"_doneStack",[]);g(this,"_emitted");g(this,"_executeCloseLastSubstream");g(this,"_input");g(this,"_inProgressFinalizer");g(this,"_providedEnv");this._currentChannel=e,this._executeCloseLastSubstream=r,this._providedEnv=n}run(){let e;for(;e===void 0;)if(this._cancelled!==void 0)e=this.processCancellation();else if(this._activeSubexecutor!==void 0)e=this.runSubexecutor();else try{if(this._currentChannel===void 0)e=pu();else if(Gl(this._currentChannel))this._currentChannel=Bs(this._currentChannel);else switch(this._currentChannel._tag){case z1:{e=this.runBracketOut(this._currentChannel);break}case V1:{const n=this._currentChannel.input;if(this._currentChannel=this._currentChannel.channel,this._input!==void 0){const r=this._input;this._input=void 0;const s=()=>Te(n.awaitRead(),()=>Hn(()=>{const i=r.run();switch(i._tag){case cg:return ji(r.getDone(),{onFailure:o=>n.error(o),onSuccess:o=>n.done(o)});case lg:return Te(n.emit(r.getEmit()),()=>s());case vd:return li(i.effect,{onFailure:o=>n.error(o),onSuccess:()=>s()});case ug:return dT(i,()=>s(),o=>n.error(o))}}));e=Nd(Te(Fm(s()),i=>Rt(()=>this.addFinalizer(o=>Te(Vl(i),()=>Hn(()=>{const l=this.restorePipe(o,r);return l!==void 0?l:Dt}))))))}break}case GS:{const n=new gu(this._currentChannel.value(),this._providedEnv,s=>Rt(()=>{const i=this._closeLastSubstream===void 0?Dt:this._closeLastSubstream;this._closeLastSubstream=I(i,an(s))}));n._input=this._input;const r=this._currentChannel;this._activeSubexecutor=new pc(n,s=>r.k(s),void 0,[],(s,i)=>r.combineInners(s,i),(s,i)=>r.combineAll(s,i),s=>r.onPull(s),s=>r.onEmit(s)),this._closeLastSubstream=void 0,this._currentChannel=void 0;break}case K1:{this._emitted=this._currentChannel.out,this._currentChannel=this._activeSubexecutor!==void 0?void 0:Ed,e=XS();break}case Q1:{this.runEnsuring(this._currentChannel);break}case H1:{e=this.doneHalt(this._currentChannel.error());break}case J1:{this._doneStack.push(this._currentChannel.k),this._currentChannel=this._currentChannel.channel;break}case G1:{const n=this._providedEnv===void 0?this._currentChannel.effect():I(this._currentChannel.effect(),ci(this._providedEnv));e=Nd(li(n,{onFailure:r=>{const s=this.doneHalt(r);return s!==void 0&&dg(s)?s.effect:Dt},onSuccess:r=>{const s=this.doneSucceed(r);return s!==void 0&&dg(s)?s.effect:Dt}}));break}case Y1:{const n=this._input,r=new gu(this._currentChannel.left(),this._providedEnv,s=>this._executeCloseLastSubstream(s));r._input=n,this._input=r,this.addFinalizer(s=>{const i=this.restorePipe(s,n);return i!==void 0?i:Dt}),this._currentChannel=this._currentChannel.right();break}case XG:{const n=this._providedEnv;this._providedEnv=this._currentChannel.context(),this._currentChannel=this._currentChannel.inner,this.addFinalizer(()=>Rt(()=>{this._providedEnv=n}));break}case X1:{const n=this._currentChannel;e=ZS(this._input,Ke,r=>{try{this._currentChannel=n.more(r)}catch(s){this._currentChannel=n.done.onExit(u4(s))}},r=>{const s=i=>n.done.onExit(i);this._currentChannel=s(r)});break}case Z1:{e=this.doneSucceed(this._currentChannel.evaluate());break}case eT:{e=this.doneSucceed(this._currentChannel.terminal);break}case tT:{this._currentChannel=this._currentChannel.channel();break}default:this._currentChannel._tag}}catch(n){this._currentChannel=hc(WU(n))}return e}getDone(){return this._done}getEmit(){return this._emitted}cancelWith(e){this._cancelled=e}clearInProgressFinalizer(){this._inProgressFinalizer=void 0}storeInProgressFinalizer(e){this._inProgressFinalizer=e}popAllFinalizers(e){const n=[];let r=this._doneStack.pop();for(;r;)r._tag==="ContinuationFinalizer"&&n.push(r.finalizer),r=this._doneStack.pop();const s=n.length===0?Dt:s0(n,e);return this.storeInProgressFinalizer(s),s}popNextFinalizers(){const e=[];for(;this._doneStack.length!==0;){const n=this._doneStack[this._doneStack.length-1];if(n._tag===ag)return e;e.push(n),this._doneStack.pop()}return e}restorePipe(e,n){const r=this._input;return this._input=n,r!==void 0?r.close(e):Dt}close(e){let n;const r=this._inProgressFinalizer;r!==void 0&&(n=I(r,ld(Rt(()=>this.clearInProgressFinalizer()))));let s;const i=this.popAllFinalizers(e);i!==void 0&&(s=I(i,ld(Rt(()=>this.clearInProgressFinalizer()))));const o=this._activeSubexecutor===void 0?void 0:this._activeSubexecutor.close(e);if(!(o===void 0&&n===void 0&&s===void 0))return I(Xr(r0(o)),iS(Xr(r0(n))),iS(Xr(r0(s))),Me(([[l,f],m])=>I(l,Vf(f),Vf(m))),cd,Te(l=>Hn(()=>l)))}doneSucceed(e){if(this._doneStack.length===0)return this._done=Rs(e),this._currentChannel=void 0,pu();const n=this._doneStack[this._doneStack.length-1];if(n._tag===ag){this._doneStack.pop(),this._currentChannel=n.onSuccess(e);return}const r=this.popNextFinalizers();if(this._doneStack.length===0)return this._doneStack=r.reverse(),this._done=Rs(e),this._currentChannel=void 0,pu();const s=s0(r.map(o=>o.finalizer),Rs(e));this.storeInProgressFinalizer(s);const i=I(s,ld(Rt(()=>this.clearInProgressFinalizer())),cd,Te(()=>Rt(()=>this.doneSucceed(e))));return Nd(i)}doneHalt(e){if(this._doneStack.length===0)return this._done=Fs(e),this._currentChannel=void 0,pu();const n=this._doneStack[this._doneStack.length-1];if(n._tag===ag){this._doneStack.pop(),this._currentChannel=n.onHalt(e);return}const r=this.popNextFinalizers();if(this._doneStack.length===0)return this._doneStack=r.reverse(),this._done=Fs(e),this._currentChannel=void 0,pu();const s=s0(r.map(o=>o.finalizer),Fs(e));this.storeInProgressFinalizer(s);const i=I(s,ld(Rt(()=>this.clearInProgressFinalizer())),cd,Te(()=>Rt(()=>this.doneHalt(e))));return Nd(i)}processCancellation(){return this._currentChannel=void 0,this._done=this._cancelled,this._cancelled=void 0,pu()}runBracketOut(e){const n=cd(li(this.provide(e.acquire()),{onFailure:r=>Rt(()=>{this._currentChannel=hc(r)}),onSuccess:r=>Rt(()=>{this.addFinalizer(s=>this.provide(e.finalizer(r,s))),this._currentChannel=Us(r)})}));return Nd(n)}provide(e){return this._providedEnv===void 0?e:I(e,ci(this._providedEnv))}runEnsuring(e){this.addFinalizer(e.finalizer),this._currentChannel=e.channel}addFinalizer(e){this._doneStack.push(new QG(e))}runSubexecutor(){const e=this._activeSubexecutor;switch(e._tag){case cT:return this.pullFromChild(e.childExecutor,e.parentSubexecutor,e.onEmit,e);case e0:return this.pullFromUpstream(e);case t0:return this.drainChildExecutors(e);case lT:return this._emitted=e.value,this._activeSubexecutor=e.next,XS()}}replaceSubexecutor(e){this._currentChannel=void 0,this._activeSubexecutor=e}finishWithExit(e){const n=ji(e,{onFailure:r=>this.doneHalt(r),onSuccess:r=>this.doneSucceed(r)});return this._activeSubexecutor=void 0,n===void 0?Dt:fY(n)}finishSubexecutorWithCloseEffect(e,...n){this.addFinalizer(()=>I(n,Wr(s=>I(Rt(()=>s(e)),Te(i=>i!==void 0?i:Dt)),{discard:!0})));const r=I(e,ji({onFailure:s=>this.doneHalt(s),onSuccess:s=>this.doneSucceed(s)}));return this._activeSubexecutor=void 0,r}applyUpstreamPullStrategy(e,n,r){switch(r._tag){case U1:{const s=!e||n.some(i=>i!==void 0);return[r.emitSeparator,s?[void 0,...n]:n]}case HG:{const s=!e||n.some(i=>i!==void 0);return[r.emitSeparator,s?[...n,void 0]:n]}}}pullFromChild(e,n,r,s){return ZS(e,Ke,i=>{const o=r(i);switch(o._tag){case $1:break;case jG:{this.finishWithDoneValue(e,n,o.value);break}case zG:{const l=n.enqueuePullFromChild(s);this.replaceSubexecutor(l);break}}this._activeSubexecutor=new n0(i,this._activeSubexecutor)},ji({onFailure:i=>{const o=this.handleSubexecutorFailure(e,n,i);return o===void 0?void 0:aT(o)},onSuccess:i=>{this.finishWithDoneValue(e,n,i)}}))}finishWithDoneValue(e,n,r){const s=n;switch(s._tag){case e0:{const i=new pc(s.upstreamExecutor,s.createChild,s.lastDone!==void 0?s.combineChildResults(s.lastDone,r):r,s.activeChildExecutors,s.combineChildResults,s.combineWithChildResult,s.onPull,s.onEmit);this._closeLastSubstream=e.close(Rs(r)),this.replaceSubexecutor(i);break}case t0:{const i=new mu(s.upstreamExecutor,s.lastDone!==void 0?s.combineChildResults(s.lastDone,r):r,s.activeChildExecutors,s.upstreamDone,s.combineChildResults,s.combineWithChildResult,s.onPull);this._closeLastSubstream=e.close(Rs(r)),this.replaceSubexecutor(i);break}}}handleSubexecutorFailure(e,n,r){return this.finishSubexecutorWithCloseEffect(Fs(r),s=>n.close(s),s=>e.close(s))}pullFromUpstream(e){if(e.activeChildExecutors.length===0)return this.performPullFromUpstream(e);const n=e.activeChildExecutors[0],r=new pc(e.upstreamExecutor,e.createChild,e.lastDone,e.activeChildExecutors.slice(1),e.combineChildResults,e.combineWithChildResult,e.onPull,e.onEmit);if(n===void 0)return this.performPullFromUpstream(r);this.replaceSubexecutor(new hg(n.childExecutor,r,n.onEmit))}performPullFromUpstream(e){return ZS(e.upstreamExecutor,n=>{const r=this._closeLastSubstream===void 0?Dt:this._closeLastSubstream;return this._closeLastSubstream=void 0,I(this._executeCloseLastSubstream(r),an(n))},n=>{if(this._closeLastSubstream!==void 0){const o=this._closeLastSubstream;return this._closeLastSubstream=void 0,I(this._executeCloseLastSubstream(o),Me(()=>{const l=new gu(e.createChild(n),this._providedEnv,this._executeCloseLastSubstream);l._input=this._input;const[f,m]=this.applyUpstreamPullStrategy(!1,e.activeChildExecutors,e.onPull(fT(n)));this._activeSubexecutor=new hg(l,new pc(e.upstreamExecutor,e.createChild,e.lastDone,m,e.combineChildResults,e.combineWithChildResult,e.onPull,e.onEmit),e.onEmit),pt(f)&&(this._activeSubexecutor=new n0(f.value,this._activeSubexecutor))}))}const r=new gu(e.createChild(n),this._providedEnv,this._executeCloseLastSubstream);r._input=this._input;const[s,i]=this.applyUpstreamPullStrategy(!1,e.activeChildExecutors,e.onPull(fT(n)));this._activeSubexecutor=new hg(r,new pc(e.upstreamExecutor,e.createChild,e.lastDone,i,e.combineChildResults,e.combineWithChildResult,e.onPull,e.onEmit),e.onEmit),pt(s)&&(this._activeSubexecutor=new n0(s.value,this._activeSubexecutor))},n=>{if(e.activeChildExecutors.some(i=>i!==void 0)){const i=new mu(e.upstreamExecutor,e.lastDone,[void 0,...e.activeChildExecutors],e.upstreamExecutor.getDone(),e.combineChildResults,e.combineWithChildResult,e.onPull);if(this._closeLastSubstream!==void 0){const o=this._closeLastSubstream;return this._closeLastSubstream=void 0,I(this._executeCloseLastSubstream(o),Me(()=>this.replaceSubexecutor(i)))}this.replaceSubexecutor(i);return}const r=this._closeLastSubstream,s=this.finishSubexecutorWithCloseEffect(I(n,h4(i=>e.combineWithChildResult(e.lastDone,i))),()=>r,i=>e.upstreamExecutor.close(i));return s===void 0?void 0:aT(s)})}drainChildExecutors(e){if(e.activeChildExecutors.length===0){const i=this._closeLastSubstream;return i!==void 0&&this.addFinalizer(()=>Tt(i)),this.finishSubexecutorWithCloseEffect(e.upstreamDone,()=>i,o=>e.upstreamExecutor.close(o))}const n=e.activeChildExecutors[0],r=e.activeChildExecutors.slice(1);if(n===void 0){const[i,o]=this.applyUpstreamPullStrategy(!0,r,e.onPull(gY(r.reduce((l,f)=>f!==void 0?l+1:l,0))));return this.replaceSubexecutor(new mu(e.upstreamExecutor,e.lastDone,o,e.upstreamDone,e.combineChildResults,e.combineWithChildResult,e.onPull)),pt(i)?(this._emitted=i.value,XS()):void 0}const s=new mu(e.upstreamExecutor,e.lastDone,r,e.upstreamDone,e.combineChildResults,e.combineWithChildResult,e.onPull);this.replaceSubexecutor(new hg(n.childExecutor,s,n.onEmit))}}const r0=t=>t!==void 0?t:Dt,s0=(t,e)=>I(Wr(t,n=>Xr(n(e))),Me(n=>I(l4(n),nn(()=>Wb))),Te(n=>Hn(()=>n))),dT=(t,e,n)=>{const r=[t],s=()=>{const i=r.pop();if(i===void 0||i.upstream===void 0)return SO("Unexpected end of input for channel execution");const o=i.upstream.run();switch(o._tag){case lg:{const l=i.onEmit(i.upstream.getEmit());return r.length===0?l===void 0?Hn(e):I(l,li({onFailure:n,onSuccess:e})):l===void 0?Hn(()=>s()):I(l,li({onFailure:n,onSuccess:()=>s()}))}case cg:{const l=i.onDone(i.upstream.getDone());return r.length===0?l===void 0?Hn(e):I(l,li({onFailure:n,onSuccess:e})):l===void 0?Hn(()=>s()):I(l,li({onFailure:n,onSuccess:()=>s()}))}case vd:return r.push(i),I(i.onEffect(o.effect),Qw(l=>Hn(()=>{const f=i.onDone(Fs(l));return f===void 0?Dt:f})),li({onFailure:n,onSuccess:()=>s()}));case ug:return r.push(i),r.push(o),Hn(()=>s())}};return s()},_Y="Done",yY="Await",bY={[Symbol.for("effect/ChannelMergeDecision")]:{_R:t=>t,_E0:t=>t,_Z0:t=>t,_E:t=>t,_Z:t=>t}},hT=t=>{const e=Object.create(bY);return e._tag=yY,e.f=t,e},pT="BothRunning",mT="LeftDone",gT="RightDone",_T=Symbol.for("effect/ChannelMergeState"),i0={[_T]:_T},o0=(t,e)=>{const n=Object.create(i0);return n._tag=pT,n.left=t,n.right=e,n},yT=t=>{const e=Object.create(i0);return e._tag=mT,e.f=t,e},bT=t=>{const e=Object.create(i0);return e._tag=gT,e.f=t,e},wT="BackPressure",ST="BufferSliding",ET=Symbol.for("effect/ChannelMergeStrategy"),vT={[ET]:ET},wY=t=>{const e=Object.create(vT);return e._tag=wT,e},SY=t=>{const e=Object.create(vT);return e._tag=ST,e},EY=w(2,(t,{onBackPressure:e,onBufferSliding:n})=>{switch(t._tag){case wT:return e();case ST:return n()}}),_u="Empty",kd="Emit",xd="Error",qd="Done",NT=t=>({_tag:_u,notifyProducer:t}),a0=t=>({_tag:kd,notifyConsumers:t}),vY=t=>({_tag:xd,cause:t}),NY=t=>({_tag:qd,done:t});class kY{constructor(e){g(this,"ref");this.ref=e}awaitRead(){return ac(Ml(this.ref,e=>e._tag===_u?[Qn(e.notifyProducer),e]:[Dt,e]))}get close(){return IO(e=>this.error(BU(e)))}done(e){return ac(Ml(this.ref,n=>{switch(n._tag){case _u:return[Qn(n.notifyProducer),n];case kd:return[Wr(n.notifyConsumers,r=>Wo(r,ut(e)),{discard:!0}),NY(e)];case xd:return[oc,n];case qd:return[oc,n]}}))}emit(e){return Te(Bi(),n=>ac(Ml(this.ref,r=>{switch(r._tag){case _u:return[Qn(r.notifyProducer),r];case kd:{const s=r.notifyConsumers[0],i=r.notifyConsumers.slice(1);if(s!==void 0)return[Wo(s,Mt(e)),i.length===0?NT(n):a0(i)];throw new Error("Bug: Channel.SingleProducerAsyncInput.emit - Queue was empty! please report an issue at https://github.com/Effect-TS/effect/issues")}case xd:return[oc,r];case qd:return[oc,r]}})))}error(e){return ac(Ml(this.ref,n=>{switch(n._tag){case _u:return[Qn(n.notifyProducer),n];case kd:return[Wr(n.notifyConsumers,r=>sD(r,e),{discard:!0}),vY(e)];case xd:return[oc,n];case qd:return[oc,n]}}))}get take(){return this.takeWith(e=>Fs(jU(e,ut)),e=>Rs(e),e=>f4(Mt(e)))}takeWith(e,n,r){return Te(Bi(),s=>ac(Ml(this.ref,i=>{switch(i._tag){case _u:return[an(Wo(i.notifyProducer,void 0),Lm(Qn(s),{onFailure:e,onSuccess:ps({onLeft:r,onRight:n})})),a0([s])];case kd:return[Lm(Qn(s),{onFailure:e,onSuccess:ps({onLeft:r,onRight:n})}),a0([...i.notifyConsumers,s])];case xd:return[Tt(e(i.cause)),i];case qd:return[Tt(r(i.done)),i]}})))}}const kT=()=>I(Bi(),Te(t=>Ll(NT(t))),Me(t=>new kY(t))),c0=w(2,(t,e)=>nY(t,e,()=>{},()=>{})),xY=w(2,(t,e)=>rY(t,()=>e)),qY=t=>zr(t,Ke),l0=t=>ta(t.takeWith(hc,e=>zr(Us(e),()=>l0(t)),aY)),xT=w(2,(t,e)=>zr(t,n=>oT(()=>e(n)))),OY=w(2,(t,e)=>{const n=iY({onInput:r=>zr(Us(e(r)),()=>n),onFailure:iT,onDone:YS});return Sd(t,n)}),IY=t=>e=>TY(t)(e,bo),TY=({bufferSize:t=16,concurrency:e,mergeStrategy:n=wY()})=>(r,s)=>I(Wt(function*(i){const o=e==="unbounded"?Number.MAX_SAFE_INTEGER:e,l=yield*i(kT()),f=l0(l),m=yield*i(eu(DG(t),J=>F1(J))),S=yield*i(eu(WG(),J=>F1(J))),N=yield*i(Ll(ce())),O=yield*i(Bi()),M=(yield*i(WO(o))).withPermits,z=yield*i(yu(r)),Z=J=>I(Te(J,ps({onLeft:ee=>Tt(de(ee)),onRight:ee=>Am(hu(m,Tt(Mt(ee))),ce())})),$m({until:ee=>pt(ee)}),Te(ee=>vx(N,Nn({onNone:()=>de(ee.value),onSome:ve=>de(s(ve,ee.value))}))),Qw(ee=>UU(ee)?Yl(ee):I(hu(m,Yl(ee)),an(Wo(O,void 0)),Jw)));return yield*i(li(z,{onFailure:J=>I(hu(m,Yl(J)),an(Tt(!1))),onSuccess:ps({onLeft:J=>eS(Qo(Qn(O)),Qo(M(o)(Dt)),{onSelfDone:(ee,ve)=>Am(Vl(ve),!1),onOtherDone:(ee,ve)=>an(Vl(ve),I(zp(N),Te(Nn({onNone:()=>hu(m,Tt(ut(J))),onSome:ye=>hu(m,Tt(ut(s(ye,J))))})),Am(!1)))}),onRight:J=>EY(n,{onBackPressure:()=>Wt(function*(ee){const ve=yield*ee(Bi()),ye=I(f,Sd(J),yu,Te(Je=>Pm(Z(Je),Qo(Qn(O)))),ud);return yield*ee(Wo(ve,void 0),an(ye),M(1),Rm),yield*ee(Qn(ve)),!(yield*ee(Wk(O)))}),onBufferSliding:()=>Wt(function*(ee){const ve=yield*ee(Bi()),ye=yield*ee(Bi()),Fe=yield*ee(BG(S));yield*ee(R1(S),Te(We=>Wo(We,void 0)),$O(()=>Fe>=o)),yield*ee(hu(S,ve));const Je=I(f,Sd(J),yu,Te(We=>I(Z(We),Pm(Qo(Qn(O))),Pm(Qo(Qn(ve))))),ud);return yield*ee(Wo(ye,void 0),an(Je),M(1),Rm),yield*ee(Qn(ye)),!(yield*ee(Wk(O)))})})})}),$m({while:J=>J}),Rm),[m,l]}),Me(([i,o])=>{const l=I(R1(i),ac,Lm({onFailure:hc,onSuccess:ps({onLeft:YS,onRight:f=>zr(Us(f),()=>l)})}),ta);return sT(l,o)}),IT),qT=w(3,(t,e,n)=>IY(n)(OY(t,e))),AY=w(2,(t,e)=>IT(Te(kT(),n=>{const r=l0(n);return Me(Om([yu(Sd(r,t)),yu(Sd(r,e.other)),OO]),([s,i,o])=>{const l=(m,S,N)=>(O,M,z)=>{const Z=J=>{const ee=J;return ee._tag===_Y?Tt(Bs(an(Vl(S),ee.effect))):Me(d8(S),ji({onFailure:ve=>Bs(ee.f(Fs(ve))),onSuccess:ps({onLeft:ve=>Bs(ee.f(Rs(ve))),onRight:ve=>CT(Us(ve),f(z(ee.f)))})}))};return ji(m,{onFailure:J=>Z(O(Fs(J))),onSuccess:ps({onLeft:J=>Z(O(Rs(J))),onRight:J=>Tt(zr(Us(J),()=>zr(Bs(Fm(N)),ee=>f(M(ee,S)))))})})},f=m=>{switch(m._tag){case pT:{const S=Qo(Dq(m.left)),N=Qo(Dq(m.right));return ta(eS(S,N,{onSelfDone:(O,M)=>an(Vl(M),l(O,m.right,s)(e.onSelfDone,o0,z=>yT(z))),onOtherDone:(O,M)=>an(Vl(M),l(O,m.left,i)(e.onOtherDone,(z,Z)=>o0(Z,z),z=>bT(z)))}))}case mT:return ta(Me(Xr(i),ji({onFailure:S=>Bs(m.f(Fs(S))),onSuccess:ps({onLeft:S=>Bs(m.f(Rs(S))),onRight:S=>zr(Us(S),()=>f(yT(m.f)))})})));case gT:return ta(Me(Xr(s),ji({onFailure:S=>Bs(m.f(Fs(S))),onSuccess:ps({onLeft:S=>Bs(m.f(Rs(S))),onRight:S=>zr(Us(S),()=>f(bT(m.f)))})})))}};return I(Bs(tu(Yw(s,o),Yw(i,o),(m,S)=>o0(m,S))),zr(f),sT(n))})}))),OT=t=>ta(xO(e=>Me(hq(),n=>eY(nS(e(gw(t,n)),r=>zl(n,Fs(r))),(r,s)=>zl(n,s))))),yu=t=>Me(eu(Rt(()=>new gu(t,void 0,Ke)),(e,n)=>{const r=e.close(n);return r===void 0?Dt:r}),e=>Hn(()=>u0(e.run(),e))),u0=(t,e)=>{const n=t;switch(n._tag){case cg:return ji(e.getDone(),{onFailure:Yl,onSuccess:r=>Tt(ut(r))});case lg:return Tt(Mt(e.getEmit()));case vd:return I(n.effect,Te(()=>u0(e.run(),e)));case ug:return dT(n,()=>u0(e.run(),e),r=>Yl(r))}},ta=t=>qY(Bs(t)),IT=t=>tY(OT(t),(e,n)=>e,(e,n)=>e),TT=t=>AT(0,t.length,t),AT=(t,e,n)=>t===e?Ed:I(Us(I(n,ko(t))),zr(()=>AT(t+1,e,n))),CY=w(t=>rT(t[1]),(t,e,n)=>n!=null&&n.concurrent?AY(t,{other:e,onSelfDone:r=>hT(s=>Hn(()=>s3(r,s))),onOtherDone:r=>hT(s=>Hn(()=>s3(s,r)))}):zr(t,r=>xT(e,s=>[r,s]))),CT=w(t=>rT(t[1]),(t,e,n)=>n!=null&&n.concurrent?xT(CY(t,e,{concurrent:!0}),r=>r[1]):zr(t,()=>e)),FY=Kl,RY=xw,FT=Symbol.for("effect/Stream"),PY={_R:t=>t,_E:t=>t,_A:t=>t};class mc{constructor(e){g(this,"channel");g(this,tre,PY);this.channel=e}pipe(){return et(this,arguments)}}tre=FT;const pg=t=>it(t,FT)||Gl(t),$Y=t=>$T(dr(de(t))),LY=w(t=>pg(t[0]),(t,e,n)=>{const r=(n==null?void 0:n.bufferSize)??16;return n!=null&&n.switch?RT(n==null?void 0:n.concurrency,()=>PT(t,1,r,e),s=>PT(t,s,r,e)):RT(n==null?void 0:n.concurrency,()=>new mc(c0(eo(t),s=>I(s,Tv(i=>eo(e(i))),kR(Ed,(i,o)=>I(i,CT(o)))))),s=>new mc(I(eo(t),c0(TT),qT(i=>eo(e(i)),n))))}),RT=(t,e,n)=>{switch(t){case void 0:return e();case"unbounded":return n(Number.MAX_SAFE_INTEGER);default:return t>1?n(t):e()}},PT=w(4,(t,e,n,r)=>new mc(I(eo(t),c0(TT),qT(s=>eo(r(s)),{concurrency:e,mergeStrategy:SY(),bufferSize:n})))),MY=w(t=>pg(t[0]),(t,e)=>LY(t,Ke,e)),eo=t=>{if("channel"in t)return t.channel;if(Gl(t))return eo(DY(t));throw new TypeError("Expected a Stream.")},DY=t=>I(t,Cm(de),$T),$T=t=>new mc(ta(rS(t,{onFailure:Nn({onNone:()=>Ed,onSome:iT}),onSuccess:e=>Us(Zn(e))}))),WY=(t,e)=>JY(Me(eu(Rt(()=>t().getReader()),n=>Im(()=>n.cancel())),n=>UY(Te(Zl({try:()=>n.read(),catch:r=>de(e(r))}),({done:r,value:s})=>r?dr(ce()):Tt(s))))),BY=t=>HY(t,e=>I(Me(e,n=>de([n,e])),ic(Nn({onNone:()=>Tt(ce()),onSome:dr})))),UY=t=>BY(I(t,Me(Zn))),jY=t=>new mc(xY(OT(I(t,Me(Zn))),Dt)),zY=t=>new mc(cY(()=>eo(t()))),VY=t=>Me(yu(eo(t)),e=>I(e,Cm(de),Te(ps({onLeft:()=>dr(ce()),onRight:Tt})))),KY=w(t=>pg(t[0]),(t,e)=>Me(DO(),n=>QY(t,n,e))),QY=w(t=>pg(t[0]),(t,e,n)=>{const r=RY(e),s=FY(e);let i,o;return new ReadableStream({start(l){o=r(hq());const f=I(VY(t),gw(o),r,Te(m=>my(m)?f:Tt(m)));i=I(f,on(m=>Rt(()=>{Tv(m,S=>{l.enqueue(S)})})),nS(()=>zl(o,Wb)),vO({None:()=>Rt(()=>{l.close()}),Some:m=>Rt(()=>{l.error(m.value)})}),Jw)},pull(){return new Promise(l=>{s(i,{scope:o}).addObserver(f=>l())})},cancel(){return new Promise(l=>{s(zl(o,Wb)).addObserver(f=>l())})}},n==null?void 0:n.strategy)}),HY=(t,e)=>zY(()=>{const n=r=>ta(Me(e(r),Nn({onNone:()=>Ed,onSome:([s,i])=>zr(Us(s),()=>n(i))})));return new mc(n(t))}),JY=t=>MY(jY(t)),GY=$Y,YY=WY,XY=KY,LT=(t,e)=>{class n extends _O{constructor(){super(...arguments);g(this,"_tag",e)}}return n.prototype[t]=t,n.prototype.name=e,n},MT=Symbol.for("@effect/platform/Cookies"),DT=Symbol.for("@effect/platform/Cookies/Cookie"),ZY={[MT]:MT,...kh,toJSON(){return{_id:"@effect/platform/Cookies",cookies:J2(this.cookies,t=>t.toJSON())}},pipe(){return et(this,arguments)}},eX=t=>{const e=Object.create(ZY);return e.cookies=t,e},tX=t=>{const e={};for(const n of t)e[n.name]=n;return eX(e)},nX=t=>{const e=typeof t=="string"?[t]:t,n=[];for(const r of e){const s=rX(r.trim());pt(s)&&n.push(s.value)}return tX(n)};function rX(t){const e=t.split(";").map(l=>l.trim()).filter(l=>l!=="");if(e.length===0)return ce();const n=e[0].indexOf("=");if(n===-1)return ce();const r=e[0].slice(0,n);if(!sX.test(r))return ce();const s=e[0].slice(n+1),i=iX(s);if(e.length===1)return de(Object.assign(Object.create(WT),{name:r,value:i,valueEncoded:s}));const o={};for(let l=1;l<e.length;l++){const f=e[l],m=f.indexOf("="),S=m===-1?f:f.slice(0,m).trim(),N=m===-1?void 0:f.slice(m+1).trim();switch(S.toLowerCase()){case"domain":{if(N===void 0)break;const O=N.trim().replace(/^\./,"");O&&(o.domain=O);break}case"expires":{if(N===void 0)break;const O=new Date(N);isNaN(O.getTime())||(o.expires=O);break}case"max-age":{if(N===void 0)break;const O=parseInt(N,10);isNaN(O)||(o.maxAge=iy(O));break}case"path":{if(N===void 0)break;N[0]==="/"&&(o.path=N);break}case"priority":{if(N===void 0)break;switch(N.toLowerCase()){case"low":o.priority="low";break;case"medium":o.priority="medium";break;case"high":o.priority="high";break}break}case"httponly":{o.httpOnly=!0;break}case"secure":{o.secure=!0;break}case"partitioned":{o.partitioned=!0;break}case"samesite":{if(N===void 0)break;switch(N.toLowerCase()){case"lax":o.sameSite="lax";break;case"strict":o.sameSite="strict";break;case"none":o.sameSite="none";break}break}}}return de(Object.assign(Object.create(WT),{name:r,value:i,valueEncoded:s,options:Object.keys(o).length>0?o:void 0}))}const sX=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,WT={[DT]:DT,...kh,toJSON(){return{_id:"@effect/platform/Cookies/Cookie",name:this.name,value:this.value,options:this.options}}},iX=t=>{try{return decodeURIComponent(t)}catch{return t}},BT=Symbol.for("@effect/platform/HttpClientError");class UT extends LT(BT,"RequestError"){get methodAndUrl(){return`${this.request.method} ${this.request.url}`}get message(){return this.description?`${this.reason}: ${this.description} (${this.methodAndUrl})`:`${this.reason} error (${this.methodAndUrl})`}}class na extends LT(BT,"ResponseError"){get methodAndUrl(){return`${this.request.method} ${this.request.url}`}get message(){const e=`${this.response.status} ${this.methodAndUrl}`;return this.description?`${this.reason}: ${this.description} (${e})`:`${this.reason} error (${e})`}}const jT=Symbol.for("@effect/platform/Headers"),Od=Object.assign(Object.create(null),{[jT]:jT}),f0=t=>Object.assign(Object.create(Od),t),zT=Object.create(Od),VT=t=>{if(t===void 0)return zT;if(Symbol.iterator in t){const n=Object.create(Od);for(const[r,s]of t)n[r.toLowerCase()]=s;return n}const e=Object.create(Od);for(const[n,r]of Object.entries(t))Array.isArray(r)?e[n.toLowerCase()]=r.join(", "):r!==void 0&&(e[n.toLowerCase()]=r);return e},oX=t=>Object.setPrototypeOf(t,Od),d0=w(3,(t,e,n)=>{const r=f0(t);return r[e.toLowerCase()]=n,r}),aX=w(2,(t,e)=>f0({...t,...VT(e)})),KT=w(2,(t,e)=>{const n=f0(t);return delete n[e.toLowerCase()],n}),QT=w(2,(t,e)=>{const n={...t},r=s=>{if(typeof s=="string"){const i=s.toLowerCase();i in t&&(n[i]=zO(t[i]))}else for(const i in t)s.test(i)&&(n[i]=zO(t[i]))};if(Array.isArray(e))for(let s=0;s<e.length;s++)r(e[s]);else r(e);return n}),cX=gt("@effect/platform/Headers/currentRedactedNames",()=>JS(["authorization","cookie","set-cookie","x-api-key"])),lX=t=>oX({b3:`${t.traceId}-${t.spanId}-${t.sampled?"1":"0"}${t.parent._tag==="Some"?`-${t.parent.value.spanId}`:""}`,traceparent:`00-${t.traceId}-${t.spanId}-${t.sampled?"01":"00"}`}),h0=t=>{const e=Symbol.iterator in t?bt(t):Object.entries(t),n=[];for(const[r,s]of e)if(Array.isArray(s))for(let i=0;i<s.length;i++)s[i]!==void 0&&n.push([r,String(s[i])]);else s!==void 0&&n.push([r,String(s)]);return n},uX=[],fX=w(2,(t,e)=>{const n=h0(e),r=n.map(([s])=>s);return oy(ly(t,([s])=>r.includes(s)),n)}),dX=(t,e,n)=>{try{const r=new URL(t,hX());for(let s=0;s<e.length;s++){const[i,o]=e[s];o!==void 0&&r.searchParams.append(i,o)}return n._tag==="Some"&&(r.hash=n.value),Mt(r)}catch(r){return ut(r)}},hX=()=>{if("location"in globalThis&&globalThis.location!==void 0&&globalThis.location.origin!==void 0&&globalThis.location.pathname!==void 0)return location.origin+location.pathname},p0=Symbol.for("@effect/platform/HttpBody");class HT{constructor(){g(this,nre);this[p0]=p0}[(nre=p0,Zt)](){return this.toJSON()}toString(){return vn(this)}}class pX extends HT{constructor(){super(...arguments);g(this,"_tag","Empty")}toJSON(){return{_id:"@effect/platform/HttpBody",_tag:"Empty"}}}const mX=new pX;class gX extends HT{constructor(n,r){super();g(this,"body");g(this,"contentType");g(this,"_tag","Uint8Array");this.body=n,this.contentType=r}get contentLength(){return this.body.length}toJSON(){return{_id:"@effect/platform/HttpBody",_tag:"Uint8Array",body:this.contentType.startsWith("text/")||this.contentType.endsWith("json")?new TextDecoder().decode(this.body):`Uint8Array(${this.body.length})`,contentType:this.contentType,contentLength:this.contentLength}}}const _X=(t,e)=>new gX(t,e??"application/octet-stream"),m0=Symbol.for("@effect/platform/HttpClientRequest"),yX=xr("@effect/platform/HttpClient"),bX={[m0]:m0,..._b,...kh,commit(){return Te(yX,t=>t.execute(this))},toJSON(){return{_id:"@effect/platform/HttpClientRequest",method:this.method,url:this.url,urlParams:this.urlParams,hash:this.hash,headers:this.headers,body:this.body.toJSON()}}};function to(t,e,n,r,s,i){const o=Object.create(bX);return o.method=t,o.url=e,o.urlParams=n,o.hash=r,o.headers=s,o.body=i,o}const wX=t=>typeof t=="object"&&t!==null&&m0 in t,SX=to("GET","",uX,ce(),zT,mX),gc=t=>(e,n)=>OX(SX,{method:t,url:e,...n??void 0}),EX=gc("GET"),JT=gc("POST"),vX=gc("PUT"),NX=gc("PATCH"),kX=gc("DELETE"),xX=gc("HEAD"),qX=gc("OPTIONS"),OX=w(2,(t,e)=>{let n=t;return e.method&&(n=AX(n,e.method)),e.url&&(n=CX(n,e.url)),e.headers&&(n=GT(n,e.headers)),e.urlParams&&(n=FX(n,e.urlParams)),e.hash&&(n=RX(n,e.hash)),e.body&&(n=XT(n,e.body)),e.accept&&(n=YT(n,e.accept)),e.acceptJson&&(n=TX(n)),n}),IX=w(3,(t,e,n)=>to(t.method,t.url,t.urlParams,t.hash,d0(t.headers,e,n),t.body)),GT=w(2,(t,e)=>to(t.method,t.url,t.urlParams,t.hash,aX(t.headers,e),t.body)),YT=w(2,(t,e)=>IX(t,"Accept",e)),TX=YT("application/json"),AX=w(2,(t,e)=>to(e,t.url,t.urlParams,t.hash,t.headers,t.body)),CX=w(2,(t,e)=>{if(typeof e=="string")return to(t.method,e,t.urlParams,t.hash,t.headers,t.body);const n=new URL(e.toString()),r=h0(n.searchParams),s=n.hash?de(n.hash.slice(1)):ce();return n.search="",n.hash="",to(t.method,n.toString(),r,s,t.headers,t.body)}),FX=w(2,(t,e)=>to(t.method,t.url,fX(t.urlParams,e),t.hash,t.headers,t.body)),RX=w(2,(t,e)=>to(t.method,t.url,t.urlParams,de(e),t.headers,t.body)),XT=w(2,(t,e)=>{let n=t.headers;if(e._tag==="Empty")n=KT(KT(n,"Content-Type"),"Content-length");else{const r=e.contentType;r&&(n=d0(n,"content-type",r));const s=e.contentLength;s&&(n=d0(n,"content-length",s.toString()))}return to(t.method,t.url,t.urlParams,t.hash,n,e)}),PX=w(t=>wX(t[0]),(t,e,n="application/octet-stream")=>XT(t,_X(e,n))),g0=Symbol.for("@effect/platform/HttpIncomingMessage"),$X=(t,e)=>{const n=t.headers["content-type"]??"";let r;if(n.includes("application/json"))try{r=ui(t.json)}catch{}else if(n.includes("text/")||n.includes("urlencoded"))try{r=ui(t.text)}catch{}const s={...e,headers:t.headers,remoteAddress:t.remoteAddress.toJSON()};return r!==void 0&&(s.body=r),s},_0=Symbol.for("@effect/platform/HttpClientResponse"),LX=(t,e)=>new MX(t,e);class MX extends MF{constructor(n,r){super();g(this,"request");g(this,"source");g(this,rre);g(this,sre);g(this,"cachedCookies");g(this,"textBody");g(this,"formDataBody");g(this,"arrayBufferBody");this.request=n,this.source=r,this[g0]=g0,this[_0]=_0}toJSON(){return $X(this,{_id:"@effect/platform/HttpClientResponse",request:this.request.toJSON(),status:this.status})}get status(){return this.source.status}get headers(){return VT(this.source.headers)}get cookies(){return this.cachedCookies?this.cachedCookies:this.cachedCookies=nX(this.source.headers.getSetCookie())}get remoteAddress(){return ce()}get stream(){return this.source.body?YY(()=>this.source.body,n=>new na({request:this.request,response:this,reason:"Decode",cause:n})):GY(new na({request:this.request,response:this,reason:"EmptyBody",description:"can not create stream from empty body"}))}get json(){return kO(this.text,{try:n=>n===""?null:JSON.parse(n),catch:n=>new na({request:this.request,response:this,reason:"Decode",cause:n})})}get text(){return this.textBody??(this.textBody=Zl({try:()=>this.source.text(),catch:n=>new na({request:this.request,response:this,reason:"Decode",cause:n})}).pipe(qm,ui))}get urlParamsBody(){return Te(this.text,n=>Hw({try:()=>h0(new URLSearchParams(n)),catch:r=>new na({request:this.request,response:this,reason:"Decode",cause:r})}))}get formData(){return this.formDataBody??(this.formDataBody=Zl({try:()=>this.source.formData(),catch:n=>new na({request:this.request,response:this,reason:"Decode",cause:n})}).pipe(qm,ui))}get arrayBuffer(){return this.arrayBufferBody??(this.arrayBufferBody=Zl({try:()=>this.source.arrayBuffer(),catch:n=>new na({request:this.request,response:this,reason:"Decode",cause:n})}).pipe(qm,ui))}}rre=g0,sre=_0;const DX=t=>t.status>=200&&t.status<300?Tt(t):dr(new na({response:t,request:t.request,reason:"StatusCode",description:"non 2xx status code"})),ZT=Symbol.for("@effect/platform/HttpClient"),eA=xr("@effect/platform/HttpClient"),WX=gt(Symbol.for("@effect/platform/HttpClient/tracerDisabledWhen"),()=>JS(Bc)),BX=gt(Symbol.for("@effect/platform/HttpClient/currentTracerPropagation"),()=>JS(!0)),UX={[ZT]:ZT,pipe(){return et(this,arguments)},...kh,toJSON(){return{_id:"@effect/platform/HttpClient"}},get(t,e){return this.execute(EX(t,e))},head(t,e){return this.execute(xX(t,e))},post(t,e){return this.execute(JT(t,e))},put(t,e){return this.execute(vX(t,e))},patch(t,e){return this.execute(NX(t,e))},del(t,e){return this.execute(kX(t,e))},options(t,e){return this.execute(qX(t,e))}},tA=(t,e)=>{const n=Object.create(UX);return n.preprocess=e,n.postprocess=t,n.execute=function(r){return t(e(r))},n},jX=t=>tA(e=>Te(e,n=>wO(r=>{const s=uf(r.getFiberRef(P1),gj),i=new AbortController,o=_j(s,Rt(()=>i.abort())),l=dX(n.url,n.urlParams,n.hash);if(l._tag==="Left")return dr(new UT({request:n,reason:"InvalidUrl",cause:l.left}));const f=l.right;return!r.getFiberRef(UG)||r.getFiberRef(WX)(n)?an(o,t(n,f,i.signal,r)):an(o,BO(`http.client ${n.method}`,{kind:"client",captureStackTrace:!1},S=>{S.attribute("http.request.method",n.method),S.attribute("server.address",f.origin),f.port!==""&&S.attribute("server.port",+f.port),S.attribute("url.full",f.toString()),S.attribute("url.path",f.pathname),S.attribute("url.scheme",f.protocol.slice(0,-1));const N=f.search.slice(1);N!==""&&S.attribute("url.query",N);const O=r.getFiberRef(cX),M=QT(n.headers,O);for(const z in M)S.attribute(`http.request.header.${z}`,String(M[z]));return n=r.getFiberRef(BX)?GT(n,lX(S)):n,on(UO(t(n,f,i.signal,r),S),z=>{S.attribute("http.response.status_code",z.status);const Z=QT(z.headers,O);for(const J in Z)S.attribute(`http.response.header.${J}`,String(Z[J]))})}))})),Tt),zX=t=>nA(t,Te(DX)),nA=w(2,(t,e)=>{const n=t;return tA(r=>e(n.postprocess(r)),n.preprocess)}),VX=t=>Nm(eA,Te(TO(),e=>Me(t,n=>nA(n,AO(r=>Jc(e,r)))))),KX="@effect/platform/FetchHttpClient/Fetch",QX="@effect/platform/FetchHttpClient/FetchOptions",HX=VX(Tt(jX((t,e,n,r)=>{const s=r.getFiberRef(P1),i=s.unsafeMap.get(KX)??globalThis.fetch,o=s.unsafeMap.get(QX)??{},l=new globalThis.Headers(t.headers),f=m=>Me(Zl({try:()=>i(e,{...o,method:t.method,headers:l,body:m,duplex:t.body._tag==="Stream"?"half":void 0,signal:n}),catch:S=>new UT({request:t,reason:"Transport",cause:S})}),S=>LX(t,S));switch(t.body._tag){case"Raw":case"Uint8Array":return f(t.body.body);case"FormData":return f(t.body.formData);case"Stream":return Te(XY(t.body.stream),f)}return f(void 0)}))),JX=eA,GX=zX,YX=JT,XX=PX;function rA(t){let e=typeof t;if(e=="object"){if(Array.isArray(t))return"array";if(t===null)return"null"}return e}function ZX(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}let no="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),mg=[];for(let t=0;t<no.length;t++)mg[no[t].charCodeAt(0)]=t;mg[45]=no.indexOf("+"),mg[95]=no.indexOf("/");function eZ(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),r=0,s=0,i,o=0;for(let l=0;l<t.length;l++){if(i=mg[t.charCodeAt(l)],i===void 0)switch(t[l]){case"=":s=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(s){case 0:o=i,s=1;break;case 1:n[r++]=o<<2|(i&48)>>4,o=i,s=2;break;case 2:n[r++]=(o&15)<<4|(i&60)>>2,o=i,s=3;break;case 3:n[r++]=(o&3)<<6|i,s=0;break}}if(s==1)throw Error("invalid base64 string.");return n.subarray(0,r)}function tZ(t){let e="",n=0,r,s=0;for(let i=0;i<t.length;i++)switch(r=t[i],n){case 0:e+=no[r>>2],s=(r&3)<<4,n=1;break;case 1:e+=no[s|r>>4],s=(r&15)<<2,n=2;break;case 2:e+=no[s|r>>6],e+=no[r&63],n=0;break}return n&&(e+=no[s],e+="=",n==1&&(e+="=")),e}var gg;(function(t){t.symbol=Symbol.for("protobuf-ts/unknown"),t.onRead=(n,r,s,i,o)=>{(e(r)?r[t.symbol]:r[t.symbol]=[]).push({no:s,wireType:i,data:o})},t.onWrite=(n,r,s)=>{for(let{no:i,wireType:o,data:l}of t.list(r))s.tag(i,o).raw(l)},t.list=(n,r)=>{if(e(n)){let s=n[t.symbol];return r?s.filter(i=>i.no==r):s}return[]},t.last=(n,r)=>t.list(n,r).slice(-1)[0];const e=n=>n&&Array.isArray(n[t.symbol])})(gg||(gg={}));var In;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(In||(In={}));function nZ(){let t=0,e=0;for(let r=0;r<28;r+=7){let s=this.buf[this.pos++];if(t|=(s&127)<<r,!(s&128))return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,!(n&128))return this.assertBounds(),[t,e];for(let r=3;r<=31;r+=7){let s=this.buf[this.pos++];if(e|=(s&127)<<r,!(s&128))return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function y0(t,e,n){for(let i=0;i<28;i=i+7){const o=t>>>i,l=!(!(o>>>7)&&e==0),f=(l?o|128:o)&255;if(n.push(f),!l)return}const r=t>>>28&15|(e&7)<<4,s=!!(e>>3);if(n.push((s?r|128:r)&255),!!s){for(let i=3;i<31;i=i+7){const o=e>>>i,l=!!(o>>>7),f=(l?o|128:o)&255;if(n.push(f),!l)return}n.push(e>>>31&1)}}const _g=65536*65536;function sA(t){let e=t[0]=="-";e&&(t=t.slice(1));const n=1e6;let r=0,s=0;function i(o,l){const f=Number(t.slice(o,l));s*=n,r=r*n+f,r>=_g&&(s=s+(r/_g|0),r=r%_g)}return i(-24,-18),i(-18,-12),i(-12,-6),i(-6),[e,r,s]}function b0(t,e){if(e>>>0<=2097151)return""+(_g*e+(t>>>0));let n=t&16777215,r=(t>>>24|e<<8)>>>0&16777215,s=e>>16&65535,i=n+r*6777216+s*6710656,o=r+s*8147497,l=s*2,f=1e7;i>=f&&(o+=Math.floor(i/f),i%=f),o>=f&&(l+=Math.floor(o/f),o%=f);function m(S,N){let O=S?String(S):"";return N?"0000000".slice(O.length)+O:O}return m(l,0)+m(o,l)+m(i,1)}function iA(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function rZ(){let t=this.buf[this.pos++],e=t&127;if(!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,!(t&128))return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;t&128&&n<10;n++)t=this.buf[this.pos++];if(t&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}let cn;function sZ(){const t=new DataView(new ArrayBuffer(8));cn=globalThis.BigInt!==void 0&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"?{MIN:BigInt("-9223372036854775808"),MAX:BigInt("9223372036854775807"),UMIN:BigInt("0"),UMAX:BigInt("18446744073709551615"),C:BigInt,V:t}:void 0}sZ();function oA(t){if(!t)throw new Error("BigInt unavailable, see https://github.com/timostamm/protobuf-ts/blob/v1.0.8/MANUAL.md#bigint-support")}const aA=/^-?[0-9]+$/,yg=4294967296,bg=2147483648;class cA{constructor(e,n){this.lo=e|0,this.hi=n|0}isZero(){return this.lo==0&&this.hi==0}toNumber(){let e=this.hi*yg+(this.lo>>>0);if(!Number.isSafeInteger(e))throw new Error("cannot convert to safe number");return e}}class vr extends cA{static from(e){if(cn)switch(typeof e){case"string":if(e=="0")return this.ZERO;if(e=="")throw new Error("string is no integer");e=cn.C(e);case"number":if(e===0)return this.ZERO;e=cn.C(e);case"bigint":if(!e)return this.ZERO;if(e<cn.UMIN)throw new Error("signed value for ulong");if(e>cn.UMAX)throw new Error("ulong too large");return cn.V.setBigUint64(0,e,!0),new vr(cn.V.getInt32(0,!0),cn.V.getInt32(4,!0))}else switch(typeof e){case"string":if(e=="0")return this.ZERO;if(e=e.trim(),!aA.test(e))throw new Error("string is no integer");let[n,r,s]=sA(e);if(n)throw new Error("signed value for ulong");return new vr(r,s);case"number":if(e==0)return this.ZERO;if(!Number.isSafeInteger(e))throw new Error("number is no integer");if(e<0)throw new Error("signed value for ulong");return new vr(e,e/yg)}throw new Error("unknown value "+typeof e)}toString(){return cn?this.toBigInt().toString():b0(this.lo,this.hi)}toBigInt(){return oA(cn),cn.V.setInt32(0,this.lo,!0),cn.V.setInt32(4,this.hi,!0),cn.V.getBigUint64(0,!0)}}vr.ZERO=new vr(0,0);class Tn extends cA{static from(e){if(cn)switch(typeof e){case"string":if(e=="0")return this.ZERO;if(e=="")throw new Error("string is no integer");e=cn.C(e);case"number":if(e===0)return this.ZERO;e=cn.C(e);case"bigint":if(!e)return this.ZERO;if(e<cn.MIN)throw new Error("signed long too small");if(e>cn.MAX)throw new Error("signed long too large");return cn.V.setBigInt64(0,e,!0),new Tn(cn.V.getInt32(0,!0),cn.V.getInt32(4,!0))}else switch(typeof e){case"string":if(e=="0")return this.ZERO;if(e=e.trim(),!aA.test(e))throw new Error("string is no integer");let[n,r,s]=sA(e);if(n){if(s>bg||s==bg&&r!=0)throw new Error("signed long too small")}else if(s>=bg)throw new Error("signed long too large");let i=new Tn(r,s);return n?i.negate():i;case"number":if(e==0)return this.ZERO;if(!Number.isSafeInteger(e))throw new Error("number is no integer");return e>0?new Tn(e,e/yg):new Tn(-e,-e/yg).negate()}throw new Error("unknown value "+typeof e)}isNegative(){return(this.hi&bg)!==0}negate(){let e=~this.hi,n=this.lo;return n?n=~n+1:e+=1,new Tn(n,e)}toString(){if(cn)return this.toBigInt().toString();if(this.isNegative()){let e=this.negate();return"-"+b0(e.lo,e.hi)}return b0(this.lo,this.hi)}toBigInt(){return oA(cn),cn.V.setInt32(0,this.lo,!0),cn.V.setInt32(4,this.hi,!0),cn.V.getBigInt64(0,!0)}}Tn.ZERO=new Tn(0,0);const lA={readUnknownField:!0,readerFactory:t=>new uA(t)};function iZ(t){return t?Object.assign(Object.assign({},lA),t):lA}class uA{constructor(e,n){this.varint64=nZ,this.uint32=rZ,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0})}tag(){let e=this.uint32(),n=e>>>3,r=e&7;if(n<=0||r<0||r>5)throw new Error("illegal tag: field no "+n+" wire type "+r);return[n,r]}skip(e){let n=this.pos;switch(e){case In.Varint:for(;this.buf[this.pos++]&128;);break;case In.Bit64:this.pos+=4;case In.Bit32:this.pos+=4;break;case In.LengthDelimited:let r=this.uint32();this.pos+=r;break;case In.StartGroup:let s;for(;(s=this.tag()[1])!==In.EndGroup;)this.skip(s);break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(n,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return new Tn(...this.varint64())}uint64(){return new vr(...this.varint64())}sint64(){let[e,n]=this.varint64(),r=-(e&1);return e=(e>>>1|(n&1)<<31)^r,n=n>>>1^r,new Tn(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return new vr(this.sfixed32(),this.sfixed32())}sfixed64(){return new Tn(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function Vt(t,e){if(!t)throw new Error(e)}const oZ=34028234663852886e22,aZ=-34028234663852886e22,cZ=4294967295,lZ=2147483647,uZ=-2147483648;function Id(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>lZ||t<uZ)throw new Error("invalid int 32: "+t)}function wg(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>cZ||t<0)throw new Error("invalid uint 32: "+t)}function w0(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>oZ||t<aZ))throw new Error("invalid float 32: "+t)}const fA={writeUnknownFields:!0,writerFactory:()=>new dA};function fZ(t){return t?Object.assign(Object.assign({},fA),t):fA}class dA{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let s=0;s<this.chunks.length;s++)e+=this.chunks[s].length;let n=new Uint8Array(e),r=0;for(let s=0;s<this.chunks.length;s++)n.set(this.chunks[s],r),r+=this.chunks[s].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(wg(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return Id(e),iA(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){w0(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){wg(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){Id(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return Id(e),e=(e<<1^e>>31)>>>0,iA(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),r=new DataView(n.buffer),s=Tn.from(e);return r.setInt32(0,s.lo,!0),r.setInt32(4,s.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),r=new DataView(n.buffer),s=vr.from(e);return r.setInt32(0,s.lo,!0),r.setInt32(4,s.hi,!0),this.raw(n)}int64(e){let n=Tn.from(e);return y0(n.lo,n.hi,this.buf),this}sint64(e){let n=Tn.from(e),r=n.hi>>31,s=n.lo<<1^r,i=(n.hi<<1|n.lo>>>31)^r;return y0(s,i,this.buf),this}uint64(e){let n=vr.from(e);return y0(n.lo,n.hi,this.buf),this}}const hA={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0},pA={ignoreUnknownFields:!1};function dZ(t){return t?Object.assign(Object.assign({},pA),t):pA}function hZ(t){return t?Object.assign(Object.assign({},hA),t):hA}const mA=Symbol.for("protobuf-ts/message-type");function gA(t){let e=!1;const n=[];for(let r=0;r<t.length;r++){let s=t.charAt(r);s=="_"?e=!0:/\d/.test(s)?(n.push(s),e=!0):e?(n.push(s.toUpperCase()),e=!1):r==0?n.push(s.toLowerCase()):n.push(s)}return n.join("")}var fe;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(fe||(fe={}));var _i;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING",t[t.NUMBER=2]="NUMBER"})(_i||(_i={}));var Sg;(function(t){t[t.NO=0]="NO",t[t.PACKED=1]="PACKED",t[t.UNPACKED=2]="UNPACKED"})(Sg||(Sg={}));function pZ(t){var e,n,r,s;return t.localName=(e=t.localName)!==null&&e!==void 0?e:gA(t.name),t.jsonName=(n=t.jsonName)!==null&&n!==void 0?n:gA(t.name),t.repeat=(r=t.repeat)!==null&&r!==void 0?r:Sg.NO,t.opt=(s=t.opt)!==null&&s!==void 0?s:t.repeat||t.oneof?!1:t.kind=="message",t}function mZ(t){if(typeof t!="object"||t===null||!t.hasOwnProperty("oneofKind"))return!1;switch(typeof t.oneofKind){case"string":return t[t.oneofKind]===void 0?!1:Object.keys(t).length==2;case"undefined":return Object.keys(t).length==1;default:return!1}}class gZ{constructor(e){var n;this.fields=(n=e.fields)!==null&&n!==void 0?n:[]}prepare(){if(this.data)return;const e=[],n=[],r=[];for(let s of this.fields)if(s.oneof)r.includes(s.oneof)||(r.push(s.oneof),e.push(s.oneof),n.push(s.oneof));else switch(n.push(s.localName),s.kind){case"scalar":case"enum":(!s.opt||s.repeat)&&e.push(s.localName);break;case"message":s.repeat&&e.push(s.localName);break;case"map":e.push(s.localName);break}this.data={req:e,known:n,oneofs:Object.values(r)}}is(e,n,r=!1){if(n<0)return!0;if(e==null||typeof e!="object")return!1;this.prepare();let s=Object.keys(e),i=this.data;if(s.length<i.req.length||i.req.some(o=>!s.includes(o))||!r&&s.some(o=>!i.known.includes(o)))return!1;if(n<1)return!0;for(const o of i.oneofs){const l=e[o];if(!mZ(l))return!1;if(l.oneofKind===void 0)continue;const f=this.fields.find(m=>m.localName===l.oneofKind);if(!f||!this.field(l[l.oneofKind],f,r,n))return!1}for(const o of this.fields)if(o.oneof===void 0&&!this.field(e[o.localName],o,r,n))return!1;return!0}field(e,n,r,s){let i=n.repeat;switch(n.kind){case"scalar":return e===void 0?n.opt:i?this.scalars(e,n.T,s,n.L):this.scalar(e,n.T,n.L);case"enum":return e===void 0?n.opt:i?this.scalars(e,fe.INT32,s):this.scalar(e,fe.INT32);case"message":return e===void 0?!0:i?this.messages(e,n.T(),r,s):this.message(e,n.T(),r,s);case"map":if(typeof e!="object"||e===null)return!1;if(s<2)return!0;if(!this.mapKeys(e,n.K,s))return!1;switch(n.V.kind){case"scalar":return this.scalars(Object.values(e),n.V.T,s,n.V.L);case"enum":return this.scalars(Object.values(e),fe.INT32,s);case"message":return this.messages(Object.values(e),n.V.T(),r,s)}break}return!0}message(e,n,r,s){return r?n.isAssignable(e,s):n.is(e,s)}messages(e,n,r,s){if(!Array.isArray(e))return!1;if(s<2)return!0;if(r){for(let i=0;i<e.length&&i<s;i++)if(!n.isAssignable(e[i],s-1))return!1}else for(let i=0;i<e.length&&i<s;i++)if(!n.is(e[i],s-1))return!1;return!0}scalar(e,n,r){let s=typeof e;switch(n){case fe.UINT64:case fe.FIXED64:case fe.INT64:case fe.SFIXED64:case fe.SINT64:switch(r){case _i.BIGINT:return s=="bigint";case _i.NUMBER:return s=="number"&&!isNaN(e);default:return s=="string"}case fe.BOOL:return s=="boolean";case fe.STRING:return s=="string";case fe.BYTES:return e instanceof Uint8Array;case fe.DOUBLE:case fe.FLOAT:return s=="number"&&!isNaN(e);default:return s=="number"&&Number.isInteger(e)}}scalars(e,n,r,s){if(!Array.isArray(e))return!1;if(r<2)return!0;if(Array.isArray(e)){for(let i=0;i<e.length&&i<r;i++)if(!this.scalar(e[i],n,s))return!1}return!0}mapKeys(e,n,r){let s=Object.keys(e);switch(n){case fe.INT32:case fe.FIXED32:case fe.SFIXED32:case fe.SINT32:case fe.UINT32:return this.scalars(s.slice(0,r).map(i=>parseInt(i)),n,r);case fe.BOOL:return this.scalars(s.slice(0,r).map(i=>i=="true"?!0:i=="false"?!1:i),n,r);default:return this.scalars(s,n,r,_i.STRING)}}}function js(t,e){switch(e){case _i.BIGINT:return t.toBigInt();case _i.NUMBER:return t.toNumber();default:return t.toString()}}class _Z{constructor(e){this.info=e}prepare(){var e;if(this.fMap===void 0){this.fMap={};const n=(e=this.info.fields)!==null&&e!==void 0?e:[];for(const r of n)this.fMap[r.name]=r,this.fMap[r.jsonName]=r,this.fMap[r.localName]=r}}assert(e,n,r){if(!e){let s=rA(r);throw(s=="number"||s=="boolean")&&(s=r.toString()),new Error(`Cannot parse JSON ${s} for ${this.info.typeName}#${n}`)}}read(e,n,r){this.prepare();const s=[];for(const[i,o]of Object.entries(e)){const l=this.fMap[i];if(!l){if(!r.ignoreUnknownFields)throw new Error(`Found unknown field while reading ${this.info.typeName} from JSON format. JSON key: ${i}`);continue}const f=l.localName;let m;if(l.oneof){if(o===null&&(l.kind!=="enum"||l.T()[0]!=="google.protobuf.NullValue"))continue;if(s.includes(l.oneof))throw new Error(`Multiple members of the oneof group "${l.oneof}" of ${this.info.typeName} are present in JSON.`);s.push(l.oneof),m=n[l.oneof]={oneofKind:f}}else m=n;if(l.kind=="map"){if(o===null)continue;this.assert(ZX(o),l.name,o);const S=m[f];for(const[N,O]of Object.entries(o)){this.assert(O!==null,l.name+" map value",null);let M;switch(l.V.kind){case"message":M=l.V.T().internalJsonRead(O,r);break;case"enum":if(M=this.enum(l.V.T(),O,l.name,r.ignoreUnknownFields),M===!1)continue;break;case"scalar":M=this.scalar(O,l.V.T,l.V.L,l.name);break}this.assert(M!==void 0,l.name+" map value",O);let z=N;l.K==fe.BOOL&&(z=z=="true"?!0:z=="false"?!1:z),z=this.scalar(z,l.K,_i.STRING,l.name).toString(),S[z]=M}}else if(l.repeat){if(o===null)continue;this.assert(Array.isArray(o),l.name,o);const S=m[f];for(const N of o){this.assert(N!==null,l.name,null);let O;switch(l.kind){case"message":O=l.T().internalJsonRead(N,r);break;case"enum":if(O=this.enum(l.T(),N,l.name,r.ignoreUnknownFields),O===!1)continue;break;case"scalar":O=this.scalar(N,l.T,l.L,l.name);break}this.assert(O!==void 0,l.name,o),S.push(O)}}else switch(l.kind){case"message":if(o===null&&l.T().typeName!="google.protobuf.Value"){this.assert(l.oneof===void 0,l.name+" (oneof member)",null);continue}m[f]=l.T().internalJsonRead(o,r,m[f]);break;case"enum":let S=this.enum(l.T(),o,l.name,r.ignoreUnknownFields);if(S===!1)continue;m[f]=S;break;case"scalar":m[f]=this.scalar(o,l.T,l.L,l.name);break}}}enum(e,n,r,s){if(e[0]=="google.protobuf.NullValue"&&Vt(n===null||n==="NULL_VALUE",`Unable to parse field ${this.info.typeName}#${r}, enum ${e[0]} only accepts null.`),n===null)return 0;switch(typeof n){case"number":return Vt(Number.isInteger(n),`Unable to parse field ${this.info.typeName}#${r}, enum can only be integral number, got ${n}.`),n;case"string":let i=n;e[2]&&n.substring(0,e[2].length)===e[2]&&(i=n.substring(e[2].length));let o=e[1][i];return typeof o>"u"&&s?!1:(Vt(typeof o=="number",`Unable to parse field ${this.info.typeName}#${r}, enum ${e[0]} has no value for "${n}".`),o)}Vt(!1,`Unable to parse field ${this.info.typeName}#${r}, cannot parse enum value from ${typeof n}".`)}scalar(e,n,r,s){let i;try{switch(n){case fe.DOUBLE:case fe.FLOAT:if(e===null)return 0;if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""){i="empty string";break}if(typeof e=="string"&&e.trim().length!==e.length){i="extra whitespace";break}if(typeof e!="string"&&typeof e!="number")break;let o=Number(e);if(Number.isNaN(o)){i="not a number";break}if(!Number.isFinite(o)){i="too large or small";break}return n==fe.FLOAT&&w0(o),o;case fe.INT32:case fe.FIXED32:case fe.SFIXED32:case fe.SINT32:case fe.UINT32:if(e===null)return 0;let l;if(typeof e=="number"?l=e:e===""?i="empty string":typeof e=="string"&&(e.trim().length!==e.length?i="extra whitespace":l=Number(e)),l===void 0)break;return n==fe.UINT32?wg(l):Id(l),l;case fe.INT64:case fe.SFIXED64:case fe.SINT64:if(e===null)return js(Tn.ZERO,r);if(typeof e!="number"&&typeof e!="string")break;return js(Tn.from(e),r);case fe.FIXED64:case fe.UINT64:if(e===null)return js(vr.ZERO,r);if(typeof e!="number"&&typeof e!="string")break;return js(vr.from(e),r);case fe.BOOL:if(e===null)return!1;if(typeof e!="boolean")break;return e;case fe.STRING:if(e===null)return"";if(typeof e!="string"){i="extra whitespace";break}try{encodeURIComponent(e)}catch(f){f="invalid UTF8";break}return e;case fe.BYTES:if(e===null||e==="")return new Uint8Array(0);if(typeof e!="string")break;return eZ(e)}}catch(o){i=o.message}this.assert(!1,s+(i?" - "+i:""),e)}}class yZ{constructor(e){var n;this.fields=(n=e.fields)!==null&&n!==void 0?n:[]}write(e,n){const r={},s=e;for(const i of this.fields){if(!i.oneof){let m=this.field(i,s[i.localName],n);m!==void 0&&(r[n.useProtoFieldName?i.name:i.jsonName]=m);continue}const o=s[i.oneof];if(o.oneofKind!==i.localName)continue;const l=i.kind=="scalar"||i.kind=="enum"?Object.assign(Object.assign({},n),{emitDefaultValues:!0}):n;let f=this.field(i,o[i.localName],l);Vt(f!==void 0),r[n.useProtoFieldName?i.name:i.jsonName]=f}return r}field(e,n,r){let s;if(e.kind=="map"){Vt(typeof n=="object"&&n!==null);const i={};switch(e.V.kind){case"scalar":for(const[f,m]of Object.entries(n)){const S=this.scalar(e.V.T,m,e.name,!1,!0);Vt(S!==void 0),i[f.toString()]=S}break;case"message":const o=e.V.T();for(const[f,m]of Object.entries(n)){const S=this.message(o,m,e.name,r);Vt(S!==void 0),i[f.toString()]=S}break;case"enum":const l=e.V.T();for(const[f,m]of Object.entries(n)){Vt(m===void 0||typeof m=="number");const S=this.enum(l,m,e.name,!1,!0,r.enumAsInteger);Vt(S!==void 0),i[f.toString()]=S}break}(r.emitDefaultValues||Object.keys(i).length>0)&&(s=i)}else if(e.repeat){Vt(Array.isArray(n));const i=[];switch(e.kind){case"scalar":for(let f=0;f<n.length;f++){const m=this.scalar(e.T,n[f],e.name,e.opt,!0);Vt(m!==void 0),i.push(m)}break;case"enum":const o=e.T();for(let f=0;f<n.length;f++){Vt(n[f]===void 0||typeof n[f]=="number");const m=this.enum(o,n[f],e.name,e.opt,!0,r.enumAsInteger);Vt(m!==void 0),i.push(m)}break;case"message":const l=e.T();for(let f=0;f<n.length;f++){const m=this.message(l,n[f],e.name,r);Vt(m!==void 0),i.push(m)}break}(r.emitDefaultValues||i.length>0||r.emitDefaultValues)&&(s=i)}else switch(e.kind){case"scalar":s=this.scalar(e.T,n,e.name,e.opt,r.emitDefaultValues);break;case"enum":s=this.enum(e.T(),n,e.name,e.opt,r.emitDefaultValues,r.enumAsInteger);break;case"message":s=this.message(e.T(),n,e.name,r);break}return s}enum(e,n,r,s,i,o){if(e[0]=="google.protobuf.NullValue")return!i&&!s?void 0:null;if(n===void 0){Vt(s);return}if(!(n===0&&!i&&!s))return Vt(typeof n=="number"),Vt(Number.isInteger(n)),o||!e[1].hasOwnProperty(n)?n:e[2]?e[2]+e[1][n]:e[1][n]}message(e,n,r,s){return n===void 0?s.emitDefaultValues?null:void 0:e.internalJsonWrite(n,s)}scalar(e,n,r,s,i){if(n===void 0){Vt(s);return}const o=i||s;switch(e){case fe.INT32:case fe.SFIXED32:case fe.SINT32:return n===0?o?0:void 0:(Id(n),n);case fe.FIXED32:case fe.UINT32:return n===0?o?0:void 0:(wg(n),n);case fe.FLOAT:w0(n);case fe.DOUBLE:return n===0?o?0:void 0:(Vt(typeof n=="number"),Number.isNaN(n)?"NaN":n===Number.POSITIVE_INFINITY?"Infinity":n===Number.NEGATIVE_INFINITY?"-Infinity":n);case fe.STRING:return n===""?o?"":void 0:(Vt(typeof n=="string"),n);case fe.BOOL:return n===!1?o?!1:void 0:(Vt(typeof n=="boolean"),n);case fe.UINT64:case fe.FIXED64:Vt(typeof n=="number"||typeof n=="string"||typeof n=="bigint");let l=vr.from(n);return l.isZero()&&!o?void 0:l.toString();case fe.INT64:case fe.SFIXED64:case fe.SINT64:Vt(typeof n=="number"||typeof n=="string"||typeof n=="bigint");let f=Tn.from(n);return f.isZero()&&!o?void 0:f.toString();case fe.BYTES:return Vt(n instanceof Uint8Array),n.byteLength?tZ(n):o?"":void 0}}}function S0(t,e=_i.STRING){switch(t){case fe.BOOL:return!1;case fe.UINT64:case fe.FIXED64:return js(vr.ZERO,e);case fe.INT64:case fe.SFIXED64:case fe.SINT64:return js(Tn.ZERO,e);case fe.DOUBLE:case fe.FLOAT:return 0;case fe.BYTES:return new Uint8Array(0);case fe.STRING:return"";default:return 0}}class bZ{constructor(e){this.info=e}prepare(){var e;if(!this.fieldNoToField){const n=(e=this.info.fields)!==null&&e!==void 0?e:[];this.fieldNoToField=new Map(n.map(r=>[r.no,r]))}}read(e,n,r,s){this.prepare();const i=s===void 0?e.len:e.pos+s;for(;e.pos<i;){const[o,l]=e.tag(),f=this.fieldNoToField.get(o);if(!f){let O=r.readUnknownField;if(O=="throw")throw new Error(`Unknown field ${o} (wire type ${l}) for ${this.info.typeName}`);let M=e.skip(l);O!==!1&&(O===!0?gg.onRead:O)(this.info.typeName,n,o,l,M);continue}let m=n,S=f.repeat,N=f.localName;switch(f.oneof&&(m=m[f.oneof],m.oneofKind!==N&&(m=n[f.oneof]={oneofKind:N})),f.kind){case"scalar":case"enum":let O=f.kind=="enum"?fe.INT32:f.T,M=f.kind=="scalar"?f.L:void 0;if(S){let J=m[N];if(l==In.LengthDelimited&&O!=fe.STRING&&O!=fe.BYTES){let ee=e.uint32()+e.pos;for(;e.pos<ee;)J.push(this.scalar(e,O,M))}else J.push(this.scalar(e,O,M))}else m[N]=this.scalar(e,O,M);break;case"message":if(S){let J=m[N],ee=f.T().internalBinaryRead(e,e.uint32(),r);J.push(ee)}else m[N]=f.T().internalBinaryRead(e,e.uint32(),r,m[N]);break;case"map":let[z,Z]=this.mapEntry(f,e,r);m[N][z]=Z;break}}}mapEntry(e,n,r){let s=n.uint32(),i=n.pos+s,o,l;for(;n.pos<i;){let[f,m]=n.tag();switch(f){case 1:e.K==fe.BOOL?o=n.bool().toString():o=this.scalar(n,e.K,_i.STRING);break;case 2:switch(e.V.kind){case"scalar":l=this.scalar(n,e.V.T,e.V.L);break;case"enum":l=n.int32();break;case"message":l=e.V.T().internalBinaryRead(n,n.uint32(),r);break}break;default:throw new Error(`Unknown field ${f} (wire type ${m}) in map entry for ${this.info.typeName}#${e.name}`)}}if(o===void 0){let f=S0(e.K);o=e.K==fe.BOOL?f.toString():f}if(l===void 0)switch(e.V.kind){case"scalar":l=S0(e.V.T,e.V.L);break;case"enum":l=0;break;case"message":l=e.V.T().create();break}return[o,l]}scalar(e,n,r){switch(n){case fe.INT32:return e.int32();case fe.STRING:return e.string();case fe.BOOL:return e.bool();case fe.DOUBLE:return e.double();case fe.FLOAT:return e.float();case fe.INT64:return js(e.int64(),r);case fe.UINT64:return js(e.uint64(),r);case fe.FIXED64:return js(e.fixed64(),r);case fe.FIXED32:return e.fixed32();case fe.BYTES:return e.bytes();case fe.UINT32:return e.uint32();case fe.SFIXED32:return e.sfixed32();case fe.SFIXED64:return js(e.sfixed64(),r);case fe.SINT32:return e.sint32();case fe.SINT64:return js(e.sint64(),r)}}}class wZ{constructor(e){this.info=e}prepare(){if(!this.fields){const e=this.info.fields?this.info.fields.concat():[];this.fields=e.sort((n,r)=>n.no-r.no)}}write(e,n,r){this.prepare();for(const i of this.fields){let o,l,f=i.repeat,m=i.localName;if(i.oneof){const S=e[i.oneof];if(S.oneofKind!==m)continue;o=S[m],l=!0}else o=e[m],l=!1;switch(i.kind){case"scalar":case"enum":let S=i.kind=="enum"?fe.INT32:i.T;if(f)if(Vt(Array.isArray(o)),f==Sg.PACKED)this.packed(n,S,i.no,o);else for(const N of o)this.scalar(n,S,i.no,N,!0);else o===void 0?Vt(i.opt):this.scalar(n,S,i.no,o,l||i.opt);break;case"message":if(f){Vt(Array.isArray(o));for(const N of o)this.message(n,r,i.T(),i.no,N)}else this.message(n,r,i.T(),i.no,o);break;case"map":Vt(typeof o=="object"&&o!==null);for(const[N,O]of Object.entries(o))this.mapEntry(n,r,i,N,O);break}}let s=r.writeUnknownFields;s!==!1&&(s===!0?gg.onWrite:s)(this.info.typeName,e,n)}mapEntry(e,n,r,s,i){e.tag(r.no,In.LengthDelimited),e.fork();let o=s;switch(r.K){case fe.INT32:case fe.FIXED32:case fe.UINT32:case fe.SFIXED32:case fe.SINT32:o=Number.parseInt(s);break;case fe.BOOL:Vt(s=="true"||s=="false"),o=s=="true";break}switch(this.scalar(e,r.K,1,o,!0),r.V.kind){case"scalar":this.scalar(e,r.V.T,2,i,!0);break;case"enum":this.scalar(e,fe.INT32,2,i,!0);break;case"message":this.message(e,n,r.V.T(),2,i);break}e.join()}message(e,n,r,s,i){i!==void 0&&(r.internalBinaryWrite(i,e.tag(s,In.LengthDelimited).fork(),n),e.join())}scalar(e,n,r,s,i){let[o,l,f]=this.scalarInfo(n,s);(!f||i)&&(e.tag(r,o),e[l](s))}packed(e,n,r,s){if(!s.length)return;Vt(n!==fe.BYTES&&n!==fe.STRING),e.tag(r,In.LengthDelimited),e.fork();let[,i]=this.scalarInfo(n);for(let o=0;o<s.length;o++)e[i](s[o]);e.join()}scalarInfo(e,n){let r=In.Varint,s,i=n===void 0,o=n===0;switch(e){case fe.INT32:s="int32";break;case fe.STRING:o=i||!n.length,r=In.LengthDelimited,s="string";break;case fe.BOOL:o=n===!1,s="bool";break;case fe.UINT32:s="uint32";break;case fe.DOUBLE:r=In.Bit64,s="double";break;case fe.FLOAT:r=In.Bit32,s="float";break;case fe.INT64:o=i||Tn.from(n).isZero(),s="int64";break;case fe.UINT64:o=i||vr.from(n).isZero(),s="uint64";break;case fe.FIXED64:o=i||vr.from(n).isZero(),r=In.Bit64,s="fixed64";break;case fe.BYTES:o=i||!n.byteLength,r=In.LengthDelimited,s="bytes";break;case fe.FIXED32:r=In.Bit32,s="fixed32";break;case fe.SFIXED32:r=In.Bit32,s="sfixed32";break;case fe.SFIXED64:o=i||Tn.from(n).isZero(),r=In.Bit64,s="sfixed64";break;case fe.SINT32:s="sint32";break;case fe.SINT64:o=i||Tn.from(n).isZero(),s="sint64";break}return[r,s,i||o]}}function SZ(t){const e=t.messagePrototype?Object.create(t.messagePrototype):Object.defineProperty({},mA,{value:t});for(let n of t.fields){let r=n.localName;if(!n.opt)if(n.oneof)e[n.oneof]={oneofKind:void 0};else if(n.repeat)e[r]=[];else switch(n.kind){case"scalar":e[r]=S0(n.T,n.L);break;case"enum":e[r]=0;break;case"map":e[r]={};break}}return e}function E0(t,e,n){let r,s=n,i;for(let o of t.fields){let l=o.localName;if(o.oneof){const f=s[o.oneof];if((f==null?void 0:f.oneofKind)==null)continue;if(r=f[l],i=e[o.oneof],i.oneofKind=f.oneofKind,r==null){delete i[l];continue}}else if(r=s[l],i=e,r==null)continue;switch(o.repeat&&(i[l].length=r.length),o.kind){case"scalar":case"enum":if(o.repeat)for(let m=0;m<r.length;m++)i[l][m]=r[m];else i[l]=r;break;case"message":let f=o.T();if(o.repeat)for(let m=0;m<r.length;m++)i[l][m]=f.create(r[m]);else i[l]===void 0?i[l]=f.create(r):f.mergePartial(i[l],r);break;case"map":switch(o.V.kind){case"scalar":case"enum":Object.assign(i[l],r);break;case"message":let m=o.V.T();for(let S of Object.keys(r))i[l][S]=m.create(r[S]);break}break}}}function EZ(t,e,n){if(e===n)return!0;if(!e||!n)return!1;for(let r of t.fields){let s=r.localName,i=r.oneof?e[r.oneof][s]:e[s],o=r.oneof?n[r.oneof][s]:n[s];switch(r.kind){case"enum":case"scalar":let l=r.kind=="enum"?fe.INT32:r.T;if(!(r.repeat?yA(l,i,o):_A(l,i,o)))return!1;break;case"map":if(!(r.V.kind=="message"?bA(r.V.T(),Eg(i),Eg(o)):yA(r.V.kind=="enum"?fe.INT32:r.V.T,Eg(i),Eg(o))))return!1;break;case"message":let f=r.T();if(!(r.repeat?bA(f,i,o):f.equals(i,o)))return!1;break}}return!0}const Eg=Object.values;function _A(t,e,n){if(e===n)return!0;if(t!==fe.BYTES)return!1;let r=e,s=n;if(r.length!==s.length)return!1;for(let i=0;i<r.length;i++)if(r[i]!=s[i])return!1;return!0}function yA(t,e,n){if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(!_A(t,e[r],n[r]))return!1;return!0}function bA(t,e,n){if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(!t.equals(e[r],n[r]))return!1;return!0}const vZ=Object.getOwnPropertyDescriptors(Object.getPrototypeOf({}));class vg{constructor(e,n,r){this.defaultCheckDepth=16,this.typeName=e,this.fields=n.map(pZ),this.options=r??{},this.messagePrototype=Object.create(null,Object.assign(Object.assign({},vZ),{[mA]:{value:this}})),this.refTypeCheck=new gZ(this),this.refJsonReader=new _Z(this),this.refJsonWriter=new yZ(this),this.refBinReader=new bZ(this),this.refBinWriter=new wZ(this)}create(e){let n=SZ(this);return e!==void 0&&E0(this,n,e),n}clone(e){let n=this.create();return E0(this,n,e),n}equals(e,n){return EZ(this,e,n)}is(e,n=this.defaultCheckDepth){return this.refTypeCheck.is(e,n,!1)}isAssignable(e,n=this.defaultCheckDepth){return this.refTypeCheck.is(e,n,!0)}mergePartial(e,n){E0(this,e,n)}fromBinary(e,n){let r=iZ(n);return this.internalBinaryRead(r.readerFactory(e),e.byteLength,r)}fromJson(e,n){return this.internalJsonRead(e,dZ(n))}fromJsonString(e,n){let r=JSON.parse(e);return this.fromJson(r,n)}toJson(e,n){return this.internalJsonWrite(e,hZ(n))}toJsonString(e,n){var r;let s=this.toJson(e,n);return JSON.stringify(s,null,(r=n==null?void 0:n.prettySpaces)!==null&&r!==void 0?r:0)}toBinary(e,n){let r=fZ(n);return this.internalBinaryWrite(e,r.writerFactory(),r).finish()}internalJsonRead(e,n,r){if(e!==null&&typeof e=="object"&&!Array.isArray(e)){let s=r??this.create();return this.refJsonReader.read(e,s,n),s}throw new Error(`Unable to parse message ${this.typeName} from JSON ${rA(e)}.`)}internalJsonWrite(e,n){return this.refJsonWriter.write(e,n)}internalBinaryWrite(e,n,r){return this.refBinWriter.write(e,n,r),n}internalBinaryRead(e,n,r,s){let i=s??this.create();return this.refBinReader.read(e,i,r,n),i}}class NZ extends vg{constructor(){super("SyncRequest",[{no:1,name:"messages",kind:"message",repeat:1,T:()=>wA},{no:2,name:"userId",kind:"scalar",T:9},{no:3,name:"nodeId",kind:"scalar",T:9},{no:4,name:"merkleTree",kind:"scalar",T:9}])}}const kZ=new NZ;class xZ extends vg{constructor(){super("SyncResponse",[{no:1,name:"messages",kind:"message",repeat:1,T:()=>wA},{no:2,name:"merkleTree",kind:"scalar",T:9}])}}const qZ=new xZ;class OZ extends vg{constructor(){super("EncryptedMessage",[{no:1,name:"timestamp",kind:"scalar",T:9},{no:2,name:"content",kind:"scalar",T:12}])}}const wA=new OZ;class IZ extends vg{constructor(){super("MessageContent",[{no:1,name:"table",kind:"scalar",T:9},{no:2,name:"row",kind:"scalar",T:9},{no:3,name:"column",kind:"scalar",T:9},{no:4,name:"stringValue",kind:"scalar",oneof:"value",T:9},{no:5,name:"numberValue",kind:"scalar",oneof:"value",T:9},{no:6,name:"bytesValue",kind:"scalar",oneof:"value",T:12},{no:7,name:"jsonValue",kind:"scalar",oneof:"value",T:9}])}}const SA=new IZ,v0=xr("Sync"),TZ={_tag:"SyncStateInitial"};class EA extends Ai("SyncFactory")(){}Wt(function*(){const t=Ns().pipe(zt(uu,yield*uu)),e=yield*Bi();return v0.of({init:n=>Br(["Sync init",{owner:n}]).pipe(on(Wo(e,t.pipe(zt(KS,n))))),sync:({merkleTree:n,timestamp:r,messages:s})=>Wt(function*(){yield*Br(["Sync request",{merkleTree:n,timestamp:r,messages:s}]);const i=yield*uu,o=yield*KS,l=yield*Ko;return yield*Wr(s||[],({timestamp:f,...m})=>Me(i.seal(o.encryptionKey,AZ(m)),S=>({timestamp:f,content:S}))).pipe(Me(f=>kZ.toBinary({messages:f,userId:o.id,nodeId:r.node,merkleTree:WS(n)},vA)),Te(f=>Wt(function*(){const m=(yield*JX).pipe(GX);return yield*YX(l.syncUrl).pipe(XX(f,"application/x-protobuf"),m.execute,Te(S=>S.arrayBuffer),ud)}).pipe(ci(HX))),Me(f=>qZ.fromBinary(new Uint8Array(f),NA)),Te(f=>Wr(f.messages,m=>Me(i.open(o.encryptionKey,m.content),S=>[S,m.timestamp])).pipe(Me(Zc(([m,S])=>df(FZ(m),N=>({...N,timestamp:S})))),Me(m=>({messages:m,merkleTree:j9(f.merkleTree)})),on(m=>Br(["Sync response",m])))),Xl("RequestError",()=>dr({_tag:"SyncStateIsNotSynced",error:{_tag:"NetworkError"}})),Xl("ResponseError",({response:{status:f}})=>{switch(f){case 402:return dr({_tag:"SyncStateIsNotSynced",error:{_tag:"PaymentRequiredError"}});default:return dr({_tag:"SyncStateIsNotSynced",error:{_tag:"ServerError",status:f}})}}))}).pipe(i=>Te(Qn(e),o=>ci(i,o)))})});const AZ=({value:t,...e})=>XI(N0,SA.toBinary({value:CZ(t),...e},vA)),N0=new Uint8Array([0,1]),CZ=t=>{switch(typeof t){case"string":return{oneofKind:"stringValue",stringValue:t};case"number":return{oneofKind:"numberValue",numberValue:RJ(HI)(t)}}return t==null?{oneofKind:void 0}:zc(t)?{oneofKind:"bytesValue",bytesValue:t}:{oneofKind:"jsonValue",jsonValue:JSON.stringify(t)}},vA={writerFactory:()=>new dA({encode:t=>new TextEncoder().encode(t)})},NA={readerFactory:t=>new uA(t,{decode:e=>new TextDecoder().decode(e)})},FZ=t=>{if(!RZ(t,N0))return ce();const{value:e,...n}=SA.fromBinary(t.slice(N0.length),NA);return de({value:PZ(e),...n})},RZ=(t,e)=>{if(e.length>t.length)return!1;for(let n=0;n<e.length;n++)if(t[n]!==e[n])return!1;return!0},PZ=t=>{switch(t.oneofKind){case"numberValue":return pd(HI)(t.numberValue);case"stringValue":return t.stringValue;case"bytesValue":return t.bytesValue;case"jsonValue":return JSON.parse(t.jsonValue);case void 0:return null;default:return U_()}};yd({name:pi,sql:pi});class k0 extends Ai("DbFactory")(){}const $Z=Wt(function*(){const{createSqlite:t}=yield*fc,{createSync:e}=yield*EA,n=Ns().pipe(zt(Ws,yield*Ws),zt(ea,yield*ea),zt(ig,yield*ig)),r=yield*Bi(),s=l=>f=>Te(Qn(r),m=>Te(Jn,S=>S.transaction(l.transaction)(f)).pipe(ci(m))),i=yield*V9(new Map);return{init:(l,f,m,S,N,O)=>Wt(function*(){yield*Br(["Db init",{schema:l}]);const M=yield*t,z=zt(n,Jn,M),Z=yield*Td.pipe(on(Ng(l)),Te(ee=>ee.tables.map(ve=>ve.name).includes("evolu_owner")?MZ:kA(O).pipe(on(xA(f)))),M.transaction("exclusive"),ci(z)),J=yield*e.pipe(ci(n));return yield*J.init(Z),oD(r,Tt(z.pipe(zt(KS,Z),zt(v0,J),zt(x0,{onError:m,onSyncStateChange:S,onReceive:N})))),Z}),loadQueries:l=>Br(["Db loadQueries",{queries:l}]).pipe(an(q0(l,i)),s({transaction:"shared"})),mutate:(l,f)=>Wt(function*(){yield*Br(["Db mutate",{mutations:l,queriesToRefresh:f}]);const m=yield*ea,S=yield*Jn,[N,O]=yR(l,M=>M.table.startsWith("_"));for(const M of O)if(T0(M).some(({column:Z,value:J})=>Z==="isDeleted"&&J===1))yield*S.exec({sql:`delete from "${M.table}" where "id" = ?;`,parameters:[M.id]});else{const Z=T0(M);for(const J of Z){const ee=yield*m.now;yield*OA(J,Z,ee)}}return N.length>0&&(yield*on(xA(N),AA)),yield*q0(f,i)}).pipe(s({transaction:"exclusive"})),resetOwner:()=>rr("Db resetOwner").pipe(on(TA),s({transaction:"last"})),restoreOwner:(l,f)=>rr("Db restoreOwner").pipe(on(TA),on(Te(Td,Ng(l))),on(kA(f)),s({transaction:"last"})),ensureSchema:l=>Td.pipe(Te(Ng(l)),s({transaction:"exclusive"})),sync:l=>Br(["Db sync",{queriesToRefresh:l}]).pipe(an(AA()),an(q0(l,i)),s({transaction:"shared"})),exportDatabase:()=>rr("Db exportDatabase").pipe(an(Jn),Te(l=>l.export()),s({transaction:"exclusive"}))}}),x0=xr("Callbacks"),q0=(t,e)=>Wt(function*(){const n=yield*Jn,r=yield*Q9(e,i=>Me(Wr(t,o=>{const l=CA(o);return n.exec(l).pipe(on(LZ(l)),Me(({rows:f})=>[o,f]))}),o=>new Map([...i,...o]))),s=yield*K9(e);return t.map(i=>({query:i,patches:J9(r.get(i),s.get(i)||[])}))}),LZ=t=>{var e;return(e=t.options)!=null&&e.logExplainQueryPlan?Jn.pipe(Te(n=>n.exec({...t,sql:`EXPLAIN QUERY PLAN ${t.sql}`})),on(BS("ExplainQueryPlan",t)),on(({rows:n})=>BS(rG(n))),Me(bo)):Dt},Td=Wt(function*(t){yield*rr("Db getSchema");const e=yield*Jn,n=yield*Me(e.exec({sql:`
select
  sqlite_master.name as tableName,
  table_info.name as columnName
from
  sqlite_master
  join pragma_table_info(sqlite_master.name) as table_info
    `.trim()}),({rows:s})=>{const i=new Map;return s.forEach(o=>{var m;const{tableName:l,columnName:f}=o;i.has(l)||i.set(l,[]),(m=i.get(l))==null||m.push(f)}),globalThis.Array.from(i,([o,l])=>({name:o,columns:l}))}),r=yield*Me(e.exec({sql:`
select
  name, sql
from
  sqlite_master
where
  type='index' and
  name not like 'sqlite_%' and
  name not like 'index_evolu_%'
`.trim()}),s=>xs(s.rows,i=>({name:i.name,sql:i.sql.replace("CREATE INDEX","create index")})));return{tables:n,indexes:r}}),Ng=t=>e=>Wt(function*(){yield*rr("Db ensureSchema");const n=[];t.tables.forEach(r=>{const s=e.tables.find(i=>i.name===r.name);s?cy(pq)(r.columns,s.columns).forEach(i=>{n.push(`alter table "${r.name}" add column "${i}" blob;`)}):n.push(`
  create table ${r.name} (
    "id" text primary key,
    ${r.columns.filter(i=>i!=="id").map(i=>`"${i}" blob`).join(", ")}
  );`.trim())}),cy(O0)(e.indexes,bv(O0)(e.indexes,t.indexes)).forEach(r=>{n.push(`drop index "${r.name}";`)}),cy(O0)(t.indexes,e.indexes).forEach(r=>{n.push(`${r.sql};`)}),n.length>0&&(yield*(yield*Jn).exec({sql:n.join(`
`)}))}),O0=(t,e)=>t.name===e.name&&t.sql===e.sql,MZ=rr("Db readOwner").pipe(an(Jn),Te(t=>t.exec(cG)),Me(({rows:[t]})=>({id:t.id,mnemonic:t.mnemonic,encryptionKey:t.encryptionKey}))),kA=t=>rr("Db createOwner").pipe(an(Om([iG(t),Jn,P9])),on(([e,n,r])=>Om([n.exec(lG),n.exec(uG),n.exec(fG),n.exec({...dG,parameters:[e.id,e.mnemonic,e.encryptionKey,wd(r),WS(DS)]})])),Me(([e])=>e)),xA=t=>Wt(function*(e){const{timestamp:n,merkleTree:r}=yield*I0,[s,i]=yield*qO(t.flatMap(T0),n,(l,f)=>Me($9(l),m=>{const S={...f,timestamp:wd(m)};return[m,S]})),o=yield*qA(r,i);return yield*IA(s,o),i}),I0=Jn.pipe(Te(t=>t.exec(hG)),Me(({rows:[{timestamp:t,merkleTree:e}]})=>({timestamp:MS(t),merkleTree:e}))),T0=t=>I(Object.entries(t.values),Zc(([e,n])=>n===void 0||t.isInsert&&n==null?ce():de([e,n])),xs(([e,n])=>({table:t.table,row:t.id,column:e,value:typeof n=="boolean"||n instanceof Date?VS(n):n}))),qA=(t,e)=>Wt(function*(){const n=yield*Jn;for(const r of e){const s=MS(r.timestamp),i=yield*Me(n.exec({...pG,parameters:[r.table,r.row,r.column,1]}),({rows:o})=>o.length>0?o[0].timestamp:null);if((i==null||i<r.timestamp)&&(yield*OA(r,e,s.millis)),i==null||i!==r.timestamp){const{changes:o}=yield*n.exec({...mG,parameters:[r.timestamp,r.table,r.row,r.column,r.value]});o===1&&(t=W9(t,s))}}return t}),OA=(t,e,n)=>Jn.pipe(Me(r=>{const s=VS(new Date(n));return r.exec({sql:`
    insert into
      "${t.table}" ("id", "${t.column}", "createdAt", "updatedAt")
    values
      (?, ?, ?, ?)
    on conflict do update set
      "${t.column}" = ?,
      "updatedAt" = ?
        `.trim(),parameters:[t.row,t.value,s,s,t.value,s]})}),Te(r=>EO(r,s=>FJ(DZ)(s)?de(WZ(e).pipe(an(r))):ce()))),DZ=yd({message:GJ(pi.pipe(NS("no such table")),pi.pipe(NS("no such column")),pi.pipe(NS("has no column")))}),WZ=t=>Wt(function*(){const e=new Map;t.forEach(r=>{const s=e.get(r.table);if(s==null){e.set(r.table,{name:r.table,columns:[r.column,"createdAt","updatedAt"]});return}s.columns.includes(r.column)||e.set(r.table,{name:r.table,columns:s.columns.concat(r.column)})});const n=bt(e.values());yield*Te(Td,Ng({tables:n,indexes:[]}))}),IA=(t,e)=>Te(Jn,n=>n.exec({...gG,parameters:[WS(e),wd(t)]})),TA=Wt(function*(){yield*rr("Db dropAllTables");const t=yield*Jn,e=yield*Td;yield*Wr(e.tables,n=>t.exec({sql:`drop table "${n.name}"`}))}),AA=(t=[])=>ig.pipe(Te(e=>e.tryAcquire),sS({onFailure:()=>Dt,onSuccess:()=>BZ(t)}),ud,Fm),BZ=(t=[])=>Wt(function*(e){const n=yield*Jn,r=yield*v0,s=yield*x0,i=yield*ea,o=yield*I0.pipe(n.transaction("shared"),Me(l=>({...l,messages:t})),Te(Ll));s.onSyncStateChange({_tag:"SyncStateIsSyncing"}),yield*zp(o).pipe(Te(r.sync),Te(UZ),$m({schedule:z9(50),until:Nn({onNone:()=>Wt(function*(){return s.onSyncStateChange({_tag:"SyncStateIsSynced",time:yield*i.now}),!0}),onSome:l=>Wt(function*(){return yield*cW(o,l),!1})})}),Tm(l=>dr(E1(jS(l)))),Xl("SyncStateIsNotSynced",l=>Tt(s.onSyncStateChange(l))),ic(l=>Tt(s.onError(l))))}),UZ=t=>Te(Jn,e=>Wt(function*(n){const{onReceive:r}=yield*x0,s=yield*I0,i=yield*bO(t.messages,s.timestamp,(l,f)=>L9({local:l,remote:MS(f.timestamp)})),o=yield*qA(s.merkleTree,t.messages);return t.messages.length>0&&(yield*IA(i,o),r()),yield*U9(t.merkleTree,o).pipe(Te(l=>e.exec({..._G,parameters:[wd(R9(l))]})),Me(({rows:l})=>({messages:l,merkleTree:o,timestamp:i})),PO)}).pipe(e.transaction("exclusive"))),jZ=({sql:t,parameters:e=[],options:n})=>{const r={sql:t,parameters:e.map(s=>zc(s)?bt(s):v1(s)?{json:s}:s),...n&&{options:n}};return JSON.stringify(r)},CA=t=>{const e=JSON.parse(t);return{...e,parameters:e.parameters.map(n=>Yc(n)?new Uint8Array(n):typeof n=="object"&&n!=null?n.json:n)}},zZ=[],A0=()=>zZ,FA=new WeakMap,RA=t=>{let e=FA.get(t);return e==null&&(e={rows:t,row:t[0]},FA.set(t,e)),e};function ra(t){return typeof t>"u"||t===void 0}function ns(t){return typeof t=="string"}function kg(t){return typeof t=="number"}function xg(t){return typeof t=="boolean"}function C0(t){return t===null}function VZ(t){return t instanceof Date}function F0(t){return typeof t=="bigint"}function rs(t){return typeof t=="function"}function yi(t){return typeof t=="object"&&t!==null}function E(t){return Object.freeze(t)}function qg(t){return ro(t)?t:[t]}function ro(t){return Array.isArray(t)}function sa(t){return t}const en=E({is(t){return t.kind==="AlterTableNode"},create(t){return E({kind:"AlterTableNode",table:t})},cloneWithTableProps(t,e){return E({...t,...e})},cloneWithColumnAlteration(t,e){return E({...t,columnAlterations:t.columnAlterations?[...t.columnAlterations,e]:[e]})}}),kn=E({is(t){return t.kind==="IdentifierNode"},create(t){return E({kind:"IdentifierNode",name:t})}}),so=E({is(t){return t.kind==="CreateIndexNode"},create(t){return E({kind:"CreateIndexNode",name:kn.create(t)})},cloneWith(t,e){return E({...t,...e})},cloneWithColumns(t,e){return E({...t,columns:[...t.columns||[],...e]})}}),PA=E({is(t){return t.kind==="CreateSchemaNode"},create(t,e){return E({kind:"CreateSchemaNode",schema:kn.create(t),...e})},cloneWith(t,e){return E({...t,...e})}}),KZ=["preserve rows","delete rows","drop"],ss=E({is(t){return t.kind==="CreateTableNode"},create(t){return E({kind:"CreateTableNode",table:t,columns:E([])})},cloneWithColumn(t,e){return E({...t,columns:E([...t.columns,e])})},cloneWithConstraint(t,e){return E({...t,constraints:t.constraints?E([...t.constraints,e]):E([e])})},cloneWithFrontModifier(t,e){return E({...t,frontModifiers:t.frontModifiers?E([...t.frontModifiers,e]):E([e])})},cloneWithEndModifier(t,e){return E({...t,endModifiers:t.endModifiers?E([...t.endModifiers,e]):E([e])})},cloneWith(t,e){return E({...t,...e})}}),ia=E({is(t){return t.kind==="SchemableIdentifierNode"},create(t){return E({kind:"SchemableIdentifierNode",identifier:kn.create(t)})},createWithSchema(t,e){return E({kind:"SchemableIdentifierNode",schema:kn.create(t),identifier:kn.create(e)})}}),Ad=E({is(t){return t.kind==="DropIndexNode"},create(t,e){return E({kind:"DropIndexNode",name:ia.create(t),...e})},cloneWith(t,e){return E({...t,...e})}}),R0=E({is(t){return t.kind==="DropSchemaNode"},create(t,e){return E({kind:"DropSchemaNode",schema:kn.create(t),...e})},cloneWith(t,e){return E({...t,...e})}}),P0=E({is(t){return t.kind==="DropTableNode"},create(t,e){return E({kind:"DropTableNode",table:t,...e})},cloneWith(t,e){return E({...t,...e})}}),_c=E({is(t){return t.kind==="AliasNode"},create(t,e){return E({kind:"AliasNode",node:t,alias:e})}}),oa=E({is(t){return t.kind==="TableNode"},create(t){return E({kind:"TableNode",table:ia.create(t)})},createWithSchema(t,e){return E({kind:"TableNode",table:ia.createWithSchema(t,e)})}});function Ss(t){return yi(t)&&rs(t.toOperationNode)}function QZ(t){return yi(t)&&"expressionType"in t&&Ss(t)}function HZ(t){return yi(t)&&"expression"in t&&ns(t.alias)&&Ss(t)}const io=E({is(t){return t.kind==="SelectModifierNode"},create(t,e){return E({kind:"SelectModifierNode",modifier:t,of:e})},createWithExpression(t){return E({kind:"SelectModifierNode",rawModifier:t})}}),aa=E({is(t){return t.kind==="AndNode"},create(t,e){return E({kind:"AndNode",left:t,right:e})}}),bu=E({is(t){return t.kind==="OrNode"},create(t,e){return E({kind:"OrNode",left:t,right:e})}}),$0=E({is(t){return t.kind==="OnNode"},create(t){return E({kind:"OnNode",on:t})},cloneWithOperation(t,e,n){return E({...t,on:e==="And"?aa.create(t.on,n):bu.create(t.on,n)})}}),Cd=E({is(t){return t.kind==="JoinNode"},create(t,e){return E({kind:"JoinNode",joinType:t,table:e,on:void 0})},createWithOn(t,e,n){return E({kind:"JoinNode",joinType:t,table:e,on:$0.create(n)})},cloneWithOn(t,e){return E({...t,on:t.on?$0.cloneWithOperation(t.on,"And",e):$0.create(e)})}}),wu=E({is(t){return t.kind==="BinaryOperationNode"},create(t,e,n){return E({kind:"BinaryOperationNode",leftOperand:t,operator:e,rightOperand:n})}}),JZ=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","^@","&&","?","?&","?|","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp","is distinct from","is not distinct from"],GZ=["+","-","*","/","%","^","&","|","#","<<",">>"],$A=["->","->>"],YZ=[...JZ,...GZ,"&&","||"],XZ=["not","-",...["exists","not exists"]],ZZ=[...YZ,...$A,...XZ,"between","between symmetric"],ca=E({is(t){return t.kind==="OperatorNode"},create(t){return E({kind:"OperatorNode",operator:t})}});function LA(t){return ns(t)&&$A.includes(t)}const An=E({is(t){return t.kind==="ColumnNode"},create(t){return E({kind:"ColumnNode",column:kn.create(t)})}}),L0=E({is(t){return t.kind==="SelectAllNode"},create(){return E({kind:"SelectAllNode"})}}),Og=E({is(t){return t.kind==="ReferenceNode"},create(t,e){return E({kind:"ReferenceNode",table:e,column:t})},createSelectAll(t){return E({kind:"ReferenceNode",table:t,column:L0.create()})}});class eee{constructor(e){ae(this,Au,void 0);Ee(this,Au,e)}get dynamicReference(){return a(this,Au)}get refType(){}toOperationNode(){return UA(a(this,Au))}}Au=new WeakMap;function MA(t){return yi(t)&&Ss(t)&&ns(t.dynamicReference)}const M0=E({is(t){return t.kind==="OrderByItemNode"},create(t,e){return E({kind:"OrderByItemNode",orderBy:t,direction:e})}}),la=E({is(t){return t.kind==="RawNode"},create(t,e){return E({kind:"RawNode",sqlFragments:E(t),parameters:E(e)})},createWithSql(t){return la.create([t],[])},createWithChild(t){return la.create(["",""],[t])},createWithChildren(t){return la.create(new Array(t.length+1).fill(""),t)}});function DA(t){return t==="asc"||t==="desc"}function Ig(t){if(t.length===2)return[D0(t[0],t[1])];if(t.length===1){const[e]=t;return Array.isArray(e)?e.map(n=>D0(n)):[D0(e)]}throw new Error(`Invalid number of arguments at order by! expected 1-2, received ${t.length}`)}function D0(t,e){const n=tee(t);if(M0.is(n)){if(e)throw new Error("Cannot specify direction twice!");return n}return M0.create(n,WA(e))}function tee(t){if(zd(t))return Sc(t);if(MA(t))return t.toOperationNode();const[e,n]=t.split(" ");if(n){if(!DA(n))throw new Error(`Invalid order by direction: ${n}`);return M0.create(ua(e),WA(n))}return ua(t)}function WA(t){if(t)return t==="asc"||t==="desc"?la.createWithSql(t):t.toOperationNode()}const Tg=E({is(t){return t.kind==="JSONReferenceNode"},create(t,e){return E({kind:"JSONReferenceNode",reference:t,traversal:e})},cloneWithTraversal(t,e){return E({...t,traversal:e})}}),BA=E({is(t){return t.kind==="JSONOperatorChainNode"},create(t){return E({kind:"JSONOperatorChainNode",operator:t,values:E([])})},cloneWithValue(t,e){return E({...t,values:E([...t.values,e])})}}),Fd=E({is(t){return t.kind==="JSONPathNode"},create(t){return E({kind:"JSONPathNode",inOperator:t,pathLegs:E([])})},cloneWithLeg(t,e){return E({...t,pathLegs:E([...t.pathLegs,e])})}});function UA(t){return ns(t)?ua(t):t.toOperationNode()}function Rd(t){return ro(t)?t.map(e=>is(e)):[is(t)]}function is(t){return zd(t)?Sc(t):UA(t)}function nee(t,e){const n=ua(t);if(LA(e))return Tg.create(n,BA.create(ca.create(e)));const r=e.slice(0,-1);if(LA(r))return Tg.create(n,Fd.create(ca.create(r)));throw new Error(`Invalid JSON operator: ${e}`)}function ua(t){const e=".";if(!t.includes(e))return Og.create(An.create(t));const n=t.split(e).map(W0);if(n.length===3)return see(n);if(n.length===2)return iee(n);throw new Error(`invalid column reference ${t}`)}function ree(t){const e=" as ";if(t.includes(e)){const[n,r]=t.split(e).map(W0);return _c.create(ua(n),kn.create(r))}else return ua(t)}function jA(t){return An.create(t)}function Ag(t){const e=" ";if(t.includes(e)){const[n,r]=t.split(e).map(W0);if(!DA(r))throw new Error(`invalid order direction "${r}" next to "${n}"`);return Ig([n,r])[0]}else return jA(t)}function see(t){const[e,n,r]=t;return Og.create(An.create(r),oa.createWithSchema(e,n))}function iee(t){const[e,n]=t;return Og.create(An.create(n),oa.create(e))}function W0(t){return t.trim()}const zA=E({is(t){return t.kind==="PrimitiveValueListNode"},create(t){return E({kind:"PrimitiveValueListNode",values:E([...t])})}}),B0=E({is(t){return t.kind==="ValueListNode"},create(t){return E({kind:"ValueListNode",values:E(t)})}}),oo=E({is(t){return t.kind==="ValueNode"},create(t){return E({kind:"ValueNode",value:t})},createImmediate(t){return E({kind:"ValueNode",value:t,immediate:!0})}});function oee(t){return ro(t)?aee(t):or(t)}function or(t){return zd(t)?Sc(t):oo.create(t)}function U0(t){return kg(t)||xg(t)||C0(t)}function j0(t){if(!U0(t))throw new Error(`unsafe immediate value ${JSON.stringify(t)}`);return oo.createImmediate(t)}function aee(t){return t.some(zd)?B0.create(t.map(e=>or(e))):zA.create(t)}const Su=E({is(t){return t.kind==="ParensNode"},create(t){return E({kind:"ParensNode",node:t})}});function gr(t){if(t.length===3)return z0(t[0],t[1],t[2]);if(t.length===1)return or(t[0]);throw new Error(`invalid arguments: ${JSON.stringify(t)}`)}function z0(t,e,n){return cee(e)&&KA(n)?wu.create(is(t),V0(e),oo.createImmediate(n)):wu.create(is(t),V0(e),oee(n))}function bi(t,e,n){return wu.create(is(t),V0(e),is(n))}function VA(t,e){return Cg(Object.entries(t).filter(([,n])=>!ra(n)).map(([n,r])=>z0(n,KA(r)?"is":"=",r)),e)}function Cg(t,e,n=!0){const r=e==="and"?aa.create:bu.create;if(t.length===0)return wu.create(oo.createImmediate(1),ca.create("="),oo.createImmediate(e==="and"?1:0));let s=QA(t[0]);for(let i=1;i<t.length;++i)s=r(s,QA(t[i]));return t.length>1&&n?Su.create(s):s}function cee(t){return t==="is"||t==="is not"}function KA(t){return C0(t)||xg(t)}function V0(t){if(ns(t)&&ZZ.includes(t))return ca.create(t);if(Ss(t))return t.toOperationNode();throw new Error(`invalid operator ${JSON.stringify(t)}`)}function QA(t){return Ss(t)?t.toOperationNode():t}const Eu=E({is(t){return t.kind==="OrderByNode"},create(t){return E({kind:"OrderByNode",items:E([...t])})},cloneWithItems(t,e){return E({...t,items:E([...t.items,...e])})}}),HA=E({is(t){return t.kind==="PartitionByNode"},create(t){return E({kind:"PartitionByNode",items:E(t)})},cloneWithItems(t,e){return E({...t,items:E([...t.items,...e])})}}),K0=E({is(t){return t.kind==="OverNode"},create(){return E({kind:"OverNode"})},cloneWithOrderByItems(t,e){return E({...t,orderBy:t.orderBy?Eu.cloneWithItems(t.orderBy,e):Eu.create(e)})},cloneWithPartitionByItems(t,e){return E({...t,partitionBy:t.partitionBy?HA.cloneWithItems(t.partitionBy,e):HA.create(e)})}}),Fg=E({is(t){return t.kind==="FromNode"},create(t){return E({kind:"FromNode",froms:E(t)})},cloneWithFroms(t,e){return E({...t,froms:E([...t.froms,...e])})}}),JA=E({is(t){return t.kind==="GroupByNode"},create(t){return E({kind:"GroupByNode",items:E(t)})},cloneWithItems(t,e){return E({...t,items:E([...t.items,...e])})}}),GA=E({is(t){return t.kind==="HavingNode"},create(t){return E({kind:"HavingNode",having:t})},cloneWithOperation(t,e,n){return E({...t,having:e==="And"?aa.create(t.having,n):bu.create(t.having,n)})}}),Pt=E({is(t){return t.kind==="SelectQueryNode"},create(t){return E({kind:"SelectQueryNode",...t&&{with:t}})},createFrom(t,e){return E({kind:"SelectQueryNode",from:Fg.create(t),...e&&{with:e}})},cloneWithSelections(t,e){return E({...t,selections:t.selections?E([...t.selections,...e]):E(e)})},cloneWithDistinctOn(t,e){return E({...t,distinctOn:t.distinctOn?E([...t.distinctOn,...e]):E(e)})},cloneWithFrontModifier(t,e){return E({...t,frontModifiers:t.frontModifiers?E([...t.frontModifiers,e]):E([e])})},cloneWithEndModifier(t,e){return E({...t,endModifiers:t.endModifiers?E([...t.endModifiers,e]):E([e])})},cloneWithOrderByItems(t,e){return E({...t,orderBy:t.orderBy?Eu.cloneWithItems(t.orderBy,e):Eu.create(e)})},cloneWithGroupByItems(t,e){return E({...t,groupBy:t.groupBy?JA.cloneWithItems(t.groupBy,e):JA.create(e)})},cloneWithLimit(t,e){return E({...t,limit:e})},cloneWithOffset(t,e){return E({...t,offset:e})},cloneWithFetch(t,e){return E({...t,fetch:e})},cloneWithHaving(t,e){return E({...t,having:t.having?GA.cloneWithOperation(t.having,"And",e):GA.create(e)})},cloneWithSetOperations(t,e){return E({...t,setOperations:t.setOperations?E([...t.setOperations,...e]):E([...e])})},cloneWithoutSelections(t){return E({...t,selections:[]})},cloneWithoutLimit(t){return E({...t,limit:void 0})},cloneWithoutOffset(t){return E({...t,offset:void 0})},cloneWithoutOrderBy(t){return E({...t,orderBy:void 0})},cloneWithoutGroupBy(t){return E({...t,groupBy:void 0})}});function xt(t,e){Object.defineProperties(t.prototype,{then:{enumerable:!1,value:()=>{throw new Error(e)}}})}const Xd=class Xd{constructor(e){ae(this,Vs,void 0);Ee(this,Vs,E(e))}on(...e){return new Xd({...a(this,Vs),joinNode:Cd.cloneWithOn(a(this,Vs).joinNode,gr(e))})}onRef(e,n,r){return new Xd({...a(this,Vs),joinNode:Cd.cloneWithOn(a(this,Vs).joinNode,bi(e,n,r))})}onTrue(){return new Xd({...a(this,Vs),joinNode:Cd.cloneWithOn(a(this,Vs).joinNode,la.createWithSql("true"))})}$call(e){return e(this)}toOperationNode(){return a(this,Vs).joinNode}};Vs=new WeakMap;let Rg=Xd;xt(Rg,"don't await JoinBuilder instances. They are never executed directly and are always just a part of a query.");const lee=E({is(t){return t.kind==="PartitionByItemNode"},create(t){return E({kind:"PartitionByItemNode",partitionBy:t})}});function uee(t){return Rd(t).map(lee.create)}const m_=class m_{constructor(e){ae(this,Nc,void 0);Ee(this,Nc,E(e))}orderBy(e,n){return new m_({overNode:K0.cloneWithOrderByItems(a(this,Nc).overNode,Ig([e,n]))})}partitionBy(e){return new m_({overNode:K0.cloneWithPartitionByItems(a(this,Nc).overNode,uee(e))})}$call(e){return e(this)}toOperationNode(){return a(this,Nc).overNode}};Nc=new WeakMap;let Pg=m_;xt(Pg,"don't await OverBuilder instances. They are never executed directly and are always just a part of a query.");const Pd=E({is(t){return t.kind==="SelectionNode"},create(t){return E({kind:"SelectionNode",selection:t})},createSelectAll(){return E({kind:"SelectionNode",selection:L0.create()})},createSelectAllFromTable(t){return E({kind:"SelectionNode",selection:Og.createSelectAll(t)})}});function zs(t){return rs(t)?zs(t(Ou())):ro(t)?t.map(e=>YA(e)):[YA(t)]}function YA(t){return ns(t)?Pd.create(ree(t)):MA(t)?Pd.create(t.toOperationNode()):Pd.create(NC(t))}function wi(t){return t?Array.isArray(t)?t.map(XA):[XA(t)]:[Pd.createSelectAll()]}function XA(t){if(ns(t))return Pd.createSelectAllFromTable(Wn(t));throw new Error(`invalid value selectAll expression: ${JSON.stringify(t)}`)}const fee=E({is(t){return t.kind==="ValuesNode"},create(t){return E({kind:"ValuesNode",values:E(t)})}}),dee=E({is(t){return t.kind==="DefaultInsertValueNode"},create(){return E({kind:"DefaultInsertValueNode"})}});function ZA(t){const e=rs(t)?t(Ou()):t,n=ro(e)?e:E([e]);return hee(n)}function hee(t){const e=pee(t);return[E([...e.keys()].map(An.create)),fee.create(t.map(n=>mee(n,e)))]}function pee(t){const e=new Map;for(const n of t){const r=Object.keys(n);for(const s of r)!e.has(s)&&n[s]!==void 0&&e.set(s,e.size)}return e}function mee(t,e){const n=Object.keys(t),r=Array.from({length:e.size});let s=!1;for(const o of n){const l=e.get(o);if(ra(l))continue;const f=t[o];(ra(f)||zd(f))&&(s=!0),r[l]=f}if(n.length<e.size||s){const o=dee.create();return B0.create(r.map(l=>ra(l)?o:or(l)))}return zA.create(r)}const os=E({is(t){return t.kind==="InsertQueryNode"},create(t,e,n){return E({kind:"InsertQueryNode",into:t,...e&&{with:e},replace:n})},createWithoutInto(){return E({kind:"InsertQueryNode"})},cloneWith(t,e){return E({...t,...e})}}),vu=E({is(t){return t.kind==="UpdateQueryNode"},create(t,e){return E({kind:"UpdateQueryNode",table:t,...e&&{with:e}})},createWithoutTable(){return E({kind:"UpdateQueryNode"})},cloneWithFromItems(t,e){return E({...t,from:t.from?Fg.cloneWithFroms(t.from,e):Fg.create(e)})},cloneWithUpdates(t,e){return E({...t,updates:t.updates?E([...t.updates,...e]):e})},cloneWithLimit(t,e){return E({...t,limit:e})}}),eC=E({is(t){return t.kind==="UsingNode"},create(t){return E({kind:"UsingNode",tables:E(t)})},cloneWithTables(t,e){return E({...t,tables:E([...t.tables,...e])})}}),yc=E({is(t){return t.kind==="DeleteQueryNode"},create(t,e){return E({kind:"DeleteQueryNode",from:Fg.create(t),...e&&{with:e}})},cloneWithOrderByItems(t,e){return E({...t,orderBy:t.orderBy?Eu.cloneWithItems(t.orderBy,e):Eu.create(e)})},cloneWithoutOrderBy(t){return E({...t,orderBy:void 0})},cloneWithLimit(t,e){return E({...t,limit:e})},cloneWithoutLimit(t){return E({...t,limit:void 0})},cloneWithUsing(t,e){return E({...t,using:t.using!==void 0?eC.cloneWithTables(t.using,e):eC.create(e)})}}),Vr=E({is(t){return t.kind==="WhereNode"},create(t){return E({kind:"WhereNode",where:t})},cloneWithOperation(t,e,n){return E({...t,where:e==="And"?aa.create(t.where,n):bu.create(t.where,n)})}}),tC=E({is(t){return t.kind==="ReturningNode"},create(t){return E({kind:"ReturningNode",selections:E(t)})},cloneWithSelections(t,e){return E({...t,selections:t.selections?E([...t.selections,...e]):E(e)})}}),gee=E({is(t){return t.kind==="ExplainNode"},create(t,e){return E({kind:"ExplainNode",format:t,options:e})}}),$d=E({is(t){return t.kind==="WhenNode"},create(t){return E({kind:"WhenNode",condition:t})},cloneWithResult(t,e){return E({...t,result:e})}}),Kr=E({is(t){return t.kind==="MergeQueryNode"},create(t,e){return E({kind:"MergeQueryNode",into:t,...e&&{with:e}})},cloneWithUsing(t,e){return E({...t,using:e})},cloneWithWhen(t,e){return E({...t,whens:t.whens?E([...t.whens,e]):E([e])})},cloneWithThen(t,e){return E({...t,whens:t.whens?E([...t.whens.slice(0,-1),$d.cloneWithResult(t.whens[t.whens.length-1],e)]):void 0})}}),nC=E({is(t){return t.kind==="OutputNode"},create(t){return E({kind:"OutputNode",selections:E(t)})},cloneWithSelections(t,e){return E({...t,selections:t.selections?E([...t.selections,...e]):E(e)})}}),tt=E({is(t){return Pt.is(t)||os.is(t)||vu.is(t)||yc.is(t)||Kr.is(t)},cloneWithWhere(t,e){return E({...t,where:t.where?Vr.cloneWithOperation(t.where,"And",e):Vr.create(e)})},cloneWithJoin(t,e){return E({...t,joins:t.joins?E([...t.joins,e]):E([e])})},cloneWithReturning(t,e){return E({...t,returning:t.returning?tC.cloneWithSelections(t.returning,e):tC.create(e)})},cloneWithoutReturning(t){return E({...t,returning:void 0})},cloneWithoutWhere(t){return E({...t,where:void 0})},cloneWithExplain(t,e,n){return E({...t,explain:gee.create(e,n==null?void 0:n.toOperationNode())})},cloneWithTop(t,e){return E({...t,top:e})},cloneWithOutput(t,e){return E({...t,output:t.output?nC.cloneWithSelections(t.output,e):nC.create(e)})}}),rC=E({is(t){return t.kind==="ColumnUpdateNode"},create(t,e){return E({kind:"ColumnUpdateNode",column:t,value:e})}});function _ee(...t){return t.length===2?[rC.create(is(t[0]),or(t[1]))]:Q0(t[0])}function Q0(t){const e=rs(t)?t(Ou()):t;return Object.entries(e).filter(([n,r])=>r!==void 0).map(([n,r])=>rC.create(An.create(n),or(r)))}const yee=E({is(t){return t.kind==="OnDuplicateKeyNode"},create(t){return E({kind:"OnDuplicateKeyNode",updates:t})}});class bee{constructor(e,n){g(this,"insertId");g(this,"numInsertedOrUpdatedRows");this.insertId=e,this.numInsertedOrUpdatedRows=n}}class Ld extends Error{constructor(n){super("no result");g(this,"node");this.node=n}}function Md(t){return Object.prototype.hasOwnProperty.call(t,"prototype")}const as=E({is(t){return t.kind==="OnConflictNode"},create(){return E({kind:"OnConflictNode"})},cloneWith(t,e){return E({...t,...e})},cloneWithIndexWhere(t,e){return E({...t,indexWhere:t.indexWhere?Vr.cloneWithOperation(t.indexWhere,"And",e):Vr.create(e)})},cloneWithIndexOrWhere(t,e){return E({...t,indexWhere:t.indexWhere?Vr.cloneWithOperation(t.indexWhere,"Or",e):Vr.create(e)})},cloneWithUpdateWhere(t,e){return E({...t,updateWhere:t.updateWhere?Vr.cloneWithOperation(t.updateWhere,"And",e):Vr.create(e)})},cloneWithUpdateOrWhere(t,e){return E({...t,updateWhere:t.updateWhere?Vr.cloneWithOperation(t.updateWhere,"Or",e):Vr.create(e)})},cloneWithoutIndexWhere(t){return E({...t,indexWhere:void 0})},cloneWithoutUpdateWhere(t){return E({...t,updateWhere:void 0})}}),co=class co{constructor(e){ae(this,un,void 0);Ee(this,un,E(e))}column(e){const n=An.create(e);return new co({...a(this,un),onConflictNode:as.cloneWith(a(this,un).onConflictNode,{columns:a(this,un).onConflictNode.columns?E([...a(this,un).onConflictNode.columns,n]):E([n])})})}columns(e){const n=e.map(An.create);return new co({...a(this,un),onConflictNode:as.cloneWith(a(this,un).onConflictNode,{columns:a(this,un).onConflictNode.columns?E([...a(this,un).onConflictNode.columns,...n]):E(n)})})}constraint(e){return new co({...a(this,un),onConflictNode:as.cloneWith(a(this,un).onConflictNode,{constraint:kn.create(e)})})}expression(e){return new co({...a(this,un),onConflictNode:as.cloneWith(a(this,un).onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new co({...a(this,un),onConflictNode:as.cloneWithIndexWhere(a(this,un).onConflictNode,gr(e))})}whereRef(e,n,r){return new co({...a(this,un),onConflictNode:as.cloneWithIndexWhere(a(this,un).onConflictNode,bi(e,n,r))})}clearWhere(){return new co({...a(this,un),onConflictNode:as.cloneWithoutIndexWhere(a(this,un).onConflictNode)})}doNothing(){return new sC({...a(this,un),onConflictNode:as.cloneWith(a(this,un).onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new Lg({...a(this,un),onConflictNode:as.cloneWith(a(this,un).onConflictNode,{updates:Q0(e)})})}$call(e){return e(this)}};un=new WeakMap;let $g=co;xt($g,"don't await OnConflictBuilder instances.");class sC{constructor(e){ae(this,Zd,void 0);Ee(this,Zd,E(e))}toOperationNode(){return a(this,Zd).onConflictNode}}Zd=new WeakMap,xt(sC,"don't await OnConflictDoNothingBuilder instances.");const eh=class eh{constructor(e){ae(this,Ks,void 0);Ee(this,Ks,E(e))}where(...e){return new eh({...a(this,Ks),onConflictNode:as.cloneWithUpdateWhere(a(this,Ks).onConflictNode,gr(e))})}whereRef(e,n,r){return new eh({...a(this,Ks),onConflictNode:as.cloneWithUpdateWhere(a(this,Ks).onConflictNode,bi(e,n,r))})}clearWhere(){return new eh({...a(this,Ks),onConflictNode:as.cloneWithoutUpdateWhere(a(this,Ks).onConflictNode)})}$call(e){return e(this)}toOperationNode(){return a(this,Ks).onConflictNode}};Ks=new WeakMap;let Lg=eh;xt(Lg,"don't await OnConflictUpdateBuilder instances.");const wee=E({is(t){return t.kind==="TopNode"},create(t,e){return E({kind:"TopNode",expression:t,modifiers:e})}});function Nu(t,e){if(!kg(t)&&!F0(t))throw new Error(`Invalid top expression: ${t}`);if(!ra(e)&&!See(e))throw new Error(`Invalid top modifiers: ${e}`);return wee.create(t,e)}function See(t){return t==="percent"||t==="with ties"||t==="percent with ties"}const Cn=class Cn{constructor(e){ae(this,ct,void 0);Ee(this,ct,E(e))}values(e){const[n,r]=ZA(e);return new Cn({...a(this,ct),queryNode:os.cloneWith(a(this,ct).queryNode,{columns:n,values:r})})}columns(e){return new Cn({...a(this,ct),queryNode:os.cloneWith(a(this,ct).queryNode,{columns:E(e.map(An.create))})})}expression(e){return new Cn({...a(this,ct),queryNode:os.cloneWith(a(this,ct).queryNode,{values:Sc(e)})})}defaultValues(){return new Cn({...a(this,ct),queryNode:os.cloneWith(a(this,ct).queryNode,{defaultValues:!0})})}ignore(){return new Cn({...a(this,ct),queryNode:os.cloneWith(a(this,ct).queryNode,{ignore:!0})})}top(e,n){return new Cn({...a(this,ct),queryNode:tt.cloneWithTop(a(this,ct).queryNode,Nu(e,n))})}onConflict(e){return new Cn({...a(this,ct),queryNode:os.cloneWith(a(this,ct).queryNode,{onConflict:e(new $g({onConflictNode:as.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new Cn({...a(this,ct),queryNode:os.cloneWith(a(this,ct).queryNode,{onDuplicateKey:yee.create(Q0(e))})})}returning(e){return new Cn({...a(this,ct),queryNode:tt.cloneWithReturning(a(this,ct).queryNode,zs(e))})}returningAll(){return new Cn({...a(this,ct),queryNode:tt.cloneWithReturning(a(this,ct).queryNode,wi())})}output(e){return new Cn({...a(this,ct),queryNode:tt.cloneWithOutput(a(this,ct).queryNode,zs(e))})}outputAll(e){return new Cn({...a(this,ct),queryNode:tt.cloneWithOutput(a(this,ct).queryNode,wi(e))})}clearReturning(){return new Cn({...a(this,ct),queryNode:tt.cloneWithoutReturning(a(this,ct).queryNode)})}$call(e){return e(this)}$if(e,n){return e?n(this):new Cn({...a(this,ct)})}$castTo(){return new Cn(a(this,ct))}$narrowType(){return new Cn(a(this,ct))}$assertType(){return new Cn(a(this,ct))}withPlugin(e){return new Cn({...a(this,ct),executor:a(this,ct).executor.withPlugin(e)})}toOperationNode(){return a(this,ct).executor.transformQuery(a(this,ct).queryNode,a(this,ct).queryId)}compile(){return a(this,ct).executor.compileQuery(this.toOperationNode(),a(this,ct).queryId)}async execute(){const e=this.compile(),n=await a(this,ct).executor.executeQuery(e,a(this,ct).queryId),{adapter:r}=a(this,ct).executor,s=e.query;return s.returning&&r.supportsReturning||s.output&&r.supportsOutput?n.rows:[new bee(n.insertId,n.numAffectedRows??n.numUpdatedOrDeletedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Ld){const n=await this.executeTakeFirst();if(n===void 0)throw Md(e)?new e(this.toOperationNode()):e(this.toOperationNode());return n}async*stream(e=100){const n=this.compile(),r=a(this,ct).executor.stream(n,e,a(this,ct).queryId);for await(const s of r)yield*s.rows}async explain(e,n){return await new Cn({...a(this,ct),queryNode:tt.cloneWithExplain(a(this,ct).queryNode,e,n)}).execute()}};ct=new WeakMap;let Dd=Cn;xt(Dd,"don't await InsertQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class Eee{constructor(e){g(this,"numDeletedRows");this.numDeletedRows=e}}const H0=E({is(t){return t.kind==="LimitNode"},create(t){return E({kind:"LimitNode",limit:t})}}),fn=class fn{constructor(e){ae(this,Ye,void 0);Ee(this,Ye,E(e))}where(...e){return new fn({...a(this,Ye),queryNode:tt.cloneWithWhere(a(this,Ye).queryNode,gr(e))})}whereRef(e,n,r){return new fn({...a(this,Ye),queryNode:tt.cloneWithWhere(a(this,Ye).queryNode,bi(e,n,r))})}clearWhere(){return new fn({...a(this,Ye),queryNode:tt.cloneWithoutWhere(a(this,Ye).queryNode)})}top(e,n){return new fn({...a(this,Ye),queryNode:tt.cloneWithTop(a(this,Ye).queryNode,Nu(e,n))})}using(e){return new fn({...a(this,Ye),queryNode:yc.cloneWithUsing(a(this,Ye).queryNode,Vd(e))})}innerJoin(...e){return new fn({...a(this,Ye),queryNode:tt.cloneWithJoin(a(this,Ye).queryNode,Cr("InnerJoin",e))})}leftJoin(...e){return new fn({...a(this,Ye),queryNode:tt.cloneWithJoin(a(this,Ye).queryNode,Cr("LeftJoin",e))})}rightJoin(...e){return new fn({...a(this,Ye),queryNode:tt.cloneWithJoin(a(this,Ye).queryNode,Cr("RightJoin",e))})}fullJoin(...e){return new fn({...a(this,Ye),queryNode:tt.cloneWithJoin(a(this,Ye).queryNode,Cr("FullJoin",e))})}returning(e){return new fn({...a(this,Ye),queryNode:tt.cloneWithReturning(a(this,Ye).queryNode,zs(e))})}returningAll(e){return new fn({...a(this,Ye),queryNode:tt.cloneWithReturning(a(this,Ye).queryNode,wi(e))})}output(e){return new fn({...a(this,Ye),queryNode:tt.cloneWithOutput(a(this,Ye).queryNode,zs(e))})}outputAll(e){return new fn({...a(this,Ye),queryNode:tt.cloneWithOutput(a(this,Ye).queryNode,wi(e))})}clearReturning(){return new fn({...a(this,Ye),queryNode:tt.cloneWithoutReturning(a(this,Ye).queryNode)})}clearLimit(){return new fn({...a(this,Ye),queryNode:yc.cloneWithoutLimit(a(this,Ye).queryNode)})}clearOrderBy(){return new fn({...a(this,Ye),queryNode:yc.cloneWithoutOrderBy(a(this,Ye).queryNode)})}orderBy(e,n){return new fn({...a(this,Ye),queryNode:yc.cloneWithOrderByItems(a(this,Ye).queryNode,Ig([e,n]))})}limit(e){return new fn({...a(this,Ye),queryNode:yc.cloneWithLimit(a(this,Ye).queryNode,H0.create(or(e)))})}$call(e){return e(this)}$if(e,n){return e?n(this):new fn({...a(this,Ye)})}$castTo(){return new fn(a(this,Ye))}$narrowType(){return new fn(a(this,Ye))}$assertType(){return new fn(a(this,Ye))}withPlugin(e){return new fn({...a(this,Ye),executor:a(this,Ye).executor.withPlugin(e)})}toOperationNode(){return a(this,Ye).executor.transformQuery(a(this,Ye).queryNode,a(this,Ye).queryId)}compile(){return a(this,Ye).executor.compileQuery(this.toOperationNode(),a(this,Ye).queryId)}async execute(){const e=this.compile(),n=await a(this,Ye).executor.executeQuery(e,a(this,Ye).queryId),{adapter:r}=a(this,Ye).executor,s=e.query;return s.returning&&r.supportsReturning||s.output&&r.supportsOutput?n.rows:[new Eee(n.numAffectedRows??n.numUpdatedOrDeletedRows??BigInt(0))]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Ld){const n=await this.executeTakeFirst();if(n===void 0)throw Md(e)?new e(this.toOperationNode()):e(this.toOperationNode());return n}async*stream(e=100){const n=this.compile(),r=a(this,Ye).executor.stream(n,e,a(this,Ye).queryId);for await(const s of r)yield*s.rows}async explain(e,n){return await new fn({...a(this,Ye),queryNode:tt.cloneWithExplain(a(this,Ye).queryNode,e,n)}).execute()}};Ye=new WeakMap;let Mg=fn;xt(Mg,"don't await DeleteQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class vee{constructor(e,n){g(this,"numUpdatedRows");g(this,"numChangedRows");this.numUpdatedRows=e,this.numChangedRows=n}}const yn=class yn{constructor(e){ae(this,rt,void 0);Ee(this,rt,E(e))}where(...e){return new yn({...a(this,rt),queryNode:tt.cloneWithWhere(a(this,rt).queryNode,gr(e))})}whereRef(e,n,r){return new yn({...a(this,rt),queryNode:tt.cloneWithWhere(a(this,rt).queryNode,bi(e,n,r))})}clearWhere(){return new yn({...a(this,rt),queryNode:tt.cloneWithoutWhere(a(this,rt).queryNode)})}top(e,n){return new yn({...a(this,rt),queryNode:tt.cloneWithTop(a(this,rt).queryNode,Nu(e,n))})}from(e){return new yn({...a(this,rt),queryNode:vu.cloneWithFromItems(a(this,rt).queryNode,Vd(e))})}innerJoin(...e){return new yn({...a(this,rt),queryNode:tt.cloneWithJoin(a(this,rt).queryNode,Cr("InnerJoin",e))})}leftJoin(...e){return new yn({...a(this,rt),queryNode:tt.cloneWithJoin(a(this,rt).queryNode,Cr("LeftJoin",e))})}rightJoin(...e){return new yn({...a(this,rt),queryNode:tt.cloneWithJoin(a(this,rt).queryNode,Cr("RightJoin",e))})}fullJoin(...e){return new yn({...a(this,rt),queryNode:tt.cloneWithJoin(a(this,rt).queryNode,Cr("FullJoin",e))})}limit(e){return new yn({...a(this,rt),queryNode:vu.cloneWithLimit(a(this,rt).queryNode,H0.create(or(e)))})}set(...e){return new yn({...a(this,rt),queryNode:vu.cloneWithUpdates(a(this,rt).queryNode,_ee(...e))})}returning(e){return new yn({...a(this,rt),queryNode:tt.cloneWithReturning(a(this,rt).queryNode,zs(e))})}returningAll(e){return new yn({...a(this,rt),queryNode:tt.cloneWithReturning(a(this,rt).queryNode,wi(e))})}output(e){return new yn({...a(this,rt),queryNode:tt.cloneWithOutput(a(this,rt).queryNode,zs(e))})}outputAll(e){return new yn({...a(this,rt),queryNode:tt.cloneWithOutput(a(this,rt).queryNode,wi(e))})}clearReturning(){return new yn({...a(this,rt),queryNode:tt.cloneWithoutReturning(a(this,rt).queryNode)})}$call(e){return e(this)}$if(e,n){return e?n(this):new yn({...a(this,rt)})}$castTo(){return new yn(a(this,rt))}$narrowType(){return new yn(a(this,rt))}$assertType(){return new yn(a(this,rt))}withPlugin(e){return new yn({...a(this,rt),executor:a(this,rt).executor.withPlugin(e)})}toOperationNode(){return a(this,rt).executor.transformQuery(a(this,rt).queryNode,a(this,rt).queryId)}compile(){return a(this,rt).executor.compileQuery(this.toOperationNode(),a(this,rt).queryId)}async execute(){const e=this.compile(),n=await a(this,rt).executor.executeQuery(e,a(this,rt).queryId),{adapter:r}=a(this,rt).executor,s=e.query;return s.returning&&r.supportsReturning||s.output&&r.supportsOutput?n.rows:[new vee(n.numAffectedRows??n.numUpdatedOrDeletedRows??BigInt(0),n.numChangedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Ld){const n=await this.executeTakeFirst();if(n===void 0)throw Md(e)?new e(this.toOperationNode()):e(this.toOperationNode());return n}async*stream(e=100){const n=this.compile(),r=a(this,rt).executor.stream(n,e,a(this,rt).queryId);for await(const s of r)yield*s.rows}async explain(e,n){return await new yn({...a(this,rt),queryNode:tt.cloneWithExplain(a(this,rt).queryNode,e,n)}).execute()}};rt=new WeakMap;let Wd=yn;xt(Wd,"don't await UpdateQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");const iC=E({is(t){return t.kind==="CommonTableExpressionNameNode"},create(t,e){return E({kind:"CommonTableExpressionNameNode",table:oa.create(t),columns:e?E(e.map(An.create)):void 0})}}),Dg=E({is(t){return t.kind==="CommonTableExpressionNode"},create(t,e){return E({kind:"CommonTableExpressionNode",name:t,expression:e})},cloneWith(t,e){return E({...t,...e})}}),g_=class g_{constructor(e){ae(this,lo,void 0);Ee(this,lo,E(e))}materialized(){return new g_({...a(this,lo),node:Dg.cloneWith(a(this,lo).node,{materialized:!0})})}notMaterialized(){return new g_({...a(this,lo),node:Dg.cloneWith(a(this,lo).node,{materialized:!1})})}toOperationNode(){return a(this,lo).node}};lo=new WeakMap;let Wg=g_;xt(Wg,"don't await CTEBuilder instances. They are never executed directly and are always just a part of a query.");function oC(t,e){const n=e(Pee()).toOperationNode();return rs(t)?t(Nee(n)).toOperationNode():Dg.create(aC(t),n)}function Nee(t){return e=>new Wg({node:Dg.create(aC(e),t)})}function aC(t){if(t.includes("(")){const e=t.split(/[\(\)]/),n=e[0],r=e[1].split(",").map(s=>s.trim());return iC.create(n,r)}else return iC.create(t)}const Bg=E({is(t){return t.kind==="WithNode"},create(t,e){return E({kind:"WithNode",expressions:E([t]),...e})},cloneWithExpression(t,e){return E({...t,expressions:E([...t.expressions,e])})}}),cC=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function kee(t){let e="";for(let n=0;n<t;++n)e+=xee();return e}function xee(){return cC[~~(Math.random()*cC.length)]}function Dn(){return new qee}class qee{constructor(){ae(this,Cu,void 0)}get queryId(){return a(this,Cu)===void 0&&Ee(this,Cu,kee(8)),a(this,Cu)}}Cu=new WeakMap;function Uie(t){return t}class lC{constructor(){g(this,"nodeStack",[]);ae(this,__,E({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this),MergeQueryNode:this.transformMergeQuery.bind(this),MatchedNode:this.transformMatched.bind(this),AddIndexNode:this.transformAddIndex.bind(this),CastNode:this.transformCast.bind(this),FetchNode:this.transformFetch.bind(this),TopNode:this.transformTop.bind(this),OutputNode:this.transformOutput.bind(this)}))}transformNode(e){if(!e)return e;this.nodeStack.push(e);const n=this.transformNodeImpl(e);return this.nodeStack.pop(),E(n)}transformNodeImpl(e){return a(this,__)[e.kind](e)}transformNodeList(e){return e&&E(e.map(n=>this.transformNode(n)))}transformSelectQuery(e){return{kind:"SelectQueryNode",from:this.transformNode(e.from),selections:this.transformNodeList(e.selections),distinctOn:this.transformNodeList(e.distinctOn),joins:this.transformNodeList(e.joins),groupBy:this.transformNode(e.groupBy),orderBy:this.transformNode(e.orderBy),where:this.transformNode(e.where),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),limit:this.transformNode(e.limit),offset:this.transformNode(e.offset),with:this.transformNode(e.with),having:this.transformNode(e.having),explain:this.transformNode(e.explain),setOperations:this.transformNodeList(e.setOperations),fetch:this.transformNode(e.fetch),top:this.transformNode(e.top)}}transformSelection(e){return{kind:"SelectionNode",selection:this.transformNode(e.selection)}}transformColumn(e){return{kind:"ColumnNode",column:this.transformNode(e.column)}}transformAlias(e){return{kind:"AliasNode",node:this.transformNode(e.node),alias:this.transformNode(e.alias)}}transformTable(e){return{kind:"TableNode",table:this.transformNode(e.table)}}transformFrom(e){return{kind:"FromNode",froms:this.transformNodeList(e.froms)}}transformReference(e){return{kind:"ReferenceNode",column:this.transformNode(e.column),table:this.transformNode(e.table)}}transformAnd(e){return{kind:"AndNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformOr(e){return{kind:"OrNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformValueList(e){return{kind:"ValueListNode",values:this.transformNodeList(e.values)}}transformParens(e){return{kind:"ParensNode",node:this.transformNode(e.node)}}transformJoin(e){return{kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table),on:this.transformNode(e.on)}}transformRaw(e){return{kind:"RawNode",sqlFragments:E([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters)}}transformWhere(e){return{kind:"WhereNode",where:this.transformNode(e.where)}}transformInsertQuery(e){return{kind:"InsertQueryNode",into:this.transformNode(e.into),columns:this.transformNodeList(e.columns),values:this.transformNode(e.values),returning:this.transformNode(e.returning),onConflict:this.transformNode(e.onConflict),onDuplicateKey:this.transformNode(e.onDuplicateKey),with:this.transformNode(e.with),ignore:e.ignore,replace:e.replace,explain:this.transformNode(e.explain),defaultValues:e.defaultValues,top:this.transformNode(e.top),output:this.transformNode(e.output)}}transformValues(e){return{kind:"ValuesNode",values:this.transformNodeList(e.values)}}transformDeleteQuery(e){return{kind:"DeleteQueryNode",from:this.transformNode(e.from),using:this.transformNode(e.using),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),returning:this.transformNode(e.returning),with:this.transformNode(e.with),orderBy:this.transformNode(e.orderBy),limit:this.transformNode(e.limit),explain:this.transformNode(e.explain),top:this.transformNode(e.top),output:this.transformNode(e.output)}}transformReturning(e){return{kind:"ReturningNode",selections:this.transformNodeList(e.selections)}}transformCreateTable(e){return{kind:"CreateTableNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),constraints:this.transformNodeList(e.constraints),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit,frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),selectQuery:this.transformNode(e.selectQuery)}}transformColumnDefinition(e){return{kind:"ColumnDefinitionNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),references:this.transformNode(e.references),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo),check:this.transformNode(e.check),generated:this.transformNode(e.generated),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),nullsNotDistinct:e.nullsNotDistinct,identity:e.identity,ifNotExists:e.ifNotExists}}transformAddColumn(e){return{kind:"AddColumnNode",column:this.transformNode(e.column)}}transformDropTable(e){return{kind:"DropTableNode",table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformOrderBy(e){return{kind:"OrderByNode",items:this.transformNodeList(e.items)}}transformOrderByItem(e){return{kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy),direction:this.transformNode(e.direction)}}transformGroupBy(e){return{kind:"GroupByNode",items:this.transformNodeList(e.items)}}transformGroupByItem(e){return{kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy)}}transformUpdateQuery(e){return{kind:"UpdateQueryNode",table:this.transformNode(e.table),from:this.transformNode(e.from),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),updates:this.transformNodeList(e.updates),returning:this.transformNode(e.returning),with:this.transformNode(e.with),explain:this.transformNode(e.explain),limit:this.transformNode(e.limit),top:this.transformNode(e.top),output:this.transformNode(e.output)}}transformColumnUpdate(e){return{kind:"ColumnUpdateNode",column:this.transformNode(e.column),value:this.transformNode(e.value)}}transformLimit(e){return{kind:"LimitNode",limit:this.transformNode(e.limit)}}transformOffset(e){return{kind:"OffsetNode",offset:this.transformNode(e.offset)}}transformOnConflict(e){return{kind:"OnConflictNode",columns:this.transformNodeList(e.columns),constraint:this.transformNode(e.constraint),indexExpression:this.transformNode(e.indexExpression),indexWhere:this.transformNode(e.indexWhere),updates:this.transformNodeList(e.updates),updateWhere:this.transformNode(e.updateWhere),doNothing:e.doNothing}}transformOnDuplicateKey(e){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates)}}transformCreateIndex(e){return{kind:"CreateIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists,where:this.transformNode(e.where),nullsNotDistinct:e.nullsNotDistinct}}transformList(e){return{kind:"ListNode",items:this.transformNodeList(e.items)}}transformDropIndex(e){return{kind:"DropIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformPrimaryKeyConstraint(e){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformUniqueConstraint(e){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name),nullsNotDistinct:e.nullsNotDistinct}}transformForeignKeyConstraint(e){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns),references:this.transformNode(e.references),name:this.transformNode(e.name),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformSetOperation(e){return{kind:"SetOperationNode",operator:e.operator,expression:this.transformNode(e.expression),all:e.all}}transformReferences(e){return{kind:"ReferencesNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformCheckConstraint(e){return{kind:"CheckConstraintNode",expression:this.transformNode(e.expression),name:this.transformNode(e.name)}}transformWith(e){return{kind:"WithNode",expressions:this.transformNodeList(e.expressions),recursive:e.recursive}}transformCommonTableExpression(e){return{kind:"CommonTableExpressionNode",name:this.transformNode(e.name),materialized:e.materialized,expression:this.transformNode(e.expression)}}transformCommonTableExpressionName(e){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns)}}transformHaving(e){return{kind:"HavingNode",having:this.transformNode(e.having)}}transformCreateSchema(e){return{kind:"CreateSchemaNode",schema:this.transformNode(e.schema),ifNotExists:e.ifNotExists}}transformDropSchema(e){return{kind:"DropSchemaNode",schema:this.transformNode(e.schema),ifExists:e.ifExists,cascade:e.cascade}}transformAlterTable(e){return{kind:"AlterTableNode",table:this.transformNode(e.table),renameTo:this.transformNode(e.renameTo),setSchema:this.transformNode(e.setSchema),columnAlterations:this.transformNodeList(e.columnAlterations),addConstraint:this.transformNode(e.addConstraint),dropConstraint:this.transformNode(e.dropConstraint),addIndex:this.transformNode(e.addIndex),dropIndex:this.transformNode(e.dropIndex)}}transformDropColumn(e){return{kind:"DropColumnNode",column:this.transformNode(e.column)}}transformRenameColumn(e){return{kind:"RenameColumnNode",column:this.transformNode(e.column),renameTo:this.transformNode(e.renameTo)}}transformAlterColumn(e){return{kind:"AlterColumnNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),dataTypeExpression:this.transformNode(e.dataTypeExpression),setDefault:this.transformNode(e.setDefault),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull}}transformModifyColumn(e){return{kind:"ModifyColumnNode",column:this.transformNode(e.column)}}transformAddConstraint(e){return{kind:"AddConstraintNode",constraint:this.transformNode(e.constraint)}}transformDropConstraint(e){return{kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName),ifExists:e.ifExists,modifier:e.modifier}}transformCreateView(e){return{kind:"CreateViewNode",name:this.transformNode(e.name),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns),as:this.transformNode(e.as)}}transformDropView(e){return{kind:"DropViewNode",name:this.transformNode(e.name),ifExists:e.ifExists,materialized:e.materialized,cascade:e.cascade}}transformGenerated(e){return{kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression)}}transformDefaultValue(e){return{kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue)}}transformOn(e){return{kind:"OnNode",on:this.transformNode(e.on)}}transformSelectModifier(e){return{kind:"SelectModifierNode",modifier:e.modifier,rawModifier:this.transformNode(e.rawModifier),of:this.transformNodeList(e.of)}}transformCreateType(e){return{kind:"CreateTypeNode",name:this.transformNode(e.name),enum:this.transformNode(e.enum)}}transformDropType(e){return{kind:"DropTypeNode",name:this.transformNode(e.name),ifExists:e.ifExists}}transformExplain(e){return{kind:"ExplainNode",format:e.format,options:this.transformNode(e.options)}}transformSchemableIdentifier(e){return{kind:"SchemableIdentifierNode",schema:this.transformNode(e.schema),identifier:this.transformNode(e.identifier)}}transformAggregateFunction(e){return{kind:"AggregateFunctionNode",aggregated:this.transformNodeList(e.aggregated),distinct:e.distinct,filter:this.transformNode(e.filter),func:e.func,over:this.transformNode(e.over)}}transformOver(e){return{kind:"OverNode",orderBy:this.transformNode(e.orderBy),partitionBy:this.transformNode(e.partitionBy)}}transformPartitionBy(e){return{kind:"PartitionByNode",items:this.transformNodeList(e.items)}}transformPartitionByItem(e){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(e.partitionBy)}}transformBinaryOperation(e){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(e.leftOperand),operator:this.transformNode(e.operator),rightOperand:this.transformNode(e.rightOperand)}}transformUnaryOperation(e){return{kind:"UnaryOperationNode",operator:this.transformNode(e.operator),operand:this.transformNode(e.operand)}}transformUsing(e){return{kind:"UsingNode",tables:this.transformNodeList(e.tables)}}transformFunction(e){return{kind:"FunctionNode",func:e.func,arguments:this.transformNodeList(e.arguments)}}transformCase(e){return{kind:"CaseNode",value:this.transformNode(e.value),when:this.transformNodeList(e.when),else:this.transformNode(e.else),isStatement:e.isStatement}}transformWhen(e){return{kind:"WhenNode",condition:this.transformNode(e.condition),result:this.transformNode(e.result)}}transformJSONReference(e){return{kind:"JSONReferenceNode",reference:this.transformNode(e.reference),traversal:this.transformNode(e.traversal)}}transformJSONPath(e){return{kind:"JSONPathNode",inOperator:this.transformNode(e.inOperator),pathLegs:this.transformNodeList(e.pathLegs)}}transformJSONPathLeg(e){return{kind:"JSONPathLegNode",type:e.type,value:e.value}}transformJSONOperatorChain(e){return{kind:"JSONOperatorChainNode",operator:this.transformNode(e.operator),values:this.transformNodeList(e.values)}}transformTuple(e){return{kind:"TupleNode",values:this.transformNodeList(e.values)}}transformMergeQuery(e){return{kind:"MergeQueryNode",into:this.transformNode(e.into),using:this.transformNode(e.using),whens:this.transformNodeList(e.whens),with:this.transformNode(e.with),top:this.transformNode(e.top),output:this.transformNode(e.output)}}transformMatched(e){return{kind:"MatchedNode",not:e.not,bySource:e.bySource}}transformAddIndex(e){return{kind:"AddIndexNode",name:this.transformNode(e.name),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists}}transformCast(e){return{kind:"CastNode",expression:this.transformNode(e.expression),dataType:this.transformNode(e.dataType)}}transformFetch(e){return{kind:"FetchNode",rowCount:this.transformNode(e.rowCount),modifier:e.modifier}}transformTop(e){return{kind:"TopNode",expression:e.expression,modifiers:e.modifiers}}transformOutput(e){return{kind:"OutputNode",selections:this.transformNodeList(e.selections)}}transformDataType(e){return e}transformSelectAll(e){return e}transformIdentifier(e){return e}transformValue(e){return e}transformPrimitiveValueList(e){return e}transformOperator(e){return e}transformDefaultInsertValue(e){return e}}__=new WeakMap;const Oee=E({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0,MergeQueryNode:!0});class Iee extends lC{constructor(n){super();ae(this,y_);ae(this,b_);ae(this,w_);ae(this,ma);ae(this,th);ae(this,S_);ae(this,Fu,void 0);ae(this,kc,new Set);ae(this,xc,new Set);Ee(this,Fu,n)}transformNodeImpl(n){if(!Lt(this,y_,uF).call(this,n))return super.transformNodeImpl(n);const r=Lt(this,w_,dF).call(this,n);for(const o of r)a(this,xc).add(o);const s=Lt(this,b_,fF).call(this,n);for(const o of s)a(this,kc).add(o);const i=super.transformNodeImpl(n);for(const o of s)a(this,kc).delete(o);for(const o of r)a(this,xc).delete(o);return i}transformSchemableIdentifier(n){const r=super.transformSchemableIdentifier(n);return r.schema||!a(this,kc).has(n.identifier.name)?r:{...r,schema:kn.create(a(this,Fu))}}transformReferences(n){const r=super.transformReferences(n);return r.table.table.schema?r:{...r,table:oa.createWithSchema(a(this,Fu),r.table.table.identifier.name)}}}Fu=new WeakMap,kc=new WeakMap,xc=new WeakMap,y_=new WeakSet,uF=function(n){return n.kind in Oee},b_=new WeakSet,fF=function(n){const r=new Set;if("name"in n&&n.name&&ia.is(n.name)&&Lt(this,th,xE).call(this,n.name,r),"from"in n&&n.from)for(const s of n.from.froms)Lt(this,ma,ef).call(this,s,r);if("into"in n&&n.into&&Lt(this,ma,ef).call(this,n.into,r),"table"in n&&n.table&&Lt(this,ma,ef).call(this,n.table,r),"joins"in n&&n.joins)for(const s of n.joins)Lt(this,ma,ef).call(this,s.table,r);return"using"in n&&n.using&&Lt(this,ma,ef).call(this,n.using,r),r},w_=new WeakSet,dF=function(n){const r=new Set;return"with"in n&&n.with&&Lt(this,S_,hF).call(this,n.with,r),r},ma=new WeakSet,ef=function(n,r){const s=oa.is(n)?n:_c.is(n)&&oa.is(n.node)?n.node:null;s&&Lt(this,th,xE).call(this,s.table,r)},th=new WeakSet,xE=function(n,r){const s=n.identifier.name;!a(this,kc).has(s)&&!a(this,xc).has(s)&&r.add(s)},S_=new WeakSet,hF=function(n,r){for(const s of n.expressions){const i=s.name.table.table.identifier.name;a(this,xc).has(i)||r.add(i)}};class Bd{constructor(e){ae(this,nh,void 0);Ee(this,nh,new Iee(e))}transformQuery(e){return a(this,nh).transformNode(e.node)}async transformResult(e){return e.result}}nh=new WeakMap;const Tee=E({is(t){return t.kind==="MatchedNode"},create(t,e=!1){return E({kind:"MatchedNode",not:t,bySource:e})}});function uC(t,e,n){return $d.create(Cg([Tee.create(!t.isMatched,t.bySource),...e&&e.length>0?[e.length===3&&n?bi(e[0],e[1],e[2]):gr(e)]:[]],"and",!1))}function Ud(t){return ns(t)?la.create([t],[]):Ss(t)?t.toOperationNode():t}class fC{constructor(){ae(this,rh,void 0);ae(this,Ru,void 0);ae(this,Pu,void 0);g(this,"resolve",e=>{a(this,Ru)&&a(this,Ru).call(this,e)});g(this,"reject",e=>{a(this,Pu)&&a(this,Pu).call(this,e)});Ee(this,rh,new Promise((e,n)=>{Ee(this,Pu,n),Ee(this,Ru,e)}))}get promise(){return a(this,rh)}}rh=new WeakMap,Ru=new WeakMap,Pu=new WeakMap;const dC=new Set;function Aee(t){dC.has(t)||(dC.add(t),console.log(t))}const Cee=E([]);class hC{constructor(e=Cee){ae(this,sh);ae(this,qc,void 0);Ee(this,qc,e)}get plugins(){return a(this,qc)}transformQuery(e,n){for(const r of a(this,qc)){const s=r.transformQuery({node:e,queryId:n});if(s.kind===e.kind)e=s;else throw new Error(["KyselyPlugin.transformQuery must return a node","of the same kind that was given to it.",`The plugin was given a ${e.kind}`,`but it returned a ${s.kind}`].join(" "))}return e}async executeQuery(e,n){return await this.provideConnection(async r=>{const s=await r.executeQuery(e),i=await Lt(this,sh,qE).call(this,s,n);return Fee(s,i),i})}async*stream(e,n,r){const s=new fC,i=new fC;this.provideConnection(async l=>(s.resolve(l),await i.promise)).catch(l=>s.reject(l));const o=await s.promise;try{for await(const l of o.streamQuery(e,n))yield await Lt(this,sh,qE).call(this,l,r)}finally{i.resolve()}}}qc=new WeakMap,sh=new WeakSet,qE=async function(e,n){for(const r of a(this,qc))e=await r.transformResult({result:e,queryId:n});return e};function Fee(t,e){const{numAffectedRows:n}=t;n===void 0&&t.numUpdatedOrDeletedRows===void 0||n!==void 0&&e.numAffectedRows!==void 0||Aee("kysely:warning: outdated driver/plugin detected! QueryResult.numUpdatedOrDeletedRows is deprecated and will be removed in a future release.")}class ku extends hC{get adapter(){throw new Error("this query cannot be compiled to SQL")}compileQuery(){throw new Error("this query cannot be compiled to SQL")}provideConnection(){throw new Error("this query cannot be executed")}withConnectionProvider(){throw new Error("this query cannot have a connection provider")}withPlugin(e){return new ku([...this.plugins,e])}withPlugins(e){return new ku([...this.plugins,...e])}withPluginAtFront(e){return new ku([e,...this.plugins])}withoutPlugins(){return new ku([])}}const J0=new ku;class Ree{constructor(e){g(this,"numChangedRows");this.numChangedRows=e}}const ih=class ih{constructor(e){ae(this,Es,void 0);Ee(this,Es,E(e))}top(e,n){return new ih({...a(this,Es),queryNode:tt.cloneWithTop(a(this,Es).queryNode,Nu(e,n))})}using(...e){return new ao({...a(this,Es),queryNode:Kr.cloneWithUsing(a(this,Es).queryNode,Cr("Using",e))})}output(e){return new ih({...a(this,Es),queryNode:tt.cloneWithOutput(a(this,Es).queryNode,zs(e))})}outputAll(e){return new ih({...a(this,Es),queryNode:tt.cloneWithOutput(a(this,Es).queryNode,wi(e))})}};Es=new WeakMap;let Ug=ih;xt(Ug,"don't await MergeQueryBuilder instances directly. To execute the query you need to call `execute` when available.");const Lu=class Lu{constructor(e){ae(this,$u);ae(this,uo);ae(this,Sn,void 0);Ee(this,Sn,E(e))}top(e,n){return new Lu({...a(this,Sn),queryNode:tt.cloneWithTop(a(this,Sn).queryNode,Nu(e,n))})}whenMatched(){return Lt(this,$u,W_).call(this,[])}whenMatchedAnd(...e){return Lt(this,$u,W_).call(this,e)}whenMatchedAndRef(e,n,r){return Lt(this,$u,W_).call(this,[e,n,r],!0)}whenNotMatched(){return Lt(this,uo,Wc).call(this,[])}whenNotMatchedAnd(...e){return Lt(this,uo,Wc).call(this,e)}whenNotMatchedAndRef(e,n,r){return Lt(this,uo,Wc).call(this,[e,n,r],!0)}whenNotMatchedBySource(){return Lt(this,uo,Wc).call(this,[],!1,!0)}whenNotMatchedBySourceAnd(...e){return Lt(this,uo,Wc).call(this,e,!1,!0)}whenNotMatchedBySourceAndRef(e,n,r){return Lt(this,uo,Wc).call(this,[e,n,r],!0,!0)}output(e){return new Lu({...a(this,Sn),queryNode:tt.cloneWithOutput(a(this,Sn).queryNode,zs(e))})}outputAll(e){return new Lu({...a(this,Sn),queryNode:tt.cloneWithOutput(a(this,Sn).queryNode,wi(e))})}$call(e){return e(this)}$if(e,n){return e?n(this):new Lu({...a(this,Sn)})}toOperationNode(){return a(this,Sn).executor.transformQuery(a(this,Sn).queryNode,a(this,Sn).queryId)}compile(){return a(this,Sn).executor.compileQuery(this.toOperationNode(),a(this,Sn).queryId)}async execute(){const e=this.compile(),n=await a(this,Sn).executor.executeQuery(e,a(this,Sn).queryId);return e.query.output&&a(this,Sn).executor.adapter.supportsOutput?n.rows:[new Ree(n.numAffectedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Ld){const n=await this.executeTakeFirst();if(n===void 0)throw Md(e)?new e(this.toOperationNode()):e(this.toOperationNode());return n}};Sn=new WeakMap,$u=new WeakSet,W_=function(e,n){return new G0({...a(this,Sn),queryNode:Kr.cloneWithWhen(a(this,Sn).queryNode,uC({isMatched:!0},e,n))})},uo=new WeakSet,Wc=function(e,n=!1,r=!1){const s={...a(this,Sn),queryNode:Kr.cloneWithWhen(a(this,Sn).queryNode,uC({isMatched:!1,bySource:r},e,n))},i=r?G0:pC;return new i(s)};let ao=Lu;xt(ao,"don't await WheneableMergeQueryBuilder instances directly. To execute the query you need to call `execute`.");class G0{constructor(e){ae(this,Qs,void 0);Ee(this,Qs,E(e))}thenDelete(){return new ao({...a(this,Qs),queryNode:Kr.cloneWithThen(a(this,Qs).queryNode,Ud("delete"))})}thenDoNothing(){return new ao({...a(this,Qs),queryNode:Kr.cloneWithThen(a(this,Qs).queryNode,Ud("do nothing"))})}thenUpdate(e){return new ao({...a(this,Qs),queryNode:Kr.cloneWithThen(a(this,Qs).queryNode,Ud(e(new Wd({queryId:a(this,Qs).queryId,executor:J0,queryNode:vu.createWithoutTable()}))))})}thenUpdateSet(...e){return this.thenUpdate(n=>n.set(...e))}}Qs=new WeakMap,xt(G0,"don't await MatchedThenableMergeQueryBuilder instances directly. To execute the query you need to call `execute` when available.");class pC{constructor(e){ae(this,ga,void 0);Ee(this,ga,E(e))}thenDoNothing(){return new ao({...a(this,ga),queryNode:Kr.cloneWithThen(a(this,ga).queryNode,Ud("do nothing"))})}thenInsertValues(e){const[n,r]=ZA(e);return new ao({...a(this,ga),queryNode:Kr.cloneWithThen(a(this,ga).queryNode,Ud(os.cloneWith(os.createWithoutInto(),{columns:n,values:r})))})}}ga=new WeakMap,xt(pC,"don't await NotMatchedThenableMergeQueryBuilder instances directly. To execute the query you need to call `execute` when available.");const Oc=class Oc{constructor(e){ae(this,Ht,void 0);Ee(this,Ht,E(e))}selectFrom(e){return eE({queryId:Dn(),executor:a(this,Ht).executor,queryNode:Pt.createFrom(Vd(e),a(this,Ht).withNode)})}selectNoFrom(e){return eE({queryId:Dn(),executor:a(this,Ht).executor,queryNode:Pt.cloneWithSelections(Pt.create(a(this,Ht).withNode),zs(e))})}insertInto(e){return new Dd({queryId:Dn(),executor:a(this,Ht).executor,queryNode:os.create(Wn(e),a(this,Ht).withNode)})}replaceInto(e){return new Dd({queryId:Dn(),executor:a(this,Ht).executor,queryNode:os.create(Wn(e),a(this,Ht).withNode,!0)})}deleteFrom(e){return new Mg({queryId:Dn(),executor:a(this,Ht).executor,queryNode:yc.create(Vd(e),a(this,Ht).withNode)})}updateTable(e){return new Wd({queryId:Dn(),executor:a(this,Ht).executor,queryNode:vu.create(Kd(e),a(this,Ht).withNode)})}mergeInto(e){return new Ug({queryId:Dn(),executor:a(this,Ht).executor,queryNode:Kr.create(kC(e),a(this,Ht).withNode)})}with(e,n){const r=oC(e,n);return new Oc({...a(this,Ht),withNode:a(this,Ht).withNode?Bg.cloneWithExpression(a(this,Ht).withNode,r):Bg.create(r)})}withRecursive(e,n){const r=oC(e,n);return new Oc({...a(this,Ht),withNode:a(this,Ht).withNode?Bg.cloneWithExpression(a(this,Ht).withNode,r):Bg.create(r,{recursive:!0})})}withPlugin(e){return new Oc({...a(this,Ht),executor:a(this,Ht).executor.withPlugin(e)})}withoutPlugins(){return new Oc({...a(this,Ht),executor:a(this,Ht).executor.withoutPlugins()})}withSchema(e){return new Oc({...a(this,Ht),executor:a(this,Ht).executor.withPluginAtFront(new Bd(e))})}};Ht=new WeakMap;let jg=Oc;function Pee(){return new jg({executor:J0})}function $ee(t,e){return new Rg({joinNode:Cd.create(t,Kd(e))})}function Lee(){return new Pg({overNode:K0.create()})}function Cr(t,e){if(e.length===3)return Dee(t,e[0],e[1],e[2]);if(e.length===2)return Mee(t,e[0],e[1]);throw new Error("not implemented")}function Mee(t,e,n){return n($ee(t,e)).toOperationNode()}function Dee(t,e,n,r){return Cd.createWithOn(t,Kd(e),bi(n,"=",r))}const Wee=E({is(t){return t.kind==="OffsetNode"},create(t){return E({kind:"OffsetNode",offset:t})}}),Bee=E({is(t){return t.kind==="GroupByItemNode"},create(t){return E({kind:"GroupByItemNode",groupBy:t})}});function Uee(t){return t=rs(t)?t(Ou()):t,Rd(t).map(Bee.create)}const mC=E({is(t){return t.kind==="SetOperationNode"},create(t,e,n){return E({kind:"SetOperationNode",operator:t,expression:e,all:n})}});function xu(t,e,n){return rs(e)&&(e=e(tE())),ro(e)||(e=[e]),e.map(r=>mC.create(t,Sc(r),n))}const E_=class E_{constructor(e){ae(this,fo,void 0);Ee(this,fo,e)}get expressionType(){}as(e){return new Y0(this,e)}or(...e){return new X0(bu.create(a(this,fo),gr(e)))}and(...e){return new Z0(aa.create(a(this,fo),gr(e)))}$castTo(){return new E_(a(this,fo))}$notNull(){return new E_(a(this,fo))}toOperationNode(){return a(this,fo)}};fo=new WeakMap;let ln=E_;class Y0{constructor(e,n){ae(this,Mu,void 0);ae(this,_a,void 0);Ee(this,Mu,e),Ee(this,_a,n)}get expression(){return a(this,Mu)}get alias(){return a(this,_a)}toOperationNode(){return _c.create(a(this,Mu).toOperationNode(),Ss(a(this,_a))?a(this,_a).toOperationNode():kn.create(a(this,_a)))}}Mu=new WeakMap,_a=new WeakMap;const v_=class v_{constructor(e){ae(this,Ic,void 0);Ee(this,Ic,e)}get expressionType(){}as(e){return new Y0(this,e)}or(...e){return new v_(bu.create(a(this,Ic),gr(e)))}$castTo(){return new v_(a(this,Ic))}toOperationNode(){return Su.create(a(this,Ic))}};Ic=new WeakMap;let X0=v_;const N_=class N_{constructor(e){ae(this,Tc,void 0);Ee(this,Tc,e)}get expressionType(){}as(e){return new Y0(this,e)}and(...e){return new N_(aa.create(a(this,Tc),gr(e)))}$castTo(){return new N_(a(this,Tc))}toOperationNode(){return Su.create(a(this,Tc))}};Tc=new WeakMap;let Z0=N_;const jee={is(t){return t.kind==="FetchNode"},create(t,e){return{kind:"FetchNode",rowCount:oo.create(t),modifier:e}}};function zee(t,e){if(!kg(t)&&!F0(t))throw new Error(`Invalid fetch row count: ${t}`);if(!Vee(e))throw new Error(`Invalid fetch modifier: ${e}`);return jee.create(t,e)}function Vee(t){return t==="only"||t==="with ties"}const lt=class lt{constructor(e){ae(this,Se,void 0);Ee(this,Se,E(e))}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...e){return new lt({...a(this,Se),queryNode:tt.cloneWithWhere(a(this,Se).queryNode,gr(e))})}whereRef(e,n,r){return new lt({...a(this,Se),queryNode:tt.cloneWithWhere(a(this,Se).queryNode,bi(e,n,r))})}having(...e){return new lt({...a(this,Se),queryNode:Pt.cloneWithHaving(a(this,Se).queryNode,gr(e))})}havingRef(e,n,r){return new lt({...a(this,Se),queryNode:Pt.cloneWithHaving(a(this,Se).queryNode,bi(e,n,r))})}select(e){return new lt({...a(this,Se),queryNode:Pt.cloneWithSelections(a(this,Se).queryNode,zs(e))})}distinctOn(e){return new lt({...a(this,Se),queryNode:Pt.cloneWithDistinctOn(a(this,Se).queryNode,Rd(e))})}modifyFront(e){return new lt({...a(this,Se),queryNode:Pt.cloneWithFrontModifier(a(this,Se).queryNode,io.createWithExpression(e.toOperationNode()))})}modifyEnd(e){return new lt({...a(this,Se),queryNode:Pt.cloneWithEndModifier(a(this,Se).queryNode,io.createWithExpression(e.toOperationNode()))})}distinct(){return new lt({...a(this,Se),queryNode:Pt.cloneWithFrontModifier(a(this,Se).queryNode,io.create("Distinct"))})}forUpdate(e){return new lt({...a(this,Se),queryNode:Pt.cloneWithEndModifier(a(this,Se).queryNode,io.create("ForUpdate",e?qg(e).map(Wn):void 0))})}forShare(e){return new lt({...a(this,Se),queryNode:Pt.cloneWithEndModifier(a(this,Se).queryNode,io.create("ForShare",e?qg(e).map(Wn):void 0))})}forKeyShare(e){return new lt({...a(this,Se),queryNode:Pt.cloneWithEndModifier(a(this,Se).queryNode,io.create("ForKeyShare",e?qg(e).map(Wn):void 0))})}forNoKeyUpdate(e){return new lt({...a(this,Se),queryNode:Pt.cloneWithEndModifier(a(this,Se).queryNode,io.create("ForNoKeyUpdate",e?qg(e).map(Wn):void 0))})}skipLocked(){return new lt({...a(this,Se),queryNode:Pt.cloneWithEndModifier(a(this,Se).queryNode,io.create("SkipLocked"))})}noWait(){return new lt({...a(this,Se),queryNode:Pt.cloneWithEndModifier(a(this,Se).queryNode,io.create("NoWait"))})}selectAll(e){return new lt({...a(this,Se),queryNode:Pt.cloneWithSelections(a(this,Se).queryNode,wi(e))})}innerJoin(...e){return new lt({...a(this,Se),queryNode:tt.cloneWithJoin(a(this,Se).queryNode,Cr("InnerJoin",e))})}leftJoin(...e){return new lt({...a(this,Se),queryNode:tt.cloneWithJoin(a(this,Se).queryNode,Cr("LeftJoin",e))})}rightJoin(...e){return new lt({...a(this,Se),queryNode:tt.cloneWithJoin(a(this,Se).queryNode,Cr("RightJoin",e))})}fullJoin(...e){return new lt({...a(this,Se),queryNode:tt.cloneWithJoin(a(this,Se).queryNode,Cr("FullJoin",e))})}innerJoinLateral(...e){return new lt({...a(this,Se),queryNode:tt.cloneWithJoin(a(this,Se).queryNode,Cr("LateralInnerJoin",e))})}leftJoinLateral(...e){return new lt({...a(this,Se),queryNode:tt.cloneWithJoin(a(this,Se).queryNode,Cr("LateralLeftJoin",e))})}orderBy(...e){return new lt({...a(this,Se),queryNode:Pt.cloneWithOrderByItems(a(this,Se).queryNode,Ig(e))})}groupBy(e){return new lt({...a(this,Se),queryNode:Pt.cloneWithGroupByItems(a(this,Se).queryNode,Uee(e))})}limit(e){return new lt({...a(this,Se),queryNode:Pt.cloneWithLimit(a(this,Se).queryNode,H0.create(or(e)))})}offset(e){return new lt({...a(this,Se),queryNode:Pt.cloneWithOffset(a(this,Se).queryNode,Wee.create(or(e)))})}fetch(e,n="only"){return new lt({...a(this,Se),queryNode:Pt.cloneWithFetch(a(this,Se).queryNode,zee(e,n))})}top(e,n){return new lt({...a(this,Se),queryNode:tt.cloneWithTop(a(this,Se).queryNode,Nu(e,n))})}union(e){return new lt({...a(this,Se),queryNode:Pt.cloneWithSetOperations(a(this,Se).queryNode,xu("union",e,!1))})}unionAll(e){return new lt({...a(this,Se),queryNode:Pt.cloneWithSetOperations(a(this,Se).queryNode,xu("union",e,!0))})}intersect(e){return new lt({...a(this,Se),queryNode:Pt.cloneWithSetOperations(a(this,Se).queryNode,xu("intersect",e,!1))})}intersectAll(e){return new lt({...a(this,Se),queryNode:Pt.cloneWithSetOperations(a(this,Se).queryNode,xu("intersect",e,!0))})}except(e){return new lt({...a(this,Se),queryNode:Pt.cloneWithSetOperations(a(this,Se).queryNode,xu("except",e,!1))})}exceptAll(e){return new lt({...a(this,Se),queryNode:Pt.cloneWithSetOperations(a(this,Se).queryNode,xu("except",e,!0))})}as(e){return new gC(this,e)}clearSelect(){return new lt({...a(this,Se),queryNode:Pt.cloneWithoutSelections(a(this,Se).queryNode)})}clearWhere(){return new lt({...a(this,Se),queryNode:tt.cloneWithoutWhere(a(this,Se).queryNode)})}clearLimit(){return new lt({...a(this,Se),queryNode:Pt.cloneWithoutLimit(a(this,Se).queryNode)})}clearOffset(){return new lt({...a(this,Se),queryNode:Pt.cloneWithoutOffset(a(this,Se).queryNode)})}clearOrderBy(){return new lt({...a(this,Se),queryNode:Pt.cloneWithoutOrderBy(a(this,Se).queryNode)})}clearGroupBy(){return new lt({...a(this,Se),queryNode:Pt.cloneWithoutGroupBy(a(this,Se).queryNode)})}$call(e){return e(this)}$if(e,n){return e?n(this):new lt({...a(this,Se)})}$castTo(){return new lt(a(this,Se))}$narrowType(){return new lt(a(this,Se))}$assertType(){return new lt(a(this,Se))}$asTuple(){return new ln(this.toOperationNode())}withPlugin(e){return new lt({...a(this,Se),executor:a(this,Se).executor.withPlugin(e)})}toOperationNode(){return a(this,Se).executor.transformQuery(a(this,Se).queryNode,a(this,Se).queryId)}compile(){return a(this,Se).executor.compileQuery(this.toOperationNode(),a(this,Se).queryId)}async execute(){const e=this.compile();return(await a(this,Se).executor.executeQuery(e,a(this,Se).queryId)).rows}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Ld){const n=await this.executeTakeFirst();if(n===void 0)throw Md(e)?new e(this.toOperationNode()):e(this.toOperationNode());return n}async*stream(e=100){const n=this.compile(),r=a(this,Se).executor.stream(n,e,a(this,Se).queryId);for await(const s of r)yield*s.rows}async explain(e,n){return await new lt({...a(this,Se),queryNode:tt.cloneWithExplain(a(this,Se).queryNode,e,n)}).execute()}};Se=new WeakMap;let zg=lt;xt(zg,"don't await SelectQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");function eE(t){return new zg(t)}class gC{constructor(e,n){ae(this,Du,void 0);ae(this,Wu,void 0);Ee(this,Du,e),Ee(this,Wu,n)}get expression(){return a(this,Du)}get alias(){return a(this,Wu)}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return _c.create(a(this,Du).toOperationNode(),kn.create(a(this,Wu)))}}Du=new WeakMap,Wu=new WeakMap,xt(gC,"don't await AliasedSelectQueryBuilder instances directly. AliasedSelectQueryBuilder should never be executed directly since it's always a part of another query.");const bc=E({is(t){return t.kind==="AggregateFunctionNode"},create(t,e=[]){return E({kind:"AggregateFunctionNode",func:t,aggregated:e})},cloneWithDistinct(t){return E({...t,distinct:!0})},cloneWithFilter(t,e){return E({...t,filter:t.filter?Vr.cloneWithOperation(t.filter,"And",e):Vr.create(e)})},cloneWithOrFilter(t,e){return E({...t,filter:t.filter?Vr.cloneWithOperation(t.filter,"Or",e):Vr.create(e)})},cloneWithOver(t,e){return E({...t,over:e})}}),_C=E({is(t){return t.kind==="FunctionNode"},create(t,e){return E({kind:"FunctionNode",func:t,arguments:e})}}),ya=class ya{constructor(e){ae(this,Fr,void 0);Ee(this,Fr,E(e))}get expressionType(){}as(e){return new Kee(this,e)}distinct(){return new ya({...a(this,Fr),aggregateFunctionNode:bc.cloneWithDistinct(a(this,Fr).aggregateFunctionNode)})}filterWhere(...e){return new ya({...a(this,Fr),aggregateFunctionNode:bc.cloneWithFilter(a(this,Fr).aggregateFunctionNode,gr(e))})}filterWhereRef(e,n,r){return new ya({...a(this,Fr),aggregateFunctionNode:bc.cloneWithFilter(a(this,Fr).aggregateFunctionNode,bi(e,n,r))})}over(e){const n=Lee();return new ya({...a(this,Fr),aggregateFunctionNode:bc.cloneWithOver(a(this,Fr).aggregateFunctionNode,(e?e(n):n).toOperationNode())})}$call(e){return e(this)}$castTo(){return new ya(a(this,Fr))}$notNull(){return new ya(a(this,Fr))}toOperationNode(){return a(this,Fr).aggregateFunctionNode}};Fr=new WeakMap;let qu=ya;xt(qu,"don't await AggregateFunctionBuilder instances. They are never executed directly and are always just a part of a query.");class Kee{constructor(e,n){ae(this,Bu,void 0);ae(this,Uu,void 0);Ee(this,Bu,e),Ee(this,Uu,n)}get expression(){return a(this,Bu)}get alias(){return a(this,Uu)}toOperationNode(){return _c.create(a(this,Bu).toOperationNode(),kn.create(a(this,Uu)))}}Bu=new WeakMap,Uu=new WeakMap;function yC(){const t=(n,r)=>new ln(_C.create(n,Rd(r??[]))),e=(n,r)=>new qu({aggregateFunctionNode:bc.create(n,r?Rd(r):void 0)});return Object.assign(t,{agg:e,avg(n){return e("avg",[n])},coalesce(...n){return t("coalesce",n)},count(n){return e("count",[n])},countAll(n){return new qu({aggregateFunctionNode:bc.create("count",wi(n))})},max(n){return e("max",[n])},min(n){return e("min",[n])},sum(n){return e("sum",[n])},any(n){return t("any",[n])},jsonAgg(n){return new qu({aggregateFunctionNode:bc.create("json_agg",[ns(n)?Wn(n):n.toOperationNode()])})},toJson(n){return new ln(_C.create("to_json",[ns(n)?Wn(n):n.toOperationNode()]))}})}const Qee=E({is(t){return t.kind==="UnaryOperationNode"},create(t,e){return E({kind:"UnaryOperationNode",operator:t,operand:e})}});function Hee(t,e){return Qee.create(ca.create(t),is(e))}const Si=E({is(t){return t.kind==="CaseNode"},create(t){return E({kind:"CaseNode",value:t})},cloneWithWhen(t,e){return E({...t,when:E(t.when?[...t.when,e]:[e])})},cloneWithThen(t,e){return E({...t,when:t.when?E([...t.when.slice(0,-1),$d.cloneWithResult(t.when[t.when.length-1],e)]):void 0})},cloneWith(t,e){return E({...t,...e})}});class bC{constructor(e){ae(this,ju,void 0);Ee(this,ju,E(e))}when(...e){return new wC({...a(this,ju),node:Si.cloneWithWhen(a(this,ju).node,$d.create(gr(e)))})}}ju=new WeakMap;class wC{constructor(e){ae(this,zu,void 0);Ee(this,zu,E(e))}then(e){return new Jee({...a(this,zu),node:Si.cloneWithThen(a(this,zu).node,U0(e)?j0(e):or(e))})}}zu=new WeakMap;class Jee{constructor(e){ae(this,Ei,void 0);Ee(this,Ei,E(e))}when(...e){return new wC({...a(this,Ei),node:Si.cloneWithWhen(a(this,Ei).node,$d.create(gr(e)))})}else(e){return new Gee({...a(this,Ei),node:Si.cloneWith(a(this,Ei).node,{else:U0(e)?j0(e):or(e)})})}end(){return new ln(Si.cloneWith(a(this,Ei).node,{isStatement:!1}))}endCase(){return new ln(Si.cloneWith(a(this,Ei).node,{isStatement:!0}))}}Ei=new WeakMap;class Gee{constructor(e){ae(this,Vu,void 0);Ee(this,Vu,E(e))}end(){return new ln(Si.cloneWith(a(this,Vu).node,{isStatement:!1}))}endCase(){return new ln(Si.cloneWith(a(this,Vu).node,{isStatement:!0}))}}Vu=new WeakMap;const SC=E({is(t){return t.kind==="JSONPathLegNode"},create(t,e){return E({kind:"JSONPathLegNode",type:t,value:e})}});class jd{constructor(e){ae(this,oh);ae(this,vi,void 0);Ee(this,vi,e)}at(e){return Lt(this,oh,OE).call(this,"ArrayLocation",e)}key(e){return Lt(this,oh,OE).call(this,"Member",e)}}vi=new WeakMap,oh=new WeakSet,OE=function(e,n){return Tg.is(a(this,vi))?new EC(Tg.cloneWithTraversal(a(this,vi),Fd.is(a(this,vi).traversal)?Fd.cloneWithLeg(a(this,vi).traversal,SC.create(e,n)):BA.cloneWithValue(a(this,vi).traversal,oo.createImmediate(n)))):new EC(Fd.cloneWithLeg(a(this,vi),SC.create(e,n)))};class EC extends jd{constructor(n){super(n);ae(this,Ac,void 0);Ee(this,Ac,n)}get expressionType(){}as(n){return new Yee(this,n)}$castTo(){return new jd(a(this,Ac))}$notNull(){return new jd(a(this,Ac))}toOperationNode(){return a(this,Ac)}}Ac=new WeakMap;class Yee{constructor(e,n){ae(this,Ku,void 0);ae(this,ba,void 0);Ee(this,Ku,e),Ee(this,ba,n)}get expression(){return a(this,Ku)}get alias(){return a(this,ba)}toOperationNode(){return _c.create(a(this,Ku).toOperationNode(),Ss(a(this,ba))?a(this,ba).toOperationNode():kn.create(a(this,ba)))}}Ku=new WeakMap,ba=new WeakMap;const vC=E({is(t){return t.kind==="TupleNode"},create(t){return E({kind:"TupleNode",values:E(t)})}}),Xee=["varchar","char","text","integer","int2","int4","int8","smallint","bigint","boolean","real","double precision","float4","float8","decimal","numeric","binary","bytea","date","datetime","time","timetz","timestamp","timestamptz","serial","bigserial","uuid","json","jsonb","blob","varbinary"],Zee=[/^varchar\(\d+\)$/,/^char\(\d+\)$/,/^decimal\(\d+, \d+\)$/,/^numeric\(\d+, \d+\)$/,/^binary\(\d+\)$/,/^datetime\(\d+\)$/,/^time\(\d+\)$/,/^timetz\(\d+\)$/,/^timestamp\(\d+\)$/,/^timestamptz\(\d+\)$/,/^varbinary\(\d+\)$/],ete=E({is(t){return t.kind==="DataTypeNode"},create(t){return E({kind:"DataTypeNode",dataType:t})}});function tte(t){return!!(Xee.includes(t)||Zee.some(e=>e.test(t)))}function wc(t){if(Ss(t))return t.toOperationNode();if(tte(t))return ete.create(t);throw new Error(`invalid column data type ${JSON.stringify(t)}`)}const nte=E({is(t){return t.kind==="CastNode"},create(t,e){return E({kind:"CastNode",expression:t,dataType:e})}});function tE(t=J0){function e(s,i,o){return new ln(z0(s,i,o))}function n(s,i){return new ln(Hee(s,i))}const r=Object.assign(e,{fn:void 0,eb:void 0,selectFrom(s){return eE({queryId:Dn(),executor:t,queryNode:Pt.createFrom(Vd(s))})},case(s){return new bC({node:Si.create(ra(s)?void 0:is(s))})},ref(s,i){return ra(i)?new ln(ua(s)):new jd(nee(s,i))},jsonPath(){return new jd(Fd.create())},table(s){return new ln(Wn(s))},val(s){return new ln(or(s))},refTuple(...s){return new ln(vC.create(s.map(is)))},tuple(...s){return new ln(vC.create(s.map(or)))},lit(s){return new ln(j0(s))},unary:n,not(s){return n("not",s)},exists(s){return n("exists",s)},neg(s){return n("-",s)},between(s,i,o){return new ln(wu.create(is(s),ca.create("between"),aa.create(or(i),or(o))))},betweenSymmetric(s,i,o){return new ln(wu.create(is(s),ca.create("between symmetric"),aa.create(or(i),or(o))))},and(s){return ro(s)?new ln(Cg(s,"and")):new ln(VA(s,"and"))},or(s){return ro(s)?new ln(Cg(s,"or")):new ln(VA(s,"or"))},parens(...s){const i=gr(s);return Su.is(i)?new ln(i):new ln(Su.create(i))},cast(s,i){return new ln(nte.create(is(s),wc(i)))},withSchema(s){return tE(t.withPluginAtFront(new Bd(s)))}});return r.fn=yC(),r.eb=r,r}function Ou(t){return tE()}function Sc(t){if(Ss(t))return t.toOperationNode();if(rs(t))return t(Ou()).toOperationNode();throw new Error(`invalid expression: ${JSON.stringify(t)}`)}function NC(t){if(Ss(t))return t.toOperationNode();if(rs(t))return t(Ou()).toOperationNode();throw new Error(`invalid aliased expression: ${JSON.stringify(t)}`)}function zd(t){return QZ(t)||HZ(t)||rs(t)}function Vd(t){return ro(t)?t.map(e=>Kd(e)):[Kd(t)]}function Kd(t){return ns(t)?kC(t):NC(t)}function kC(t){const e=" as ";if(t.includes(e)){const[n,r]=t.split(e).map(xC);return _c.create(Wn(n),kn.create(r))}else return Wn(t)}function Wn(t){const e=".";if(t.includes(e)){const[n,r]=t.split(e).map(xC);return oa.createWithSchema(n,r)}else return oa.create(t)}function xC(t){return t.trim()}const qC=E({is(t){return t.kind==="AddColumnNode"},create(t){return E({kind:"AddColumnNode",column:t})}}),_n=E({is(t){return t.kind==="ColumnDefinitionNode"},create(t,e){return E({kind:"ColumnDefinitionNode",column:An.create(t),dataType:e})},cloneWithFrontModifier(t,e){return E({...t,frontModifiers:t.frontModifiers?E([...t.frontModifiers,e]):[e]})},cloneWithEndModifier(t,e){return E({...t,endModifiers:t.endModifiers?E([...t.endModifiers,e]):[e]})},cloneWith(t,e){return E({...t,...e})}}),OC=E({is(t){return t.kind==="DropColumnNode"},create(t){return E({kind:"DropColumnNode",column:An.create(t)})}}),IC=E({is(t){return t.kind==="RenameColumnNode"},create(t,e){return E({kind:"RenameColumnNode",column:An.create(t),renameTo:An.create(e)})}}),nE=E({is(t){return t.kind==="CheckConstraintNode"},create(t,e){return E({kind:"CheckConstraintNode",expression:t,name:e?kn.create(e):void 0})}}),rte=["no action","restrict","cascade","set null","set default"],Vg=E({is(t){return t.kind==="ReferencesNode"},create(t,e){return E({kind:"ReferencesNode",table:t,columns:E([...e])})},cloneWithOnDelete(t,e){return E({...t,onDelete:e})},cloneWithOnUpdate(t,e){return E({...t,onUpdate:e})}});function TC(t){return Ss(t)?t.toOperationNode():oo.createImmediate(t)}const Kg=E({is(t){return t.kind==="GeneratedNode"},create(t){return E({kind:"GeneratedNode",...t})},createWithExpression(t){return E({kind:"GeneratedNode",always:!0,expression:t})},cloneWith(t,e){return E({...t,...e})}}),ste=E({is(t){return t.kind==="DefaultValueNode"},create(t){return E({kind:"DefaultValueNode",defaultValue:t})}});function Qg(t){if(rte.includes(t))return t;throw new Error(`invalid OnModifyForeignAction ${t}`)}const Fn=class Fn{constructor(e){ae(this,Jt,void 0);Ee(this,Jt,e)}autoIncrement(){return new Fn(_n.cloneWith(a(this,Jt),{autoIncrement:!0}))}identity(){return new Fn(_n.cloneWith(a(this,Jt),{identity:!0}))}primaryKey(){return new Fn(_n.cloneWith(a(this,Jt),{primaryKey:!0}))}references(e){const n=ua(e);if(!n.table||L0.is(n.column))throw new Error(`invalid call references('${e}'). The reference must have format table.column or schema.table.column`);return new Fn(_n.cloneWith(a(this,Jt),{references:Vg.create(n.table,[n.column])}))}onDelete(e){if(!a(this,Jt).references)throw new Error("on delete constraint can only be added for foreign keys");return new Fn(_n.cloneWith(a(this,Jt),{references:Vg.cloneWithOnDelete(a(this,Jt).references,Qg(e))}))}onUpdate(e){if(!a(this,Jt).references)throw new Error("on update constraint can only be added for foreign keys");return new Fn(_n.cloneWith(a(this,Jt),{references:Vg.cloneWithOnUpdate(a(this,Jt).references,Qg(e))}))}unique(){return new Fn(_n.cloneWith(a(this,Jt),{unique:!0}))}notNull(){return new Fn(_n.cloneWith(a(this,Jt),{notNull:!0}))}unsigned(){return new Fn(_n.cloneWith(a(this,Jt),{unsigned:!0}))}defaultTo(e){return new Fn(_n.cloneWith(a(this,Jt),{defaultTo:ste.create(TC(e))}))}check(e){return new Fn(_n.cloneWith(a(this,Jt),{check:nE.create(e.toOperationNode())}))}generatedAlwaysAs(e){return new Fn(_n.cloneWith(a(this,Jt),{generated:Kg.createWithExpression(e.toOperationNode())}))}generatedAlwaysAsIdentity(){return new Fn(_n.cloneWith(a(this,Jt),{generated:Kg.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new Fn(_n.cloneWith(a(this,Jt),{generated:Kg.create({identity:!0,byDefault:!0})}))}stored(){if(!a(this,Jt).generated)throw new Error("stored() can only be called after generatedAlwaysAs");return new Fn(_n.cloneWith(a(this,Jt),{generated:Kg.cloneWith(a(this,Jt).generated,{stored:!0})}))}modifyFront(e){return new Fn(_n.cloneWithFrontModifier(a(this,Jt),e.toOperationNode()))}nullsNotDistinct(){return new Fn(_n.cloneWith(a(this,Jt),{nullsNotDistinct:!0}))}ifNotExists(){return new Fn(_n.cloneWith(a(this,Jt),{ifNotExists:!0}))}modifyEnd(e){return new Fn(_n.cloneWithEndModifier(a(this,Jt),e.toOperationNode()))}$call(e){return e(this)}toOperationNode(){return a(this,Jt)}};Jt=new WeakMap;let fa=Fn;xt(fa,"don't await ColumnDefinitionBuilder instances directly.");const AC=E({is(t){return t.kind==="ModifyColumnNode"},create(t){return E({kind:"ModifyColumnNode",column:t})}}),Hg=E({is(t){return t.kind==="ForeignKeyConstraintNode"},create(t,e,n,r){return E({kind:"ForeignKeyConstraintNode",columns:t,references:Vg.create(e,n),name:r?kn.create(r):void 0})},cloneWith(t,e){return E({...t,...e})}}),k_=class k_{constructor(e){ae(this,Cc,void 0);Ee(this,Cc,e)}onDelete(e){return new k_(Hg.cloneWith(a(this,Cc),{onDelete:Qg(e)}))}onUpdate(e){return new k_(Hg.cloneWith(a(this,Cc),{onUpdate:Qg(e)}))}$call(e){return e(this)}toOperationNode(){return a(this,Cc)}};Cc=new WeakMap;let Qd=k_;xt(Qd,"don't await ForeignKeyConstraintBuilder instances directly.");const Jg=E({is(t){return t.kind==="AddConstraintNode"},create(t){return E({kind:"AddConstraintNode",constraint:t})}}),rE=E({is(t){return t.kind==="UniqueConstraintNode"},create(t,e,n){return E({kind:"UniqueConstraintNode",columns:E(t.map(An.create)),name:e?kn.create(e):void 0,nullsNotDistinct:n})},cloneWith(t,e){return E({...t,...e})}}),Gg=E({is(t){return t.kind==="DropConstraintNode"},create(t){return E({kind:"DropConstraintNode",constraintName:kn.create(t)})},cloneWith(t,e){return E({...t,...e})}}),Hd=E({is(t){return t.kind==="AlterColumnNode"},create(t,e,n){return E({kind:"AlterColumnNode",column:An.create(t),[e]:n})}});class sE{constructor(e){ae(this,ho,void 0);Ee(this,ho,e)}setDataType(e){return new Iu(Hd.create(a(this,ho),"dataType",wc(e)))}setDefault(e){return new Iu(Hd.create(a(this,ho),"setDefault",TC(e)))}dropDefault(){return new Iu(Hd.create(a(this,ho),"dropDefault",!0))}setNotNull(){return new Iu(Hd.create(a(this,ho),"setNotNull",!0))}dropNotNull(){return new Iu(Hd.create(a(this,ho),"dropNotNull",!0))}$call(e){return e(this)}}ho=new WeakMap,xt(sE,"don't await AlterColumnBuilder instances");class Iu{constructor(e){ae(this,ah,void 0);Ee(this,ah,e)}toOperationNode(){return a(this,ah)}}ah=new WeakMap,xt(Iu,"don't await AlteredColumnBuilder instances");class Ec{constructor(e){ae(this,Hs,void 0);Ee(this,Hs,E(e))}toOperationNode(){return a(this,Hs).executor.transformQuery(a(this,Hs).node,a(this,Hs).queryId)}compile(){return a(this,Hs).executor.compileQuery(this.toOperationNode(),a(this,Hs).queryId)}async execute(){await a(this,Hs).executor.executeQuery(this.compile(),a(this,Hs).queryId)}}Hs=new WeakMap,xt(Ec,"don't await AlterTableExecutor instances directly. To execute the query you need to call `execute`");const x_=class x_{constructor(e){ae(this,Nr,void 0);Ee(this,Nr,E(e))}onDelete(e){return new x_({...a(this,Nr),constraintBuilder:a(this,Nr).constraintBuilder.onDelete(e)})}onUpdate(e){return new x_({...a(this,Nr),constraintBuilder:a(this,Nr).constraintBuilder.onUpdate(e)})}$call(e){return e(this)}toOperationNode(){return a(this,Nr).executor.transformQuery(en.cloneWithTableProps(a(this,Nr).node,{addConstraint:Jg.create(a(this,Nr).constraintBuilder.toOperationNode())}),a(this,Nr).queryId)}compile(){return a(this,Nr).executor.compileQuery(this.toOperationNode(),a(this,Nr).queryId)}async execute(){await a(this,Nr).executor.executeQuery(this.compile(),a(this,Nr).queryId)}};Nr=new WeakMap;let Yg=x_;xt(Yg,"don't await AlterTableAddForeignKeyConstraintBuilder instances directly. To execute the query you need to call `execute`");const ch=class ch{constructor(e){ae(this,Bn,void 0);Ee(this,Bn,E(e))}ifExists(){return new ch({...a(this,Bn),node:en.cloneWithTableProps(a(this,Bn).node,{dropConstraint:Gg.cloneWith(a(this,Bn).node.dropConstraint,{ifExists:!0})})})}cascade(){return new ch({...a(this,Bn),node:en.cloneWithTableProps(a(this,Bn).node,{dropConstraint:Gg.cloneWith(a(this,Bn).node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new ch({...a(this,Bn),node:en.cloneWithTableProps(a(this,Bn).node,{dropConstraint:Gg.cloneWith(a(this,Bn).node.dropConstraint,{modifier:"restrict"})})})}$call(e){return e(this)}toOperationNode(){return a(this,Bn).executor.transformQuery(a(this,Bn).node,a(this,Bn).queryId)}compile(){return a(this,Bn).executor.compileQuery(this.toOperationNode(),a(this,Bn).queryId)}async execute(){await a(this,Bn).executor.executeQuery(this.compile(),a(this,Bn).queryId)}};Bn=new WeakMap;let Xg=ch;xt(Xg,"don't await AlterTableDropConstraintBuilder instances directly. To execute the query you need to call `execute`");const CC=E({is(t){return t.kind==="PrimaryKeyConstraintNode"},create(t,e){return E({kind:"PrimaryKeyConstraintNode",columns:E(t.map(An.create)),name:e?kn.create(e):void 0})}}),Tu=E({is(t){return t.kind==="AddIndexNode"},create(t){return E({kind:"AddIndexNode",name:kn.create(t)})},cloneWith(t,e){return E({...t,...e})},cloneWithColumns(t,e){return E({...t,columns:[...t.columns||[],...e]})}}),Fc=class Fc{constructor(e){ae(this,dn,void 0);Ee(this,dn,E(e))}unique(){return new Fc({...a(this,dn),node:en.cloneWithTableProps(a(this,dn).node,{addIndex:Tu.cloneWith(a(this,dn).node.addIndex,{unique:!0})})})}column(e){return new Fc({...a(this,dn),node:en.cloneWithTableProps(a(this,dn).node,{addIndex:Tu.cloneWithColumns(a(this,dn).node.addIndex,[Ag(e)])})})}columns(e){return new Fc({...a(this,dn),node:en.cloneWithTableProps(a(this,dn).node,{addIndex:Tu.cloneWithColumns(a(this,dn).node.addIndex,e.map(Ag))})})}expression(e){return new Fc({...a(this,dn),node:en.cloneWithTableProps(a(this,dn).node,{addIndex:Tu.cloneWithColumns(a(this,dn).node.addIndex,[e.toOperationNode()])})})}using(e){return new Fc({...a(this,dn),node:en.cloneWithTableProps(a(this,dn).node,{addIndex:Tu.cloneWith(a(this,dn).node.addIndex,{using:la.createWithSql(e)})})})}$call(e){return e(this)}toOperationNode(){return a(this,dn).executor.transformQuery(a(this,dn).node,a(this,dn).queryId)}compile(){return a(this,dn).executor.compileQuery(this.toOperationNode(),a(this,dn).queryId)}async execute(){await a(this,dn).executor.executeQuery(this.compile(),a(this,dn).queryId)}};dn=new WeakMap;let Zg=Fc;xt(Zg,"don't await AlterTableAddIndexBuilder instances directly. To execute the query you need to call `execute`");const pE=class pE{constructor(e){ae(this,Qu,void 0);Ee(this,Qu,e)}toOperationNode(){return a(this,Qu)}nullsNotDistinct(){return new pE(rE.cloneWith(a(this,Qu),{nullsNotDistinct:!0}))}};Qu=new WeakMap;let Jd=pE;xt(Jd,"don't await UniqueConstraintNodeBuilder instances directly.");class FC{constructor(e){ae(this,Kt,void 0);Ee(this,Kt,E(e))}renameTo(e){return new Ec({...a(this,Kt),node:en.cloneWithTableProps(a(this,Kt).node,{renameTo:Wn(e)})})}setSchema(e){return new Ec({...a(this,Kt),node:en.cloneWithTableProps(a(this,Kt).node,{setSchema:kn.create(e)})})}alterColumn(e,n){const r=n(new sE(e));return new da({...a(this,Kt),node:en.cloneWithColumnAlteration(a(this,Kt).node,r.toOperationNode())})}dropColumn(e){return new da({...a(this,Kt),node:en.cloneWithColumnAlteration(a(this,Kt).node,OC.create(e))})}renameColumn(e,n){return new da({...a(this,Kt),node:en.cloneWithColumnAlteration(a(this,Kt).node,IC.create(e,n))})}addColumn(e,n,r=sa){const s=r(new fa(_n.create(e,wc(n))));return new da({...a(this,Kt),node:en.cloneWithColumnAlteration(a(this,Kt).node,qC.create(s.toOperationNode()))})}modifyColumn(e,n,r=sa){const s=r(new fa(_n.create(e,wc(n))));return new da({...a(this,Kt),node:en.cloneWithColumnAlteration(a(this,Kt).node,AC.create(s.toOperationNode()))})}addUniqueConstraint(e,n,r=sa){const s=r(new Jd(rE.create(n,e)));return new Ec({...a(this,Kt),node:en.cloneWithTableProps(a(this,Kt).node,{addConstraint:Jg.create(s.toOperationNode())})})}addCheckConstraint(e,n){return new Ec({...a(this,Kt),node:en.cloneWithTableProps(a(this,Kt).node,{addConstraint:Jg.create(nE.create(n.toOperationNode(),e))})})}addForeignKeyConstraint(e,n,r,s){return new Yg({...a(this,Kt),constraintBuilder:new Qd(Hg.create(n.map(An.create),Wn(r),s.map(An.create),e))})}addPrimaryKeyConstraint(e,n){return new Ec({...a(this,Kt),node:en.cloneWithTableProps(a(this,Kt).node,{addConstraint:Jg.create(CC.create(n,e))})})}dropConstraint(e){return new Xg({...a(this,Kt),node:en.cloneWithTableProps(a(this,Kt).node,{dropConstraint:Gg.create(e)})})}addIndex(e){return new Zg({...a(this,Kt),node:en.cloneWithTableProps(a(this,Kt).node,{addIndex:Tu.create(e)})})}dropIndex(e){return new Ec({...a(this,Kt),node:en.cloneWithTableProps(a(this,Kt).node,{dropIndex:Ad.create(e)})})}$call(e){return e(this)}}Kt=new WeakMap,xt(FC,"don't await AlterTableBuilder instances");const Rc=class Rc{constructor(e){ae(this,Rn,void 0);Ee(this,Rn,E(e))}alterColumn(e,n){const r=n(new sE(e));return new Rc({...a(this,Rn),node:en.cloneWithColumnAlteration(a(this,Rn).node,r.toOperationNode())})}dropColumn(e){return new Rc({...a(this,Rn),node:en.cloneWithColumnAlteration(a(this,Rn).node,OC.create(e))})}renameColumn(e,n){return new Rc({...a(this,Rn),node:en.cloneWithColumnAlteration(a(this,Rn).node,IC.create(e,n))})}addColumn(e,n,r=sa){const s=r(new fa(_n.create(e,wc(n))));return new Rc({...a(this,Rn),node:en.cloneWithColumnAlteration(a(this,Rn).node,qC.create(s.toOperationNode()))})}modifyColumn(e,n,r=sa){const s=r(new fa(_n.create(e,wc(n))));return new Rc({...a(this,Rn),node:en.cloneWithColumnAlteration(a(this,Rn).node,AC.create(s.toOperationNode()))})}toOperationNode(){return a(this,Rn).executor.transformQuery(a(this,Rn).node,a(this,Rn).queryId)}compile(){return a(this,Rn).executor.compileQuery(this.toOperationNode(),a(this,Rn).queryId)}async execute(){await a(this,Rn).executor.executeQuery(this.compile(),a(this,Rn).queryId)}};Rn=new WeakMap;let da=Rc;xt(da,"don't await AlterTableColumnAlteringBuilder instances directly. To execute the query you need to call `execute`");class RC extends lC{transformValue(e){return{...super.transformValue(e),immediate:!0}}}const Js=class Js{constructor(e){ae(this,Xt,void 0);Ee(this,Xt,E(e))}ifNotExists(){return new Js({...a(this,Xt),node:so.cloneWith(a(this,Xt).node,{ifNotExists:!0})})}unique(){return new Js({...a(this,Xt),node:so.cloneWith(a(this,Xt).node,{unique:!0})})}nullsNotDistinct(){return new Js({...a(this,Xt),node:so.cloneWith(a(this,Xt).node,{nullsNotDistinct:!0})})}on(e){return new Js({...a(this,Xt),node:so.cloneWith(a(this,Xt).node,{table:Wn(e)})})}column(e){return new Js({...a(this,Xt),node:so.cloneWithColumns(a(this,Xt).node,[Ag(e)])})}columns(e){return new Js({...a(this,Xt),node:so.cloneWithColumns(a(this,Xt).node,e.map(Ag))})}expression(e){return new Js({...a(this,Xt),node:so.cloneWithColumns(a(this,Xt).node,[e.toOperationNode()])})}using(e){return new Js({...a(this,Xt),node:so.cloneWith(a(this,Xt).node,{using:la.createWithSql(e)})})}where(...e){const n=new RC;return new Js({...a(this,Xt),node:tt.cloneWithWhere(a(this,Xt).node,n.transformNode(gr(e)))})}$call(e){return e(this)}toOperationNode(){return a(this,Xt).executor.transformQuery(a(this,Xt).node,a(this,Xt).queryId)}compile(){return a(this,Xt).executor.compileQuery(this.toOperationNode(),a(this,Xt).queryId)}async execute(){await a(this,Xt).executor.executeQuery(this.compile(),a(this,Xt).queryId)}};Xt=new WeakMap;let e_=Js;xt(e_,"don't await CreateIndexBuilder instances directly. To execute the query you need to call `execute`");const mE=class mE{constructor(e){ae(this,cs,void 0);Ee(this,cs,E(e))}ifNotExists(){return new mE({...a(this,cs),node:PA.cloneWith(a(this,cs).node,{ifNotExists:!0})})}$call(e){return e(this)}toOperationNode(){return a(this,cs).executor.transformQuery(a(this,cs).node,a(this,cs).queryId)}compile(){return a(this,cs).executor.compileQuery(this.toOperationNode(),a(this,cs).queryId)}async execute(){await a(this,cs).executor.executeQuery(this.compile(),a(this,cs).queryId)}};cs=new WeakMap;let t_=mE;xt(t_,"don't await CreateSchemaBuilder instances directly. To execute the query you need to call `execute`");function ite(t){if(KZ.includes(t))return t;throw new Error(`invalid OnCommitAction ${t}`)}const ls=class ls{constructor(e){ae(this,Bt,void 0);Ee(this,Bt,E(e))}temporary(){return new ls({...a(this,Bt),node:ss.cloneWith(a(this,Bt).node,{temporary:!0})})}onCommit(e){return new ls({...a(this,Bt),node:ss.cloneWith(a(this,Bt).node,{onCommit:ite(e)})})}ifNotExists(){return new ls({...a(this,Bt),node:ss.cloneWith(a(this,Bt).node,{ifNotExists:!0})})}addColumn(e,n,r=sa){const s=r(new fa(_n.create(e,wc(n))));return new ls({...a(this,Bt),node:ss.cloneWithColumn(a(this,Bt).node,s.toOperationNode())})}addPrimaryKeyConstraint(e,n){return new ls({...a(this,Bt),node:ss.cloneWithConstraint(a(this,Bt).node,CC.create(n,e))})}addUniqueConstraint(e,n,r=sa){const s=r(new Jd(rE.create(n,e)));return new ls({...a(this,Bt),node:ss.cloneWithConstraint(a(this,Bt).node,s.toOperationNode())})}addCheckConstraint(e,n){return new ls({...a(this,Bt),node:ss.cloneWithConstraint(a(this,Bt).node,nE.create(n.toOperationNode(),e))})}addForeignKeyConstraint(e,n,r,s,i=sa){const o=i(new Qd(Hg.create(n.map(An.create),Wn(r),s.map(An.create),e)));return new ls({...a(this,Bt),node:ss.cloneWithConstraint(a(this,Bt).node,o.toOperationNode())})}modifyFront(e){return new ls({...a(this,Bt),node:ss.cloneWithFrontModifier(a(this,Bt).node,e.toOperationNode())})}modifyEnd(e){return new ls({...a(this,Bt),node:ss.cloneWithEndModifier(a(this,Bt).node,e.toOperationNode())})}as(e){return new ls({...a(this,Bt),node:ss.cloneWith(a(this,Bt).node,{selectQuery:Sc(e)})})}$call(e){return e(this)}toOperationNode(){return a(this,Bt).executor.transformQuery(a(this,Bt).node,a(this,Bt).queryId)}compile(){return a(this,Bt).executor.compileQuery(this.toOperationNode(),a(this,Bt).queryId)}async execute(){await a(this,Bt).executor.executeQuery(this.compile(),a(this,Bt).queryId)}};Bt=new WeakMap;let n_=ls;xt(n_,"don't await CreateTableBuilder instances directly. To execute the query you need to call `execute`");const lh=class lh{constructor(e){ae(this,_r,void 0);Ee(this,_r,E(e))}on(e){return new lh({...a(this,_r),node:Ad.cloneWith(a(this,_r).node,{table:Wn(e)})})}ifExists(){return new lh({...a(this,_r),node:Ad.cloneWith(a(this,_r).node,{ifExists:!0})})}cascade(){return new lh({...a(this,_r),node:Ad.cloneWith(a(this,_r).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return a(this,_r).executor.transformQuery(a(this,_r).node,a(this,_r).queryId)}compile(){return a(this,_r).executor.compileQuery(this.toOperationNode(),a(this,_r).queryId)}async execute(){await a(this,_r).executor.executeQuery(this.compile(),a(this,_r).queryId)}};_r=new WeakMap;let r_=lh;xt(r_,"don't await DropIndexBuilder instances directly. To execute the query you need to call `execute`");const q_=class q_{constructor(e){ae(this,Rr,void 0);Ee(this,Rr,E(e))}ifExists(){return new q_({...a(this,Rr),node:R0.cloneWith(a(this,Rr).node,{ifExists:!0})})}cascade(){return new q_({...a(this,Rr),node:R0.cloneWith(a(this,Rr).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return a(this,Rr).executor.transformQuery(a(this,Rr).node,a(this,Rr).queryId)}compile(){return a(this,Rr).executor.compileQuery(this.toOperationNode(),a(this,Rr).queryId)}async execute(){await a(this,Rr).executor.executeQuery(this.compile(),a(this,Rr).queryId)}};Rr=new WeakMap;let s_=q_;xt(s_,"don't await DropSchemaBuilder instances directly. To execute the query you need to call `execute`");const O_=class O_{constructor(e){ae(this,Pr,void 0);Ee(this,Pr,E(e))}ifExists(){return new O_({...a(this,Pr),node:P0.cloneWith(a(this,Pr).node,{ifExists:!0})})}cascade(){return new O_({...a(this,Pr),node:P0.cloneWith(a(this,Pr).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return a(this,Pr).executor.transformQuery(a(this,Pr).node,a(this,Pr).queryId)}compile(){return a(this,Pr).executor.compileQuery(this.toOperationNode(),a(this,Pr).queryId)}async execute(){await a(this,Pr).executor.executeQuery(this.compile(),a(this,Pr).queryId)}};Pr=new WeakMap;let i_=O_;xt(i_,"don't await DropTableBuilder instances directly. To execute the query you need to call `execute`");const ha=E({is(t){return t.kind==="CreateViewNode"},create(t){return E({kind:"CreateViewNode",name:ia.create(t)})},cloneWith(t,e){return E({...t,...e})}});class ote{constructor(){ae(this,I_,new RC)}transformQuery(e){return a(this,I_).transformNode(e.node)}transformResult(e){return Promise.resolve(e.result)}}I_=new WeakMap;const wa=class wa{constructor(e){ae(this,En,void 0);Ee(this,En,E(e))}temporary(){return new wa({...a(this,En),node:ha.cloneWith(a(this,En).node,{temporary:!0})})}materialized(){return new wa({...a(this,En),node:ha.cloneWith(a(this,En).node,{materialized:!0})})}ifNotExists(){return new wa({...a(this,En),node:ha.cloneWith(a(this,En).node,{ifNotExists:!0})})}orReplace(){return new wa({...a(this,En),node:ha.cloneWith(a(this,En).node,{orReplace:!0})})}columns(e){return new wa({...a(this,En),node:ha.cloneWith(a(this,En).node,{columns:e.map(jA)})})}as(e){const n=e.withPlugin(new ote).toOperationNode();return new wa({...a(this,En),node:ha.cloneWith(a(this,En).node,{as:n})})}$call(e){return e(this)}toOperationNode(){return a(this,En).executor.transformQuery(a(this,En).node,a(this,En).queryId)}compile(){return a(this,En).executor.compileQuery(this.toOperationNode(),a(this,En).queryId)}async execute(){await a(this,En).executor.executeQuery(this.compile(),a(this,En).queryId)}};En=new WeakMap;let o_=wa;xt(o_,"don't await CreateViewBuilder instances directly. To execute the query you need to call `execute`");const a_=E({is(t){return t.kind==="DropViewNode"},create(t){return E({kind:"DropViewNode",name:ia.create(t)})},cloneWith(t,e){return E({...t,...e})}}),uh=class uh{constructor(e){ae(this,yr,void 0);Ee(this,yr,E(e))}materialized(){return new uh({...a(this,yr),node:a_.cloneWith(a(this,yr).node,{materialized:!0})})}ifExists(){return new uh({...a(this,yr),node:a_.cloneWith(a(this,yr).node,{ifExists:!0})})}cascade(){return new uh({...a(this,yr),node:a_.cloneWith(a(this,yr).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return a(this,yr).executor.transformQuery(a(this,yr).node,a(this,yr).queryId)}compile(){return a(this,yr).executor.compileQuery(this.toOperationNode(),a(this,yr).queryId)}async execute(){await a(this,yr).executor.executeQuery(this.compile(),a(this,yr).queryId)}};yr=new WeakMap;let c_=uh;xt(c_,"don't await DropViewBuilder instances directly. To execute the query you need to call `execute`");const PC=E({is(t){return t.kind==="CreateTypeNode"},create(t){return E({kind:"CreateTypeNode",name:t})},cloneWithEnum(t,e){return E({...t,enum:B0.create(e.map(n=>oo.createImmediate(n)))})}}),gE=class gE{constructor(e){ae(this,us,void 0);Ee(this,us,E(e))}toOperationNode(){return a(this,us).executor.transformQuery(a(this,us).node,a(this,us).queryId)}asEnum(e){return new gE({...a(this,us),node:PC.cloneWithEnum(a(this,us).node,e)})}$call(e){return e(this)}compile(){return a(this,us).executor.compileQuery(this.toOperationNode(),a(this,us).queryId)}async execute(){await a(this,us).executor.executeQuery(this.compile(),a(this,us).queryId)}};us=new WeakMap;let l_=gE;xt(l_,"don't await CreateTypeBuilder instances directly. To execute the query you need to call `execute`");const $C=E({is(t){return t.kind==="DropTypeNode"},create(t){return E({kind:"DropTypeNode",name:t})},cloneWith(t,e){return E({...t,...e})}}),_E=class _E{constructor(e){ae(this,fs,void 0);Ee(this,fs,E(e))}ifExists(){return new _E({...a(this,fs),node:$C.cloneWith(a(this,fs).node,{ifExists:!0})})}$call(e){return e(this)}toOperationNode(){return a(this,fs).executor.transformQuery(a(this,fs).node,a(this,fs).queryId)}compile(){return a(this,fs).executor.compileQuery(this.toOperationNode(),a(this,fs).queryId)}async execute(){await a(this,fs).executor.executeQuery(this.compile(),a(this,fs).queryId)}};fs=new WeakMap;let u_=_E;xt(u_,"don't await DropTypeBuilder instances directly. To execute the query you need to call `execute`");function LC(t){const e=".";if(t.includes(e)){const n=t.split(e).map(ate);if(n.length===2)return ia.createWithSchema(n[0],n[1]);throw new Error(`invalid schemable identifier ${t}`)}else return ia.create(t)}function ate(t){return t.trim()}const fh=class fh{constructor(e){ae(this,ar,void 0);Ee(this,ar,e)}createTable(e){return new n_({queryId:Dn(),executor:a(this,ar),node:ss.create(Wn(e))})}dropTable(e){return new i_({queryId:Dn(),executor:a(this,ar),node:P0.create(Wn(e))})}createIndex(e){return new e_({queryId:Dn(),executor:a(this,ar),node:so.create(e)})}dropIndex(e){return new r_({queryId:Dn(),executor:a(this,ar),node:Ad.create(e)})}createSchema(e){return new t_({queryId:Dn(),executor:a(this,ar),node:PA.create(e)})}dropSchema(e){return new s_({queryId:Dn(),executor:a(this,ar),node:R0.create(e)})}alterTable(e){return new FC({queryId:Dn(),executor:a(this,ar),node:en.create(Wn(e))})}createView(e){return new o_({queryId:Dn(),executor:a(this,ar),node:ha.create(e)})}dropView(e){return new c_({queryId:Dn(),executor:a(this,ar),node:a_.create(e)})}createType(e){return new l_({queryId:Dn(),executor:a(this,ar),node:PC.create(LC(e))})}dropType(e){return new u_({queryId:Dn(),executor:a(this,ar),node:$C.create(LC(e))})}withPlugin(e){return new fh(a(this,ar).withPlugin(e))}withoutPlugins(){return new fh(a(this,ar).withoutPlugins())}withSchema(e){return new fh(a(this,ar).withPluginAtFront(new Bd(e)))}};ar=new WeakMap;let iE=fh;class cte{ref(e){return new eee(e)}}class lte{constructor(e){ae(this,Hu,void 0);Ee(this,Hu,e)}async provideConnection(e){const n=await a(this,Hu).acquireConnection();try{return await e(n)}finally{await a(this,Hu).releaseConnection(n)}}}Hu=new WeakMap;const Pc=class Pc extends hC{constructor(n,r,s,i=[]){super(i);ae(this,Ni,void 0);ae(this,ki,void 0);ae(this,po,void 0);Ee(this,Ni,n),Ee(this,ki,r),Ee(this,po,s)}get adapter(){return a(this,ki)}compileQuery(n){return a(this,Ni).compileQuery(n)}provideConnection(n){return a(this,po).provideConnection(n)}withPlugins(n){return new Pc(a(this,Ni),a(this,ki),a(this,po),[...this.plugins,...n])}withPlugin(n){return new Pc(a(this,Ni),a(this,ki),a(this,po),[...this.plugins,n])}withPluginAtFront(n){return new Pc(a(this,Ni),a(this,ki),a(this,po),[n,...this.plugins])}withConnectionProvider(n){return new Pc(a(this,Ni),a(this,ki),n,[...this.plugins])}withoutPlugins(){return new Pc(a(this,Ni),a(this,ki),a(this,po),[])}};Ni=new WeakMap,ki=new WeakMap,po=new WeakMap;let oE=Pc;function MC(){return typeof performance<"u"&&rs(performance.now)?performance.now():Date.now()}class ute{constructor(e,n){ae(this,T_);ae(this,A_);ae(this,C_);ae(this,F_);ae(this,hh);ae(this,Gs,void 0);ae(this,Sa,void 0);ae(this,mo,void 0);ae(this,Ju,void 0);ae(this,go,void 0);ae(this,dh,new WeakSet);Ee(this,Ju,!1),Ee(this,Gs,e),Ee(this,Sa,n)}async init(){if(a(this,go))throw new Error("driver has already been destroyed");a(this,mo)||Ee(this,mo,a(this,Gs).init().then(()=>{Ee(this,Ju,!0)}).catch(e=>(Ee(this,mo,void 0),Promise.reject(e)))),await a(this,mo)}async acquireConnection(){if(a(this,go))throw new Error("driver has already been destroyed");a(this,Ju)||await this.init();const e=await a(this,Gs).acquireConnection();return a(this,dh).has(e)||(Lt(this,T_,pF).call(this)&&Lt(this,A_,mF).call(this,e),a(this,dh).add(e)),e}async releaseConnection(e){await a(this,Gs).releaseConnection(e)}beginTransaction(e,n){return a(this,Gs).beginTransaction(e,n)}commitTransaction(e){return a(this,Gs).commitTransaction(e)}rollbackTransaction(e){return a(this,Gs).rollbackTransaction(e)}async destroy(){a(this,mo)&&(await a(this,mo),a(this,go)||Ee(this,go,a(this,Gs).destroy().catch(e=>(Ee(this,go,void 0),Promise.reject(e)))),await a(this,go))}}Gs=new WeakMap,Sa=new WeakMap,mo=new WeakMap,Ju=new WeakMap,go=new WeakMap,dh=new WeakMap,T_=new WeakSet,pF=function(){return a(this,Sa).isLevelEnabled("query")||a(this,Sa).isLevelEnabled("error")},A_=new WeakSet,mF=function(e){const n=e.executeQuery;e.executeQuery=async r=>{let s;const i=MC();try{return await n.call(e,r)}catch(o){throw s=o,await Lt(this,C_,gF).call(this,o,r,i),o}finally{s||await Lt(this,F_,_F).call(this,r,i)}}},C_=new WeakSet,gF=async function(e,n,r){await a(this,Sa).error(()=>({level:"error",error:e,query:n,queryDurationMillis:Lt(this,hh,IE).call(this,r)}))},F_=new WeakSet,_F=async function(e,n){await a(this,Sa).query(()=>({level:"query",query:e,queryDurationMillis:Lt(this,hh,IE).call(this,n)}))},hh=new WeakSet,IE=function(e){return MC()-e};const fte=()=>{};class DC{constructor(e){ae(this,R_);ae(this,ph,void 0);ae(this,Ea,void 0);Ee(this,ph,e)}async provideConnection(e){for(;a(this,Ea);)await a(this,Ea).catch(fte);return Ee(this,Ea,Lt(this,R_,yF).call(this,e).finally(()=>{Ee(this,Ea,void 0)})),a(this,Ea)}}ph=new WeakMap,Ea=new WeakMap,R_=new WeakSet,yF=async function(e){return await e(a(this,ph))};const dte=["read uncommitted","read committed","repeatable read","serializable","snapshot"];E(["query","error"]);class hte{constructor(e){ae(this,va,void 0);ae(this,$c,void 0);rs(e)?(Ee(this,$c,e),Ee(this,va,E({query:!0,error:!0}))):(Ee(this,$c,pte),Ee(this,va,E({query:e.includes("query"),error:e.includes("error")})))}isLevelEnabled(e){return a(this,va)[e]}async query(e){a(this,va).query&&await a(this,$c).call(this,e())}async error(e){a(this,va).error&&await a(this,$c).call(this,e())}}va=new WeakMap,$c=new WeakMap;function pte(t){t.level==="query"?(console.log(`kysely:query: ${t.query.sql}`),console.log(`kysely:query: duration: ${t.queryDurationMillis.toFixed(1)}ms`)):t.level==="error"&&(t.error instanceof Error?console.error(`kysely:error: ${t.error.stack??t.error.message}`):console.error(`kysely:error: ${JSON.stringify({error:t.error,query:t.query.sql,queryDurationMillis:t.queryDurationMillis})}`))}function mte(t){return yi(t)&&rs(t.compile)}const Gu=class Gu extends jg{constructor(n){let r,s;if(gte(n))r={executor:n.executor},s={...n};else{const i=n.dialect,o=i.createDriver(),l=i.createQueryCompiler(),f=i.createAdapter(),m=new hte(n.log??[]),S=new ute(o,m),N=new lte(S),O=new oE(l,f,N,n.plugins??[]);r={executor:O},s={config:n,executor:O,dialect:i,driver:S}}super(r);ae(this,br,void 0);Ee(this,br,E(s))}get schema(){return new iE(a(this,br).executor)}get dynamic(){return new cte}get introspection(){return a(this,br).dialect.createIntrospector(this.withoutPlugins())}case(n){return new bC({node:Si.create(ra(n)?void 0:Sc(n))})}get fn(){return yC()}transaction(){return new f_({...a(this,br)})}connection(){return new WC({...a(this,br)})}withPlugin(n){return new Gu({...a(this,br),executor:a(this,br).executor.withPlugin(n)})}withoutPlugins(){return new Gu({...a(this,br),executor:a(this,br).executor.withoutPlugins()})}withSchema(n){return new Gu({...a(this,br),executor:a(this,br).executor.withPluginAtFront(new Bd(n))})}withTables(){return new Gu({...a(this,br)})}async destroy(){await a(this,br).driver.destroy()}get isTransaction(){return!1}getExecutor(){return a(this,br).executor}executeQuery(n,r=Dn()){const s=mte(n)?n.compile():n;return this.getExecutor().executeQuery(s,r)}};br=new WeakMap;let Gd=Gu;const Yu=class Yu extends Gd{constructor(n){super(n);ae(this,Ys,void 0);Ee(this,Ys,n)}get isTransaction(){return!0}transaction(){throw new Error("calling the transaction method for a Transaction is not supported")}connection(){throw new Error("calling the connection method for a Transaction is not supported")}async destroy(){throw new Error("calling the destroy method for a Transaction is not supported")}withPlugin(n){return new Yu({...a(this,Ys),executor:a(this,Ys).executor.withPlugin(n)})}withoutPlugins(){return new Yu({...a(this,Ys),executor:a(this,Ys).executor.withoutPlugins()})}withSchema(n){return new Yu({...a(this,Ys),executor:a(this,Ys).executor.withPluginAtFront(new Bd(n))})}withTables(){return new Yu({...a(this,Ys)})}};Ys=new WeakMap;let aE=Yu;function gte(t){return yi(t)&&yi(t.config)&&yi(t.driver)&&yi(t.executor)&&yi(t.dialect)}class WC{constructor(e){ae(this,Lc,void 0);Ee(this,Lc,E(e))}async execute(e){return a(this,Lc).executor.provideConnection(async n=>{const r=a(this,Lc).executor.withConnectionProvider(new DC(n)),s=new Gd({...a(this,Lc),executor:r});return await e(s)})}}Lc=new WeakMap,xt(WC,"don't await ConnectionBuilder instances directly. To execute the query you need to call the `execute` method");const yE=class yE{constructor(e){ae(this,Xs,void 0);Ee(this,Xs,E(e))}setIsolationLevel(e){return new yE({...a(this,Xs),isolationLevel:e})}async execute(e){const{isolationLevel:n,...r}=a(this,Xs),s={isolationLevel:n};return _te(s),a(this,Xs).executor.provideConnection(async i=>{const o=a(this,Xs).executor.withConnectionProvider(new DC(i)),l=new aE({...r,executor:o});try{await a(this,Xs).driver.beginTransaction(i,s);const f=await e(l);return await a(this,Xs).driver.commitTransaction(i),f}catch(f){throw await a(this,Xs).driver.rollbackTransaction(i),f}})}};Xs=new WeakMap;let f_=yE;xt(f_,"don't await TransactionBuilder instances directly. To execute the transaction you need to call the `execute` method");function _te(t){if(t.isolationLevel&&!dte.includes(t.isolationLevel))throw new Error(`invalid transaction isolation level ${t.isolationLevel}`)}class yte{constructor(){g(this,"nodeStack",[]);ae(this,P_,E({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this),TupleNode:this.visitTuple.bind(this),MergeQueryNode:this.visitMergeQuery.bind(this),MatchedNode:this.visitMatched.bind(this),AddIndexNode:this.visitAddIndex.bind(this),CastNode:this.visitCast.bind(this),FetchNode:this.visitFetch.bind(this),TopNode:this.visitTop.bind(this),OutputNode:this.visitOutput.bind(this)}));g(this,"visitNode",e=>{this.nodeStack.push(e),a(this,P_)[e.kind](e),this.nodeStack.pop()})}get parentNode(){return this.nodeStack[this.nodeStack.length-2]}}P_=new WeakMap;class bte extends yte{constructor(){super(...arguments);ae(this,Xu,"");ae(this,Mc,[])}get numParameters(){return a(this,Mc).length}compileQuery(n){return Ee(this,Xu,""),Ee(this,Mc,[]),this.nodeStack.splice(0,this.nodeStack.length),this.visitNode(n),E({query:n,sql:this.getSql(),parameters:[...a(this,Mc)]})}getSql(){return a(this,Xu)}visitSelectQuery(n){var s,i;const r=this.parentNode!==void 0&&!Su.is(this.parentNode)&&!os.is(this.parentNode)&&!ss.is(this.parentNode)&&!ha.is(this.parentNode)&&!mC.is(this.parentNode);this.parentNode===void 0&&n.explain&&(this.visitNode(n.explain),this.append(" ")),r&&this.append("("),n.with&&(this.visitNode(n.with),this.append(" ")),this.append("select"),n.distinctOn&&(this.append(" "),this.compileDistinctOn(n.distinctOn)),(s=n.frontModifiers)!=null&&s.length&&(this.append(" "),this.compileList(n.frontModifiers," ")),n.top&&(this.append(" "),this.visitNode(n.top)),n.selections&&(this.append(" "),this.compileList(n.selections)),n.from&&(this.append(" "),this.visitNode(n.from)),n.joins&&(this.append(" "),this.compileList(n.joins," ")),n.where&&(this.append(" "),this.visitNode(n.where)),n.groupBy&&(this.append(" "),this.visitNode(n.groupBy)),n.having&&(this.append(" "),this.visitNode(n.having)),n.setOperations&&(this.append(" "),this.compileList(n.setOperations," ")),n.orderBy&&(this.append(" "),this.visitNode(n.orderBy)),n.limit&&(this.append(" "),this.visitNode(n.limit)),n.offset&&(this.append(" "),this.visitNode(n.offset)),n.fetch&&(this.append(" "),this.visitNode(n.fetch)),(i=n.endModifiers)!=null&&i.length&&(this.append(" "),this.compileList(this.sortSelectModifiers([...n.endModifiers])," ")),r&&this.append(")")}visitFrom(n){this.append("from "),this.compileList(n.froms)}visitSelection(n){this.visitNode(n.selection)}visitColumn(n){this.visitNode(n.column)}compileDistinctOn(n){this.append("distinct on ("),this.compileList(n),this.append(")")}compileList(n,r=", "){const s=n.length-1;for(let i=0;i<=s;i++)this.visitNode(n[i]),i<s&&this.append(r)}visitWhere(n){this.append("where "),this.visitNode(n.where)}visitHaving(n){this.append("having "),this.visitNode(n.having)}visitInsertQuery(n){const r=this.nodeStack.find(tt.is),s=r!==n;!s&&n.explain&&(this.visitNode(n.explain),this.append(" ")),s&&!Kr.is(r)&&this.append("("),n.with&&(this.visitNode(n.with),this.append(" ")),this.append(n.replace?"replace":"insert"),n.ignore&&this.append(" ignore"),n.top&&(this.append(" "),this.visitNode(n.top)),n.into&&(this.append(" into "),this.visitNode(n.into)),n.columns&&(this.append(" ("),this.compileList(n.columns),this.append(")")),n.output&&(this.append(" "),this.visitNode(n.output)),n.values&&(this.append(" "),this.visitNode(n.values)),n.defaultValues&&(this.append(" "),this.append("default values")),n.onConflict&&(this.append(" "),this.visitNode(n.onConflict)),n.onDuplicateKey&&(this.append(" "),this.visitNode(n.onDuplicateKey)),n.returning&&(this.append(" "),this.visitNode(n.returning)),s&&!Kr.is(r)&&this.append(")")}visitValues(n){this.append("values "),this.compileList(n.values)}visitDeleteQuery(n){const r=this.nodeStack.find(tt.is)!==n;!r&&n.explain&&(this.visitNode(n.explain),this.append(" ")),r&&this.append("("),n.with&&(this.visitNode(n.with),this.append(" ")),this.append("delete "),n.top&&(this.visitNode(n.top),this.append(" ")),this.visitNode(n.from),n.output&&(this.append(" "),this.visitNode(n.output)),n.using&&(this.append(" "),this.visitNode(n.using)),n.joins&&(this.append(" "),this.compileList(n.joins," ")),n.where&&(this.append(" "),this.visitNode(n.where)),n.orderBy&&(this.append(" "),this.visitNode(n.orderBy)),n.limit&&(this.append(" "),this.visitNode(n.limit)),n.returning&&(this.append(" "),this.visitNode(n.returning)),r&&this.append(")")}visitReturning(n){this.append("returning "),this.compileList(n.selections)}visitAlias(n){this.visitNode(n.node),this.append(" as "),this.visitNode(n.alias)}visitReference(n){n.table&&(this.visitNode(n.table),this.append(".")),this.visitNode(n.column)}visitSelectAll(n){this.append("*")}visitIdentifier(n){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(n),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(n){if(!ns(n.name))throw new Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(n.name))}visitAnd(n){this.visitNode(n.left),this.append(" and "),this.visitNode(n.right)}visitOr(n){this.visitNode(n.left),this.append(" or "),this.visitNode(n.right)}visitValue(n){n.immediate?this.appendImmediateValue(n.value):this.appendValue(n.value)}visitValueList(n){this.append("("),this.compileList(n.values),this.append(")")}visitTuple(n){this.append("("),this.compileList(n.values),this.append(")")}visitPrimitiveValueList(n){this.append("(");const{values:r}=n;for(let s=0;s<r.length;++s)this.appendValue(r[s]),s!==r.length-1&&this.append(", ");this.append(")")}visitParens(n){this.append("("),this.visitNode(n.node),this.append(")")}visitJoin(n){this.append(Ste[n.joinType]),this.append(" "),this.visitNode(n.table),n.on&&(this.append(" "),this.visitNode(n.on))}visitOn(n){this.append("on "),this.visitNode(n.on)}visitRaw(n){const{sqlFragments:r,parameters:s}=n;for(let i=0;i<r.length;++i)this.append(r[i]),s.length>i&&this.visitNode(s[i])}visitOperator(n){this.append(n.operator)}visitTable(n){this.visitNode(n.table)}visitSchemableIdentifier(n){n.schema&&(this.visitNode(n.schema),this.append(".")),this.visitNode(n.identifier)}visitCreateTable(n){this.append("create "),n.frontModifiers&&n.frontModifiers.length>0&&(this.compileList(n.frontModifiers," "),this.append(" ")),n.temporary&&this.append("temporary "),this.append("table "),n.ifNotExists&&this.append("if not exists "),this.visitNode(n.table),n.selectQuery?(this.append(" as "),this.visitNode(n.selectQuery)):(this.append(" ("),this.compileList([...n.columns,...n.constraints??[]]),this.append(")"),n.onCommit&&(this.append(" on commit "),this.append(n.onCommit)),n.endModifiers&&n.endModifiers.length>0&&(this.append(" "),this.compileList(n.endModifiers," ")))}visitColumnDefinition(n){n.ifNotExists&&this.append("if not exists "),this.visitNode(n.column),this.append(" "),this.visitNode(n.dataType),n.unsigned&&this.append(" unsigned"),n.frontModifiers&&n.frontModifiers.length>0&&(this.append(" "),this.compileList(n.frontModifiers," ")),n.generated&&(this.append(" "),this.visitNode(n.generated)),n.identity&&this.append(" identity"),n.defaultTo&&(this.append(" "),this.visitNode(n.defaultTo)),n.notNull&&this.append(" not null"),n.unique&&this.append(" unique"),n.nullsNotDistinct&&this.append(" nulls not distinct"),n.primaryKey&&this.append(" primary key"),n.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),n.references&&(this.append(" "),this.visitNode(n.references)),n.check&&(this.append(" "),this.visitNode(n.check)),n.endModifiers&&n.endModifiers.length>0&&(this.append(" "),this.compileList(n.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(n){this.append("references "),this.visitNode(n.table),this.append(" ("),this.compileList(n.columns),this.append(")"),n.onDelete&&(this.append(" on delete "),this.append(n.onDelete)),n.onUpdate&&(this.append(" on update "),this.append(n.onUpdate))}visitDropTable(n){this.append("drop table "),n.ifExists&&this.append("if exists "),this.visitNode(n.table),n.cascade&&this.append(" cascade")}visitDataType(n){this.append(n.dataType)}visitOrderBy(n){this.append("order by "),this.compileList(n.items)}visitOrderByItem(n){this.visitNode(n.orderBy),n.direction&&(this.append(" "),this.visitNode(n.direction))}visitGroupBy(n){this.append("group by "),this.compileList(n.items)}visitGroupByItem(n){this.visitNode(n.groupBy)}visitUpdateQuery(n){const r=this.nodeStack.find(tt.is),s=r!==n;!s&&n.explain&&(this.visitNode(n.explain),this.append(" ")),s&&!Kr.is(r)&&this.append("("),n.with&&(this.visitNode(n.with),this.append(" ")),this.append("update "),n.top&&(this.visitNode(n.top),this.append(" ")),n.table&&(this.visitNode(n.table),this.append(" ")),this.append("set "),n.updates&&this.compileList(n.updates),n.output&&(this.append(" "),this.visitNode(n.output)),n.from&&(this.append(" "),this.visitNode(n.from)),n.joins&&(this.append(" "),this.compileList(n.joins," ")),n.where&&(this.append(" "),this.visitNode(n.where)),n.limit&&(this.append(" "),this.visitNode(n.limit)),n.returning&&(this.append(" "),this.visitNode(n.returning)),s&&!Kr.is(r)&&this.append(")")}visitColumnUpdate(n){this.visitNode(n.column),this.append(" = "),this.visitNode(n.value)}visitLimit(n){this.append("limit "),this.visitNode(n.limit)}visitOffset(n){this.append("offset "),this.visitNode(n.offset)}visitOnConflict(n){this.append("on conflict"),n.columns?(this.append(" ("),this.compileList(n.columns),this.append(")")):n.constraint?(this.append(" on constraint "),this.visitNode(n.constraint)):n.indexExpression&&(this.append(" ("),this.visitNode(n.indexExpression),this.append(")")),n.indexWhere&&(this.append(" "),this.visitNode(n.indexWhere)),n.doNothing===!0?this.append(" do nothing"):n.updates&&(this.append(" do update set "),this.compileList(n.updates),n.updateWhere&&(this.append(" "),this.visitNode(n.updateWhere)))}visitOnDuplicateKey(n){this.append("on duplicate key update "),this.compileList(n.updates)}visitCreateIndex(n){this.append("create "),n.unique&&this.append("unique "),this.append("index "),n.ifNotExists&&this.append("if not exists "),this.visitNode(n.name),n.table&&(this.append(" on "),this.visitNode(n.table)),n.using&&(this.append(" using "),this.visitNode(n.using)),n.columns&&(this.append(" ("),this.compileList(n.columns),this.append(")")),n.nullsNotDistinct&&this.append(" nulls not distinct"),n.where&&(this.append(" "),this.visitNode(n.where))}visitDropIndex(n){this.append("drop index "),n.ifExists&&this.append("if exists "),this.visitNode(n.name),n.table&&(this.append(" on "),this.visitNode(n.table)),n.cascade&&this.append(" cascade")}visitCreateSchema(n){this.append("create schema "),n.ifNotExists&&this.append("if not exists "),this.visitNode(n.schema)}visitDropSchema(n){this.append("drop schema "),n.ifExists&&this.append("if exists "),this.visitNode(n.schema),n.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(n){n.name&&(this.append("constraint "),this.visitNode(n.name),this.append(" ")),this.append("primary key ("),this.compileList(n.columns),this.append(")")}visitUniqueConstraint(n){n.name&&(this.append("constraint "),this.visitNode(n.name),this.append(" ")),this.append("unique"),n.nullsNotDistinct&&this.append(" nulls not distinct"),this.append(" ("),this.compileList(n.columns),this.append(")")}visitCheckConstraint(n){n.name&&(this.append("constraint "),this.visitNode(n.name),this.append(" ")),this.append("check ("),this.visitNode(n.expression),this.append(")")}visitForeignKeyConstraint(n){n.name&&(this.append("constraint "),this.visitNode(n.name),this.append(" ")),this.append("foreign key ("),this.compileList(n.columns),this.append(") "),this.visitNode(n.references),n.onDelete&&(this.append(" on delete "),this.append(n.onDelete)),n.onUpdate&&(this.append(" on update "),this.append(n.onUpdate))}visitList(n){this.compileList(n.items)}visitWith(n){this.append("with "),n.recursive&&this.append("recursive "),this.compileList(n.expressions)}visitCommonTableExpression(n){this.visitNode(n.name),this.append(" as "),xg(n.materialized)&&(n.materialized||this.append("not "),this.append("materialized ")),this.visitNode(n.expression)}visitCommonTableExpressionName(n){this.visitNode(n.table),n.columns&&(this.append("("),this.compileList(n.columns),this.append(")"))}visitAlterTable(n){this.append("alter table "),this.visitNode(n.table),this.append(" "),n.renameTo&&(this.append("rename to "),this.visitNode(n.renameTo)),n.setSchema&&(this.append("set schema "),this.visitNode(n.setSchema)),n.addConstraint&&this.visitNode(n.addConstraint),n.dropConstraint&&this.visitNode(n.dropConstraint),n.columnAlterations&&this.compileColumnAlterations(n.columnAlterations),n.addIndex&&this.visitNode(n.addIndex),n.dropIndex&&this.visitNode(n.dropIndex)}visitAddColumn(n){this.append("add column "),this.visitNode(n.column)}visitRenameColumn(n){this.append("rename column "),this.visitNode(n.column),this.append(" to "),this.visitNode(n.renameTo)}visitDropColumn(n){this.append("drop column "),this.visitNode(n.column)}visitAlterColumn(n){this.append("alter column "),this.visitNode(n.column),this.append(" "),n.dataType&&(this.announcesNewColumnDataType()&&this.append("type "),this.visitNode(n.dataType),n.dataTypeExpression&&(this.append("using "),this.visitNode(n.dataTypeExpression))),n.setDefault&&(this.append("set default "),this.visitNode(n.setDefault)),n.dropDefault&&this.append("drop default"),n.setNotNull&&this.append("set not null"),n.dropNotNull&&this.append("drop not null")}visitModifyColumn(n){this.append("modify column "),this.visitNode(n.column)}visitAddConstraint(n){this.append("add "),this.visitNode(n.constraint)}visitDropConstraint(n){this.append("drop constraint "),n.ifExists&&this.append("if exists "),this.visitNode(n.constraintName),n.modifier==="cascade"?this.append(" cascade"):n.modifier==="restrict"&&this.append(" restrict")}visitSetOperation(n){this.append(n.operator),this.append(" "),n.all&&this.append("all "),this.visitNode(n.expression)}visitCreateView(n){this.append("create "),n.orReplace&&this.append("or replace "),n.materialized&&this.append("materialized "),n.temporary&&this.append("temporary "),this.append("view "),n.ifNotExists&&this.append("if not exists "),this.visitNode(n.name),this.append(" "),n.columns&&(this.append("("),this.compileList(n.columns),this.append(") ")),n.as&&(this.append("as "),this.visitNode(n.as))}visitDropView(n){this.append("drop "),n.materialized&&this.append("materialized "),this.append("view "),n.ifExists&&this.append("if exists "),this.visitNode(n.name),n.cascade&&this.append(" cascade")}visitGenerated(n){this.append("generated "),n.always&&this.append("always "),n.byDefault&&this.append("by default "),this.append("as "),n.identity&&this.append("identity"),n.expression&&(this.append("("),this.visitNode(n.expression),this.append(")")),n.stored&&this.append(" stored")}visitDefaultValue(n){this.append("default "),this.visitNode(n.defaultValue)}visitSelectModifier(n){n.rawModifier?this.visitNode(n.rawModifier):this.append(wte[n.modifier]),n.of&&(this.append(" of "),this.compileList(n.of,", "))}visitCreateType(n){this.append("create type "),this.visitNode(n.name),n.enum&&(this.append(" as enum "),this.visitNode(n.enum))}visitDropType(n){this.append("drop type "),n.ifExists&&this.append("if exists "),this.visitNode(n.name)}visitExplain(n){this.append("explain"),(n.options||n.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),n.options&&(this.visitNode(n.options),n.format&&this.append(this.getExplainOptionsDelimiter())),n.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(n.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(n){this.append("default")}visitAggregateFunction(n){this.append(n.func),this.append("("),n.distinct&&this.append("distinct "),this.compileList(n.aggregated),this.append(")"),n.filter&&(this.append(" filter("),this.visitNode(n.filter),this.append(")")),n.over&&(this.append(" "),this.visitNode(n.over))}visitOver(n){this.append("over("),n.partitionBy&&(this.visitNode(n.partitionBy),n.orderBy&&this.append(" ")),n.orderBy&&this.visitNode(n.orderBy),this.append(")")}visitPartitionBy(n){this.append("partition by "),this.compileList(n.items)}visitPartitionByItem(n){this.visitNode(n.partitionBy)}visitBinaryOperation(n){this.visitNode(n.leftOperand),this.append(" "),this.visitNode(n.operator),this.append(" "),this.visitNode(n.rightOperand)}visitUnaryOperation(n){this.visitNode(n.operator),this.isMinusOperator(n.operator)||this.append(" "),this.visitNode(n.operand)}isMinusOperator(n){return ca.is(n)&&n.operator==="-"}visitUsing(n){this.append("using "),this.compileList(n.tables)}visitFunction(n){this.append(n.func),this.append("("),this.compileList(n.arguments),this.append(")")}visitCase(n){this.append("case"),n.value&&(this.append(" "),this.visitNode(n.value)),n.when&&(this.append(" "),this.compileList(n.when," ")),n.else&&(this.append(" else "),this.visitNode(n.else)),this.append(" end"),n.isStatement&&this.append(" case")}visitWhen(n){this.append("when "),this.visitNode(n.condition),n.result&&(this.append(" then "),this.visitNode(n.result))}visitJSONReference(n){this.visitNode(n.reference),this.visitNode(n.traversal)}visitJSONPath(n){n.inOperator&&this.visitNode(n.inOperator),this.append("'$");for(const r of n.pathLegs)this.visitNode(r);this.append("'")}visitJSONPathLeg(n){const r=n.type==="ArrayLocation";this.append(r?"[":"."),this.append(String(n.value)),r&&this.append("]")}visitJSONOperatorChain(n){for(let r=0,s=n.values.length;r<s;r++)r===s-1?this.visitNode(n.operator):this.append("->"),this.visitNode(n.values[r])}visitMergeQuery(n){n.with&&(this.visitNode(n.with),this.append(" ")),this.append("merge "),n.top&&(this.visitNode(n.top),this.append(" ")),this.append("into "),this.visitNode(n.into),n.using&&(this.append(" "),this.visitNode(n.using)),n.whens&&(this.append(" "),this.compileList(n.whens," ")),n.output&&(this.append(" "),this.visitNode(n.output))}visitMatched(n){n.not&&this.append("not "),this.append("matched"),n.bySource&&this.append(" by source")}visitAddIndex(n){this.append("add "),n.unique&&this.append("unique "),this.append("index "),this.visitNode(n.name),n.columns&&(this.append(" ("),this.compileList(n.columns),this.append(")")),n.using&&(this.append(" using "),this.visitNode(n.using))}visitCast(n){this.append("cast("),this.visitNode(n.expression),this.append(" as "),this.visitNode(n.dataType),this.append(")")}visitFetch(n){this.append("fetch next "),this.visitNode(n.rowCount),this.append(` rows ${n.modifier}`)}visitOutput(n){this.append("output "),this.compileList(n.selections)}visitTop(n){this.append(`top(${n.expression})`),n.modifiers&&this.append(` ${n.modifiers}`)}append(n){Ee(this,Xu,a(this,Xu)+n)}appendValue(n){this.addParameter(n),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(n){const r=this.getLeftIdentifierWrapper(),s=this.getRightIdentifierWrapper();let i="";for(const o of n)i+=o,o===r?i+=r:o===s&&(i+=s);return i}addParameter(n){a(this,Mc).push(n)}appendImmediateValue(n){if(ns(n))this.append(`'${n}'`);else if(kg(n)||xg(n))this.append(n.toString());else if(C0(n))this.append("null");else if(VZ(n))this.appendImmediateValue(n.toISOString());else if(F0(n))this.appendImmediateValue(n.toString());else throw new Error(`invalid immediate value ${n}`)}sortSelectModifiers(n){return n.sort((r,s)=>r.modifier&&s.modifier?BC[r.modifier]-BC[s.modifier]:1),E(n)}compileColumnAlterations(n){this.compileList(n)}announcesNewColumnDataType(){return!0}}Xu=new WeakMap,Mc=new WeakMap;const wte=E({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),BC=E({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),Ste=E({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral",Using:"using"});class Ete{async init(){}async acquireConnection(){return new vte}async beginTransaction(){}async commitTransaction(){}async rollbackTransaction(){}async releaseConnection(){}async destroy(){}}class vte{async executeQuery(){return{rows:[]}}async*streamQuery(){}}class Nte{get supportsCreateIfNotExists(){return!0}get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}get supportsOutput(){return!1}}const kte=/"/g;class xte extends bte{getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(e){return e.replace(kte,'""')}visitDefaultInsertValue(e){this.append("null")}}class qte extends Nte{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(e,n){}async releaseMigrationLock(e,n){}}let d_,UC,jC,cE=!1;const Ote=3e3,Ite=500,Tte=500;let vc;const zC=(t,e)=>{typeof e.data=="string"||cE===!0||(clearTimeout(d_),d_=void 0,d_=setTimeout(()=>{cE=!0,t({refreshQueries:!0})(),clearTimeout(d_),clearTimeout(UC),UC=setTimeout(()=>{cE=!1},Tte)},Ite))},VC=(t,e,n)=>{var r;if(e.externalWebsocketConnection)return e.externalWebsocketConnection.send(JSON.stringify({message:"subscribe",channelId:n.id})),e.externalWebsocketConnection.addEventListener("message",s=>zC(t,s)),e.externalWebsocketConnection;if(e.enableWebsocketConnection)return vc=new WebSocket((r=e.syncUrl)==null?void 0:r.replace("http","ws")),vc.addEventListener("message",s=>zC(t,s)),vc.onerror=s=>{console.error("WebSocket error:",s)},vc.onclose=()=>{jC=setTimeout(()=>VC(t,e,n),Ote)},vc.onopen=()=>{vc.send(JSON.stringify({message:"subscribe",channelId:n.id})),clearTimeout(jC)},vc},h_=t=>Rt(()=>{const e=new Set;let n=t;return{subscribe(s){return e.add(s),()=>{e.delete(s)}},getState(){return n},setState:s=>Rt(()=>{s!==n&&(n=s,e.forEach(i=>i()))})}});class lE extends Ai("EvoluFactory")(){}lE.Common=Nm(lE,Wt(function*(){const t=yield*Me(CO(QS),nn(()=>r=>r())),e=Ns().pipe(zt(k0,yield*k0),zt(Ws,yield*Ws),zt(QS,t),zt(sg,yield*sg)),n=new Map;return lE.of({createEvolu:(r,{indexes:s,initialData:i,mnemonic:o,...l}={})=>{const f=Vw(l),m=(l==null?void 0:l.name)||pO.name,S={tables:Ate(r),indexes:s||[]};let N=n.get(m);return N==null?(N=Cte(S,f,i,o).pipe(ci(e),f.runSync),n.set(m,N)):N.ensureSchema(S),N}})}));const Ate=t=>I(KC(t),H2,xs(([e,n])=>({name:e,columns:Object.keys(KC(n))}))),KC=t=>{const e={},n=dS(t.ast);for(let r=0;r<n.length;r++){const s=n[r];e[s.name]=hi(s.type)}return e},Cte=(t,e,n,r)=>Wt(function*(){yield*rr("EvoluFactory createEvolu");const s=yield*Ko,i=yield*k0,o=yield*sg,l=yield*Ws,f=yield*QS,m=yield*i.createDb,S=yield*h_(null),N=yield*h_(null),O=yield*h_(new Map),M=yield*h_(TZ),z=new Map,Z=new Map,J=ke=>ke.pipe(Tm(Ne=>dr(E1(Ne))),tS(LO),tS(S.setState)),ee=j_(J,e.runFork),ve=j_(J,e.runSync),ye=j_(J,e.runPromise),Fe=yield*Xw(Fte(n),Ws,l),Je=ke=>{dr(ke).pipe(ee)},Xe=ke=>{Br(["Evolu handleSyncStateChange",{state:ke}]).pipe(an(M.setState(ke)),ee)},We=()=>{Wt(function*(){yield*rr("Evolu handleDbReceive"),qt();const ke=[...Z.keys()];ke.length>0&&(yield*Te(m.loadQueries(ke),He()))}).pipe(ee)},Re=({refreshQueries:ke})=>()=>{Te(m.sync(ke?[...Z.keys()]:[]),He()).pipe(ee)};m.init(t,Fe,Je,Xe,We,r).pipe(on(Re({refreshQueries:!1})),Te(N.setState),Xl("NotSupportedPlatformError",()=>Dt),ee);let Be=!1;const ze=new Promise(ke=>{N.subscribe(()=>{const Ne=N.getState();!Be&&typeof(Ne==null?void 0:Ne.id)=="string"&&(Be=!0,ke(VC(Re,s,Ne)))})}),Le=yield*o.init({onRequestSync:Re({refreshQueries:!0}),reloadUrl:s.reloadUrl}),He=ke=>Ne=>Br(["Evolu handlePatches",{patches:Ne}]).pipe(an(Ze(Ne)),on(Ve=>Wr(Ne,({query:kt})=>ht(kt,Ve.get(kt)||A0()))),on(Ve=>{ke!=null&&ke.flushSync?f(()=>{O.setState(Ve).pipe(ve)}):O.setState(Ve).pipe(ve)})),Ze=ke=>Rt(()=>{const Ne=O.getState();if(ke.length===0)return Ne;const Ve=xs(ke,({query:kt,patches:Ut})=>[kt,H9(Ut,Ne.get(kt)||A0())]);return new Map([...Ne,...Ve])}),ht=(ke,Ne)=>Rt(()=>{const Ve=z.get(ke);if(!Ve)return;const kt=RA(Ne);Ve.promise.status!=="fulfilled"?Ve.resolve(kt):Ve.promise=Promise.resolve(kt),Object.assign(Ve.promise,{status:"fulfilled",value:kt}),Ve.releaseOnResolve&&z.delete(ke)}),qt=()=>{[...z.entries()].filter(([ke])=>!Z.has(ke)).forEach(([ke,Ne])=>{Ne.promise.status==="fulfilled"?z.delete(ke):Ne.releaseOnResolve=!0})},Ae=(()=>{let ke=[];return(Ne,{id:Ve,...kt},Ut)=>{Br(["Evolu mutate",{table:Ne,id:Ve,values:kt}]).pipe(ve);const kr=Ve==null;return kr&&(Ve=l.rowId.pipe(ve)),ke=[...ke,[{table:Ne,id:Ve,values:kt,isInsert:kr},Ut]],ke.length===1&&queueMicrotask(()=>{const[xi,qi]=dR(ke);ke=[];const Zs=qi.filter(SF);qt(),m.mutate(xi,[...Z.keys()]).pipe(Te(He({flushSync:Zs.length>0})),on(()=>{Zs.forEach(Oi=>Oi())}),ee)}),{id:Ve}}})(),Ue={socket:ze,subscribeError:S.subscribe,getError:S.getState,createQuery:(ke,Ne)=>I(ke(uE).compile(),Ve=>{if(tG(Ve.sql))throw new Error("SQL mutation (INSERT, UPDATE, DELETE, etc.) isn't allowed in the Evolu `createQuery` function. Kysely suggests it because there is no read-only Kysely yet, and removing such an API is not possible. For mutations, use Evolu mutation API.");const kt=Ve.parameters;return{sql:Ve.sql,parameters:kt,...Ne&&{options:Ne}}},Ve=>jZ(Ve)),loadQuery:(()=>{let ke=[];return Ne=>{Br(["Evolu loadQuery",{query:CA(Ne)}]).pipe(ve);let Ve=z.get(Ne);if(!Ve){let kt=bo;const Ut=new Promise(kr=>{kt=kr});Ve={resolve:kt,promise:Ut,releaseOnResolve:!1},z.set(Ne,Ve),ke=[...ke,Ne],ke.length===1&&queueMicrotask(()=>{m.loadQueries(vv(ke)).pipe(Te(He()),ee),ke=[]})}return Ve.promise}})(),loadQueries:ke=>ke.map(Ue.loadQuery),subscribeQuery:ke=>Ne=>{Z.set(ke,Sk(Z.get(ke)??0));const Ve=O.subscribe(Ne);return()=>{const kt=Z.get(ke);kt!=null&&kt>1?Z.set(ke,cM(kt)):Z.delete(ke),Ve()}},getQuery:ke=>RA(O.getState().get(ke)||A0()),subscribeOwner:N.subscribe,getOwner:N.getState,subscribeSyncState:M.subscribe,getSyncState:M.getState,create:Ae,update:Ae,createOrUpdate:Ae,resetOwner:ke=>Wt(function*(){yield*m.resetOwner(),(ke==null?void 0:ke.reload)!==!1&&(yield*Le.reset)}).pipe(ye),restoreOwner:(ke,Ne)=>Wt(function*(){yield*m.restoreOwner(t,ke),(Ne==null?void 0:Ne.reload)!==!1&&(yield*Le.reset)}).pipe(ye),reloadApp:()=>{Le.reset.pipe(ee)},ensureSchema:ke=>{m.ensureSchema(ke).pipe(ee)},exportDatabase:()=>m.exportDatabase().pipe(ye)};return Ue}),Fte=(t=bo)=>Me(Ws,e=>{const n=[],r=(i,{id:o,...l})=>(o==null&&(o=e.rowId.pipe(ui)),n.push({isInsert:!0,id:o,table:i,values:l}),{id:o});return t({create:r,createOrUpdate:r}),n}),uE=new Gd({dialect:{createAdapter:()=>new qte,createDriver:()=>new Ete,createIntrospector(){throw"Not implemeneted"},createQueryCompiler:()=>new xte}});uE.schema.createIndex.bind(uE.schema);const p_=t=>Me(Ko,e=>`evolu:${e.name}:${t}`);let Rte=t=>crypto.getRandomValues(new Uint8Array(t)),Pte=(t,e,n)=>{let r=(2<<Math.log(t.length-1)/Math.LN2)-1,s=-~(1.6*r*e/t.length);return(i=e)=>{let o="";for(;;){let l=n(s),f=s;for(;f--;)if(o+=t[l[f]&r]||"",o.length===i)return o}}},$te=(t,e=21)=>Pte(t,e,Rte),QC=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,n)=>(n&=63,n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n>62?e+="-":e+="_",e),"");const HC=I9($te,QC);rc(sg,{init:({reloadUrl:t,onRequestSync:e})=>Rt(()=>{if(typeof document>"u")return{reset:Dt};const n="evolu:reloadAllTabs",r=()=>{location.replace(t)};window.addEventListener("storage",l=>{l.key===n&&r()});let s;const i=()=>{s==null&&(e(),s=window.setTimeout(()=>{s=null},50))};return window.addEventListener("online",i),document.addEventListener("visibilitychange",()=>{document.visibilityState!=="hidden"&&i()}),window.addEventListener("focus",i),{reset:Rt(()=>{localStorage.setItem(n,Date.now().toString()),r()})}})});const Lte=rc(ig,{tryAcquire:Wt(function*(){yield*rr("SyncLock tryAcquire");const t=yield*p_("SyncLock"),e=sc(r=>{navigator.locks.request(t,{ifAvailable:!0},s=>{if(s==null){rr("SyncLock not acquired").pipe(an(dr(new aG)),r);return}return new Promise(i=>{rr("SyncLock acquired").pipe(an(Tt({release:rr("SyncLock released").pipe(on(Rt(i)))})),r)})})});return yield*eu(e,({release:r})=>r)})}),Mte=t=>{const e=new Map;return t.onmessage=({data:r})=>{const s=e.get(r.id);s&&(s(r.response),e.delete(r.id))},new Proxy(t,{get(r,s){return(...i)=>Te(Ko,o=>sc(l=>{const f=[],m=i.map(O=>{if(typeof O!="function")return O;const M=new MessageChannel;return M.port1.onmessage=({data:z})=>{O(...z)},f.push(M.port2),M.port2}),S=QC();e.set(S,O=>{l(nH[O._tag](O.value))});const N={id:S,name:s,args:m,config:o};r.postMessage(N,f)}))}})},Dte=t=>{let e=null;onmessage=({data:{id:n,name:r,args:s,config:i}})=>{e==null&&(e=Vw(i));const o=s.map(l=>l instanceof MessagePort?(...f)=>{l.postMessage(f)}:l);e.runFork(t[r](...o).pipe(Me(l=>({id:n,response:{_tag:"succeed",value:l}})),ic(l=>Tt({id:n,response:{_tag:"fail",value:l}})),Tm(l=>Tt({id:n,response:{_tag:"die",value:jS(l)}})),on(l=>postMessage(l))))}};var fE=(()=>{var t=self.location.href;return function(e){var n=e||{},r=typeof n<"u"?n:{},s,i;r.ready=new Promise(function(u,c){s=u,i=c});const o=globalThis.sqlite3InitModuleState||Object.assign(Object.create(null),{debugModule:()=>{}});delete globalThis.sqlite3InitModuleState,o.debugModule("globalThis.location =",globalThis.location);const l="emscripten-bug-17951";r[l]=function u(c,h){c.env.foo=function(){};const d=r.locateFile(u.uri,typeof O>"u"?"":O);o.debugModule("instantiateWasm() uri =",d);const p=()=>fetch(d,{credentials:"same-origin"});return(WebAssembly.instantiateStreaming?async()=>WebAssembly.instantiateStreaming(p(),c).then(A=>h(A.instance,A.module)):async()=>p().then(A=>A.arrayBuffer()).then(A=>WebAssembly.instantiate(A,c)).then(A=>h(A.instance,A.module)))(),{}},r[l].uri="sqlite3.wasm";var f=Object.assign({},r),m="./this.program",S=typeof window=="object",N=typeof importScripts=="function";typeof process=="object"&&typeof process.versions=="object"&&process.versions.node;var O="";function M(u){return r.locateFile?r.locateFile(u,O):O+u}var z,Z,J;(S||N)&&(N?O=self.location.href:typeof document<"u"&&document.currentScript&&(O=document.currentScript.src),t&&(O=t),O.indexOf("blob:")!==0?O=O.substr(0,O.replace(/[?#].*/,"").lastIndexOf("/")+1):O="",z=u=>{var c=new XMLHttpRequest;return c.open("GET",u,!1),c.send(null),c.responseText},N&&(J=u=>{var c=new XMLHttpRequest;return c.open("GET",u,!1),c.responseType="arraybuffer",c.send(null),new Uint8Array(c.response)}),Z=(u,c,h)=>{var d=new XMLHttpRequest;d.open("GET",u,!0),d.responseType="arraybuffer",d.onload=()=>{if(d.status==200||d.status==0&&d.response){c(d.response);return}h()},d.onerror=h,d.send(null)});var ee=r.print||console.log.bind(console),ve=r.printErr||console.warn.bind(console);Object.assign(r,f),f=null,r.arguments&&r.arguments,r.thisProgram&&(m=r.thisProgram),r.quit&&r.quit;var ye;r.wasmBinary&&(ye=r.wasmBinary),r.noExitRuntime,typeof WebAssembly!="object"&&Zu("no native wasm support detected");var Fe,Je=!1;function Xe(u,c){u||Zu(c)}var We=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function Re(u,c,h){for(var d=c+h,p=c;u[p]&&!(p>=d);)++p;if(p-c>16&&u.buffer&&We)return We.decode(u.subarray(c,p));for(var y="";c<p;){var A=u[c++];if(!(A&128)){y+=String.fromCharCode(A);continue}var P=u[c++]&63;if((A&224)==192){y+=String.fromCharCode((A&31)<<6|P);continue}var te=u[c++]&63;if((A&240)==224?A=(A&15)<<12|P<<6|te:A=(A&7)<<18|P<<12|te<<6|u[c++]&63,A<65536)y+=String.fromCharCode(A);else{var ne=A-65536;y+=String.fromCharCode(55296|ne>>10,56320|ne&1023)}}return y}function Be(u,c){return u?Re(ht,u,c):""}function ze(u,c,h,d){if(!(d>0))return 0;for(var p=h,y=h+d-1,A=0;A<u.length;++A){var P=u.charCodeAt(A);if(P>=55296&&P<=57343){var te=u.charCodeAt(++A);P=65536+((P&1023)<<10)|te&1023}if(P<=127){if(h>=y)break;c[h++]=P}else if(P<=2047){if(h+1>=y)break;c[h++]=192|P>>6,c[h++]=128|P&63}else if(P<=65535){if(h+2>=y)break;c[h++]=224|P>>12,c[h++]=128|P>>6&63,c[h++]=128|P&63}else{if(h+3>=y)break;c[h++]=240|P>>18,c[h++]=128|P>>12&63,c[h++]=128|P>>6&63,c[h++]=128|P&63}}return c[h]=0,h-p}function Le(u,c,h){return ze(u,ht,c,h)}function He(u){for(var c=0,h=0;h<u.length;++h){var d=u.charCodeAt(h);d<=127?c++:d<=2047?c+=2:d>=55296&&d<=57343?(c+=4,++h):c+=3}return c}var Ze,ht,qt,Ae,Ue;function ke(){var u=Fe.buffer;r.HEAP8=Ze=new Int8Array(u),r.HEAP16=qt=new Int16Array(u),r.HEAP32=Ae=new Int32Array(u),r.HEAPU8=ht=new Uint8Array(u),r.HEAPU16=new Uint16Array(u),r.HEAPU32=Ue=new Uint32Array(u),r.HEAPF32=new Float32Array(u),r.HEAPF64=new Float64Array(u),r.HEAP64=new BigInt64Array(u),r.HEAPU64=new BigUint64Array(u)}var Ne=r.INITIAL_MEMORY||16777216;r.wasmMemory?Fe=r.wasmMemory:Fe=new WebAssembly.Memory({initial:Ne/65536,maximum:2147483648/65536}),ke(),Ne=Fe.buffer.byteLength;var Ve=[],kt=[],Ut=[];function kr(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)Zs(r.preRun.shift());wE(Ve)}function xi(){!r.noFSInit&&!_.init.initialized&&_.init(),_.ignorePermissions=!1,wE(kt)}function qi(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)Na(r.postRun.shift());wE(Ut)}function Zs(u){Ve.unshift(u)}function Oi(u){kt.unshift(u)}function Na(u){Ut.unshift(u)}var Qr=0,mh=null;function zie(u){return u}function bE(u){Qr++,r.monitorRunDependencies&&r.monitorRunDependencies(Qr)}function $_(u){if(Qr--,r.monitorRunDependencies&&r.monitorRunDependencies(Qr),Qr==0&&mh){var c=mh;mh=null,c()}}function Zu(u){r.onAbort&&r.onAbort(u),u="Aborted("+u+")",ve(u),Je=!0,u+=". Build with -sASSERTIONS for more info.";var c=new WebAssembly.RuntimeError(u);throw i(c),c}var ire="data:application/octet-stream;base64,";function GC(u){return u.startsWith(ire)}var vs;r.locateFile?(vs="sqlite3.wasm",GC(vs)||(vs=M(vs))):vs=new URL("/tea-tracker-test/assets/sqlite3-BqX9F35q.wasm",self.location.href).href;function YC(u){try{if(u==vs&&ye)return new Uint8Array(ye);if(J)return J(u);throw"both async and sync fetching of the wasm failed"}catch(c){Zu(c)}}function ore(){return!ye&&(S||N)&&typeof fetch=="function"?fetch(vs,{credentials:"same-origin"}).then(function(u){if(!u.ok)throw"failed to load wasm binary file at '"+vs+"'";return u.arrayBuffer()}).catch(function(){return YC(vs)}):Promise.resolve().then(function(){return YC(vs)})}function are(){var u={env:rF,wasi_snapshot_preview1:rF};function c(A,P){var te=A.exports;r.asm=te,r.asm.__indirect_function_table,Oi(r.asm.__wasm_call_ctors),$_()}bE();function h(A){c(A.instance)}function d(A){return ore().then(function(P){return WebAssembly.instantiate(P,u)}).then(function(P){return P}).then(A,function(P){ve("failed to asynchronously prepare wasm: "+P),Zu(P)})}function p(){return!ye&&typeof WebAssembly.instantiateStreaming=="function"&&!GC(vs)&&typeof fetch=="function"?fetch(vs,{credentials:"same-origin"}).then(function(A){var P=WebAssembly.instantiateStreaming(A,u);return P.then(h,function(te){return ve("wasm streaming compile failed: "+te),ve("falling back to ArrayBuffer instantiation"),d(h)})}):d(h)}if(r.instantiateWasm)try{var y=r.instantiateWasm(u,c);return y}catch(A){ve("Module.instantiateWasm callback failed with error: "+A),i(A)}return p().catch(i),{}}var Ft,cr;function wE(u){for(;u.length>0;)u.shift()(r)}var jt={isAbs:u=>u.charAt(0)==="/",splitPath:u=>{var c=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return c.exec(u).slice(1)},normalizeArray:(u,c)=>{for(var h=0,d=u.length-1;d>=0;d--){var p=u[d];p==="."?u.splice(d,1):p===".."?(u.splice(d,1),h++):h&&(u.splice(d,1),h--)}if(c)for(;h;h--)u.unshift("..");return u},normalize:u=>{var c=jt.isAbs(u),h=u.substr(-1)==="/";return u=jt.normalizeArray(u.split("/").filter(d=>!!d),!c).join("/"),!u&&!c&&(u="."),u&&h&&(u+="/"),(c?"/":"")+u},dirname:u=>{var c=jt.splitPath(u),h=c[0],d=c[1];return!h&&!d?".":(d&&(d=d.substr(0,d.length-1)),h+d)},basename:u=>{if(u==="/")return"/";u=jt.normalize(u),u=u.replace(/\/$/,"");var c=u.lastIndexOf("/");return c===-1?u:u.substr(c+1)},join:function(){var u=Array.prototype.slice.call(arguments);return jt.normalize(u.join("/"))},join2:(u,c)=>jt.normalize(u+"/"+c)};function cre(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var u=new Uint8Array(1);return()=>(crypto.getRandomValues(u),u[0])}else return()=>Zu("randomDevice")}var _o={resolve:function(){for(var u="",c=!1,h=arguments.length-1;h>=-1&&!c;h--){var d=h>=0?arguments[h]:_.cwd();if(typeof d!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!d)return"";u=d+"/"+u,c=jt.isAbs(d)}return u=jt.normalizeArray(u.split("/").filter(p=>!!p),!c).join("/"),(c?"/":"")+u||"."},relative:(u,c)=>{u=_o.resolve(u).substr(1),c=_o.resolve(c).substr(1);function h(ne){for(var pe=0;pe<ne.length&&ne[pe]==="";pe++);for(var xe=ne.length-1;xe>=0&&ne[xe]==="";xe--);return pe>xe?[]:ne.slice(pe,xe-pe+1)}for(var d=h(u.split("/")),p=h(c.split("/")),y=Math.min(d.length,p.length),A=y,P=0;P<y;P++)if(d[P]!==p[P]){A=P;break}for(var te=[],P=A;P<d.length;P++)te.push("..");return te=te.concat(p.slice(A)),te.join("/")}};function SE(u,c,h){var d=He(u)+1,p=new Array(d),y=ze(u,p,0,p.length);return p.length=y,p}var Dc={ttys:[],init:function(){},shutdown:function(){},register:function(u,c){Dc.ttys[u]={input:[],output:[],ops:c},_.registerDevice(u,Dc.stream_ops)},stream_ops:{open:function(u){var c=Dc.ttys[u.node.rdev];if(!c)throw new _.ErrnoError(43);u.tty=c,u.seekable=!1},close:function(u){u.tty.ops.fsync(u.tty)},fsync:function(u){u.tty.ops.fsync(u.tty)},read:function(u,c,h,d,p){if(!u.tty||!u.tty.ops.get_char)throw new _.ErrnoError(60);for(var y=0,A=0;A<d;A++){var P;try{P=u.tty.ops.get_char(u.tty)}catch{throw new _.ErrnoError(29)}if(P===void 0&&y===0)throw new _.ErrnoError(6);if(P==null)break;y++,c[h+A]=P}return y&&(u.node.timestamp=Date.now()),y},write:function(u,c,h,d,p){if(!u.tty||!u.tty.ops.put_char)throw new _.ErrnoError(60);try{for(var y=0;y<d;y++)u.tty.ops.put_char(u.tty,c[h+y])}catch{throw new _.ErrnoError(29)}return d&&(u.node.timestamp=Date.now()),y}},default_tty_ops:{get_char:function(u){if(!u.input.length){var c=null;if(typeof window<"u"&&typeof window.prompt=="function"?(c=window.prompt("Input: "),c!==null&&(c+=`
`)):typeof readline=="function"&&(c=readline(),c!==null&&(c+=`
`)),!c)return null;u.input=SE(c)}return u.input.shift()},put_char:function(u,c){c===null||c===10?(ee(Re(u.output,0)),u.output=[]):c!=0&&u.output.push(c)},fsync:function(u){u.output&&u.output.length>0&&(ee(Re(u.output,0)),u.output=[])}},default_tty1_ops:{put_char:function(u,c){c===null||c===10?(ve(Re(u.output,0)),u.output=[]):c!=0&&u.output.push(c)},fsync:function(u){u.output&&u.output.length>0&&(ve(Re(u.output,0)),u.output=[])}}};function lre(u,c){return ht.fill(0,u,u+c),u}function ure(u,c){return Math.ceil(u/c)*c}function XC(u){u=ure(u,65536);var c=oF(65536,u);return c?lre(c,u):0}var St={ops_table:null,mount:function(u){return St.createNode(null,"/",16895,0)},createNode:function(u,c,h,d){if(_.isBlkdev(h)||_.isFIFO(h))throw new _.ErrnoError(63);St.ops_table||(St.ops_table={dir:{node:{getattr:St.node_ops.getattr,setattr:St.node_ops.setattr,lookup:St.node_ops.lookup,mknod:St.node_ops.mknod,rename:St.node_ops.rename,unlink:St.node_ops.unlink,rmdir:St.node_ops.rmdir,readdir:St.node_ops.readdir,symlink:St.node_ops.symlink},stream:{llseek:St.stream_ops.llseek}},file:{node:{getattr:St.node_ops.getattr,setattr:St.node_ops.setattr},stream:{llseek:St.stream_ops.llseek,read:St.stream_ops.read,write:St.stream_ops.write,allocate:St.stream_ops.allocate,mmap:St.stream_ops.mmap,msync:St.stream_ops.msync}},link:{node:{getattr:St.node_ops.getattr,setattr:St.node_ops.setattr,readlink:St.node_ops.readlink},stream:{}},chrdev:{node:{getattr:St.node_ops.getattr,setattr:St.node_ops.setattr},stream:_.chrdev_stream_ops}});var p=_.createNode(u,c,h,d);return _.isDir(p.mode)?(p.node_ops=St.ops_table.dir.node,p.stream_ops=St.ops_table.dir.stream,p.contents={}):_.isFile(p.mode)?(p.node_ops=St.ops_table.file.node,p.stream_ops=St.ops_table.file.stream,p.usedBytes=0,p.contents=null):_.isLink(p.mode)?(p.node_ops=St.ops_table.link.node,p.stream_ops=St.ops_table.link.stream):_.isChrdev(p.mode)&&(p.node_ops=St.ops_table.chrdev.node,p.stream_ops=St.ops_table.chrdev.stream),p.timestamp=Date.now(),u&&(u.contents[c]=p,u.timestamp=p.timestamp),p},getFileDataAsTypedArray:function(u){return u.contents?u.contents.subarray?u.contents.subarray(0,u.usedBytes):new Uint8Array(u.contents):new Uint8Array(0)},expandFileStorage:function(u,c){var h=u.contents?u.contents.length:0;if(!(h>=c)){var d=1024*1024;c=Math.max(c,h*(h<d?2:1.125)>>>0),h!=0&&(c=Math.max(c,256));var p=u.contents;u.contents=new Uint8Array(c),u.usedBytes>0&&u.contents.set(p.subarray(0,u.usedBytes),0)}},resizeFileStorage:function(u,c){if(u.usedBytes!=c)if(c==0)u.contents=null,u.usedBytes=0;else{var h=u.contents;u.contents=new Uint8Array(c),h&&u.contents.set(h.subarray(0,Math.min(c,u.usedBytes))),u.usedBytes=c}},node_ops:{getattr:function(u){var c={};return c.dev=_.isChrdev(u.mode)?u.id:1,c.ino=u.id,c.mode=u.mode,c.nlink=1,c.uid=0,c.gid=0,c.rdev=u.rdev,_.isDir(u.mode)?c.size=4096:_.isFile(u.mode)?c.size=u.usedBytes:_.isLink(u.mode)?c.size=u.link.length:c.size=0,c.atime=new Date(u.timestamp),c.mtime=new Date(u.timestamp),c.ctime=new Date(u.timestamp),c.blksize=4096,c.blocks=Math.ceil(c.size/c.blksize),c},setattr:function(u,c){c.mode!==void 0&&(u.mode=c.mode),c.timestamp!==void 0&&(u.timestamp=c.timestamp),c.size!==void 0&&St.resizeFileStorage(u,c.size)},lookup:function(u,c){throw _.genericErrors[44]},mknod:function(u,c,h,d){return St.createNode(u,c,h,d)},rename:function(u,c,h){if(_.isDir(u.mode)){var d;try{d=_.lookupNode(c,h)}catch{}if(d)for(var p in d.contents)throw new _.ErrnoError(55)}delete u.parent.contents[u.name],u.parent.timestamp=Date.now(),u.name=h,c.contents[h]=u,c.timestamp=u.parent.timestamp,u.parent=c},unlink:function(u,c){delete u.contents[c],u.timestamp=Date.now()},rmdir:function(u,c){var h=_.lookupNode(u,c);for(var d in h.contents)throw new _.ErrnoError(55);delete u.contents[c],u.timestamp=Date.now()},readdir:function(u){var c=[".",".."];for(var h in u.contents)u.contents.hasOwnProperty(h)&&c.push(h);return c},symlink:function(u,c,h){var d=St.createNode(u,c,41471,0);return d.link=h,d},readlink:function(u){if(!_.isLink(u.mode))throw new _.ErrnoError(28);return u.link}},stream_ops:{read:function(u,c,h,d,p){var y=u.node.contents;if(p>=u.node.usedBytes)return 0;var A=Math.min(u.node.usedBytes-p,d);if(A>8&&y.subarray)c.set(y.subarray(p,p+A),h);else for(var P=0;P<A;P++)c[h+P]=y[p+P];return A},write:function(u,c,h,d,p,y){if(c.buffer===Ze.buffer&&(y=!1),!d)return 0;var A=u.node;if(A.timestamp=Date.now(),c.subarray&&(!A.contents||A.contents.subarray)){if(y)return A.contents=c.subarray(h,h+d),A.usedBytes=d,d;if(A.usedBytes===0&&p===0)return A.contents=c.slice(h,h+d),A.usedBytes=d,d;if(p+d<=A.usedBytes)return A.contents.set(c.subarray(h,h+d),p),d}if(St.expandFileStorage(A,p+d),A.contents.subarray&&c.subarray)A.contents.set(c.subarray(h,h+d),p);else for(var P=0;P<d;P++)A.contents[p+P]=c[h+P];return A.usedBytes=Math.max(A.usedBytes,p+d),d},llseek:function(u,c,h){var d=c;if(h===1?d+=u.position:h===2&&_.isFile(u.node.mode)&&(d+=u.node.usedBytes),d<0)throw new _.ErrnoError(28);return d},allocate:function(u,c,h){St.expandFileStorage(u.node,c+h),u.node.usedBytes=Math.max(u.node.usedBytes,c+h)},mmap:function(u,c,h,d,p){if(!_.isFile(u.node.mode))throw new _.ErrnoError(43);var y,A,P=u.node.contents;if(!(p&2)&&P.buffer===Ze.buffer)A=!1,y=P.byteOffset;else{if((h>0||h+c<P.length)&&(P.subarray?P=P.subarray(h,h+c):P=Array.prototype.slice.call(P,h,h+c)),A=!0,y=XC(c),!y)throw new _.ErrnoError(48);Ze.set(P,y)}return{ptr:y,allocated:A}},msync:function(u,c,h,d,p){return St.stream_ops.write(u,c,0,d,h,!1),0}}};function fre(u,c,h,d){var p="al "+u;Z(u,y=>{Xe(y,'Loading data file "'+u+'" failed (no arrayBuffer).'),c(new Uint8Array(y)),p&&$_()},y=>{if(h)h();else throw'Loading data file "'+u+'" failed.'}),p&&bE()}var _={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:(u,c={})=>{if(u=_o.resolve(u),!u)return{path:"",node:null};var h={follow_mount:!0,recurse_count:0};if(c=Object.assign(h,c),c.recurse_count>8)throw new _.ErrnoError(32);for(var d=u.split("/").filter(xe=>!!xe),p=_.root,y="/",A=0;A<d.length;A++){var P=A===d.length-1;if(P&&c.parent)break;if(p=_.lookupNode(p,d[A]),y=jt.join2(y,d[A]),_.isMountpoint(p)&&(!P||P&&c.follow_mount)&&(p=p.mounted.root),!P||c.follow)for(var te=0;_.isLink(p.mode);){var ne=_.readlink(y);y=_o.resolve(jt.dirname(y),ne);var pe=_.lookupPath(y,{recurse_count:c.recurse_count+1});if(p=pe.node,te++>40)throw new _.ErrnoError(32)}}return{path:y,node:p}},getPath:u=>{for(var c;;){if(_.isRoot(u)){var h=u.mount.mountpoint;return c?h[h.length-1]!=="/"?h+"/"+c:h+c:h}c=c?u.name+"/"+c:u.name,u=u.parent}},hashName:(u,c)=>{for(var h=0,d=0;d<c.length;d++)h=(h<<5)-h+c.charCodeAt(d)|0;return(u+h>>>0)%_.nameTable.length},hashAddNode:u=>{var c=_.hashName(u.parent.id,u.name);u.name_next=_.nameTable[c],_.nameTable[c]=u},hashRemoveNode:u=>{var c=_.hashName(u.parent.id,u.name);if(_.nameTable[c]===u)_.nameTable[c]=u.name_next;else for(var h=_.nameTable[c];h;){if(h.name_next===u){h.name_next=u.name_next;break}h=h.name_next}},lookupNode:(u,c)=>{var h=_.mayLookup(u);if(h)throw new _.ErrnoError(h,u);for(var d=_.hashName(u.id,c),p=_.nameTable[d];p;p=p.name_next){var y=p.name;if(p.parent.id===u.id&&y===c)return p}return _.lookup(u,c)},createNode:(u,c,h,d)=>{var p=new _.FSNode(u,c,h,d);return _.hashAddNode(p),p},destroyNode:u=>{_.hashRemoveNode(u)},isRoot:u=>u===u.parent,isMountpoint:u=>!!u.mounted,isFile:u=>(u&61440)===32768,isDir:u=>(u&61440)===16384,isLink:u=>(u&61440)===40960,isChrdev:u=>(u&61440)===8192,isBlkdev:u=>(u&61440)===24576,isFIFO:u=>(u&61440)===4096,isSocket:u=>(u&49152)===49152,flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:u=>{var c=_.flagModes[u];if(typeof c>"u")throw new Error("Unknown file open mode: "+u);return c},flagsToPermissionString:u=>{var c=["r","w","rw"][u&3];return u&512&&(c+="w"),c},nodePermissions:(u,c)=>_.ignorePermissions?0:c.includes("r")&&!(u.mode&292)||c.includes("w")&&!(u.mode&146)||c.includes("x")&&!(u.mode&73)?2:0,mayLookup:u=>{var c=_.nodePermissions(u,"x");return c||(u.node_ops.lookup?0:2)},mayCreate:(u,c)=>{try{var h=_.lookupNode(u,c);return 20}catch{}return _.nodePermissions(u,"wx")},mayDelete:(u,c,h)=>{var d;try{d=_.lookupNode(u,c)}catch(y){return y.errno}var p=_.nodePermissions(u,"wx");if(p)return p;if(h){if(!_.isDir(d.mode))return 54;if(_.isRoot(d)||_.getPath(d)===_.cwd())return 10}else if(_.isDir(d.mode))return 31;return 0},mayOpen:(u,c)=>u?_.isLink(u.mode)?32:_.isDir(u.mode)&&(_.flagsToPermissionString(c)!=="r"||c&512)?31:_.nodePermissions(u,_.flagsToPermissionString(c)):44,MAX_OPEN_FDS:4096,nextfd:(u=0,c=_.MAX_OPEN_FDS)=>{for(var h=u;h<=c;h++)if(!_.streams[h])return h;throw new _.ErrnoError(33)},getStream:u=>_.streams[u],createStream:(u,c,h)=>{_.FSStream||(_.FSStream=function(){this.shared={}},_.FSStream.prototype={},Object.defineProperties(_.FSStream.prototype,{object:{get:function(){return this.node},set:function(p){this.node=p}},isRead:{get:function(){return(this.flags&2097155)!==1}},isWrite:{get:function(){return(this.flags&2097155)!==0}},isAppend:{get:function(){return this.flags&1024}},flags:{get:function(){return this.shared.flags},set:function(p){this.shared.flags=p}},position:{get:function(){return this.shared.position},set:function(p){this.shared.position=p}}})),u=Object.assign(new _.FSStream,u);var d=_.nextfd(c,h);return u.fd=d,_.streams[d]=u,u},closeStream:u=>{_.streams[u]=null},chrdev_stream_ops:{open:u=>{var c=_.getDevice(u.node.rdev);u.stream_ops=c.stream_ops,u.stream_ops.open&&u.stream_ops.open(u)},llseek:()=>{throw new _.ErrnoError(70)}},major:u=>u>>8,minor:u=>u&255,makedev:(u,c)=>u<<8|c,registerDevice:(u,c)=>{_.devices[u]={stream_ops:c}},getDevice:u=>_.devices[u],getMounts:u=>{for(var c=[],h=[u];h.length;){var d=h.pop();c.push(d),h.push.apply(h,d.mounts)}return c},syncfs:(u,c)=>{typeof u=="function"&&(c=u,u=!1),_.syncFSRequests++,_.syncFSRequests>1&&ve("warning: "+_.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var h=_.getMounts(_.root.mount),d=0;function p(A){return _.syncFSRequests--,c(A)}function y(A){if(A)return y.errored?void 0:(y.errored=!0,p(A));++d>=h.length&&p(null)}h.forEach(A=>{if(!A.type.syncfs)return y(null);A.type.syncfs(A,u,y)})},mount:(u,c,h)=>{var d=h==="/",p=!h,y;if(d&&_.root)throw new _.ErrnoError(10);if(!d&&!p){var A=_.lookupPath(h,{follow_mount:!1});if(h=A.path,y=A.node,_.isMountpoint(y))throw new _.ErrnoError(10);if(!_.isDir(y.mode))throw new _.ErrnoError(54)}var P={type:u,opts:c,mountpoint:h,mounts:[]},te=u.mount(P);return te.mount=P,P.root=te,d?_.root=te:y&&(y.mounted=P,y.mount&&y.mount.mounts.push(P)),te},unmount:u=>{var c=_.lookupPath(u,{follow_mount:!1});if(!_.isMountpoint(c.node))throw new _.ErrnoError(28);var h=c.node,d=h.mounted,p=_.getMounts(d);Object.keys(_.nameTable).forEach(A=>{for(var P=_.nameTable[A];P;){var te=P.name_next;p.includes(P.mount)&&_.destroyNode(P),P=te}}),h.mounted=null;var y=h.mount.mounts.indexOf(d);h.mount.mounts.splice(y,1)},lookup:(u,c)=>u.node_ops.lookup(u,c),mknod:(u,c,h)=>{var d=_.lookupPath(u,{parent:!0}),p=d.node,y=jt.basename(u);if(!y||y==="."||y==="..")throw new _.ErrnoError(28);var A=_.mayCreate(p,y);if(A)throw new _.ErrnoError(A);if(!p.node_ops.mknod)throw new _.ErrnoError(63);return p.node_ops.mknod(p,y,c,h)},create:(u,c)=>(c=c!==void 0?c:438,c&=4095,c|=32768,_.mknod(u,c,0)),mkdir:(u,c)=>(c=c!==void 0?c:511,c&=1023,c|=16384,_.mknod(u,c,0)),mkdirTree:(u,c)=>{for(var h=u.split("/"),d="",p=0;p<h.length;++p)if(h[p]){d+="/"+h[p];try{_.mkdir(d,c)}catch(y){if(y.errno!=20)throw y}}},mkdev:(u,c,h)=>(typeof h>"u"&&(h=c,c=438),c|=8192,_.mknod(u,c,h)),symlink:(u,c)=>{if(!_o.resolve(u))throw new _.ErrnoError(44);var h=_.lookupPath(c,{parent:!0}),d=h.node;if(!d)throw new _.ErrnoError(44);var p=jt.basename(c),y=_.mayCreate(d,p);if(y)throw new _.ErrnoError(y);if(!d.node_ops.symlink)throw new _.ErrnoError(63);return d.node_ops.symlink(d,p,u)},rename:(u,c)=>{var h=jt.dirname(u),d=jt.dirname(c),p=jt.basename(u),y=jt.basename(c),A,P,te;if(A=_.lookupPath(u,{parent:!0}),P=A.node,A=_.lookupPath(c,{parent:!0}),te=A.node,!P||!te)throw new _.ErrnoError(44);if(P.mount!==te.mount)throw new _.ErrnoError(75);var ne=_.lookupNode(P,p),pe=_o.relative(u,d);if(pe.charAt(0)!==".")throw new _.ErrnoError(28);if(pe=_o.relative(c,h),pe.charAt(0)!==".")throw new _.ErrnoError(55);var xe;try{xe=_.lookupNode(te,y)}catch{}if(ne!==xe){var Q=_.isDir(ne.mode),K=_.mayDelete(P,p,Q);if(K)throw new _.ErrnoError(K);if(K=xe?_.mayDelete(te,y,Q):_.mayCreate(te,y),K)throw new _.ErrnoError(K);if(!P.node_ops.rename)throw new _.ErrnoError(63);if(_.isMountpoint(ne)||xe&&_.isMountpoint(xe))throw new _.ErrnoError(10);if(te!==P&&(K=_.nodePermissions(P,"w"),K))throw new _.ErrnoError(K);_.hashRemoveNode(ne);try{P.node_ops.rename(ne,te,y)}catch(oe){throw oe}finally{_.hashAddNode(ne)}}},rmdir:u=>{var c=_.lookupPath(u,{parent:!0}),h=c.node,d=jt.basename(u),p=_.lookupNode(h,d),y=_.mayDelete(h,d,!0);if(y)throw new _.ErrnoError(y);if(!h.node_ops.rmdir)throw new _.ErrnoError(63);if(_.isMountpoint(p))throw new _.ErrnoError(10);h.node_ops.rmdir(h,d),_.destroyNode(p)},readdir:u=>{var c=_.lookupPath(u,{follow:!0}),h=c.node;if(!h.node_ops.readdir)throw new _.ErrnoError(54);return h.node_ops.readdir(h)},unlink:u=>{var c=_.lookupPath(u,{parent:!0}),h=c.node;if(!h)throw new _.ErrnoError(44);var d=jt.basename(u),p=_.lookupNode(h,d),y=_.mayDelete(h,d,!1);if(y)throw new _.ErrnoError(y);if(!h.node_ops.unlink)throw new _.ErrnoError(63);if(_.isMountpoint(p))throw new _.ErrnoError(10);h.node_ops.unlink(h,d),_.destroyNode(p)},readlink:u=>{var c=_.lookupPath(u),h=c.node;if(!h)throw new _.ErrnoError(44);if(!h.node_ops.readlink)throw new _.ErrnoError(28);return _o.resolve(_.getPath(h.parent),h.node_ops.readlink(h))},stat:(u,c)=>{var h=_.lookupPath(u,{follow:!c}),d=h.node;if(!d)throw new _.ErrnoError(44);if(!d.node_ops.getattr)throw new _.ErrnoError(63);return d.node_ops.getattr(d)},lstat:u=>_.stat(u,!0),chmod:(u,c,h)=>{var d;if(typeof u=="string"){var p=_.lookupPath(u,{follow:!h});d=p.node}else d=u;if(!d.node_ops.setattr)throw new _.ErrnoError(63);d.node_ops.setattr(d,{mode:c&4095|d.mode&-4096,timestamp:Date.now()})},lchmod:(u,c)=>{_.chmod(u,c,!0)},fchmod:(u,c)=>{var h=_.getStream(u);if(!h)throw new _.ErrnoError(8);_.chmod(h.node,c)},chown:(u,c,h,d)=>{var p;if(typeof u=="string"){var y=_.lookupPath(u,{follow:!d});p=y.node}else p=u;if(!p.node_ops.setattr)throw new _.ErrnoError(63);p.node_ops.setattr(p,{timestamp:Date.now()})},lchown:(u,c,h)=>{_.chown(u,c,h,!0)},fchown:(u,c,h)=>{var d=_.getStream(u);if(!d)throw new _.ErrnoError(8);_.chown(d.node,c,h)},truncate:(u,c)=>{if(c<0)throw new _.ErrnoError(28);var h;if(typeof u=="string"){var d=_.lookupPath(u,{follow:!0});h=d.node}else h=u;if(!h.node_ops.setattr)throw new _.ErrnoError(63);if(_.isDir(h.mode))throw new _.ErrnoError(31);if(!_.isFile(h.mode))throw new _.ErrnoError(28);var p=_.nodePermissions(h,"w");if(p)throw new _.ErrnoError(p);h.node_ops.setattr(h,{size:c,timestamp:Date.now()})},ftruncate:(u,c)=>{var h=_.getStream(u);if(!h)throw new _.ErrnoError(8);if(!(h.flags&2097155))throw new _.ErrnoError(28);_.truncate(h.node,c)},utime:(u,c,h)=>{var d=_.lookupPath(u,{follow:!0}),p=d.node;p.node_ops.setattr(p,{timestamp:Math.max(c,h)})},open:(u,c,h)=>{if(u==="")throw new _.ErrnoError(44);c=typeof c=="string"?_.modeStringToFlags(c):c,h=typeof h>"u"?438:h,c&64?h=h&4095|32768:h=0;var d;if(typeof u=="object")d=u;else{u=jt.normalize(u);try{var p=_.lookupPath(u,{follow:!(c&131072)});d=p.node}catch{}}var y=!1;if(c&64)if(d){if(c&128)throw new _.ErrnoError(20)}else d=_.mknod(u,h,0),y=!0;if(!d)throw new _.ErrnoError(44);if(_.isChrdev(d.mode)&&(c&=-513),c&65536&&!_.isDir(d.mode))throw new _.ErrnoError(54);if(!y){var A=_.mayOpen(d,c);if(A)throw new _.ErrnoError(A)}c&512&&!y&&_.truncate(d,0),c&=-131713;var P=_.createStream({node:d,path:_.getPath(d),flags:c,seekable:!0,position:0,stream_ops:d.stream_ops,ungotten:[],error:!1});return P.stream_ops.open&&P.stream_ops.open(P),r.logReadFiles&&!(c&1)&&(_.readFiles||(_.readFiles={}),u in _.readFiles||(_.readFiles[u]=1)),P},close:u=>{if(_.isClosed(u))throw new _.ErrnoError(8);u.getdents&&(u.getdents=null);try{u.stream_ops.close&&u.stream_ops.close(u)}catch(c){throw c}finally{_.closeStream(u.fd)}u.fd=null},isClosed:u=>u.fd===null,llseek:(u,c,h)=>{if(_.isClosed(u))throw new _.ErrnoError(8);if(!u.seekable||!u.stream_ops.llseek)throw new _.ErrnoError(70);if(h!=0&&h!=1&&h!=2)throw new _.ErrnoError(28);return u.position=u.stream_ops.llseek(u,c,h),u.ungotten=[],u.position},read:(u,c,h,d,p)=>{if(d<0||p<0)throw new _.ErrnoError(28);if(_.isClosed(u))throw new _.ErrnoError(8);if((u.flags&2097155)===1)throw new _.ErrnoError(8);if(_.isDir(u.node.mode))throw new _.ErrnoError(31);if(!u.stream_ops.read)throw new _.ErrnoError(28);var y=typeof p<"u";if(!y)p=u.position;else if(!u.seekable)throw new _.ErrnoError(70);var A=u.stream_ops.read(u,c,h,d,p);return y||(u.position+=A),A},write:(u,c,h,d,p,y)=>{if(d<0||p<0)throw new _.ErrnoError(28);if(_.isClosed(u))throw new _.ErrnoError(8);if(!(u.flags&2097155))throw new _.ErrnoError(8);if(_.isDir(u.node.mode))throw new _.ErrnoError(31);if(!u.stream_ops.write)throw new _.ErrnoError(28);u.seekable&&u.flags&1024&&_.llseek(u,0,2);var A=typeof p<"u";if(!A)p=u.position;else if(!u.seekable)throw new _.ErrnoError(70);var P=u.stream_ops.write(u,c,h,d,p,y);return A||(u.position+=P),P},allocate:(u,c,h)=>{if(_.isClosed(u))throw new _.ErrnoError(8);if(c<0||h<=0)throw new _.ErrnoError(28);if(!(u.flags&2097155))throw new _.ErrnoError(8);if(!_.isFile(u.node.mode)&&!_.isDir(u.node.mode))throw new _.ErrnoError(43);if(!u.stream_ops.allocate)throw new _.ErrnoError(138);u.stream_ops.allocate(u,c,h)},mmap:(u,c,h,d,p)=>{if(d&2&&!(p&2)&&(u.flags&2097155)!==2)throw new _.ErrnoError(2);if((u.flags&2097155)===1)throw new _.ErrnoError(2);if(!u.stream_ops.mmap)throw new _.ErrnoError(43);return u.stream_ops.mmap(u,c,h,d,p)},msync:(u,c,h,d,p)=>u.stream_ops.msync?u.stream_ops.msync(u,c,h,d,p):0,munmap:u=>0,ioctl:(u,c,h)=>{if(!u.stream_ops.ioctl)throw new _.ErrnoError(59);return u.stream_ops.ioctl(u,c,h)},readFile:(u,c={})=>{if(c.flags=c.flags||0,c.encoding=c.encoding||"binary",c.encoding!=="utf8"&&c.encoding!=="binary")throw new Error('Invalid encoding type "'+c.encoding+'"');var h,d=_.open(u,c.flags),p=_.stat(u),y=p.size,A=new Uint8Array(y);return _.read(d,A,0,y,0),c.encoding==="utf8"?h=Re(A,0):c.encoding==="binary"&&(h=A),_.close(d),h},writeFile:(u,c,h={})=>{h.flags=h.flags||577;var d=_.open(u,h.flags,h.mode);if(typeof c=="string"){var p=new Uint8Array(He(c)+1),y=ze(c,p,0,p.length);_.write(d,p,0,y,void 0,h.canOwn)}else if(ArrayBuffer.isView(c))_.write(d,c,0,c.byteLength,void 0,h.canOwn);else throw new Error("Unsupported data type");_.close(d)},cwd:()=>_.currentPath,chdir:u=>{var c=_.lookupPath(u,{follow:!0});if(c.node===null)throw new _.ErrnoError(44);if(!_.isDir(c.node.mode))throw new _.ErrnoError(54);var h=_.nodePermissions(c.node,"x");if(h)throw new _.ErrnoError(h);_.currentPath=c.path},createDefaultDirectories:()=>{_.mkdir("/tmp"),_.mkdir("/home"),_.mkdir("/home/web_user")},createDefaultDevices:()=>{_.mkdir("/dev"),_.registerDevice(_.makedev(1,3),{read:()=>0,write:(c,h,d,p,y)=>p}),_.mkdev("/dev/null",_.makedev(1,3)),Dc.register(_.makedev(5,0),Dc.default_tty_ops),Dc.register(_.makedev(6,0),Dc.default_tty1_ops),_.mkdev("/dev/tty",_.makedev(5,0)),_.mkdev("/dev/tty1",_.makedev(6,0));var u=cre();_.createDevice("/dev","random",u),_.createDevice("/dev","urandom",u),_.mkdir("/dev/shm"),_.mkdir("/dev/shm/tmp")},createSpecialDirectories:()=>{_.mkdir("/proc");var u=_.mkdir("/proc/self");_.mkdir("/proc/self/fd"),_.mount({mount:()=>{var c=_.createNode(u,"fd",16895,73);return c.node_ops={lookup:(h,d)=>{var p=+d,y=_.getStream(p);if(!y)throw new _.ErrnoError(8);var A={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>y.path}};return A.parent=A,A}},c}},{},"/proc/self/fd")},createStandardStreams:()=>{r.stdin?_.createDevice("/dev","stdin",r.stdin):_.symlink("/dev/tty","/dev/stdin"),r.stdout?_.createDevice("/dev","stdout",null,r.stdout):_.symlink("/dev/tty","/dev/stdout"),r.stderr?_.createDevice("/dev","stderr",null,r.stderr):_.symlink("/dev/tty1","/dev/stderr"),_.open("/dev/stdin",0),_.open("/dev/stdout",1),_.open("/dev/stderr",1)},ensureErrnoError:()=>{_.ErrnoError||(_.ErrnoError=function(c,h){this.node=h,this.setErrno=function(d){this.errno=d},this.setErrno(c),this.message="FS error"},_.ErrnoError.prototype=new Error,_.ErrnoError.prototype.constructor=_.ErrnoError,[44].forEach(u=>{_.genericErrors[u]=new _.ErrnoError(u),_.genericErrors[u].stack="<generic error, no stack>"}))},staticInit:()=>{_.ensureErrnoError(),_.nameTable=new Array(4096),_.mount(St,{},"/"),_.createDefaultDirectories(),_.createDefaultDevices(),_.createSpecialDirectories(),_.filesystems={MEMFS:St}},init:(u,c,h)=>{_.init.initialized=!0,_.ensureErrnoError(),r.stdin=u||r.stdin,r.stdout=c||r.stdout,r.stderr=h||r.stderr,_.createStandardStreams()},quit:()=>{_.init.initialized=!1;for(var u=0;u<_.streams.length;u++){var c=_.streams[u];c&&_.close(c)}},getMode:(u,c)=>{var h=0;return u&&(h|=365),c&&(h|=146),h},findObject:(u,c)=>{var h=_.analyzePath(u,c);return h.exists?h.object:null},analyzePath:(u,c)=>{try{var h=_.lookupPath(u,{follow:!c});u=h.path}catch{}var d={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var h=_.lookupPath(u,{parent:!0});d.parentExists=!0,d.parentPath=h.path,d.parentObject=h.node,d.name=jt.basename(u),h=_.lookupPath(u,{follow:!c}),d.exists=!0,d.path=h.path,d.object=h.node,d.name=h.node.name,d.isRoot=h.path==="/"}catch(p){d.error=p.errno}return d},createPath:(u,c,h,d)=>{u=typeof u=="string"?u:_.getPath(u);for(var p=c.split("/").reverse();p.length;){var y=p.pop();if(y){var A=jt.join2(u,y);try{_.mkdir(A)}catch{}u=A}}return A},createFile:(u,c,h,d,p)=>{var y=jt.join2(typeof u=="string"?u:_.getPath(u),c),A=_.getMode(d,p);return _.create(y,A)},createDataFile:(u,c,h,d,p,y)=>{var A=c;u&&(u=typeof u=="string"?u:_.getPath(u),A=c?jt.join2(u,c):u);var P=_.getMode(d,p),te=_.create(A,P);if(h){if(typeof h=="string"){for(var ne=new Array(h.length),pe=0,xe=h.length;pe<xe;++pe)ne[pe]=h.charCodeAt(pe);h=ne}_.chmod(te,P|146);var Q=_.open(te,577);_.write(Q,h,0,h.length,0,y),_.close(Q),_.chmod(te,P)}return te},createDevice:(u,c,h,d)=>{var p=jt.join2(typeof u=="string"?u:_.getPath(u),c),y=_.getMode(!!h,!!d);_.createDevice.major||(_.createDevice.major=64);var A=_.makedev(_.createDevice.major++,0);return _.registerDevice(A,{open:P=>{P.seekable=!1},close:P=>{d&&d.buffer&&d.buffer.length&&d(10)},read:(P,te,ne,pe,xe)=>{for(var Q=0,K=0;K<pe;K++){var oe;try{oe=h()}catch{throw new _.ErrnoError(29)}if(oe===void 0&&Q===0)throw new _.ErrnoError(6);if(oe==null)break;Q++,te[ne+K]=oe}return Q&&(P.node.timestamp=Date.now()),Q},write:(P,te,ne,pe,xe)=>{for(var Q=0;Q<pe;Q++)try{d(te[ne+Q])}catch{throw new _.ErrnoError(29)}return pe&&(P.node.timestamp=Date.now()),Q}}),_.mkdev(p,y,A)},forceLoadFile:u=>{if(u.isDevice||u.isFolder||u.link||u.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(z)try{u.contents=SE(z(u.url),!0),u.usedBytes=u.contents.length}catch{throw new _.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile:(u,c,h,d,p)=>{function y(){this.lengthKnown=!1,this.chunks=[]}if(y.prototype.get=function(K){if(!(K>this.length-1||K<0)){var oe=K%this.chunkSize,D=K/this.chunkSize|0;return this.getter(D)[oe]}},y.prototype.setDataGetter=function(K){this.getter=K},y.prototype.cacheLength=function(){var K=new XMLHttpRequest;if(K.open("HEAD",h,!1),K.send(null),!(K.status>=200&&K.status<300||K.status===304))throw new Error("Couldn't load "+h+". Status: "+K.status);var oe=Number(K.getResponseHeader("Content-length")),D,B=(D=K.getResponseHeader("Accept-Ranges"))&&D==="bytes",G=(D=K.getResponseHeader("Content-Encoding"))&&D==="gzip",Y=1024*1024;B||(Y=oe);var ie=(le,we)=>{if(le>we)throw new Error("invalid range ("+le+", "+we+") or no bytes requested!");if(we>oe-1)throw new Error("only "+oe+" bytes available! programmer error!");var k=new XMLHttpRequest;if(k.open("GET",h,!1),oe!==Y&&k.setRequestHeader("Range","bytes="+le+"-"+we),k.responseType="arraybuffer",k.overrideMimeType&&k.overrideMimeType("text/plain; charset=x-user-defined"),k.send(null),!(k.status>=200&&k.status<300||k.status===304))throw new Error("Couldn't load "+h+". Status: "+k.status);return k.response!==void 0?new Uint8Array(k.response||[]):SE(k.responseText||"")},V=this;V.setDataGetter(le=>{var we=le*Y,k=(le+1)*Y-1;if(k=Math.min(k,oe-1),typeof V.chunks[le]>"u"&&(V.chunks[le]=ie(we,k)),typeof V.chunks[le]>"u")throw new Error("doXHR failed!");return V.chunks[le]}),(G||!oe)&&(Y=oe=1,oe=this.getter(0).length,Y=oe,ee("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=oe,this._chunkSize=Y,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!N)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var A=new y;Object.defineProperties(A,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var P={isDevice:!1,contents:A}}else var P={isDevice:!1,url:h};var te=_.createFile(u,c,P,d,p);P.contents?te.contents=P.contents:P.url&&(te.contents=null,te.url=P.url),Object.defineProperties(te,{usedBytes:{get:function(){return this.contents.length}}});var ne={},pe=Object.keys(te.stream_ops);pe.forEach(Q=>{var K=te.stream_ops[Q];ne[Q]=function(){return _.forceLoadFile(te),K.apply(null,arguments)}});function xe(Q,K,oe,D,B){var G=Q.node.contents;if(B>=G.length)return 0;var Y=Math.min(G.length-B,D);if(G.slice)for(var ie=0;ie<Y;ie++)K[oe+ie]=G[B+ie];else for(var ie=0;ie<Y;ie++)K[oe+ie]=G.get(B+ie);return Y}return ne.read=(Q,K,oe,D,B)=>(_.forceLoadFile(te),xe(Q,K,oe,D,B)),ne.mmap=(Q,K,oe,D,B)=>{_.forceLoadFile(te);var G=XC(K);if(!G)throw new _.ErrnoError(48);return xe(Q,Ze,G,K,oe),{ptr:G,allocated:!0}},te.stream_ops=ne,te},createPreloadedFile:(u,c,h,d,p,y,A,P,te,ne)=>{var pe=c?_o.resolve(jt.join2(u,c)):u;function xe(Q){function K(oe){ne&&ne(),P||_.createDataFile(u,c,oe,d,p,te),y&&y(),$_()}Browser.handledByPreloadPlugin(Q,pe,K,()=>{A&&A(),$_()})||K(Q)}bE(),typeof h=="string"?fre(h,Q=>xe(Q),A):xe(h)},indexedDB:()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,DB_NAME:()=>"EM_FS_"+window.location.pathname,DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:(u,c,h)=>{c=c||(()=>{}),h=h||(()=>{});var d=_.indexedDB();try{var p=d.open(_.DB_NAME(),_.DB_VERSION)}catch(y){return h(y)}p.onupgradeneeded=()=>{ee("creating db");var y=p.result;y.createObjectStore(_.DB_STORE_NAME)},p.onsuccess=()=>{var y=p.result,A=y.transaction([_.DB_STORE_NAME],"readwrite"),P=A.objectStore(_.DB_STORE_NAME),te=0,ne=0,pe=u.length;function xe(){ne==0?c():h()}u.forEach(Q=>{var K=P.put(_.analyzePath(Q).object.contents,Q);K.onsuccess=()=>{te++,te+ne==pe&&xe()},K.onerror=()=>{ne++,te+ne==pe&&xe()}}),A.onerror=h},p.onerror=h},loadFilesFromDB:(u,c,h)=>{c=c||(()=>{}),h=h||(()=>{});var d=_.indexedDB();try{var p=d.open(_.DB_NAME(),_.DB_VERSION)}catch(y){return h(y)}p.onupgradeneeded=h,p.onsuccess=()=>{var y=p.result;try{var A=y.transaction([_.DB_STORE_NAME],"readonly")}catch(Q){h(Q);return}var P=A.objectStore(_.DB_STORE_NAME),te=0,ne=0,pe=u.length;function xe(){ne==0?c():h()}u.forEach(Q=>{var K=P.get(Q);K.onsuccess=()=>{_.analyzePath(Q).exists&&_.unlink(Q),_.createDataFile(jt.dirname(Q),jt.basename(Q),K.result,!0,!0,!0),te++,te+ne==pe&&xe()},K.onerror=()=>{ne++,te+ne==pe&&xe()}}),A.onerror=h},p.onerror=h}},dt={DEFAULT_POLLMASK:5,calculateAt:function(u,c,h){if(jt.isAbs(c))return c;var d;if(u===-100)d=_.cwd();else{var p=dt.getStreamFromFD(u);d=p.path}if(c.length==0){if(!h)throw new _.ErrnoError(44);return d}return jt.join2(d,c)},doStat:function(u,c,h){try{var d=u(c)}catch(P){if(P&&P.node&&jt.normalize(c)!==jt.normalize(_.getPath(P.node)))return-54;throw P}Ae[h>>2]=d.dev,Ae[h+8>>2]=d.ino,Ae[h+12>>2]=d.mode,Ue[h+16>>2]=d.nlink,Ae[h+20>>2]=d.uid,Ae[h+24>>2]=d.gid,Ae[h+28>>2]=d.rdev,cr=[d.size>>>0,(Ft=d.size,+Math.abs(Ft)>=1?Ft>0?(Math.min(+Math.floor(Ft/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ft-+(~~Ft>>>0))/4294967296)>>>0:0)],Ae[h+40>>2]=cr[0],Ae[h+44>>2]=cr[1],Ae[h+48>>2]=4096,Ae[h+52>>2]=d.blocks;var p=d.atime.getTime(),y=d.mtime.getTime(),A=d.ctime.getTime();return cr=[Math.floor(p/1e3)>>>0,(Ft=Math.floor(p/1e3),+Math.abs(Ft)>=1?Ft>0?(Math.min(+Math.floor(Ft/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ft-+(~~Ft>>>0))/4294967296)>>>0:0)],Ae[h+56>>2]=cr[0],Ae[h+60>>2]=cr[1],Ue[h+64>>2]=p%1e3*1e3,cr=[Math.floor(y/1e3)>>>0,(Ft=Math.floor(y/1e3),+Math.abs(Ft)>=1?Ft>0?(Math.min(+Math.floor(Ft/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ft-+(~~Ft>>>0))/4294967296)>>>0:0)],Ae[h+72>>2]=cr[0],Ae[h+76>>2]=cr[1],Ue[h+80>>2]=y%1e3*1e3,cr=[Math.floor(A/1e3)>>>0,(Ft=Math.floor(A/1e3),+Math.abs(Ft)>=1?Ft>0?(Math.min(+Math.floor(Ft/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ft-+(~~Ft>>>0))/4294967296)>>>0:0)],Ae[h+88>>2]=cr[0],Ae[h+92>>2]=cr[1],Ue[h+96>>2]=A%1e3*1e3,cr=[d.ino>>>0,(Ft=d.ino,+Math.abs(Ft)>=1?Ft>0?(Math.min(+Math.floor(Ft/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ft-+(~~Ft>>>0))/4294967296)>>>0:0)],Ae[h+104>>2]=cr[0],Ae[h+108>>2]=cr[1],0},doMsync:function(u,c,h,d,p){if(!_.isFile(c.node.mode))throw new _.ErrnoError(43);if(d&2)return 0;var y=ht.slice(u,u+h);_.msync(c,y,p,h,d)},varargs:void 0,get:function(){dt.varargs+=4;var u=Ae[dt.varargs-4>>2];return u},getStr:function(u){var c=Be(u);return c},getStreamFromFD:function(u){var c=_.getStream(u);if(!c)throw new _.ErrnoError(8);return c}};function dre(u,c){try{return u=dt.getStr(u),_.chmod(u,c),0}catch(h){if(typeof _>"u"||!(h instanceof _.ErrnoError))throw h;return-h.errno}}function hre(u,c,h,d){try{if(c=dt.getStr(c),c=dt.calculateAt(u,c),h&-8)return-28;var p=_.lookupPath(c,{follow:!0}),y=p.node;if(!y)return-44;var A="";return h&4&&(A+="r"),h&2&&(A+="w"),h&1&&(A+="x"),A&&_.nodePermissions(y,A)?-2:0}catch(P){if(typeof _>"u"||!(P instanceof _.ErrnoError))throw P;return-P.errno}}function pre(u,c){try{return _.fchmod(u,c),0}catch(h){if(typeof _>"u"||!(h instanceof _.ErrnoError))throw h;return-h.errno}}function mre(u,c,h){try{return _.fchown(u,c,h),0}catch(d){if(typeof _>"u"||!(d instanceof _.ErrnoError))throw d;return-d.errno}}function gre(u){return Ae[sF()>>2]=u,u}function _re(u,c,h){dt.varargs=h;try{var d=dt.getStreamFromFD(u);switch(c){case 0:{var p=dt.get();if(p<0)return-28;var y;return y=_.createStream(d,p),y.fd}case 1:case 2:return 0;case 3:return d.flags;case 4:{var p=dt.get();return d.flags|=p,0}case 5:{var p=dt.get(),A=0;return qt[p+A>>1]=2,0}case 6:case 7:return 0;case 16:case 8:return-28;case 9:return gre(28),-1;default:return-28}}catch(P){if(typeof _>"u"||!(P instanceof _.ErrnoError))throw P;return-P.errno}}function yre(u,c){try{var h=dt.getStreamFromFD(u);return dt.doStat(_.stat,h.path,c)}catch(d){if(typeof _>"u"||!(d instanceof _.ErrnoError))throw d;return-d.errno}}var bre=9007199254740992,wre=-9007199254740992;function ZC(u){return u<wre||u>bre?NaN:Number(u)}function Sre(u,c){try{return c=ZC(c),isNaN(c)?-61:(_.ftruncate(u,c),0)}catch(h){if(typeof _>"u"||!(h instanceof _.ErrnoError))throw h;return-h.errno}}function Ere(u,c){try{if(c===0)return-28;var h=_.cwd(),d=He(h)+1;return c<d?-68:(Le(h,u,c),d)}catch(p){if(typeof _>"u"||!(p instanceof _.ErrnoError))throw p;return-p.errno}}function vre(u,c,h){dt.varargs=h;try{var d=dt.getStreamFromFD(u);switch(c){case 21509:case 21505:return d.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return d.tty?0:-59;case 21519:{if(!d.tty)return-59;var p=dt.get();return Ae[p>>2]=0,0}case 21520:return d.tty?-28:-59;case 21531:{var p=dt.get();return _.ioctl(d,c,p)}case 21523:return d.tty?0:-59;case 21524:return d.tty?0:-59;default:return-28}}catch(y){if(typeof _>"u"||!(y instanceof _.ErrnoError))throw y;return-y.errno}}function Nre(u,c){try{return u=dt.getStr(u),dt.doStat(_.lstat,u,c)}catch(h){if(typeof _>"u"||!(h instanceof _.ErrnoError))throw h;return-h.errno}}function kre(u,c,h){try{return c=dt.getStr(c),c=dt.calculateAt(u,c),c=jt.normalize(c),c[c.length-1]==="/"&&(c=c.substr(0,c.length-1)),_.mkdir(c,h,0),0}catch(d){if(typeof _>"u"||!(d instanceof _.ErrnoError))throw d;return-d.errno}}function xre(u,c,h,d){try{c=dt.getStr(c);var p=d&256,y=d&4096;return d=d&-6401,c=dt.calculateAt(u,c,y),dt.doStat(p?_.lstat:_.stat,c,h)}catch(A){if(typeof _>"u"||!(A instanceof _.ErrnoError))throw A;return-A.errno}}function qre(u,c,h,d){dt.varargs=d;try{c=dt.getStr(c),c=dt.calculateAt(u,c);var p=d?dt.get():0;return _.open(c,h,p).fd}catch(y){if(typeof _>"u"||!(y instanceof _.ErrnoError))throw y;return-y.errno}}function Ore(u,c,h,d){try{if(c=dt.getStr(c),c=dt.calculateAt(u,c),d<=0)return-28;var p=_.readlink(c),y=Math.min(d,He(p)),A=Ze[h+y];return Le(p,h,d+1),Ze[h+y]=A,y}catch(P){if(typeof _>"u"||!(P instanceof _.ErrnoError))throw P;return-P.errno}}function Ire(u){try{return u=dt.getStr(u),_.rmdir(u),0}catch(c){if(typeof _>"u"||!(c instanceof _.ErrnoError))throw c;return-c.errno}}function Tre(u,c){try{return u=dt.getStr(u),dt.doStat(_.stat,u,c)}catch(h){if(typeof _>"u"||!(h instanceof _.ErrnoError))throw h;return-h.errno}}function Are(u,c,h){try{return c=dt.getStr(c),c=dt.calculateAt(u,c),h===0?_.unlink(c):h===512?_.rmdir(c):Zu("Invalid flags passed to unlinkat"),0}catch(d){if(typeof _>"u"||!(d instanceof _.ErrnoError))throw d;return-d.errno}}function EE(u){return Ue[u>>2]+Ae[u+4>>2]*4294967296}function Cre(u,c,h,d){try{if(c=dt.getStr(c),c=dt.calculateAt(u,c,!0),h){var A=EE(h),P=Ae[h+8>>2];p=A*1e3+P/(1e3*1e3),h+=16,A=EE(h),P=Ae[h+8>>2],y=A*1e3+P/(1e3*1e3)}else var p=Date.now(),y=p;return _.utime(c,p,y),0}catch(te){if(typeof _>"u"||!(te instanceof _.ErrnoError))throw te;return-te.errno}}var Fre=!0;function Rre(){return Fre}function Pre(u){return u%4===0&&(u%100!==0||u%400===0)}var $re=[0,31,60,91,121,152,182,213,244,274,305,335],Lre=[0,31,59,90,120,151,181,212,243,273,304,334];function Mre(u){var c=Pre(u.getFullYear()),h=c?$re:Lre,d=h[u.getMonth()]+u.getDate()-1;return d}function Dre(u,c){var h=new Date(EE(u)*1e3);Ae[c>>2]=h.getSeconds(),Ae[c+4>>2]=h.getMinutes(),Ae[c+8>>2]=h.getHours(),Ae[c+12>>2]=h.getDate(),Ae[c+16>>2]=h.getMonth(),Ae[c+20>>2]=h.getFullYear()-1900,Ae[c+24>>2]=h.getDay();var d=Mre(h)|0;Ae[c+28>>2]=d,Ae[c+36>>2]=-(h.getTimezoneOffset()*60);var p=new Date(h.getFullYear(),0,1),y=new Date(h.getFullYear(),6,1).getTimezoneOffset(),A=p.getTimezoneOffset(),P=(y!=A&&h.getTimezoneOffset()==Math.min(A,y))|0;Ae[c+32>>2]=P}function Wre(u,c,h,d,p,y,A){try{var P=dt.getStreamFromFD(d),te=_.mmap(P,u,p,c,h),ne=te.ptr;return Ae[y>>2]=te.allocated,Ue[A>>2]=ne,0}catch(pe){if(typeof _>"u"||!(pe instanceof _.ErrnoError))throw pe;return-pe.errno}}function Bre(u,c,h,d,p,y){try{var A=dt.getStreamFromFD(p);h&2&&dt.doMsync(u,A,c,d,y),_.munmap(A)}catch(P){if(typeof _>"u"||!(P instanceof _.ErrnoError))throw P;return-P.errno}}function eF(u){var c=He(u)+1,h=iF(c);return h&&ze(u,Ze,h,c),h}function Ure(u,c,h){var d=new Date().getFullYear(),p=new Date(d,0,1),y=new Date(d,6,1),A=p.getTimezoneOffset(),P=y.getTimezoneOffset(),te=Math.max(A,P);Ue[u>>2]=te*60,Ae[c>>2]=+(A!=P);function ne(oe){var D=oe.toTimeString().match(/\(([A-Za-z ]+)\)$/);return D?D[1]:"GMT"}var pe=ne(p),xe=ne(y),Q=eF(pe),K=eF(xe);P<A?(Ue[h>>2]=Q,Ue[h+4>>2]=K):(Ue[h>>2]=K,Ue[h+4>>2]=Q)}function jre(){return Date.now()}var tF;tF=()=>performance.now();function zre(){return 2147483648}function Vre(u){var c=Fe.buffer;try{return Fe.grow(u-c.byteLength+65535>>>16),ke(),1}catch{}}function Kre(u){var c=ht.length;u=u>>>0;var h=zre();if(u>h)return!1;let d=(te,ne)=>te+(ne-te%ne)%ne;for(var p=1;p<=4;p*=2){var y=c*(1+.2/p);y=Math.min(y,u+100663296);var A=Math.min(h,d(Math.max(u,y),65536)),P=Vre(A);if(P)return!0}return!1}var vE={};function Qre(){return m||"./this.program"}function gh(){if(!gh.strings){var u=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",c={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:u,_:Qre()};for(var h in vE)vE[h]===void 0?delete c[h]:c[h]=vE[h];var d=[];for(var h in c)d.push(h+"="+c[h]);gh.strings=d}return gh.strings}function Hre(u,c,h){for(var d=0;d<u.length;++d)Ze[c++>>0]=u.charCodeAt(d);Ze[c>>0]=0}function Jre(u,c){var h=0;return gh().forEach(function(d,p){var y=c+h;Ue[u+p*4>>2]=y,Hre(d,y),h+=d.length+1}),0}function Gre(u,c){var h=gh();Ue[u>>2]=h.length;var d=0;return h.forEach(function(p){d+=p.length+1}),Ue[c>>2]=d,0}function Yre(u){try{var c=dt.getStreamFromFD(u);return _.close(c),0}catch(h){if(typeof _>"u"||!(h instanceof _.ErrnoError))throw h;return h.errno}}function Xre(u,c){try{var h=dt.getStreamFromFD(u),d=h.tty?2:_.isDir(h.mode)?3:_.isLink(h.mode)?7:4;return Ze[c>>0]=d,0}catch(p){if(typeof _>"u"||!(p instanceof _.ErrnoError))throw p;return p.errno}}function Zre(u,c,h,d){for(var p=0,y=0;y<h;y++){var A=Ue[c>>2],P=Ue[c+4>>2];c+=8;var te=_.read(u,Ze,A,P,d);if(te<0)return-1;if(p+=te,te<P)break}return p}function ese(u,c,h,d){try{var p=dt.getStreamFromFD(u),y=Zre(p,c,h);return Ue[d>>2]=y,0}catch(A){if(typeof _>"u"||!(A instanceof _.ErrnoError))throw A;return A.errno}}function tse(u,c,h,d){try{if(c=ZC(c),isNaN(c))return 61;var p=dt.getStreamFromFD(u);return _.llseek(p,c,h),cr=[p.position>>>0,(Ft=p.position,+Math.abs(Ft)>=1?Ft>0?(Math.min(+Math.floor(Ft/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ft-+(~~Ft>>>0))/4294967296)>>>0:0)],Ae[d>>2]=cr[0],Ae[d+4>>2]=cr[1],p.getdents&&c===0&&h===0&&(p.getdents=null),0}catch(y){if(typeof _>"u"||!(y instanceof _.ErrnoError))throw y;return y.errno}}function nse(u){try{var c=dt.getStreamFromFD(u);return c.stream_ops&&c.stream_ops.fsync?c.stream_ops.fsync(c):0}catch(h){if(typeof _>"u"||!(h instanceof _.ErrnoError))throw h;return h.errno}}function rse(u,c,h,d){for(var p=0,y=0;y<h;y++){var A=Ue[c>>2],P=Ue[c+4>>2];c+=8;var te=_.write(u,Ze,A,P,d);if(te<0)return-1;p+=te}return p}function sse(u,c,h,d){try{var p=dt.getStreamFromFD(u),y=rse(p,c,h);return Ue[d>>2]=y,0}catch(A){if(typeof _>"u"||!(A instanceof _.ErrnoError))throw A;return A.errno}}var nF=function(u,c,h,d){u||(u=this),this.parent=u,this.mount=u.mount,this.mounted=null,this.id=_.nextInode++,this.name=c,this.mode=h,this.node_ops={},this.stream_ops={},this.rdev=d},L_=365,M_=146;Object.defineProperties(nF.prototype,{read:{get:function(){return(this.mode&L_)===L_},set:function(u){u?this.mode|=L_:this.mode&=~L_}},write:{get:function(){return(this.mode&M_)===M_},set:function(u){u?this.mode|=M_:this.mode&=~M_}},isFolder:{get:function(){return _.isDir(this.mode)}},isDevice:{get:function(){return _.isChrdev(this.mode)}}}),_.FSNode=nF,_.staticInit();var rF={__syscall_chmod:dre,__syscall_faccessat:hre,__syscall_fchmod:pre,__syscall_fchown32:mre,__syscall_fcntl64:_re,__syscall_fstat64:yre,__syscall_ftruncate64:Sre,__syscall_getcwd:Ere,__syscall_ioctl:vre,__syscall_lstat64:Nre,__syscall_mkdirat:kre,__syscall_newfstatat:xre,__syscall_openat:qre,__syscall_readlinkat:Ore,__syscall_rmdir:Ire,__syscall_stat64:Tre,__syscall_unlinkat:Are,__syscall_utimensat:Cre,_emscripten_get_now_is_monotonic:Rre,_localtime_js:Dre,_mmap_js:Wre,_munmap_js:Bre,_tzset_js:Ure,emscripten_date_now:jre,emscripten_get_now:tF,emscripten_resize_heap:Kre,environ_get:Jre,environ_sizes_get:Gre,fd_close:Yre,fd_fdstat_get:Xre,fd_read:ese,fd_seek:tse,fd_sync:nse,fd_write:sse,memory:Fe};are(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.__wasm_call_ctors).apply(null,arguments)},r._sqlite3_status64=function(){return(r._sqlite3_status64=r.asm.sqlite3_status64).apply(null,arguments)},r._sqlite3_status=function(){return(r._sqlite3_status=r.asm.sqlite3_status).apply(null,arguments)},r._sqlite3_db_status=function(){return(r._sqlite3_db_status=r.asm.sqlite3_db_status).apply(null,arguments)},r._sqlite3_msize=function(){return(r._sqlite3_msize=r.asm.sqlite3_msize).apply(null,arguments)},r._sqlite3_vfs_find=function(){return(r._sqlite3_vfs_find=r.asm.sqlite3_vfs_find).apply(null,arguments)},r._sqlite3_initialize=function(){return(r._sqlite3_initialize=r.asm.sqlite3_initialize).apply(null,arguments)},r._sqlite3_malloc=function(){return(r._sqlite3_malloc=r.asm.sqlite3_malloc).apply(null,arguments)},r._sqlite3_free=function(){return(r._sqlite3_free=r.asm.sqlite3_free).apply(null,arguments)},r._sqlite3_vfs_register=function(){return(r._sqlite3_vfs_register=r.asm.sqlite3_vfs_register).apply(null,arguments)},r._sqlite3_vfs_unregister=function(){return(r._sqlite3_vfs_unregister=r.asm.sqlite3_vfs_unregister).apply(null,arguments)},r._sqlite3_malloc64=function(){return(r._sqlite3_malloc64=r.asm.sqlite3_malloc64).apply(null,arguments)},r._sqlite3_realloc=function(){return(r._sqlite3_realloc=r.asm.sqlite3_realloc).apply(null,arguments)},r._sqlite3_realloc64=function(){return(r._sqlite3_realloc64=r.asm.sqlite3_realloc64).apply(null,arguments)},r._sqlite3_value_text=function(){return(r._sqlite3_value_text=r.asm.sqlite3_value_text).apply(null,arguments)},r._sqlite3_randomness=function(){return(r._sqlite3_randomness=r.asm.sqlite3_randomness).apply(null,arguments)},r._sqlite3_stricmp=function(){return(r._sqlite3_stricmp=r.asm.sqlite3_stricmp).apply(null,arguments)},r._sqlite3_strnicmp=function(){return(r._sqlite3_strnicmp=r.asm.sqlite3_strnicmp).apply(null,arguments)},r._sqlite3_uri_parameter=function(){return(r._sqlite3_uri_parameter=r.asm.sqlite3_uri_parameter).apply(null,arguments)};var sF=r.___errno_location=function(){return(sF=r.___errno_location=r.asm.__errno_location).apply(null,arguments)};r._sqlite3_uri_boolean=function(){return(r._sqlite3_uri_boolean=r.asm.sqlite3_uri_boolean).apply(null,arguments)},r._sqlite3_serialize=function(){return(r._sqlite3_serialize=r.asm.sqlite3_serialize).apply(null,arguments)},r._sqlite3_prepare_v2=function(){return(r._sqlite3_prepare_v2=r.asm.sqlite3_prepare_v2).apply(null,arguments)},r._sqlite3_step=function(){return(r._sqlite3_step=r.asm.sqlite3_step).apply(null,arguments)},r._sqlite3_column_int64=function(){return(r._sqlite3_column_int64=r.asm.sqlite3_column_int64).apply(null,arguments)},r._sqlite3_reset=function(){return(r._sqlite3_reset=r.asm.sqlite3_reset).apply(null,arguments)},r._sqlite3_exec=function(){return(r._sqlite3_exec=r.asm.sqlite3_exec).apply(null,arguments)},r._sqlite3_column_int=function(){return(r._sqlite3_column_int=r.asm.sqlite3_column_int).apply(null,arguments)},r._sqlite3_finalize=function(){return(r._sqlite3_finalize=r.asm.sqlite3_finalize).apply(null,arguments)},r._sqlite3_file_control=function(){return(r._sqlite3_file_control=r.asm.sqlite3_file_control).apply(null,arguments)},r._sqlite3_column_name=function(){return(r._sqlite3_column_name=r.asm.sqlite3_column_name).apply(null,arguments)},r._sqlite3_column_text=function(){return(r._sqlite3_column_text=r.asm.sqlite3_column_text).apply(null,arguments)},r._sqlite3_column_type=function(){return(r._sqlite3_column_type=r.asm.sqlite3_column_type).apply(null,arguments)},r._sqlite3_errmsg=function(){return(r._sqlite3_errmsg=r.asm.sqlite3_errmsg).apply(null,arguments)},r._sqlite3_deserialize=function(){return(r._sqlite3_deserialize=r.asm.sqlite3_deserialize).apply(null,arguments)},r._sqlite3_clear_bindings=function(){return(r._sqlite3_clear_bindings=r.asm.sqlite3_clear_bindings).apply(null,arguments)},r._sqlite3_value_blob=function(){return(r._sqlite3_value_blob=r.asm.sqlite3_value_blob).apply(null,arguments)},r._sqlite3_value_bytes=function(){return(r._sqlite3_value_bytes=r.asm.sqlite3_value_bytes).apply(null,arguments)},r._sqlite3_value_double=function(){return(r._sqlite3_value_double=r.asm.sqlite3_value_double).apply(null,arguments)},r._sqlite3_value_int=function(){return(r._sqlite3_value_int=r.asm.sqlite3_value_int).apply(null,arguments)},r._sqlite3_value_int64=function(){return(r._sqlite3_value_int64=r.asm.sqlite3_value_int64).apply(null,arguments)},r._sqlite3_value_subtype=function(){return(r._sqlite3_value_subtype=r.asm.sqlite3_value_subtype).apply(null,arguments)},r._sqlite3_value_pointer=function(){return(r._sqlite3_value_pointer=r.asm.sqlite3_value_pointer).apply(null,arguments)},r._sqlite3_value_type=function(){return(r._sqlite3_value_type=r.asm.sqlite3_value_type).apply(null,arguments)},r._sqlite3_value_nochange=function(){return(r._sqlite3_value_nochange=r.asm.sqlite3_value_nochange).apply(null,arguments)},r._sqlite3_value_frombind=function(){return(r._sqlite3_value_frombind=r.asm.sqlite3_value_frombind).apply(null,arguments)},r._sqlite3_value_dup=function(){return(r._sqlite3_value_dup=r.asm.sqlite3_value_dup).apply(null,arguments)},r._sqlite3_value_free=function(){return(r._sqlite3_value_free=r.asm.sqlite3_value_free).apply(null,arguments)},r._sqlite3_result_blob=function(){return(r._sqlite3_result_blob=r.asm.sqlite3_result_blob).apply(null,arguments)},r._sqlite3_result_error_toobig=function(){return(r._sqlite3_result_error_toobig=r.asm.sqlite3_result_error_toobig).apply(null,arguments)},r._sqlite3_result_error_nomem=function(){return(r._sqlite3_result_error_nomem=r.asm.sqlite3_result_error_nomem).apply(null,arguments)},r._sqlite3_result_double=function(){return(r._sqlite3_result_double=r.asm.sqlite3_result_double).apply(null,arguments)},r._sqlite3_result_error=function(){return(r._sqlite3_result_error=r.asm.sqlite3_result_error).apply(null,arguments)},r._sqlite3_result_int=function(){return(r._sqlite3_result_int=r.asm.sqlite3_result_int).apply(null,arguments)},r._sqlite3_result_int64=function(){return(r._sqlite3_result_int64=r.asm.sqlite3_result_int64).apply(null,arguments)},r._sqlite3_result_null=function(){return(r._sqlite3_result_null=r.asm.sqlite3_result_null).apply(null,arguments)},r._sqlite3_result_pointer=function(){return(r._sqlite3_result_pointer=r.asm.sqlite3_result_pointer).apply(null,arguments)},r._sqlite3_result_subtype=function(){return(r._sqlite3_result_subtype=r.asm.sqlite3_result_subtype).apply(null,arguments)},r._sqlite3_result_text=function(){return(r._sqlite3_result_text=r.asm.sqlite3_result_text).apply(null,arguments)},r._sqlite3_result_zeroblob=function(){return(r._sqlite3_result_zeroblob=r.asm.sqlite3_result_zeroblob).apply(null,arguments)},r._sqlite3_result_zeroblob64=function(){return(r._sqlite3_result_zeroblob64=r.asm.sqlite3_result_zeroblob64).apply(null,arguments)},r._sqlite3_result_error_code=function(){return(r._sqlite3_result_error_code=r.asm.sqlite3_result_error_code).apply(null,arguments)},r._sqlite3_user_data=function(){return(r._sqlite3_user_data=r.asm.sqlite3_user_data).apply(null,arguments)},r._sqlite3_context_db_handle=function(){return(r._sqlite3_context_db_handle=r.asm.sqlite3_context_db_handle).apply(null,arguments)},r._sqlite3_vtab_nochange=function(){return(r._sqlite3_vtab_nochange=r.asm.sqlite3_vtab_nochange).apply(null,arguments)},r._sqlite3_vtab_in_first=function(){return(r._sqlite3_vtab_in_first=r.asm.sqlite3_vtab_in_first).apply(null,arguments)},r._sqlite3_vtab_in_next=function(){return(r._sqlite3_vtab_in_next=r.asm.sqlite3_vtab_in_next).apply(null,arguments)},r._sqlite3_aggregate_context=function(){return(r._sqlite3_aggregate_context=r.asm.sqlite3_aggregate_context).apply(null,arguments)},r._sqlite3_get_auxdata=function(){return(r._sqlite3_get_auxdata=r.asm.sqlite3_get_auxdata).apply(null,arguments)},r._sqlite3_set_auxdata=function(){return(r._sqlite3_set_auxdata=r.asm.sqlite3_set_auxdata).apply(null,arguments)},r._sqlite3_column_count=function(){return(r._sqlite3_column_count=r.asm.sqlite3_column_count).apply(null,arguments)},r._sqlite3_data_count=function(){return(r._sqlite3_data_count=r.asm.sqlite3_data_count).apply(null,arguments)},r._sqlite3_column_blob=function(){return(r._sqlite3_column_blob=r.asm.sqlite3_column_blob).apply(null,arguments)},r._sqlite3_column_bytes=function(){return(r._sqlite3_column_bytes=r.asm.sqlite3_column_bytes).apply(null,arguments)},r._sqlite3_column_double=function(){return(r._sqlite3_column_double=r.asm.sqlite3_column_double).apply(null,arguments)},r._sqlite3_column_value=function(){return(r._sqlite3_column_value=r.asm.sqlite3_column_value).apply(null,arguments)},r._sqlite3_bind_blob=function(){return(r._sqlite3_bind_blob=r.asm.sqlite3_bind_blob).apply(null,arguments)},r._sqlite3_bind_double=function(){return(r._sqlite3_bind_double=r.asm.sqlite3_bind_double).apply(null,arguments)},r._sqlite3_bind_int=function(){return(r._sqlite3_bind_int=r.asm.sqlite3_bind_int).apply(null,arguments)},r._sqlite3_bind_int64=function(){return(r._sqlite3_bind_int64=r.asm.sqlite3_bind_int64).apply(null,arguments)},r._sqlite3_bind_null=function(){return(r._sqlite3_bind_null=r.asm.sqlite3_bind_null).apply(null,arguments)},r._sqlite3_bind_pointer=function(){return(r._sqlite3_bind_pointer=r.asm.sqlite3_bind_pointer).apply(null,arguments)},r._sqlite3_bind_text=function(){return(r._sqlite3_bind_text=r.asm.sqlite3_bind_text).apply(null,arguments)},r._sqlite3_bind_parameter_count=function(){return(r._sqlite3_bind_parameter_count=r.asm.sqlite3_bind_parameter_count).apply(null,arguments)},r._sqlite3_bind_parameter_index=function(){return(r._sqlite3_bind_parameter_index=r.asm.sqlite3_bind_parameter_index).apply(null,arguments)},r._sqlite3_db_handle=function(){return(r._sqlite3_db_handle=r.asm.sqlite3_db_handle).apply(null,arguments)},r._sqlite3_stmt_readonly=function(){return(r._sqlite3_stmt_readonly=r.asm.sqlite3_stmt_readonly).apply(null,arguments)},r._sqlite3_stmt_isexplain=function(){return(r._sqlite3_stmt_isexplain=r.asm.sqlite3_stmt_isexplain).apply(null,arguments)},r._sqlite3_stmt_status=function(){return(r._sqlite3_stmt_status=r.asm.sqlite3_stmt_status).apply(null,arguments)},r._sqlite3_sql=function(){return(r._sqlite3_sql=r.asm.sqlite3_sql).apply(null,arguments)},r._sqlite3_expanded_sql=function(){return(r._sqlite3_expanded_sql=r.asm.sqlite3_expanded_sql).apply(null,arguments)},r._sqlite3_preupdate_old=function(){return(r._sqlite3_preupdate_old=r.asm.sqlite3_preupdate_old).apply(null,arguments)},r._sqlite3_preupdate_count=function(){return(r._sqlite3_preupdate_count=r.asm.sqlite3_preupdate_count).apply(null,arguments)},r._sqlite3_preupdate_depth=function(){return(r._sqlite3_preupdate_depth=r.asm.sqlite3_preupdate_depth).apply(null,arguments)},r._sqlite3_preupdate_blobwrite=function(){return(r._sqlite3_preupdate_blobwrite=r.asm.sqlite3_preupdate_blobwrite).apply(null,arguments)},r._sqlite3_preupdate_new=function(){return(r._sqlite3_preupdate_new=r.asm.sqlite3_preupdate_new).apply(null,arguments)},r._sqlite3_value_numeric_type=function(){return(r._sqlite3_value_numeric_type=r.asm.sqlite3_value_numeric_type).apply(null,arguments)},r._sqlite3_set_authorizer=function(){return(r._sqlite3_set_authorizer=r.asm.sqlite3_set_authorizer).apply(null,arguments)},r._sqlite3_strglob=function(){return(r._sqlite3_strglob=r.asm.sqlite3_strglob).apply(null,arguments)},r._sqlite3_strlike=function(){return(r._sqlite3_strlike=r.asm.sqlite3_strlike).apply(null,arguments)},r._sqlite3_auto_extension=function(){return(r._sqlite3_auto_extension=r.asm.sqlite3_auto_extension).apply(null,arguments)},r._sqlite3_cancel_auto_extension=function(){return(r._sqlite3_cancel_auto_extension=r.asm.sqlite3_cancel_auto_extension).apply(null,arguments)},r._sqlite3_reset_auto_extension=function(){return(r._sqlite3_reset_auto_extension=r.asm.sqlite3_reset_auto_extension).apply(null,arguments)},r._sqlite3_prepare_v3=function(){return(r._sqlite3_prepare_v3=r.asm.sqlite3_prepare_v3).apply(null,arguments)},r._sqlite3_create_module=function(){return(r._sqlite3_create_module=r.asm.sqlite3_create_module).apply(null,arguments)},r._sqlite3_create_module_v2=function(){return(r._sqlite3_create_module_v2=r.asm.sqlite3_create_module_v2).apply(null,arguments)},r._sqlite3_drop_modules=function(){return(r._sqlite3_drop_modules=r.asm.sqlite3_drop_modules).apply(null,arguments)},r._sqlite3_declare_vtab=function(){return(r._sqlite3_declare_vtab=r.asm.sqlite3_declare_vtab).apply(null,arguments)},r._sqlite3_vtab_on_conflict=function(){return(r._sqlite3_vtab_on_conflict=r.asm.sqlite3_vtab_on_conflict).apply(null,arguments)},r._sqlite3_vtab_collation=function(){return(r._sqlite3_vtab_collation=r.asm.sqlite3_vtab_collation).apply(null,arguments)},r._sqlite3_vtab_in=function(){return(r._sqlite3_vtab_in=r.asm.sqlite3_vtab_in).apply(null,arguments)},r._sqlite3_vtab_rhs_value=function(){return(r._sqlite3_vtab_rhs_value=r.asm.sqlite3_vtab_rhs_value).apply(null,arguments)},r._sqlite3_vtab_distinct=function(){return(r._sqlite3_vtab_distinct=r.asm.sqlite3_vtab_distinct).apply(null,arguments)},r._sqlite3_keyword_name=function(){return(r._sqlite3_keyword_name=r.asm.sqlite3_keyword_name).apply(null,arguments)},r._sqlite3_keyword_count=function(){return(r._sqlite3_keyword_count=r.asm.sqlite3_keyword_count).apply(null,arguments)},r._sqlite3_keyword_check=function(){return(r._sqlite3_keyword_check=r.asm.sqlite3_keyword_check).apply(null,arguments)},r._sqlite3_complete=function(){return(r._sqlite3_complete=r.asm.sqlite3_complete).apply(null,arguments)},r._sqlite3_libversion=function(){return(r._sqlite3_libversion=r.asm.sqlite3_libversion).apply(null,arguments)},r._sqlite3_libversion_number=function(){return(r._sqlite3_libversion_number=r.asm.sqlite3_libversion_number).apply(null,arguments)},r._sqlite3_shutdown=function(){return(r._sqlite3_shutdown=r.asm.sqlite3_shutdown).apply(null,arguments)},r._sqlite3_last_insert_rowid=function(){return(r._sqlite3_last_insert_rowid=r.asm.sqlite3_last_insert_rowid).apply(null,arguments)},r._sqlite3_set_last_insert_rowid=function(){return(r._sqlite3_set_last_insert_rowid=r.asm.sqlite3_set_last_insert_rowid).apply(null,arguments)},r._sqlite3_changes64=function(){return(r._sqlite3_changes64=r.asm.sqlite3_changes64).apply(null,arguments)},r._sqlite3_changes=function(){return(r._sqlite3_changes=r.asm.sqlite3_changes).apply(null,arguments)},r._sqlite3_total_changes64=function(){return(r._sqlite3_total_changes64=r.asm.sqlite3_total_changes64).apply(null,arguments)},r._sqlite3_total_changes=function(){return(r._sqlite3_total_changes=r.asm.sqlite3_total_changes).apply(null,arguments)},r._sqlite3_txn_state=function(){return(r._sqlite3_txn_state=r.asm.sqlite3_txn_state).apply(null,arguments)},r._sqlite3_close_v2=function(){return(r._sqlite3_close_v2=r.asm.sqlite3_close_v2).apply(null,arguments)},r._sqlite3_busy_handler=function(){return(r._sqlite3_busy_handler=r.asm.sqlite3_busy_handler).apply(null,arguments)},r._sqlite3_progress_handler=function(){return(r._sqlite3_progress_handler=r.asm.sqlite3_progress_handler).apply(null,arguments)},r._sqlite3_busy_timeout=function(){return(r._sqlite3_busy_timeout=r.asm.sqlite3_busy_timeout).apply(null,arguments)},r._sqlite3_create_function=function(){return(r._sqlite3_create_function=r.asm.sqlite3_create_function).apply(null,arguments)},r._sqlite3_create_function_v2=function(){return(r._sqlite3_create_function_v2=r.asm.sqlite3_create_function_v2).apply(null,arguments)},r._sqlite3_create_window_function=function(){return(r._sqlite3_create_window_function=r.asm.sqlite3_create_window_function).apply(null,arguments)},r._sqlite3_overload_function=function(){return(r._sqlite3_overload_function=r.asm.sqlite3_overload_function).apply(null,arguments)},r._sqlite3_trace_v2=function(){return(r._sqlite3_trace_v2=r.asm.sqlite3_trace_v2).apply(null,arguments)},r._sqlite3_commit_hook=function(){return(r._sqlite3_commit_hook=r.asm.sqlite3_commit_hook).apply(null,arguments)},r._sqlite3_update_hook=function(){return(r._sqlite3_update_hook=r.asm.sqlite3_update_hook).apply(null,arguments)},r._sqlite3_rollback_hook=function(){return(r._sqlite3_rollback_hook=r.asm.sqlite3_rollback_hook).apply(null,arguments)},r._sqlite3_preupdate_hook=function(){return(r._sqlite3_preupdate_hook=r.asm.sqlite3_preupdate_hook).apply(null,arguments)},r._sqlite3_error_offset=function(){return(r._sqlite3_error_offset=r.asm.sqlite3_error_offset).apply(null,arguments)},r._sqlite3_errcode=function(){return(r._sqlite3_errcode=r.asm.sqlite3_errcode).apply(null,arguments)},r._sqlite3_extended_errcode=function(){return(r._sqlite3_extended_errcode=r.asm.sqlite3_extended_errcode).apply(null,arguments)},r._sqlite3_errstr=function(){return(r._sqlite3_errstr=r.asm.sqlite3_errstr).apply(null,arguments)},r._sqlite3_limit=function(){return(r._sqlite3_limit=r.asm.sqlite3_limit).apply(null,arguments)},r._sqlite3_open=function(){return(r._sqlite3_open=r.asm.sqlite3_open).apply(null,arguments)},r._sqlite3_open_v2=function(){return(r._sqlite3_open_v2=r.asm.sqlite3_open_v2).apply(null,arguments)},r._sqlite3_create_collation=function(){return(r._sqlite3_create_collation=r.asm.sqlite3_create_collation).apply(null,arguments)},r._sqlite3_create_collation_v2=function(){return(r._sqlite3_create_collation_v2=r.asm.sqlite3_create_collation_v2).apply(null,arguments)},r._sqlite3_collation_needed=function(){return(r._sqlite3_collation_needed=r.asm.sqlite3_collation_needed).apply(null,arguments)},r._sqlite3_get_autocommit=function(){return(r._sqlite3_get_autocommit=r.asm.sqlite3_get_autocommit).apply(null,arguments)},r._sqlite3_table_column_metadata=function(){return(r._sqlite3_table_column_metadata=r.asm.sqlite3_table_column_metadata).apply(null,arguments)},r._sqlite3_extended_result_codes=function(){return(r._sqlite3_extended_result_codes=r.asm.sqlite3_extended_result_codes).apply(null,arguments)},r._sqlite3_uri_key=function(){return(r._sqlite3_uri_key=r.asm.sqlite3_uri_key).apply(null,arguments)},r._sqlite3_uri_int64=function(){return(r._sqlite3_uri_int64=r.asm.sqlite3_uri_int64).apply(null,arguments)},r._sqlite3_db_name=function(){return(r._sqlite3_db_name=r.asm.sqlite3_db_name).apply(null,arguments)},r._sqlite3_db_filename=function(){return(r._sqlite3_db_filename=r.asm.sqlite3_db_filename).apply(null,arguments)},r._sqlite3_compileoption_used=function(){return(r._sqlite3_compileoption_used=r.asm.sqlite3_compileoption_used).apply(null,arguments)},r._sqlite3_compileoption_get=function(){return(r._sqlite3_compileoption_get=r.asm.sqlite3_compileoption_get).apply(null,arguments)},r._sqlite3session_diff=function(){return(r._sqlite3session_diff=r.asm.sqlite3session_diff).apply(null,arguments)},r._sqlite3session_attach=function(){return(r._sqlite3session_attach=r.asm.sqlite3session_attach).apply(null,arguments)},r._sqlite3session_create=function(){return(r._sqlite3session_create=r.asm.sqlite3session_create).apply(null,arguments)},r._sqlite3session_delete=function(){return(r._sqlite3session_delete=r.asm.sqlite3session_delete).apply(null,arguments)},r._sqlite3session_table_filter=function(){return(r._sqlite3session_table_filter=r.asm.sqlite3session_table_filter).apply(null,arguments)},r._sqlite3session_changeset=function(){return(r._sqlite3session_changeset=r.asm.sqlite3session_changeset).apply(null,arguments)},r._sqlite3session_changeset_strm=function(){return(r._sqlite3session_changeset_strm=r.asm.sqlite3session_changeset_strm).apply(null,arguments)},r._sqlite3session_patchset_strm=function(){return(r._sqlite3session_patchset_strm=r.asm.sqlite3session_patchset_strm).apply(null,arguments)},r._sqlite3session_patchset=function(){return(r._sqlite3session_patchset=r.asm.sqlite3session_patchset).apply(null,arguments)},r._sqlite3session_enable=function(){return(r._sqlite3session_enable=r.asm.sqlite3session_enable).apply(null,arguments)},r._sqlite3session_indirect=function(){return(r._sqlite3session_indirect=r.asm.sqlite3session_indirect).apply(null,arguments)},r._sqlite3session_isempty=function(){return(r._sqlite3session_isempty=r.asm.sqlite3session_isempty).apply(null,arguments)},r._sqlite3session_memory_used=function(){return(r._sqlite3session_memory_used=r.asm.sqlite3session_memory_used).apply(null,arguments)},r._sqlite3session_object_config=function(){return(r._sqlite3session_object_config=r.asm.sqlite3session_object_config).apply(null,arguments)},r._sqlite3session_changeset_size=function(){return(r._sqlite3session_changeset_size=r.asm.sqlite3session_changeset_size).apply(null,arguments)},r._sqlite3changeset_start=function(){return(r._sqlite3changeset_start=r.asm.sqlite3changeset_start).apply(null,arguments)},r._sqlite3changeset_start_v2=function(){return(r._sqlite3changeset_start_v2=r.asm.sqlite3changeset_start_v2).apply(null,arguments)},r._sqlite3changeset_start_strm=function(){return(r._sqlite3changeset_start_strm=r.asm.sqlite3changeset_start_strm).apply(null,arguments)},r._sqlite3changeset_start_v2_strm=function(){return(r._sqlite3changeset_start_v2_strm=r.asm.sqlite3changeset_start_v2_strm).apply(null,arguments)},r._sqlite3changeset_next=function(){return(r._sqlite3changeset_next=r.asm.sqlite3changeset_next).apply(null,arguments)},r._sqlite3changeset_op=function(){return(r._sqlite3changeset_op=r.asm.sqlite3changeset_op).apply(null,arguments)},r._sqlite3changeset_pk=function(){return(r._sqlite3changeset_pk=r.asm.sqlite3changeset_pk).apply(null,arguments)},r._sqlite3changeset_old=function(){return(r._sqlite3changeset_old=r.asm.sqlite3changeset_old).apply(null,arguments)},r._sqlite3changeset_new=function(){return(r._sqlite3changeset_new=r.asm.sqlite3changeset_new).apply(null,arguments)},r._sqlite3changeset_conflict=function(){return(r._sqlite3changeset_conflict=r.asm.sqlite3changeset_conflict).apply(null,arguments)},r._sqlite3changeset_fk_conflicts=function(){return(r._sqlite3changeset_fk_conflicts=r.asm.sqlite3changeset_fk_conflicts).apply(null,arguments)},r._sqlite3changeset_finalize=function(){return(r._sqlite3changeset_finalize=r.asm.sqlite3changeset_finalize).apply(null,arguments)},r._sqlite3changeset_invert=function(){return(r._sqlite3changeset_invert=r.asm.sqlite3changeset_invert).apply(null,arguments)},r._sqlite3changeset_invert_strm=function(){return(r._sqlite3changeset_invert_strm=r.asm.sqlite3changeset_invert_strm).apply(null,arguments)},r._sqlite3changeset_apply_v2=function(){return(r._sqlite3changeset_apply_v2=r.asm.sqlite3changeset_apply_v2).apply(null,arguments)},r._sqlite3changeset_apply=function(){return(r._sqlite3changeset_apply=r.asm.sqlite3changeset_apply).apply(null,arguments)},r._sqlite3changeset_apply_v2_strm=function(){return(r._sqlite3changeset_apply_v2_strm=r.asm.sqlite3changeset_apply_v2_strm).apply(null,arguments)},r._sqlite3changeset_apply_strm=function(){return(r._sqlite3changeset_apply_strm=r.asm.sqlite3changeset_apply_strm).apply(null,arguments)},r._sqlite3changegroup_new=function(){return(r._sqlite3changegroup_new=r.asm.sqlite3changegroup_new).apply(null,arguments)},r._sqlite3changegroup_add=function(){return(r._sqlite3changegroup_add=r.asm.sqlite3changegroup_add).apply(null,arguments)},r._sqlite3changegroup_output=function(){return(r._sqlite3changegroup_output=r.asm.sqlite3changegroup_output).apply(null,arguments)},r._sqlite3changegroup_add_strm=function(){return(r._sqlite3changegroup_add_strm=r.asm.sqlite3changegroup_add_strm).apply(null,arguments)},r._sqlite3changegroup_output_strm=function(){return(r._sqlite3changegroup_output_strm=r.asm.sqlite3changegroup_output_strm).apply(null,arguments)},r._sqlite3changegroup_delete=function(){return(r._sqlite3changegroup_delete=r.asm.sqlite3changegroup_delete).apply(null,arguments)},r._sqlite3changeset_concat=function(){return(r._sqlite3changeset_concat=r.asm.sqlite3changeset_concat).apply(null,arguments)},r._sqlite3changeset_concat_strm=function(){return(r._sqlite3changeset_concat_strm=r.asm.sqlite3changeset_concat_strm).apply(null,arguments)},r._sqlite3session_config=function(){return(r._sqlite3session_config=r.asm.sqlite3session_config).apply(null,arguments)},r._sqlite3_sourceid=function(){return(r._sqlite3_sourceid=r.asm.sqlite3_sourceid).apply(null,arguments)},r._sqlite3__wasm_pstack_ptr=function(){return(r._sqlite3__wasm_pstack_ptr=r.asm.sqlite3__wasm_pstack_ptr).apply(null,arguments)},r._sqlite3__wasm_pstack_restore=function(){return(r._sqlite3__wasm_pstack_restore=r.asm.sqlite3__wasm_pstack_restore).apply(null,arguments)},r._sqlite3__wasm_pstack_alloc=function(){return(r._sqlite3__wasm_pstack_alloc=r.asm.sqlite3__wasm_pstack_alloc).apply(null,arguments)},r._sqlite3__wasm_pstack_remaining=function(){return(r._sqlite3__wasm_pstack_remaining=r.asm.sqlite3__wasm_pstack_remaining).apply(null,arguments)},r._sqlite3__wasm_pstack_quota=function(){return(r._sqlite3__wasm_pstack_quota=r.asm.sqlite3__wasm_pstack_quota).apply(null,arguments)},r._sqlite3__wasm_db_error=function(){return(r._sqlite3__wasm_db_error=r.asm.sqlite3__wasm_db_error).apply(null,arguments)},r._sqlite3__wasm_test_struct=function(){return(r._sqlite3__wasm_test_struct=r.asm.sqlite3__wasm_test_struct).apply(null,arguments)},r._sqlite3__wasm_enum_json=function(){return(r._sqlite3__wasm_enum_json=r.asm.sqlite3__wasm_enum_json).apply(null,arguments)},r._sqlite3__wasm_vfs_unlink=function(){return(r._sqlite3__wasm_vfs_unlink=r.asm.sqlite3__wasm_vfs_unlink).apply(null,arguments)},r._sqlite3__wasm_db_vfs=function(){return(r._sqlite3__wasm_db_vfs=r.asm.sqlite3__wasm_db_vfs).apply(null,arguments)},r._sqlite3__wasm_db_reset=function(){return(r._sqlite3__wasm_db_reset=r.asm.sqlite3__wasm_db_reset).apply(null,arguments)},r._sqlite3__wasm_db_export_chunked=function(){return(r._sqlite3__wasm_db_export_chunked=r.asm.sqlite3__wasm_db_export_chunked).apply(null,arguments)},r._sqlite3__wasm_db_serialize=function(){return(r._sqlite3__wasm_db_serialize=r.asm.sqlite3__wasm_db_serialize).apply(null,arguments)},r._sqlite3__wasm_vfs_create_file=function(){return(r._sqlite3__wasm_vfs_create_file=r.asm.sqlite3__wasm_vfs_create_file).apply(null,arguments)},r._sqlite3__wasm_posix_create_file=function(){return(r._sqlite3__wasm_posix_create_file=r.asm.sqlite3__wasm_posix_create_file).apply(null,arguments)},r._sqlite3__wasm_kvvfsMakeKeyOnPstack=function(){return(r._sqlite3__wasm_kvvfsMakeKeyOnPstack=r.asm.sqlite3__wasm_kvvfsMakeKeyOnPstack).apply(null,arguments)},r._sqlite3__wasm_kvvfs_methods=function(){return(r._sqlite3__wasm_kvvfs_methods=r.asm.sqlite3__wasm_kvvfs_methods).apply(null,arguments)},r._sqlite3__wasm_vtab_config=function(){return(r._sqlite3__wasm_vtab_config=r.asm.sqlite3__wasm_vtab_config).apply(null,arguments)},r._sqlite3__wasm_db_config_ip=function(){return(r._sqlite3__wasm_db_config_ip=r.asm.sqlite3__wasm_db_config_ip).apply(null,arguments)},r._sqlite3__wasm_db_config_pii=function(){return(r._sqlite3__wasm_db_config_pii=r.asm.sqlite3__wasm_db_config_pii).apply(null,arguments)},r._sqlite3__wasm_db_config_s=function(){return(r._sqlite3__wasm_db_config_s=r.asm.sqlite3__wasm_db_config_s).apply(null,arguments)},r._sqlite3__wasm_config_i=function(){return(r._sqlite3__wasm_config_i=r.asm.sqlite3__wasm_config_i).apply(null,arguments)},r._sqlite3__wasm_config_ii=function(){return(r._sqlite3__wasm_config_ii=r.asm.sqlite3__wasm_config_ii).apply(null,arguments)},r._sqlite3__wasm_config_j=function(){return(r._sqlite3__wasm_config_j=r.asm.sqlite3__wasm_config_j).apply(null,arguments)},r._sqlite3__wasm_qfmt_token=function(){return(r._sqlite3__wasm_qfmt_token=r.asm.sqlite3__wasm_qfmt_token).apply(null,arguments)},r._sqlite3__wasm_init_wasmfs=function(){return(r._sqlite3__wasm_init_wasmfs=r.asm.sqlite3__wasm_init_wasmfs).apply(null,arguments)},r._sqlite3__wasm_test_intptr=function(){return(r._sqlite3__wasm_test_intptr=r.asm.sqlite3__wasm_test_intptr).apply(null,arguments)},r._sqlite3__wasm_test_voidptr=function(){return(r._sqlite3__wasm_test_voidptr=r.asm.sqlite3__wasm_test_voidptr).apply(null,arguments)},r._sqlite3__wasm_test_int64_max=function(){return(r._sqlite3__wasm_test_int64_max=r.asm.sqlite3__wasm_test_int64_max).apply(null,arguments)},r._sqlite3__wasm_test_int64_min=function(){return(r._sqlite3__wasm_test_int64_min=r.asm.sqlite3__wasm_test_int64_min).apply(null,arguments)},r._sqlite3__wasm_test_int64_times2=function(){return(r._sqlite3__wasm_test_int64_times2=r.asm.sqlite3__wasm_test_int64_times2).apply(null,arguments)},r._sqlite3__wasm_test_int64_minmax=function(){return(r._sqlite3__wasm_test_int64_minmax=r.asm.sqlite3__wasm_test_int64_minmax).apply(null,arguments)},r._sqlite3__wasm_test_int64ptr=function(){return(r._sqlite3__wasm_test_int64ptr=r.asm.sqlite3__wasm_test_int64ptr).apply(null,arguments)},r._sqlite3__wasm_test_stack_overflow=function(){return(r._sqlite3__wasm_test_stack_overflow=r.asm.sqlite3__wasm_test_stack_overflow).apply(null,arguments)},r._sqlite3__wasm_test_str_hello=function(){return(r._sqlite3__wasm_test_str_hello=r.asm.sqlite3__wasm_test_str_hello).apply(null,arguments)},r._sqlite3__wasm_SQLTester_strglob=function(){return(r._sqlite3__wasm_SQLTester_strglob=r.asm.sqlite3__wasm_SQLTester_strglob).apply(null,arguments)};var iF=r._malloc=function(){return(iF=r._malloc=r.asm.malloc).apply(null,arguments)};r._free=function(){return(r._free=r.asm.free).apply(null,arguments)},r._realloc=function(){return(r._realloc=r.asm.realloc).apply(null,arguments)};var oF=r._emscripten_builtin_memalign=function(){return(oF=r._emscripten_builtin_memalign=r.asm.emscripten_builtin_memalign).apply(null,arguments)};r.stackSave=function(){return(r.stackSave=r.asm.stackSave).apply(null,arguments)},r.stackRestore=function(){return(r.stackRestore=r.asm.stackRestore).apply(null,arguments)},r.stackAlloc=function(){return(r.stackAlloc=r.asm.stackAlloc).apply(null,arguments)},r.wasmMemory=Fe;var D_;mh=function u(){D_||aF(),D_||(mh=u)};function aF(u){if(Qr>0||(kr(),Qr>0))return;function c(){D_||(D_=!0,r.calledRun=!0,!Je&&(xi(),s(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),qi()))}r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),c()},1)):c()}if(r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return aF(),r.postRun||(r.postRun=[]),r.postRun.push(function(u){if(globalThis.sqlite3ApiBootstrap=function c(h=globalThis.sqlite3ApiConfig||c.defaultConfig){if(c.sqlite3)return(c.sqlite3.config||console).warn("sqlite3ApiBootstrap() called multiple times.","Config and external initializers are ignored on calls after the first."),c.sqlite3;const d=Object.assign(Object.create(null),{exports:void 0,memory:void 0,bigIntEnabled:typeof u<"u"&&u.HEAPU64?!0:!!globalThis.BigInt64Array,debug:console.debug.bind(console),warn:console.warn.bind(console),error:console.error.bind(console),log:console.log.bind(console),wasmfsOpfsDir:"/opfs",useStdAlloc:!1},h||{});Object.assign(d,{allocExportName:d.useStdAlloc?"malloc":"sqlite3_malloc",deallocExportName:d.useStdAlloc?"free":"sqlite3_free",reallocExportName:d.useStdAlloc?"realloc":"sqlite3_realloc"},d),["exports","memory","wasmfsOpfsDir"].forEach(b=>{typeof d[b]=="function"&&(d[b]=d[b]())}),delete globalThis.sqlite3ApiConfig,delete c.defaultConfig;const p=Object.create(null),y=Object.create(null),A=b=>p.sqlite3_js_rc_str&&p.sqlite3_js_rc_str(b)||"Unknown result code #"+b,P=b=>typeof b=="number"&&b===(b|0);class te extends Error{constructor(...x){let $;if(x.length)if(P(x[0]))if($=x[0],x.length===1)super(A(x[0]));else{const L=A($);typeof x[1]=="object"?super(L,x[1]):(x[0]=L+":",super(x.join(" ")))}else x.length===2&&typeof x[1]=="object"?super(...x):super(x.join(" "));this.resultCode=$||p.SQLITE_ERROR,this.name="SQLite3Error"}}te.toss=(...b)=>{throw new te(...b)};const ne=te.toss;d.wasmfsOpfsDir&&!/^\/[^/]+$/.test(d.wasmfsOpfsDir)&&ne("config.wasmfsOpfsDir must be falsy or in the form '/dir-name'.");const pe=b=>typeof b!="bigint"&&b===(b|0)&&b<=2147483647&&b>=-2147483648,xe=function b(x){return b._max||(b._max=BigInt("0x7fffffffffffffff"),b._min=~b._max),x>=b._min&&x<=b._max},Q=b=>b>=-0x7fffffffn-1n&&b<=0x7fffffffn,K=function b(x){return b._min||(b._min=Number.MIN_SAFE_INTEGER,b._max=Number.MAX_SAFE_INTEGER),x>=b._min&&x<=b._max},oe=b=>b&&b.constructor&&pe(b.constructor.BYTES_PER_ELEMENT)?b:!1,D=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,B=b=>b.buffer instanceof D,G=(b,x,$)=>B(b)?b.slice(x,$):b.subarray(x,$),Y=b=>b&&(b instanceof Uint8Array||b instanceof Int8Array||b instanceof ArrayBuffer),ie=b=>b&&(b instanceof Uint8Array||b instanceof Int8Array||b instanceof ArrayBuffer),V=b=>Y(b)||ne("Value is not of a supported TypedArray type."),le=new TextDecoder("utf-8"),we=function(b,x,$){return le.decode(G(b,x,$))},k=function(b){return ie(b)?we(b instanceof ArrayBuffer?new Uint8Array(b):b):Array.isArray(b)?b.join(""):(y.isPtr(b)&&(b=y.cstrToJs(b)),b)};class F extends Error{constructor(...x){x.length===2&&typeof x[1]=="object"?super(...x):x.length?super(x.join(" ")):super("Allocation failed."),this.resultCode=p.SQLITE_NOMEM,this.name="WasmAllocError"}}F.toss=(...b)=>{throw new F(...b)},Object.assign(p,{sqlite3_bind_blob:void 0,sqlite3_bind_text:void 0,sqlite3_create_function_v2:(b,x,$,L,me,Pe,nt,mt,st)=>{},sqlite3_create_function:(b,x,$,L,me,Pe,nt,mt)=>{},sqlite3_create_window_function:(b,x,$,L,me,Pe,nt,mt,st,at)=>{},sqlite3_prepare_v3:(b,x,$,L,me,Pe)=>{},sqlite3_prepare_v2:(b,x,$,L,me)=>{},sqlite3_exec:(b,x,$,L,me)=>{},sqlite3_randomness:(b,x)=>{}});const W={affirmBindableTypedArray:V,flexibleString:k,bigIntFits32:Q,bigIntFits64:xe,bigIntFitsDouble:K,isBindableTypedArray:Y,isInt32:pe,isSQLableTypedArray:ie,isTypedArray:oe,typedArrayToString:we,isUIThread:()=>globalThis.window===globalThis&&!!globalThis.document,isSharedTypedArray:B,toss:function(...b){throw new Error(b.join(" "))},toss3:ne,typedArrayPart:G,affirmDbHeader:function(b){b instanceof ArrayBuffer&&(b=new Uint8Array(b));const x="SQLite format 3";x.length>b.byteLength&&ne("Input does not contain an SQLite3 database header.");for(let $=0;$<x.length;++$)x.charCodeAt($)!==b[$]&&ne("Input does not contain an SQLite3 database header.")},affirmIsDb:function(b){b instanceof ArrayBuffer&&(b=new Uint8Array(b));const x=b.byteLength;(x<512||x%512!==0)&&ne("Byte array size",x,"is invalid for an SQLite3 db."),W.affirmDbHeader(b)}};Object.assign(y,{ptrSizeof:d.wasmPtrSizeof||4,ptrIR:d.wasmPtrIR||"i32",bigIntEnabled:!!d.bigIntEnabled,exports:d.exports||ne("Missing API config.exports (WASM module exports)."),memory:d.memory||d.exports.memory||ne("API config object requires a WebAssembly.Memory object","in either config.exports.memory (exported)","or config.memory (imported)."),alloc:void 0,realloc:void 0,dealloc:void 0}),y.allocFromTypedArray=function(b){b instanceof ArrayBuffer&&(b=new Uint8Array(b)),V(b);const x=y.alloc(b.byteLength||1);return y.heapForSize(b.constructor).set(b.byteLength?b:[0],x),x};{const b=d.allocExportName,x=d.deallocExportName,$=d.reallocExportName;for(const L of[b,x,$])y.exports[L]instanceof Function||ne("Missing required exports[",L,"] function.");y.alloc=function L(me){return L.impl(me)||F.toss("Failed to allocate",me," bytes.")},y.alloc.impl=y.exports[b],y.realloc=function L(me,Pe){const nt=L.impl(me,Pe);return Pe?nt||F.toss("Failed to reallocate",Pe," bytes."):0},y.realloc.impl=y.exports[$],y.dealloc=y.exports[x]}y.compileOptionUsed=function b(x){if(arguments.length){if(Array.isArray(x)){const $={};return x.forEach(L=>{$[L]=p.sqlite3_compileoption_used(L)}),$}else if(typeof x=="object")return Object.keys(x).forEach($=>{x[$]=p.sqlite3_compileoption_used($)}),x}else{if(b._result)return b._result;b._opt||(b._rx=/^([^=]+)=(.+)/,b._rxInt=/^-?\d+$/,b._opt=function(nt,mt){const st=b._rx.exec(nt);mt[0]=st?st[1]:nt,mt[1]=st?b._rxInt.test(st[2])?+st[2]:st[2]:!0});const $={},L=[0,0];let me=0,Pe;for(;Pe=p.sqlite3_compileoption_get(me++);)b._opt(Pe,L),$[L[0]]=L[1];return b._result=$}return typeof x=="string"?!!p.sqlite3_compileoption_used(x):!1},y.pstack=Object.assign(Object.create(null),{restore:y.exports.sqlite3__wasm_pstack_restore,alloc:function(b){return typeof b=="string"&&!(b=y.sizeofIR(b))&&F.toss("Invalid value for pstack.alloc(",arguments[0],")"),y.exports.sqlite3__wasm_pstack_alloc(b)||F.toss("Could not allocate",b,"bytes from the pstack.")},allocChunks:function(b,x){typeof x=="string"&&!(x=y.sizeofIR(x))&&F.toss("Invalid size value for allocChunks(",arguments[1],")");const $=y.pstack.alloc(b*x),L=[];let me=0,Pe=0;for(;me<b;++me,Pe+=x)L.push($+Pe);return L},allocPtr:(b=1,x=!0)=>b===1?y.pstack.alloc(x?8:y.ptrSizeof):y.pstack.allocChunks(b,x?8:y.ptrSizeof),call:function(b){const x=y.pstack.pointer;try{return b(R)}finally{y.pstack.restore(x)}}}),Object.defineProperties(y.pstack,{pointer:{configurable:!1,iterable:!0,writeable:!1,get:y.exports.sqlite3__wasm_pstack_ptr},quota:{configurable:!1,iterable:!0,writeable:!1,get:y.exports.sqlite3__wasm_pstack_quota},remaining:{configurable:!1,iterable:!0,writeable:!1,get:y.exports.sqlite3__wasm_pstack_remaining}}),p.sqlite3_randomness=(...b)=>{if(b.length===1&&W.isTypedArray(b[0])&&b[0].BYTES_PER_ELEMENT===1){const x=b[0];if(x.byteLength===0)return y.exports.sqlite3_randomness(0,0),x;const $=y.pstack.pointer;try{let L=x.byteLength,me=0;const Pe=y.exports.sqlite3_randomness,nt=y.heap8u(),mt=L<512?L:512,st=y.pstack.alloc(mt);do{const at=L>mt?mt:L;Pe(at,st),x.set(G(nt,st,st+at),me),L-=at,me+=at}while(L>0)}catch(L){console.error("Highly unexpected (and ignored!) exception in sqlite3_randomness():",L)}finally{y.pstack.restore($)}return x}y.exports.sqlite3_randomness(...b)};let _e;if(p.sqlite3_wasmfs_opfs_dir=function(){if(_e!==void 0)return _e;const b=d.wasmfsOpfsDir;if(!b||!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle)return _e="";try{return b&&y.xCallWrapped("sqlite3__wasm_init_wasmfs","i32",["string"],b)===0?_e=b:_e=""}catch{return _e=""}},p.sqlite3_wasmfs_filename_is_persistent=function(b){const x=p.sqlite3_wasmfs_opfs_dir();return x&&b?b.startsWith(x+"/"):!1},p.sqlite3_js_db_uses_vfs=function(b,x,$=0){try{const L=p.sqlite3_vfs_find(x);return L?b?L===p.sqlite3_js_db_vfs(b,$)?L:!1:L===p.sqlite3_vfs_find(0)?L:!1:!1}catch{return!1}},p.sqlite3_js_vfs_list=function(){const b=[];let x=p.sqlite3_vfs_find(0);for(;x;){const $=new p.sqlite3_vfs(x);b.push(y.cstrToJs($.$zName)),x=$.$pNext,$.dispose()}return b},p.sqlite3_js_db_export=function(b,x=0){b=y.xWrap.testConvertArg("sqlite3*",b),b||ne("Invalid sqlite3* argument."),y.bigIntEnabled||ne("BigInt64 support is not enabled.");const $=y.scopedAllocPush();let L;try{const me=y.scopedAlloc(8+y.ptrSizeof),Pe=me+8,nt=x?y.isPtr(x)?x:y.scopedAllocCString(""+x):0;let mt=y.exports.sqlite3__wasm_db_serialize(b,nt,Pe,me,0);mt&&ne("Database serialization failed with code",R.capi.sqlite3_js_rc_str(mt)),L=y.peekPtr(Pe);const st=y.peek(me,"i64");return mt=st?y.heap8u().slice(L,L+Number(st)):new Uint8Array,mt}finally{L&&y.exports.sqlite3_free(L),y.scopedAllocPop($)}},p.sqlite3_js_db_vfs=(b,x=0)=>W.sqlite3__wasm_db_vfs(b,x),p.sqlite3_js_aggregate_context=(b,x)=>p.sqlite3_aggregate_context(b,x)||(x?F.toss("Cannot allocate",x,"bytes for sqlite3_aggregate_context()"):0),p.sqlite3_js_posix_create_file=function(b,x,$){let L;x&&y.isPtr(x)?L=x:x instanceof ArrayBuffer||x instanceof Uint8Array?(L=y.allocFromTypedArray(x),(arguments.length<3||!W.isInt32($)||$<0)&&($=x.byteLength)):te.toss("Invalid 2nd argument for sqlite3_js_posix_create_file().");try{(!W.isInt32($)||$<0)&&te.toss("Invalid 3rd argument for sqlite3_js_posix_create_file().");const me=W.sqlite3__wasm_posix_create_file(b,L,$);me&&te.toss("Creation of file failed with sqlite3 result code",p.sqlite3_js_rc_str(me))}finally{y.dealloc(L)}},p.sqlite3_js_vfs_create_file=function(b,x,$,L){d.warn("sqlite3_js_vfs_create_file() is deprecated and","should be avoided because it can lead to C-level crashes.","See its documentation for alternative options.");let me;$?(y.isPtr($)?me=$:$ instanceof ArrayBuffer&&($=new Uint8Array($)),$ instanceof Uint8Array?(me=y.allocFromTypedArray($),(arguments.length<4||!W.isInt32(L)||L<0)&&(L=$.byteLength)):te.toss("Invalid 3rd argument type for sqlite3_js_vfs_create_file().")):me=0,(!W.isInt32(L)||L<0)&&(y.dealloc(me),te.toss("Invalid 4th argument for sqlite3_js_vfs_create_file()."));try{const Pe=W.sqlite3__wasm_vfs_create_file(b,x,me,L);Pe&&te.toss("Creation of file failed with sqlite3 result code",p.sqlite3_js_rc_str(Pe))}finally{y.dealloc(me)}},p.sqlite3_js_sql_to_string=b=>{if(typeof b=="string")return b;const x=k(v);return x===v?void 0:x},W.isUIThread()){const b=function(x){const $=Object.create(null);return $.prefix="kvvfs-"+x,$.stores=[],(x==="session"||x==="")&&$.stores.push(globalThis.sessionStorage),(x==="local"||x==="")&&$.stores.push(globalThis.localStorage),$};p.sqlite3_js_kvvfs_clear=function(x=""){let $=0;const L=b(x);return L.stores.forEach(me=>{const Pe=[];let nt;for(nt=0;nt<me.length;++nt){const mt=me.key(nt);mt.startsWith(L.prefix)&&Pe.push(mt)}Pe.forEach(mt=>me.removeItem(mt)),$+=Pe.length}),$},p.sqlite3_js_kvvfs_size=function(x=""){let $=0;const L=b(x);return L.stores.forEach(me=>{let Pe;for(Pe=0;Pe<me.length;++Pe){const nt=me.key(Pe);nt.startsWith(L.prefix)&&($+=nt.length,$+=me.getItem(nt).length)}}),$*2}}p.sqlite3_db_config=(function(b,x,...$){switch(this.s||(this.s=y.xWrap("sqlite3__wasm_db_config_s","int",["sqlite3*","int","string:static"]),this.pii=y.xWrap("sqlite3__wasm_db_config_pii","int",["sqlite3*","int","*","int","int"]),this.ip=y.xWrap("sqlite3__wasm_db_config_ip","int",["sqlite3*","int","int","*"])),x){case p.SQLITE_DBCONFIG_ENABLE_FKEY:case p.SQLITE_DBCONFIG_ENABLE_TRIGGER:case p.SQLITE_DBCONFIG_ENABLE_FTS3_TOKENIZER:case p.SQLITE_DBCONFIG_ENABLE_LOAD_EXTENSION:case p.SQLITE_DBCONFIG_NO_CKPT_ON_CLOSE:case p.SQLITE_DBCONFIG_ENABLE_QPSG:case p.SQLITE_DBCONFIG_TRIGGER_EQP:case p.SQLITE_DBCONFIG_RESET_DATABASE:case p.SQLITE_DBCONFIG_DEFENSIVE:case p.SQLITE_DBCONFIG_WRITABLE_SCHEMA:case p.SQLITE_DBCONFIG_LEGACY_ALTER_TABLE:case p.SQLITE_DBCONFIG_DQS_DML:case p.SQLITE_DBCONFIG_DQS_DDL:case p.SQLITE_DBCONFIG_ENABLE_VIEW:case p.SQLITE_DBCONFIG_LEGACY_FILE_FORMAT:case p.SQLITE_DBCONFIG_TRUSTED_SCHEMA:case p.SQLITE_DBCONFIG_STMT_SCANSTATUS:case p.SQLITE_DBCONFIG_REVERSE_SCANORDER:return this.ip(b,x,$[0],$[1]||0);case p.SQLITE_DBCONFIG_LOOKASIDE:return this.pii(b,x,$[0],$[1],$[2]);case p.SQLITE_DBCONFIG_MAINDBNAME:return this.s(b,x,$[0]);default:return p.SQLITE_MISUSE}}).bind(Object.create(null)),p.sqlite3_value_to_js=function(b,x=!0){let $;const L=p.sqlite3_value_type(b);switch(L){case p.SQLITE_INTEGER:y.bigIntEnabled?($=p.sqlite3_value_int64(b),W.bigIntFitsDouble($)&&($=Number($))):$=p.sqlite3_value_double(b);break;case p.SQLITE_FLOAT:$=p.sqlite3_value_double(b);break;case p.SQLITE_TEXT:$=p.sqlite3_value_text(b);break;case p.SQLITE_BLOB:{const me=p.sqlite3_value_bytes(b),Pe=p.sqlite3_value_blob(b);me&&!Pe&&R.WasmAllocError.toss("Cannot allocate memory for blob argument of",me,"byte(s)"),$=me?y.heap8u().slice(Pe,Pe+Number(me)):null;break}case p.SQLITE_NULL:$=null;break;default:x&&ne(p.SQLITE_MISMATCH,"Unhandled sqlite3_value_type():",L),$=void 0}return $},p.sqlite3_values_to_js=function(b,x,$=!0){let L;const me=[];for(L=0;L<b;++L)me.push(p.sqlite3_value_to_js(y.peekPtr(x+y.ptrSizeof*L),$));return me},p.sqlite3_result_error_js=function(b,x){x instanceof F?p.sqlite3_result_error_nomem(b):p.sqlite3_result_error(b,""+x,-1)},p.sqlite3_result_js=function(b,x){if(x instanceof Error){p.sqlite3_result_error_js(b,x);return}try{switch(typeof x){case"undefined":break;case"boolean":p.sqlite3_result_int(b,x?1:0);break;case"bigint":W.bigIntFits32(x)?p.sqlite3_result_int(b,Number(x)):W.bigIntFitsDouble(x)?p.sqlite3_result_double(b,Number(x)):y.bigIntEnabled?W.bigIntFits64(x)?p.sqlite3_result_int64(b,x):ne("BigInt value",x.toString(),"is too BigInt for int64."):ne("BigInt value",x.toString(),"is too BigInt.");break;case"number":{let $;W.isInt32(x)?$=p.sqlite3_result_int:y.bigIntEnabled&&Number.isInteger(x)&&W.bigIntFits64(BigInt(x))?$=p.sqlite3_result_int64:$=p.sqlite3_result_double,$(b,x);break}case"string":{const[$,L]=y.allocCString(x,!0);p.sqlite3_result_text(b,$,L,p.SQLITE_WASM_DEALLOC);break}case"object":if(x===null){p.sqlite3_result_null(b);break}else if(W.isBindableTypedArray(x)){const $=y.allocFromTypedArray(x);p.sqlite3_result_blob(b,$,x.byteLength,p.SQLITE_WASM_DEALLOC);break}default:ne("Don't not how to handle this UDF result value:",typeof x,x)}}catch($){p.sqlite3_result_error_js(b,$)}},p.sqlite3_column_js=function(b,x,$=!0){const L=p.sqlite3_column_value(b,x);return L===0?void 0:p.sqlite3_value_to_js(L,$)};const q=(function(b,x,$){$=p[$],this.ptr?y.pokePtr(this.ptr,0):this.ptr=y.allocPtr();const L=$(b,x,this.ptr);if(L)return te.toss(L,arguments[2]+"() failed with code "+L);const me=y.peekPtr(this.ptr);return me?p.sqlite3_value_to_js(me,!0):void 0}).bind(Object.create(null));p.sqlite3_preupdate_new_js=(b,x)=>q(b,x,"sqlite3_preupdate_new"),p.sqlite3_preupdate_old_js=(b,x)=>q(b,x,"sqlite3_preupdate_old"),p.sqlite3changeset_new_js=(b,x)=>q(b,x,"sqlite3changeset_new"),p.sqlite3changeset_old_js=(b,x)=>q(b,x,"sqlite3changeset_old");const R={WasmAllocError:F,SQLite3Error:te,capi:p,util:W,wasm:y,config:d,version:Object.create(null),client:void 0,asyncPostInit:async function b(){if(b.isReady instanceof Promise)return b.isReady;let x=c.initializersAsync;delete c.initializersAsync;const $=async()=>(R.__isUnderTest||(delete R.util,delete R.StructBinder),R),L=Pe=>{throw d.error("an async sqlite3 initializer failed:",Pe),Pe};if(!x||!x.length)return b.isReady=$().catch(L);x=x.map(Pe=>Pe instanceof Function?async nt=>Pe(R):Pe),x.push($);let me=Promise.resolve(R);for(;x.length;)me=me.then(x.shift());return b.isReady=me.catch(L)},scriptInfo:void 0};try{c.initializers.forEach(b=>{b(R)})}catch(b){throw console.error("sqlite3 bootstrap initializer threw:",b),b}return delete c.initializers,c.sqlite3=R,R},globalThis.sqlite3ApiBootstrap.initializers=[],globalThis.sqlite3ApiBootstrap.initializersAsync=[],globalThis.sqlite3ApiBootstrap.defaultConfig=Object.create(null),globalThis.sqlite3ApiBootstrap.sqlite3=void 0,globalThis.WhWasmUtilInstaller=function(c){c.bigIntEnabled===void 0&&(c.bigIntEnabled=!!globalThis.BigInt64Array);const h=(...k)=>{throw new Error(k.join(" "))};c.exports||Object.defineProperty(c,"exports",{enumerable:!0,configurable:!0,get:()=>c.instance&&c.instance.exports});const d=c.pointerIR||"i32",p=c.ptrSizeof=d==="i32"?4:d==="i64"?8:h("Unhandled ptrSizeof:",d),y=Object.create(null);y.heapSize=0,y.memory=null,y.freeFuncIndexes=[],y.scopedAlloc=[],y.utf8Decoder=new TextDecoder,y.utf8Encoder=new TextEncoder("utf-8"),c.sizeofIR=k=>{switch(k){case"i8":return 1;case"i16":return 2;case"i32":case"f32":case"float":return 4;case"i64":case"f64":case"double":return 8;case"*":return p;default:return(""+k).endsWith("*")?p:void 0}};const A=function(){if(!y.memory)y.memory=c.memory instanceof WebAssembly.Memory?c.memory:c.exports.memory;else if(y.heapSize===y.memory.buffer.byteLength)return y;const k=y.memory.buffer;return y.HEAP8=new Int8Array(k),y.HEAP8U=new Uint8Array(k),y.HEAP16=new Int16Array(k),y.HEAP16U=new Uint16Array(k),y.HEAP32=new Int32Array(k),y.HEAP32U=new Uint32Array(k),c.bigIntEnabled&&(y.HEAP64=new BigInt64Array(k),y.HEAP64U=new BigUint64Array(k)),y.HEAP32F=new Float32Array(k),y.HEAP64F=new Float64Array(k),y.heapSize=k.byteLength,y};c.heap8=()=>A().HEAP8,c.heap8u=()=>A().HEAP8U,c.heap16=()=>A().HEAP16,c.heap16u=()=>A().HEAP16U,c.heap32=()=>A().HEAP32,c.heap32u=()=>A().HEAP32U,c.heapForSize=function(k,F=!0){const W=y.memory&&y.heapSize===y.memory.buffer.byteLength?y:A();switch(k){case Int8Array:return W.HEAP8;case Uint8Array:return W.HEAP8U;case Int16Array:return W.HEAP16;case Uint16Array:return W.HEAP16U;case Int32Array:return W.HEAP32;case Uint32Array:return W.HEAP32U;case 8:return F?W.HEAP8U:W.HEAP8;case 16:return F?W.HEAP16U:W.HEAP16;case 32:return F?W.HEAP32U:W.HEAP32;case 64:if(W.HEAP64)return F?W.HEAP64U:W.HEAP64;break;default:if(c.bigIntEnabled){if(k===globalThis.BigUint64Array)return W.HEAP64U;if(k===globalThis.BigInt64Array)return W.HEAP64;break}}h("Invalid heapForSize() size: expecting 8, 16, 32,","or (if BigInt is enabled) 64.")},c.functionTable=function(){return c.exports.__indirect_function_table},c.functionEntry=function(k){const F=c.functionTable();return k<F.length?F.get(k):void 0},c.jsFuncToWasm=function k(F,W){if(k._||(k._={sigTypes:Object.assign(Object.create(null),{i:"i32",p:"i32",P:"i32",s:"i32",j:"i64",f:"f32",d:"f64"}),typeCodes:Object.assign(Object.create(null),{f64:124,f32:125,i64:126,i32:127}),uleb128Encode:function(R,b,x){x<128?R[b](x):R[b](x%128|128,x>>7)},rxJSig:/^(\w)\((\w*)\)$/,sigParams:function(R){const b=k._.rxJSig.exec(R);return b?b[2]:R.substr(1)},letterType:R=>k._.sigTypes[R]||h("Invalid signature letter:",R),pushSigType:(R,b)=>R.push(k._.typeCodes[k._.letterType(b)])}),typeof F=="string"){const R=W;W=F,F=R}const _e=k._.sigParams(W),q=[1,96];k._.uleb128Encode(q,"push",_e.length);for(const R of _e)k._.pushSigType(q,R);return W[0]==="v"?q.push(0):(q.push(1),k._.pushSigType(q,W[0])),k._.uleb128Encode(q,"unshift",q.length),q.unshift(0,97,115,109,1,0,0,0,1),q.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array(q)),{e:{f:F}}).exports.f};const P=function(F,W,_e){if(_e&&!y.scopedAlloc.length&&h("No scopedAllocPush() scope is active."),typeof F=="string"){const x=W;W=F,F=x}(typeof W!="string"||!(F instanceof Function))&&h("Invalid arguments: expecting (function,signature) or (signature,function).");const q=c.functionTable(),R=q.length;let b;for(;y.freeFuncIndexes.length&&(b=y.freeFuncIndexes.pop(),q.get(b));){b=null;continue}b||(b=R,q.grow(1));try{return q.set(b,F),_e&&y.scopedAlloc[y.scopedAlloc.length-1].push(b),b}catch(x){if(!(x instanceof TypeError))throw b===R&&y.freeFuncIndexes.push(R),x}try{const x=c.jsFuncToWasm(F,W);q.set(b,x),_e&&y.scopedAlloc[y.scopedAlloc.length-1].push(b)}catch(x){throw b===R&&y.freeFuncIndexes.push(R),x}return b};c.installFunction=(k,F)=>P(k,F,!1),c.scopedInstallFunction=(k,F)=>P(k,F,!0),c.uninstallFunction=function(k){if(!k&&k!==0)return;const F=y.freeFuncIndexes,W=c.functionTable();F.push(k);const _e=W.get(k);return W.set(k,null),_e},c.peek=function(F,W="i8"){W.endsWith("*")&&(W=d);const _e=y.memory&&y.heapSize===y.memory.buffer.byteLength?y:A(),q=Array.isArray(F)?[]:void 0;let R;do{switch(q&&(F=arguments[0].shift()),W){case"i1":case"i8":R=_e.HEAP8[F>>0];break;case"i16":R=_e.HEAP16[F>>1];break;case"i32":R=_e.HEAP32[F>>2];break;case"float":case"f32":R=_e.HEAP32F[F>>2];break;case"double":case"f64":R=Number(_e.HEAP64F[F>>3]);break;case"i64":if(c.bigIntEnabled){R=BigInt(_e.HEAP64[F>>3]);break}default:h("Invalid type for peek():",W)}q&&q.push(R)}while(q&&arguments[0].length);return q||R},c.poke=function(k,F,W="i8"){W.endsWith("*")&&(W=d);const _e=y.memory&&y.heapSize===y.memory.buffer.byteLength?y:A();for(const q of Array.isArray(k)?k:[k])switch(W){case"i1":case"i8":_e.HEAP8[q>>0]=F;continue;case"i16":_e.HEAP16[q>>1]=F;continue;case"i32":_e.HEAP32[q>>2]=F;continue;case"float":case"f32":_e.HEAP32F[q>>2]=F;continue;case"double":case"f64":_e.HEAP64F[q>>3]=F;continue;case"i64":if(_e.HEAP64){_e.HEAP64[q>>3]=BigInt(F);continue}default:h("Invalid type for poke(): "+W)}return this},c.peekPtr=(...k)=>c.peek(k.length===1?k[0]:k,d),c.pokePtr=(k,F=0)=>c.poke(k,F,d),c.peek8=(...k)=>c.peek(k.length===1?k[0]:k,"i8"),c.poke8=(k,F)=>c.poke(k,F,"i8"),c.peek16=(...k)=>c.peek(k.length===1?k[0]:k,"i16"),c.poke16=(k,F)=>c.poke(k,F,"i16"),c.peek32=(...k)=>c.peek(k.length===1?k[0]:k,"i32"),c.poke32=(k,F)=>c.poke(k,F,"i32"),c.peek64=(...k)=>c.peek(k.length===1?k[0]:k,"i64"),c.poke64=(k,F)=>c.poke(k,F,"i64"),c.peek32f=(...k)=>c.peek(k.length===1?k[0]:k,"f32"),c.poke32f=(k,F)=>c.poke(k,F,"f32"),c.peek64f=(...k)=>c.peek(k.length===1?k[0]:k,"f64"),c.poke64f=(k,F)=>c.poke(k,F,"f64"),c.getMemValue=c.peek,c.getPtrValue=c.peekPtr,c.setMemValue=c.poke,c.setPtrValue=c.pokePtr,c.isPtr32=k=>typeof k=="number"&&k===(k|0)&&k>=0,c.isPtr=c.isPtr32,c.cstrlen=function(k){if(!k||!c.isPtr(k))return null;const F=A().HEAP8U;let W=k;for(;F[W]!==0;++W);return W-k};const te=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,ne=function(k,F,W){return y.utf8Decoder.decode(k.buffer instanceof te?k.slice(F,W):k.subarray(F,W))};c.cstrToJs=function(k){const F=c.cstrlen(k);return F?ne(A().HEAP8U,k,k+F):F===null?F:""},c.jstrlen=function(k){if(typeof k!="string")return null;const F=k.length;let W=0;for(let _e=0;_e<F;++_e){let q=k.charCodeAt(_e);q>=55296&&q<=57343&&(q=65536+((q&1023)<<10)|k.charCodeAt(++_e)&1023),q<=127?++W:q<=2047?W+=2:q<=65535?W+=3:W+=4}return W},c.jstrcpy=function(k,F,W=0,_e=-1,q=!0){if((!F||!(F instanceof Int8Array)&&!(F instanceof Uint8Array))&&h("jstrcpy() target must be an Int8Array or Uint8Array."),_e<0&&(_e=F.length-W),!(_e>0)||!(W>=0))return 0;let R=0,b=k.length;const x=W,$=W+_e-(q?1:0);for(;R<b&&W<$;++R){let L=k.charCodeAt(R);if(L>=55296&&L<=57343&&(L=65536+((L&1023)<<10)|k.charCodeAt(++R)&1023),L<=127){if(W>=$)break;F[W++]=L}else if(L<=2047){if(W+1>=$)break;F[W++]=192|L>>6,F[W++]=128|L&63}else if(L<=65535){if(W+2>=$)break;F[W++]=224|L>>12,F[W++]=128|L>>6&63,F[W++]=128|L&63}else{if(W+3>=$)break;F[W++]=240|L>>18,F[W++]=128|L>>12&63,F[W++]=128|L>>6&63,F[W++]=128|L&63}}return q&&(F[W++]=0),W-x},c.cstrncpy=function(k,F,W){if((!k||!F)&&h("cstrncpy() does not accept NULL strings."),W<0)W=c.cstrlen(strPtr)+1;else if(!(W>0))return 0;const _e=c.heap8u();let q=0,R;for(;q<W&&(R=_e[F+q]);++q)_e[k+q]=R;return q<W&&(_e[k+q++]=0),q},c.jstrToUintArray=(k,F=!1)=>y.utf8Encoder.encode(F?k+"\0":k);const pe=(k,F)=>{(!(k.alloc instanceof Function)||!(k.dealloc instanceof Function))&&h("Object is missing alloc() and/or dealloc() function(s)","required by",F+"().")},xe=function(k,F,W,_e){if(pe(c,_e),typeof k!="string")return null;{const q=y.utf8Encoder.encode(k),R=W(q.length+1),b=A().HEAP8U;return b.set(q,R),b[R+q.length]=0,F?[R,q.length]:R}};c.allocCString=(k,F=!1)=>xe(k,F,c.alloc,"allocCString()"),c.scopedAllocPush=function(){pe(c,"scopedAllocPush");const k=[];return y.scopedAlloc.push(k),k},c.scopedAllocPop=function(k){pe(c,"scopedAllocPop");const F=arguments.length?y.scopedAlloc.indexOf(k):y.scopedAlloc.length-1;F<0&&h("Invalid state object for scopedAllocPop()."),arguments.length===0&&(k=y.scopedAlloc[F]),y.scopedAlloc.splice(F,1);for(let W;W=k.pop();)c.functionEntry(W)?c.uninstallFunction(W):c.dealloc(W)},c.scopedAlloc=function(k){y.scopedAlloc.length||h("No scopedAllocPush() scope is active.");const F=c.alloc(k);return y.scopedAlloc[y.scopedAlloc.length-1].push(F),F},Object.defineProperty(c.scopedAlloc,"level",{configurable:!1,enumerable:!1,get:()=>y.scopedAlloc.length,set:()=>h("The 'active' property is read-only.")}),c.scopedAllocCString=(k,F=!1)=>xe(k,F,c.scopedAlloc,"scopedAllocCString()");const Q=function(k,F){const W=c[k?"scopedAlloc":"alloc"]((F.length+1)*c.ptrSizeof);let _e=0;return F.forEach(q=>{c.pokePtr(W+c.ptrSizeof*_e++,c[k?"scopedAllocCString":"allocCString"](""+q))}),c.pokePtr(W+c.ptrSizeof*_e,0),W};c.scopedAllocMainArgv=k=>Q(!0,k),c.allocMainArgv=k=>Q(!1,k),c.cArgvToJs=(k,F)=>{const W=[];for(let _e=0;_e<k;++_e){const q=c.peekPtr(F+c.ptrSizeof*_e);W.push(q?c.cstrToJs(q):null)}return W},c.scopedAllocCall=function(k){c.scopedAllocPush();try{return k()}finally{c.scopedAllocPop()}};const K=function(k,F,W){pe(c,W);const _e=F?"i64":d;let q=c[W](k*(F?8:p));if(c.poke(q,0,_e),k===1)return q;const R=[q];for(let b=1;b<k;++b)q+=F?8:p,R[b]=q,c.poke(q,0,_e);return R};c.allocPtr=(k=1,F=!0)=>K(k,F,"alloc"),c.scopedAllocPtr=(k=1,F=!0)=>K(k,F,"scopedAlloc"),c.xGet=function(k){return c.exports[k]||h("Cannot find exported symbol:",k)};const oe=(k,F)=>h(k+"() requires",F,"argument(s).");c.xCall=function(k,...F){const W=k instanceof Function?k:c.xGet(k);return W instanceof Function||h("Exported symbol",k,"is not a function."),W.length!==F.length&&oe(W===k?W.name:k,W.length),arguments.length===2&&Array.isArray(arguments[1])?W.apply(null,arguments[1]):W.apply(null,F)},y.xWrap=Object.create(null),y.xWrap.convert=Object.create(null),y.xWrap.convert.arg=new Map,y.xWrap.convert.result=new Map;const D=y.xWrap.convert.arg,B=y.xWrap.convert.result;c.bigIntEnabled&&D.set("i64",k=>BigInt(k));const G=d==="i32"?k=>k|0:k=>BigInt(k)|BigInt(0);D.set("i32",G).set("i16",k=>(k|0)&65535).set("i8",k=>(k|0)&255).set("f32",k=>Number(k).valueOf()).set("float",D.get("f32")).set("f64",D.get("f32")).set("double",D.get("f64")).set("int",D.get("i32")).set("null",k=>k).set(null,D.get("null")).set("**",G).set("*",G),B.set("*",G).set("pointer",G).set("number",k=>Number(k)).set("void",k=>{}).set("null",k=>k).set(null,B.get("null"));{const k=["i8","i16","i32","int","f32","float","f64","double"];c.bigIntEnabled&&k.push("i64");const F=D.get(d);for(const W of k)D.set(W+"*",F),B.set(W+"*",F),B.set(W,D.get(W)||h("Missing arg converter:",W))}const Y=function(k){return typeof k=="string"?c.scopedAllocCString(k):k?G(k):null};D.set("string",Y).set("utf8",Y).set("pointer",Y),B.set("string",k=>c.cstrToJs(k)).set("utf8",B.get("string")).set("string:dealloc",k=>{try{return k?c.cstrToJs(k):null}finally{c.dealloc(k)}}).set("utf8:dealloc",B.get("string:dealloc")).set("json",k=>JSON.parse(c.cstrToJs(k))).set("json:dealloc",k=>{try{return k?JSON.parse(c.cstrToJs(k)):null}finally{c.dealloc(k)}});const ie=class{constructor(k){this.name=k.name||"unnamed adapter"}convertArg(k,F,W){h("AbstractArgAdapter must be subclassed.")}};D.FuncPtrAdapter=class yo extends ie{constructor(F){super(F),D.FuncPtrAdapter.warnOnUse&&console.warn("xArg.FuncPtrAdapter is an internal-only API","and is not intended to be invoked from","client-level code. Invoked with:",F),this.name=F.name||"unnamed",this.signature=F.signature,F.contextKey instanceof Function&&(this.contextKey=F.contextKey,F.bindScope||(F.bindScope="context")),this.bindScope=F.bindScope||h("FuncPtrAdapter options requires a bindScope (explicit or implied)."),yo.bindScopes.indexOf(F.bindScope)<0&&h("Invalid options.bindScope ("+F.bindMod+") for FuncPtrAdapter. Expecting one of: ("+yo.bindScopes.join(", ")+")"),this.isTransient=this.bindScope==="transient",this.isContext=this.bindScope==="context",this.isPermanent=this.bindScope==="permanent",this.singleton=this.bindScope==="singleton"?[]:void 0,this.callProxy=F.callProxy instanceof Function?F.callProxy:void 0}contextKey(F,W){return this}contextMap(F){const W=this.__cmap||(this.__cmap=new Map);let _e=W.get(F);return _e===void 0&&W.set(F,_e=[]),_e}convertArg(F,W,_e){let q=this.singleton;if(!q&&this.isContext&&(q=this.contextMap(this.contextKey(W,_e))),q&&q[0]===F)return q[1];if(F instanceof Function){this.callProxy&&(F=this.callProxy(F));const R=P(F,this.signature,this.isTransient);if(yo.debugFuncInstall&&yo.debugOut("FuncPtrAdapter installed",this,this.contextKey(W,_e),"@"+R,F),q){if(q[1]){yo.debugFuncInstall&&yo.debugOut("FuncPtrAdapter uninstalling",this,this.contextKey(W,_e),"@"+q[1],F);try{y.scopedAlloc[y.scopedAlloc.length-1].push(q[1])}catch{}}q[0]=F,q[1]=R}return R}else if(c.isPtr(F)||F===null||F===void 0){if(q&&q[1]&&q[1]!==F){yo.debugFuncInstall&&yo.debugOut("FuncPtrAdapter uninstalling",this,this.contextKey(W,_e),"@"+q[1],F);try{y.scopedAlloc[y.scopedAlloc.length-1].push(q[1])}catch{}q[0]=q[1]=F|0}return F||0}else throw new TypeError("Invalid FuncPtrAdapter argument type. Expecting a function pointer or a "+(this.name?this.name+" ":"")+"function matching signature "+this.signature+".")}},D.FuncPtrAdapter.warnOnUse=!1,D.FuncPtrAdapter.debugFuncInstall=!1,D.FuncPtrAdapter.debugOut=console.debug.bind(console),D.FuncPtrAdapter.bindScopes=["transient","context","singleton","permanent"];const V=k=>D.get(k)||h("Argument adapter not found:",k),le=k=>B.get(k)||h("Result adapter not found:",k);y.xWrap.convertArg=(k,...F)=>V(k)(...F),y.xWrap.convertArgNoCheck=(k,...F)=>D.get(k)(...F),y.xWrap.convertResult=(k,F)=>k===null?F:k?le(k)(F):void 0,y.xWrap.convertResultNoCheck=(k,F)=>k===null?F:k?B.get(k)(F):void 0,c.xWrap=function(k,F,...W){arguments.length===3&&Array.isArray(arguments[2])&&(W=arguments[2]),c.isPtr(k)&&(k=c.functionEntry(k)||h("Function pointer not found in WASM function table."));const _e=k instanceof Function,q=_e?k:c.xGet(k);if(_e&&(k=q.name||"unnamed function"),W.length!==q.length&&oe(k,q.length),F===null&&q.length===0)return q;F!=null&&le(F);for(const b of W)b instanceof ie?D.set(b,(...x)=>b.convertArg(...x)):V(b);const R=y.xWrap;return q.length===0?(...b)=>b.length?oe(k,q.length):R.convertResult(F,q.call(null)):function(...b){b.length!==q.length&&oe(k,q.length);const x=c.scopedAllocPush();try{let $=0;for(;$<b.length;++$)b[$]=R.convertArgNoCheck(W[$],b[$],b,$);return R.convertResultNoCheck(F,q.apply(null,b))}finally{c.scopedAllocPop(x)}}};const we=function(k,F,W,_e,q,R){if(typeof W=="string"){if(F===1)return R.get(W);if(F===2){if(_e)_e instanceof Function||h(q,"requires a function argument.");else return delete R.get(W),k;return R.set(W,_e),k}}h("Invalid arguments to",q)};return c.xWrap.resultAdapter=function k(F,W){return we(k,arguments.length,F,W,"resultAdapter()",B)},c.xWrap.argAdapter=function k(F,W){return we(k,arguments.length,F,W,"argAdapter()",D)},c.xWrap.FuncPtrAdapter=D.FuncPtrAdapter,c.xCallWrapped=function(k,F,W,..._e){return Array.isArray(arguments[3])&&(_e=arguments[3]),c.xWrap(k,F,W||[]).apply(null,_e||[])},c.xWrap.testConvertArg=y.xWrap.convertArg,c.xWrap.testConvertResult=y.xWrap.convertResult,c},globalThis.WhWasmUtilInstaller.yawl=(function(c){const h=()=>fetch(c.uri,{credentials:"same-origin"}),d=this,p=function(A){if(c.wasmUtilTarget){const P=(...ne)=>{throw new Error(ne.join(" "))},te=c.wasmUtilTarget;if(te.module=A.module,te.instance=A.instance,te.instance.exports.memory||(te.memory=c.imports&&c.imports.env&&c.imports.env.memory||P("Missing 'memory' object!")),!te.alloc&&A.instance.exports.malloc){const ne=A.instance.exports;te.alloc=function(pe){return ne.malloc(pe)||P("Allocation of",pe,"bytes failed.")},te.dealloc=function(pe){ne.free(pe)}}d(te)}return c.onload&&c.onload(A,c),A};return WebAssembly.instantiateStreaming?function(){return WebAssembly.instantiateStreaming(h(),c.imports||{}).then(p)}:function(){return h().then(P=>P.arrayBuffer()).then(P=>WebAssembly.instantiate(P,c.imports||{})).then(p)}}).bind(globalThis.WhWasmUtilInstaller),globalThis.Jaccwabyt=function c(h){const d=(...T)=>{throw new Error(T.join(" "))};!(h.heap instanceof WebAssembly.Memory)&&!(h.heap instanceof Function)&&d("config.heap must be WebAssembly.Memory instance or a function."),["alloc","dealloc"].forEach(function(T){h[T]instanceof Function||d("Config option '"+T+"' must be a function.")});const p=c,y=h.heap instanceof Function?h.heap:()=>new Uint8Array(h.heap.buffer),A=h.alloc,P=h.dealloc,te=h.log||console.log.bind(console),ne=h.memberPrefix||"",pe=h.memberSuffix||"",xe=h.bigIntEnabled===void 0?!!globalThis.BigInt64Array:!!h.bigIntEnabled,Q=globalThis.BigInt,K=globalThis.BigInt64Array,oe=h.ptrSizeof||4,D=h.ptrIR||"i32";p.debugFlags||(p.__makeDebugFlags=function(T=null){T&&T.__flags&&(T=T.__flags);const j=function H(re){return arguments.length===0?H.__flags:(re<0?(delete H.__flags.getter,delete H.__flags.setter,delete H.__flags.alloc,delete H.__flags.dealloc):(H.__flags.getter=(1&re)!==0,H.__flags.setter=(2&re)!==0,H.__flags.alloc=(4&re)!==0,H.__flags.dealloc=(8&re)!==0),H._flags)};return Object.defineProperty(j,"__flags",{iterable:!1,writable:!1,value:Object.create(T)}),T||j(0),j},p.debugFlags=p.__makeDebugFlags());const B=function(){const T=new ArrayBuffer(2);return new DataView(T).setInt16(0,256,!0),new Int16Array(T)[0]===256}(),G=T=>T[1]==="(",Y=T=>T==="P",ie=T=>G(T)?"p":T[0],V=function(T){switch(ie(T)){case"c":case"C":return"i8";case"i":return"i32";case"p":case"P":case"s":return D;case"j":return"i64";case"f":return"float";case"d":return"double"}d("Unhandled signature IR:",T)},le=K?()=>!0:()=>d("BigInt64Array is not available."),we=function(T){switch(ie(T)){case"p":case"P":case"s":{switch(oe){case 4:return"getInt32";case 8:return le()&&"getBigInt64"}break}case"i":return"getInt32";case"c":return"getInt8";case"C":return"getUint8";case"j":return le()&&"getBigInt64";case"f":return"getFloat32";case"d":return"getFloat64"}d("Unhandled DataView getter for signature:",T)},k=function(T){switch(ie(T)){case"p":case"P":case"s":{switch(oe){case 4:return"setInt32";case 8:return le()&&"setBigInt64"}break}case"i":return"setInt32";case"c":return"setInt8";case"C":return"setUint8";case"j":return le()&&"setBigInt64";case"f":return"setFloat32";case"d":return"setFloat64"}d("Unhandled DataView setter for signature:",T)},F=function(T){switch(ie(T)){case"i":case"f":case"c":case"C":case"d":return Number;case"j":return le()&&Q;case"p":case"P":case"s":switch(oe){case 4:return Number;case 8:return le()&&Q}break}d("Unhandled DataView set wrapper for signature:",T)},W=(T,j)=>T+"::"+j,_e=function(T,j){return()=>d(W(T,j),"is read-only.")},q=new WeakMap,R="(pointer-is-external)",b=function(T,j,H){if(H||(H=q.get(j)),H){if(q.delete(j),Array.isArray(j.ondispose)){let re;for(;re=j.ondispose.shift();)try{re instanceof Function?re.call(j):re instanceof Oe?re.dispose():typeof re=="number"&&P(re)}catch(Ie){console.warn("ondispose() for",T.structName,"@",H,"threw. NOT propagating it.",Ie)}}else if(j.ondispose instanceof Function)try{j.ondispose()}catch(re){console.warn("ondispose() for",T.structName,"@",H,"threw. NOT propagating it.",re)}delete j.ondispose,T.debugFlags.__flags.dealloc&&te("debug.dealloc:",j[R]?"EXTERNAL":"",T.structName,"instance:",T.structInfo.sizeof,"bytes @"+H),j[R]||P(H)}},x=T=>({configurable:!1,writable:!1,iterable:!1,value:T}),$=function(T,j,H){let re=!H;H?Object.defineProperty(j,R,x(H)):(H=A(T.structInfo.sizeof),H||d("Allocation of",T.structName,"structure failed."));try{T.debugFlags.__flags.alloc&&te("debug.alloc:",re?"":"EXTERNAL",T.structName,"instance:",T.structInfo.sizeof,"bytes @"+H),re&&y().fill(0,H,H+T.structInfo.sizeof),q.set(j,H)}catch(Ie){throw b(T,j,H),Ie}},L=function(){const T=this.pointer;return T?new Uint8Array(y().slice(T,T+this.structInfo.sizeof)):null},Pe=x(T=>ne+T+pe),nt=function(T,j,H=!0){let re=T.members[j];if(!re&&(ne||pe)){for(const Ie of Object.values(T.members))if(Ie.key===j){re=Ie;break}!re&&H&&d(W(T.name,j),"is not a mapped struct member.")}return re},mt=function T(j,H,re=!1){T._||(T._=Ge=>Ge.replace(/[^vipPsjrdcC]/g,"").replace(/[pPscC]/g,"i"));const Ie=nt(j.structInfo,H,!0);return re?T._(Ie.signature):Ie.signature},st={configurable:!1,enumerable:!1,get:function(){return q.get(this)},set:()=>d("Cannot assign the 'pointer' property of a struct.")},at=x(function(){const T=[];for(const j of Object.keys(this.structInfo.members))T.push(this.memberKey(j));return T}),Et=new TextDecoder("utf-8"),Ct=new TextEncoder,Gt=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,Yt=function(T,j,H){return Et.decode(T.buffer instanceof Gt?T.slice(j,H):T.subarray(j,H))},wr=function(T,j,H=!1){const re=nt(T.structInfo,j,H);return re&&re.signature.length===1&&re.signature[0]==="s"?re:!1},mn=function(T){T.signature!=="s"&&d("Invalid member type signature for C-string value:",JSON.stringify(T))},X=function(j,H){const re=nt(j.structInfo,H,!0);mn(re);const Ie=j[re.key];if(!Ie)return null;let Ge=Ie;const wt=y();for(;wt[Ge]!==0;++Ge);return Ie===Ge?"":Yt(wt,Ie,Ge)},ue=function(T,...j){T.ondispose?Array.isArray(T.ondispose)||(T.ondispose=[T.ondispose]):T.ondispose=[],T.ondispose.push(...j)},ge=function(T){const j=Ct.encode(T),H=A(j.length+1);H||d("Allocation error while duplicating string:",T);const re=y();return re.set(j,H),re[H+j.length]=0,H},Ce=function(T,j,H){const re=nt(T.structInfo,j,!0);mn(re);const Ie=ge(H);return T[re.key]=Ie,ue(T,Ie),T},Oe=function(j,H){arguments[2]!==x&&d("Do not call the StructType constructor","from client-level code."),Object.defineProperties(this,{structName:x(j),structInfo:x(H)})};Oe.prototype=Object.create(null,{dispose:x(function(){b(this.constructor,this)}),lookupMember:x(function(T,j=!0){return nt(this.structInfo,T,j)}),memberToJsString:x(function(T){return X(this,T)}),memberIsString:x(function(T,j=!0){return wr(this,T,j)}),memberKey:Pe,memberKeys:at,memberSignature:x(function(T,j=!1){return mt(this,T,j)}),memoryDump:x(L),pointer:st,setMemberCString:x(function(T,j){return Ce(this,T,j)})}),Object.assign(Oe.prototype,{addOnDispose:function(...T){return ue(this,...T),this}}),Object.defineProperties(Oe,{allocCString:x(ge),isA:x(T=>T instanceof Oe),hasExternalPointer:x(T=>T instanceof Oe&&!!T[R]),memberKey:Pe});const $e=T=>Number.isFinite(T)||T instanceof(Q||Number),be=function T(j,H,re){if(!T._){T._={getters:{},setters:{},sw:{}};const $r=["i","c","C","p","P","s","f","d","v()"];xe&&$r.push("j"),$r.forEach(function(Ii){T._.getters[Ii]=we(Ii),T._.setters[Ii]=k(Ii),T._.sw[Ii]=F(Ii)});const ise=/^[ipPsjfdcC]$/,ose=/^[vipPsjfdcC]\([ipPsjfdcC]*\)$/;T.sigCheck=function(Ii,ase,cF,NE){Object.prototype.hasOwnProperty.call(Ii,cF)&&d(Ii.structName,"already has a property named",cF+"."),ise.test(NE)||ose.test(NE)||d("Malformed signature for",W(Ii.structName,ase)+":",NE)}}const Ie=j.memberKey(H);T.sigCheck(j.prototype,H,Ie,re.signature),re.key=Ie,re.name=H;const Ge=ie(re.signature),wt=W(j.prototype.structName,Ie),$t=j.prototype.debugFlags.__flags,ds=Object.create(null);ds.configurable=!1,ds.enumerable=!1,ds.get=function(){$t.getter&&te("debug.getter:",T._.getters[Ge],"for",V(Ge),wt,"@",this.pointer,"+",re.offset,"sz",re.sizeof);let $r=new DataView(y().buffer,this.pointer+re.offset,re.sizeof)[T._.getters[Ge]](0,B);return $t.getter&&te("debug.getter:",wt,"result =",$r),$r},re.readOnly?ds.set=_e(j.prototype.structName,Ie):ds.set=function($r){if($t.setter&&te("debug.setter:",T._.setters[Ge],"for",V(Ge),wt,"@",this.pointer,"+",re.offset,"sz",re.sizeof,$r),this.pointer||d("Cannot set struct property on disposed instance."),$r===null)$r=0;else for(;!$e($r);){if(Y(re.signature)&&$r instanceof Oe){$r=$r.pointer||0,$t.setter&&te("debug.setter:",wt,"resolved to",$r);break}d("Invalid value for pointer-type",wt+".")}new DataView(y().buffer,this.pointer+re.offset,re.sizeof)[T._.setters[Ge]](0,T._.sw[Ge]($r),B)},Object.defineProperty(j.prototype,Ie,ds)},C=function T(j,H){arguments.length===1?(H=j,j=H.name):H.name||(H.name=j),j||d("Struct name is required.");let re=!1;Object.keys(H.members).forEach(wt=>{const $t=H.members[wt];$t.sizeof?$t.sizeof===1?$t.signature==="c"||$t.signature==="C"||d("Unexpected sizeof==1 member",W(H.name,wt),"with signature",$t.signature):($t.sizeof%4!==0&&(console.warn("Invalid struct member description =",$t,"from",H),d(j,"member",wt,"sizeof is not aligned. sizeof="+$t.sizeof)),$t.offset%4!==0&&(console.warn("Invalid struct member description =",$t,"from",H),d(j,"member",wt,"offset is not aligned. offset="+$t.offset))):d(j,"member",wt,"is missing sizeof."),(!re||re.offset<$t.offset)&&(re=$t)}),re?H.sizeof<re.offset+re.sizeof&&d("Invalid struct config:",j,"max member offset ("+re.offset+") ","extends past end of struct (sizeof="+H.sizeof+")."):d("No member property descriptions found.");const Ie=x(p.__makeDebugFlags(T.debugFlags)),Ge=function wt($t){this instanceof wt?arguments.length?(($t!==($t|0)||$t<=0)&&d("Invalid pointer value for",j,"constructor."),$(wt,this,$t)):$(wt,this):d("The",j,"constructor may only be called via 'new'.")};return Object.defineProperties(Ge,{debugFlags:Ie,isA:x(wt=>wt instanceof Ge),memberKey:Pe,memberKeys:at,methodInfoForKey:x(function(wt){}),structInfo:x(H),structName:x(j)}),Ge.prototype=new Oe(j,H,x),Object.defineProperties(Ge.prototype,{debugFlags:Ie,constructor:x(Ge)}),Object.keys(H.members).forEach(wt=>be(Ge,wt,H.members[wt])),Ge};return C.StructType=Oe,C.config=h,C.allocCString=ge,C.debugFlags||(C.debugFlags=p.__makeDebugFlags(p.debugFlags)),C},globalThis.sqlite3ApiBootstrap.initializers.push(function(c){const h=(...D)=>{throw new Error(D.join(" "))};c.SQLite3Error.toss;const d=c.capi,p=c.wasm,y=c.util;if(globalThis.WhWasmUtilInstaller(p),delete globalThis.WhWasmUtilInstaller,p.bindingSignatures=[["sqlite3_aggregate_context","void*","sqlite3_context*","int"],["sqlite3_bind_double","int","sqlite3_stmt*","int","f64"],["sqlite3_bind_int","int","sqlite3_stmt*","int","int"],["sqlite3_bind_null",void 0,"sqlite3_stmt*","int"],["sqlite3_bind_parameter_count","int","sqlite3_stmt*"],["sqlite3_bind_parameter_index","int","sqlite3_stmt*","string"],["sqlite3_bind_pointer","int","sqlite3_stmt*","int","*","string:static","*"],["sqlite3_busy_handler","int",["sqlite3*",new p.xWrap.FuncPtrAdapter({signature:"i(pi)",contextKey:(D,B)=>D[0]}),"*"]],["sqlite3_busy_timeout","int","sqlite3*","int"],["sqlite3_changes","int","sqlite3*"],["sqlite3_clear_bindings","int","sqlite3_stmt*"],["sqlite3_collation_needed","int","sqlite3*","*","*"],["sqlite3_column_blob","*","sqlite3_stmt*","int"],["sqlite3_column_bytes","int","sqlite3_stmt*","int"],["sqlite3_column_count","int","sqlite3_stmt*"],["sqlite3_column_double","f64","sqlite3_stmt*","int"],["sqlite3_column_int","int","sqlite3_stmt*","int"],["sqlite3_column_name","string","sqlite3_stmt*","int"],["sqlite3_column_text","string","sqlite3_stmt*","int"],["sqlite3_column_type","int","sqlite3_stmt*","int"],["sqlite3_column_value","sqlite3_value*","sqlite3_stmt*","int"],["sqlite3_commit_hook","void*",["sqlite3*",new p.xWrap.FuncPtrAdapter({name:"sqlite3_commit_hook",signature:"i(p)",contextKey:D=>D[0]}),"*"]],["sqlite3_compileoption_get","string","int"],["sqlite3_compileoption_used","int","string"],["sqlite3_complete","int","string:flexible"],["sqlite3_context_db_handle","sqlite3*","sqlite3_context*"],["sqlite3_data_count","int","sqlite3_stmt*"],["sqlite3_db_filename","string","sqlite3*","string"],["sqlite3_db_handle","sqlite3*","sqlite3_stmt*"],["sqlite3_db_name","string","sqlite3*","int"],["sqlite3_db_status","int","sqlite3*","int","*","*","int"],["sqlite3_errcode","int","sqlite3*"],["sqlite3_errmsg","string","sqlite3*"],["sqlite3_error_offset","int","sqlite3*"],["sqlite3_errstr","string","int"],["sqlite3_exec","int",["sqlite3*","string:flexible",new p.xWrap.FuncPtrAdapter({signature:"i(pipp)",bindScope:"transient",callProxy:D=>{let B;return(G,Y,ie,V)=>{try{const le=p.cArgvToJs(Y,ie);return B||(B=p.cArgvToJs(Y,V)),D(le,B)|0}catch(le){return le.resultCode||d.SQLITE_ERROR}}}}),"*","**"]],["sqlite3_expanded_sql","string","sqlite3_stmt*"],["sqlite3_extended_errcode","int","sqlite3*"],["sqlite3_extended_result_codes","int","sqlite3*","int"],["sqlite3_file_control","int","sqlite3*","string","int","*"],["sqlite3_finalize","int","sqlite3_stmt*"],["sqlite3_free",void 0,"*"],["sqlite3_get_autocommit","int","sqlite3*"],["sqlite3_get_auxdata","*","sqlite3_context*","int"],["sqlite3_initialize",void 0],["sqlite3_keyword_count","int"],["sqlite3_keyword_name","int",["int","**","*"]],["sqlite3_keyword_check","int",["string","int"]],["sqlite3_libversion","string"],["sqlite3_libversion_number","int"],["sqlite3_limit","int",["sqlite3*","int","int"]],["sqlite3_malloc","*","int"],["sqlite3_open","int","string","*"],["sqlite3_open_v2","int","string","*","int","string"],["sqlite3_progress_handler",void 0,["sqlite3*","int",new p.xWrap.FuncPtrAdapter({name:"xProgressHandler",signature:"i(p)",bindScope:"context",contextKey:(D,B)=>D[0]}),"*"]],["sqlite3_realloc","*","*","int"],["sqlite3_reset","int","sqlite3_stmt*"],["sqlite3_result_blob",void 0,"sqlite3_context*","*","int","*"],["sqlite3_result_double",void 0,"sqlite3_context*","f64"],["sqlite3_result_error",void 0,"sqlite3_context*","string","int"],["sqlite3_result_error_code",void 0,"sqlite3_context*","int"],["sqlite3_result_error_nomem",void 0,"sqlite3_context*"],["sqlite3_result_error_toobig",void 0,"sqlite3_context*"],["sqlite3_result_int",void 0,"sqlite3_context*","int"],["sqlite3_result_null",void 0,"sqlite3_context*"],["sqlite3_result_pointer",void 0,"sqlite3_context*","*","string:static","*"],["sqlite3_result_subtype",void 0,"sqlite3_value*","int"],["sqlite3_result_text",void 0,"sqlite3_context*","string","int","*"],["sqlite3_result_zeroblob",void 0,"sqlite3_context*","int"],["sqlite3_rollback_hook","void*",["sqlite3*",new p.xWrap.FuncPtrAdapter({name:"sqlite3_rollback_hook",signature:"v(p)",contextKey:D=>D[0]}),"*"]],["sqlite3_set_authorizer","int",["sqlite3*",new p.xWrap.FuncPtrAdapter({name:"sqlite3_set_authorizer::xAuth",signature:"i(pissss)",contextKey:(D,B)=>D[0],callProxy:D=>(B,G,Y,ie,V,le)=>{try{return Y=Y&&p.cstrToJs(Y),ie=ie&&p.cstrToJs(ie),V=V&&p.cstrToJs(V),le=le&&p.cstrToJs(le),D(B,G,Y,ie,V,le)||0}catch(we){return we.resultCode||d.SQLITE_ERROR}}}),"*"]],["sqlite3_set_auxdata",void 0,["sqlite3_context*","int","*",new p.xWrap.FuncPtrAdapter({name:"xDestroyAuxData",signature:"v(*)",contextKey:(D,B)=>D[0]})]],["sqlite3_shutdown",void 0],["sqlite3_sourceid","string"],["sqlite3_sql","string","sqlite3_stmt*"],["sqlite3_status","int","int","*","*","int"],["sqlite3_step","int","sqlite3_stmt*"],["sqlite3_stmt_isexplain","int",["sqlite3_stmt*"]],["sqlite3_stmt_readonly","int",["sqlite3_stmt*"]],["sqlite3_stmt_status","int","sqlite3_stmt*","int","int"],["sqlite3_strglob","int","string","string"],["sqlite3_stricmp","int","string","string"],["sqlite3_strlike","int","string","string","int"],["sqlite3_strnicmp","int","string","string","int"],["sqlite3_table_column_metadata","int","sqlite3*","string","string","string","**","**","*","*","*"],["sqlite3_total_changes","int","sqlite3*"],["sqlite3_trace_v2","int",["sqlite3*","int",new p.xWrap.FuncPtrAdapter({name:"sqlite3_trace_v2::callback",signature:"i(ippp)",contextKey:(D,B)=>D[0]}),"*"]],["sqlite3_txn_state","int",["sqlite3*","string"]],["sqlite3_uri_boolean","int","sqlite3_filename","string","int"],["sqlite3_uri_key","string","sqlite3_filename","int"],["sqlite3_uri_parameter","string","sqlite3_filename","string"],["sqlite3_user_data","void*","sqlite3_context*"],["sqlite3_value_blob","*","sqlite3_value*"],["sqlite3_value_bytes","int","sqlite3_value*"],["sqlite3_value_double","f64","sqlite3_value*"],["sqlite3_value_dup","sqlite3_value*","sqlite3_value*"],["sqlite3_value_free",void 0,"sqlite3_value*"],["sqlite3_value_frombind","int","sqlite3_value*"],["sqlite3_value_int","int","sqlite3_value*"],["sqlite3_value_nochange","int","sqlite3_value*"],["sqlite3_value_numeric_type","int","sqlite3_value*"],["sqlite3_value_pointer","*","sqlite3_value*","string:static"],["sqlite3_value_subtype","int","sqlite3_value*"],["sqlite3_value_text","string","sqlite3_value*"],["sqlite3_value_type","int","sqlite3_value*"],["sqlite3_vfs_find","*","string"],["sqlite3_vfs_register","int","sqlite3_vfs*","int"],["sqlite3_vfs_unregister","int","sqlite3_vfs*"]],p.bindingSignatures.int64=[["sqlite3_bind_int64","int",["sqlite3_stmt*","int","i64"]],["sqlite3_changes64","i64",["sqlite3*"]],["sqlite3_column_int64","i64",["sqlite3_stmt*","int"]],["sqlite3_create_module","int",["sqlite3*","string","sqlite3_module*","*"]],["sqlite3_create_module_v2","int",["sqlite3*","string","sqlite3_module*","*","*"]],["sqlite3_declare_vtab","int",["sqlite3*","string:flexible"]],["sqlite3_deserialize","int","sqlite3*","string","*","i64","i64","int"],["sqlite3_drop_modules","int",["sqlite3*","**"]],["sqlite3_last_insert_rowid","i64",["sqlite3*"]],["sqlite3_malloc64","*","i64"],["sqlite3_msize","i64","*"],["sqlite3_overload_function","int",["sqlite3*","string","int"]],["sqlite3_preupdate_blobwrite","int","sqlite3*"],["sqlite3_preupdate_count","int","sqlite3*"],["sqlite3_preupdate_depth","int","sqlite3*"],["sqlite3_preupdate_hook","*",["sqlite3*",new p.xWrap.FuncPtrAdapter({name:"sqlite3_preupdate_hook",signature:"v(ppippjj)",contextKey:D=>D[0],callProxy:D=>(B,G,Y,ie,V,le,we)=>{D(B,G,Y,p.cstrToJs(ie),p.cstrToJs(V),le,we)}}),"*"]],["sqlite3_preupdate_new","int",["sqlite3*","int","**"]],["sqlite3_preupdate_old","int",["sqlite3*","int","**"]],["sqlite3_realloc64","*","*","i64"],["sqlite3_result_int64",void 0,"*","i64"],["sqlite3_result_zeroblob64","int","*","i64"],["sqlite3_serialize","*","sqlite3*","string","*","int"],["sqlite3_set_last_insert_rowid",void 0,["sqlite3*","i64"]],["sqlite3_status64","int","int","*","*","int"],["sqlite3_total_changes64","i64",["sqlite3*"]],["sqlite3_update_hook","*",["sqlite3*",new p.xWrap.FuncPtrAdapter({name:"sqlite3_update_hook",signature:"v(iippj)",contextKey:D=>D[0],callProxy:D=>(B,G,Y,ie,V)=>{D(B,G,p.cstrToJs(Y),p.cstrToJs(ie),V)}}),"*"]],["sqlite3_uri_int64","i64",["sqlite3_filename","string","i64"]],["sqlite3_value_int64","i64","sqlite3_value*"],["sqlite3_vtab_collation","string","sqlite3_index_info*","int"],["sqlite3_vtab_distinct","int","sqlite3_index_info*"],["sqlite3_vtab_in","int","sqlite3_index_info*","int","int"],["sqlite3_vtab_in_first","int","sqlite3_value*","**"],["sqlite3_vtab_in_next","int","sqlite3_value*","**"],["sqlite3_vtab_nochange","int","sqlite3_context*"],["sqlite3_vtab_on_conflict","int","sqlite3*"],["sqlite3_vtab_rhs_value","int","sqlite3_index_info*","int","**"]],p.bigIntEnabled&&p.exports.sqlite3changegroup_add){const D={signature:"i(ps)",callProxy:B=>(G,Y)=>{try{return B(G,p.cstrToJs(Y))|0}catch(ie){return ie.resultCode||d.SQLITE_ERROR}}};p.bindingSignatures.int64.push(["sqlite3changegroup_add","int",["sqlite3_changegroup*","int","void*"]],["sqlite3changegroup_add_strm","int",["sqlite3_changegroup*",new p.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3changegroup_delete",void 0,["sqlite3_changegroup*"]],["sqlite3changegroup_new","int",["**"]],["sqlite3changegroup_output","int",["sqlite3_changegroup*","int*","**"]],["sqlite3changegroup_output_strm","int",["sqlite3_changegroup*",new p.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply","int",["sqlite3*","int","void*",new p.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...D}),new p.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply_strm","int",["sqlite3*",new p.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new p.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...D}),new p.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply_v2","int",["sqlite3*","int","void*",new p.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...D}),new p.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_apply_v2_strm","int",["sqlite3*",new p.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new p.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...D}),new p.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_concat","int",["int","void*","int","void*","int*","**"]],["sqlite3changeset_concat_strm","int",[new p.xWrap.FuncPtrAdapter({name:"xInputA",signature:"i(ppp)",bindScope:"transient"}),"void*",new p.xWrap.FuncPtrAdapter({name:"xInputB",signature:"i(ppp)",bindScope:"transient"}),"void*",new p.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_conflict","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_finalize","int",["sqlite3_changeset_iter*"]],["sqlite3changeset_fk_conflicts","int",["sqlite3_changeset_iter*","int*"]],["sqlite3changeset_invert","int",["int","void*","int*","**"]],["sqlite3changeset_invert_strm","int",[new p.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new p.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_new","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_next","int",["sqlite3_changeset_iter*"]],["sqlite3changeset_old","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_op","int",["sqlite3_changeset_iter*","**","int*","int*","int*"]],["sqlite3changeset_pk","int",["sqlite3_changeset_iter*","**","int*"]],["sqlite3changeset_start","int",["**","int","*"]],["sqlite3changeset_start_strm","int",["**",new p.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3changeset_start_v2","int",["**","int","*","int"]],["sqlite3changeset_start_v2_strm","int",["**",new p.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*","int"]],["sqlite3session_attach","int",["sqlite3_session*","string"]],["sqlite3session_changeset","int",["sqlite3_session*","int*","**"]],["sqlite3session_changeset_size","i64",["sqlite3_session*"]],["sqlite3session_changeset_strm","int",["sqlite3_session*",new p.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3session_config","int",["int","void*"]],["sqlite3session_create","int",["sqlite3*","string","**"]],["sqlite3session_diff","int",["sqlite3_session*","string","string","**"]],["sqlite3session_enable","int",["sqlite3_session*","int"]],["sqlite3session_indirect","int",["sqlite3_session*","int"]],["sqlite3session_isempty","int",["sqlite3_session*"]],["sqlite3session_memory_used","i64",["sqlite3_session*"]],["sqlite3session_object_config","int",["sqlite3_session*","int","void*"]],["sqlite3session_patchset","int",["sqlite3_session*","*","**"]],["sqlite3session_patchset_strm","int",["sqlite3_session*",new p.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3session_table_filter",void 0,["sqlite3_session*",new p.xWrap.FuncPtrAdapter({name:"xFilter",...D,contextKey:(B,G)=>B[0]}),"*"]])}p.bindingSignatures.wasmInternal=[["sqlite3__wasm_db_reset","int","sqlite3*"],["sqlite3__wasm_db_vfs","sqlite3_vfs*","sqlite3*","string"],["sqlite3__wasm_vfs_create_file","int","sqlite3_vfs*","string","*","int"],["sqlite3__wasm_posix_create_file","int","string","*","int"],["sqlite3__wasm_vfs_unlink","int","sqlite3_vfs*","string"],["sqlite3__wasm_qfmt_token","string:dealloc","string","int"]],c.StructBinder=globalThis.Jaccwabyt({heap:p.heap8u,alloc:p.alloc,dealloc:p.dealloc,bigIntEnabled:p.bigIntEnabled,memberPrefix:"$"}),delete globalThis.Jaccwabyt;{const D=p.xWrap.argAdapter("string");p.xWrap.argAdapter("string:flexible",V=>D(y.flexibleString(V))),p.xWrap.argAdapter("string:static",(function(V){return p.isPtr(V)?V:(V=""+V,this[V]||(this[V]=p.allocCString(V)))}).bind(Object.create(null)));const B=p.xWrap.argAdapter("*"),G=function(){};p.xWrap.argAdapter("sqlite3_filename",B)("sqlite3_context*",B)("sqlite3_value*",B)("void*",B)("sqlite3_changegroup*",B)("sqlite3_changeset_iter*",B)("sqlite3_session*",B)("sqlite3_stmt*",V=>{var le;return B(V instanceof(((le=c==null?void 0:c.oo1)==null?void 0:le.Stmt)||G)?V.pointer:V)})("sqlite3*",V=>{var le;return B(V instanceof(((le=c==null?void 0:c.oo1)==null?void 0:le.DB)||G)?V.pointer:V)})("sqlite3_index_info*",V=>B(V instanceof(d.sqlite3_index_info||G)?V.pointer:V))("sqlite3_module*",V=>B(V instanceof(d.sqlite3_module||G)?V.pointer:V))("sqlite3_vfs*",V=>typeof V=="string"?d.sqlite3_vfs_find(V)||c.SQLite3Error.toss(d.SQLITE_NOTFOUND,"Unknown sqlite3_vfs name:",V):B(V instanceof(d.sqlite3_vfs||G)?V.pointer:V));const Y=p.xWrap.resultAdapter("*");p.xWrap.resultAdapter("sqlite3*",Y)("sqlite3_context*",Y)("sqlite3_stmt*",Y)("sqlite3_value*",Y)("sqlite3_vfs*",Y)("void*",Y),p.exports.sqlite3_step.length===0&&(p.xWrap.doArgcCheck=!1,c.config.warn("Disabling sqlite3.wasm.xWrap.doArgcCheck due to environmental quirks."));for(const V of p.bindingSignatures)d[V[0]]=p.xWrap.apply(null,V);for(const V of p.bindingSignatures.wasmInternal)y[V[0]]=p.xWrap.apply(null,V);const ie=function(V){return()=>h(V+"() is unavailable due to lack","of BigInt support in this build.")};for(const V of p.bindingSignatures.int64)d[V[0]]=p.bigIntEnabled?p.xWrap.apply(null,V):ie(V[0]);if(delete p.bindingSignatures,p.exports.sqlite3__wasm_db_error){const V=p.xWrap("sqlite3__wasm_db_error","int","sqlite3*","int","string");y.sqlite3__wasm_db_error=function(le,we,k){return we instanceof c.WasmAllocError?(we=d.SQLITE_NOMEM,k=0):we instanceof Error&&(k=k||""+we,we=we.resultCode||d.SQLITE_ERROR),le?V(le,we,k):we}}else y.sqlite3__wasm_db_error=function(V,le,we){return console.warn("sqlite3__wasm_db_error() is not exported.",arguments),le}}{const D=p.xCall("sqlite3__wasm_enum_json");D||h("Maintenance required: increase sqlite3__wasm_enum_json()'s","static buffer size!"),p.ctype=JSON.parse(p.cstrToJs(D));const B=["access","authorizer","blobFinalizers","changeset","config","dataTypes","dbConfig","dbStatus","encodings","fcntl","flock","ioCap","limits","openFlags","prepareFlags","resultCodes","sqlite3Status","stmtStatus","syncFlags","trace","txnState","udfFlags","version"];p.bigIntEnabled&&B.push("serialize","session","vtab");for(const ie of B)for(const V of Object.entries(p.ctype[ie]))d[V[0]]=V[1];p.functionEntry(d.SQLITE_WASM_DEALLOC)||h("Internal error: cannot resolve exported function","entry SQLITE_WASM_DEALLOC (=="+d.SQLITE_WASM_DEALLOC+").");const G=Object.create(null);for(const ie of["resultCodes"])for(const V of Object.entries(p.ctype[ie]))G[V[1]]=V[0];d.sqlite3_js_rc_str=ie=>G[ie];const Y=Object.assign(Object.create(null),{WasmTestStruct:!0,sqlite3_kvvfs_methods:!y.isUIThread(),sqlite3_index_info:!p.bigIntEnabled,sqlite3_index_constraint:!p.bigIntEnabled,sqlite3_index_orderby:!p.bigIntEnabled,sqlite3_index_constraint_usage:!p.bigIntEnabled});for(const ie of p.ctype.structs)Y[ie.name]||(d[ie.name]=c.StructBinder(ie));if(d.sqlite3_index_info){for(const ie of["sqlite3_index_constraint","sqlite3_index_orderby","sqlite3_index_constraint_usage"])d.sqlite3_index_info[ie]=d[ie],delete d[ie];d.sqlite3_vtab_config=p.xWrap("sqlite3__wasm_vtab_config","int",["sqlite3*","int","int"])}}const A=(D,B,G)=>y.sqlite3__wasm_db_error(D,d.SQLITE_MISUSE,B+"() requires "+G+" argument"+(G===1?"":"s")+"."),P=D=>y.sqlite3__wasm_db_error(D,d.SQLITE_FORMAT,"SQLITE_UTF8 is the only supported encoding."),te=D=>p.xWrap.argAdapter("sqlite3*")(D),ne=D=>p.isPtr(D)?p.cstrToJs(D):D,pe=(function(D,B){D=te(D);let G=this.dbMap.get(D);if(B)!G&&B>0&&this.dbMap.set(D,G=Object.create(null));else return this.dbMap.delete(D),G;return G}).bind(Object.assign(Object.create(null),{dbMap:new Map}));pe.addCollation=function(D,B){const G=pe(D,1);G.collation||(G.collation=new Set),G.collation.add(ne(B).toLowerCase())},pe._addUDF=function(D,B,G,Y){B=ne(B).toLowerCase();let ie=Y.get(B);ie||Y.set(B,ie=new Set),ie.add(G<0?-1:G)},pe.addFunction=function(D,B,G){const Y=pe(D,1);Y.udf||(Y.udf=new Map),this._addUDF(D,B,G,Y.udf)},pe.addWindowFunc=function(D,B,G){const Y=pe(D,1);Y.wudf||(Y.wudf=new Map),this._addUDF(D,B,G,Y.wudf)},pe.cleanup=function(D){D=te(D);const B=[D];for(const ie of["sqlite3_busy_handler","sqlite3_commit_hook","sqlite3_preupdate_hook","sqlite3_progress_handler","sqlite3_rollback_hook","sqlite3_set_authorizer","sqlite3_trace_v2","sqlite3_update_hook"]){const V=p.exports[ie];B.length=V.length;try{d[ie](...B)}catch(le){console.warn("close-time call of",ie+"(",B,") threw:",le)}}const G=pe(D,0);if(!G)return;if(G.collation){for(const ie of G.collation)try{d.sqlite3_create_collation_v2(D,ie,d.SQLITE_UTF8,0,0,0)}catch{}delete G.collation}let Y;for(Y=0;Y<2;++Y){const ie=Y?G.wudf:G.udf;if(!ie)continue;const V=Y?d.sqlite3_create_window_function:d.sqlite3_create_function_v2;for(const le of ie){const we=le[0],k=le[1],F=[D,we,0,d.SQLITE_UTF8,0,0,0,0,0];Y&&F.push(0);for(const W of k)try{F[2]=W,V.apply(null,F)}catch{}k.clear()}ie.clear()}delete G.udf,delete G.wudf};{const D=p.xWrap("sqlite3_close_v2","int","sqlite3*");d.sqlite3_close_v2=function(B){if(arguments.length!==1)return A(B,"sqlite3_close_v2",1);if(B)try{pe.cleanup(B)}catch{}return D(B)}}if(d.sqlite3session_table_filter){const D=p.xWrap("sqlite3session_delete",void 0,["sqlite3_session*"]);d.sqlite3session_delete=function(B){if(arguments.length!==1)return A(pDb,"sqlite3session_delete",1);B&&d.sqlite3session_table_filter(B,0,0),D(B)}}{const D=(G,Y)=>"argv["+Y+"]:"+G[0]+":"+p.cstrToJs(G[1]).toLowerCase(),B=p.xWrap("sqlite3_create_collation_v2","int",["sqlite3*","string","int","*",new p.xWrap.FuncPtrAdapter({name:"xCompare",signature:"i(pipip)",contextKey:D}),new p.xWrap.FuncPtrAdapter({name:"xDestroy",signature:"v(p)",contextKey:D})]);d.sqlite3_create_collation_v2=function(G,Y,ie,V,le,we){if(arguments.length!==6)return A(G,"sqlite3_create_collation_v2",6);if(!(ie&15))ie|=d.SQLITE_UTF8;else if(d.SQLITE_UTF8!==(ie&15))return P(G);try{const k=B(G,Y,ie,V,le,we);return k===0&&le instanceof Function&&pe.addCollation(G,Y),k}catch(k){return y.sqlite3__wasm_db_error(G,k)}},d.sqlite3_create_collation=(G,Y,ie,V,le)=>arguments.length===5?d.sqlite3_create_collation_v2(G,Y,ie,V,le,0):A(G,"sqlite3_create_collation",5)}{const D=function(ie,V){return ie[0]+":"+(ie[2]<0?-1:ie[2])+":"+V+":"+p.cstrToJs(ie[1]).toLowerCase()},B=Object.assign(Object.create(null),{xInverseAndStep:{signature:"v(pip)",contextKey:D,callProxy:ie=>(V,le,we)=>{try{ie(V,...d.sqlite3_values_to_js(le,we))}catch(k){d.sqlite3_result_error_js(V,k)}}},xFinalAndValue:{signature:"v(p)",contextKey:D,callProxy:ie=>V=>{try{d.sqlite3_result_js(V,ie(V))}catch(le){d.sqlite3_result_error_js(V,le)}}},xFunc:{signature:"v(pip)",contextKey:D,callProxy:ie=>(V,le,we)=>{try{d.sqlite3_result_js(V,ie(V,...d.sqlite3_values_to_js(le,we)))}catch(k){d.sqlite3_result_error_js(V,k)}}},xDestroy:{signature:"v(p)",contextKey:D,callProxy:ie=>V=>{try{ie(V)}catch(le){console.error("UDF xDestroy method threw:",le)}}}}),G=p.xWrap("sqlite3_create_function_v2","int",["sqlite3*","string","int","int","*",new p.xWrap.FuncPtrAdapter({name:"xFunc",...B.xFunc}),new p.xWrap.FuncPtrAdapter({name:"xStep",...B.xInverseAndStep}),new p.xWrap.FuncPtrAdapter({name:"xFinal",...B.xFinalAndValue}),new p.xWrap.FuncPtrAdapter({name:"xDestroy",...B.xDestroy})]),Y=p.xWrap("sqlite3_create_window_function","int",["sqlite3*","string","int","int","*",new p.xWrap.FuncPtrAdapter({name:"xStep",...B.xInverseAndStep}),new p.xWrap.FuncPtrAdapter({name:"xFinal",...B.xFinalAndValue}),new p.xWrap.FuncPtrAdapter({name:"xValue",...B.xFinalAndValue}),new p.xWrap.FuncPtrAdapter({name:"xInverse",...B.xInverseAndStep}),new p.xWrap.FuncPtrAdapter({name:"xDestroy",...B.xDestroy})]);d.sqlite3_create_function_v2=function ie(V,le,we,k,F,W,_e,q,R){if(ie.length!==arguments.length)return A(V,"sqlite3_create_function_v2",ie.length);if(!(k&15))k|=d.SQLITE_UTF8;else if(d.SQLITE_UTF8!==(k&15))return P(V);try{const b=G(V,le,we,k,F,W,_e,q,R);return b===0&&(W instanceof Function||_e instanceof Function||q instanceof Function||R instanceof Function)&&pe.addFunction(V,le,we),b}catch(b){return console.error("sqlite3_create_function_v2() setup threw:",b),y.sqlite3__wasm_db_error(V,b,"Creation of UDF threw: "+b)}},d.sqlite3_create_function=function ie(V,le,we,k,F,W,_e,q){return ie.length===arguments.length?d.sqlite3_create_function_v2(V,le,we,k,F,W,_e,q,0):A(V,"sqlite3_create_function",ie.length)},d.sqlite3_create_window_function=function ie(V,le,we,k,F,W,_e,q,R,b){if(ie.length!==arguments.length)return A(V,"sqlite3_create_window_function",ie.length);if(!(k&15))k|=d.SQLITE_UTF8;else if(d.SQLITE_UTF8!==(k&15))return P(V);try{const x=Y(V,le,we,k,F,W,_e,q,R,b);return x===0&&(W instanceof Function||_e instanceof Function||q instanceof Function||R instanceof Function||b instanceof Function)&&pe.addWindowFunc(V,le,we),x}catch(x){return console.error("sqlite3_create_window_function() setup threw:",x),y.sqlite3__wasm_db_error(V,x,"Creation of UDF threw: "+x)}},d.sqlite3_create_function_v2.udfSetResult=d.sqlite3_create_function.udfSetResult=d.sqlite3_create_window_function.udfSetResult=d.sqlite3_result_js,d.sqlite3_create_function_v2.udfConvertArgs=d.sqlite3_create_function.udfConvertArgs=d.sqlite3_create_window_function.udfConvertArgs=d.sqlite3_values_to_js,d.sqlite3_create_function_v2.udfSetError=d.sqlite3_create_function.udfSetError=d.sqlite3_create_window_function.udfSetError=d.sqlite3_result_error_js}{const D=(G,Y)=>(typeof G=="string"?Y=-1:y.isSQLableTypedArray(G)?(Y=G.byteLength,G=y.typedArrayToString(G instanceof ArrayBuffer?new Uint8Array(G):G)):Array.isArray(G)&&(G=G.join(""),Y=-1),[G,Y]),B={basic:p.xWrap("sqlite3_prepare_v3","int",["sqlite3*","string","int","int","**","**"]),full:p.xWrap("sqlite3_prepare_v3","int",["sqlite3*","*","int","int","**","**"])};d.sqlite3_prepare_v3=function G(Y,ie,V,le,we,k){if(G.length!==arguments.length)return A(Y,"sqlite3_prepare_v3",G.length);const[F,W]=D(ie,V);switch(typeof F){case"string":return B.basic(Y,F,W,le,we,null);case"number":return B.full(Y,F,W,le,we,k);default:return y.sqlite3__wasm_db_error(Y,d.SQLITE_MISUSE,"Invalid SQL argument type for sqlite3_prepare_v2/v3().")}},d.sqlite3_prepare_v2=function G(Y,ie,V,le,we){return G.length===arguments.length?d.sqlite3_prepare_v3(Y,ie,V,0,le,we):A(Y,"sqlite3_prepare_v2",G.length)}}{const D=p.xWrap("sqlite3_bind_text","int",["sqlite3_stmt*","int","string","int","*"]),B=p.xWrap("sqlite3_bind_blob","int",["sqlite3_stmt*","int","*","int","*"]);d.sqlite3_bind_text=function G(Y,ie,V,le,we){if(G.length!==arguments.length)return A(d.sqlite3_db_handle(Y),"sqlite3_bind_text",G.length);if(p.isPtr(V)||V===null)return D(Y,ie,V,le,we);V instanceof ArrayBuffer?V=new Uint8Array(V):Array.isArray(pMem)&&(V=pMem.join(""));let k,F;try{if(y.isSQLableTypedArray(V))k=p.allocFromTypedArray(V),F=V.byteLength;else if(typeof V=="string")[k,F]=p.allocCString(V);else return y.sqlite3__wasm_db_error(d.sqlite3_db_handle(Y),d.SQLITE_MISUSE,"Invalid 3rd argument type for sqlite3_bind_text().");return D(Y,ie,k,F,d.SQLITE_WASM_DEALLOC)}catch(W){return p.dealloc(k),y.sqlite3__wasm_db_error(d.sqlite3_db_handle(Y),W)}},d.sqlite3_bind_blob=function G(Y,ie,V,le,we){if(G.length!==arguments.length)return A(d.sqlite3_db_handle(Y),"sqlite3_bind_blob",G.length);if(p.isPtr(V)||V===null)return B(Y,ie,V,le,we);V instanceof ArrayBuffer?V=new Uint8Array(V):Array.isArray(V)&&(V=V.join(""));let k,F;try{if(y.isBindableTypedArray(V))k=p.allocFromTypedArray(V),F=le>=0?le:V.byteLength;else if(typeof V=="string")[k,F]=p.allocCString(V);else return y.sqlite3__wasm_db_error(d.sqlite3_db_handle(Y),d.SQLITE_MISUSE,"Invalid 3rd argument type for sqlite3_bind_blob().");return B(Y,ie,k,F,d.SQLITE_WASM_DEALLOC)}catch(W){return p.dealloc(k),y.sqlite3__wasm_db_error(d.sqlite3_db_handle(Y),W)}}}d.sqlite3_config=function(D,...B){if(arguments.length<2)return d.SQLITE_MISUSE;switch(D){case d.SQLITE_CONFIG_COVERING_INDEX_SCAN:case d.SQLITE_CONFIG_MEMSTATUS:case d.SQLITE_CONFIG_SMALL_MALLOC:case d.SQLITE_CONFIG_SORTERREF_SIZE:case d.SQLITE_CONFIG_STMTJRNL_SPILL:case d.SQLITE_CONFIG_URI:return p.exports.sqlite3__wasm_config_i(D,B[0]);case d.SQLITE_CONFIG_LOOKASIDE:return p.exports.sqlite3__wasm_config_ii(D,B[0],B[1]);case d.SQLITE_CONFIG_MEMDB_MAXSIZE:return p.exports.sqlite3__wasm_config_j(D,B[0]);case d.SQLITE_CONFIG_GETMALLOC:case d.SQLITE_CONFIG_GETMUTEX:case d.SQLITE_CONFIG_GETPCACHE2:case d.SQLITE_CONFIG_GETPCACHE:case d.SQLITE_CONFIG_HEAP:case d.SQLITE_CONFIG_LOG:case d.SQLITE_CONFIG_MALLOC:case d.SQLITE_CONFIG_MMAP_SIZE:case d.SQLITE_CONFIG_MULTITHREAD:case d.SQLITE_CONFIG_MUTEX:case d.SQLITE_CONFIG_PAGECACHE:case d.SQLITE_CONFIG_PCACHE2:case d.SQLITE_CONFIG_PCACHE:case d.SQLITE_CONFIG_PCACHE_HDRSZ:case d.SQLITE_CONFIG_PMASZ:case d.SQLITE_CONFIG_SERIALIZED:case d.SQLITE_CONFIG_SINGLETHREAD:case d.SQLITE_CONFIG_SQLLOG:case d.SQLITE_CONFIG_WIN32_HEAPSIZE:default:return d.SQLITE_NOTFOUND}};{const D=new Set;d.sqlite3_auto_extension=function(B){if(B instanceof Function)B=p.installFunction("i(ppp)",B);else if(arguments.length!==1||!p.isPtr(B))return d.SQLITE_MISUSE;const G=p.exports.sqlite3_auto_extension(B);return B!==arguments[0]&&(G===0?D.add(B):p.uninstallFunction(B)),G},d.sqlite3_cancel_auto_extension=function(B){return!B||arguments.length!==1||!p.isPtr(B)?0:p.exports.sqlite3_cancel_auto_extension(B)},d.sqlite3_reset_auto_extension=function(){p.exports.sqlite3_reset_auto_extension();for(const B of D)p.uninstallFunction(B);D.clear()}}const xe=d.sqlite3_vfs_find("kvvfs");if(xe)if(y.isUIThread()){const D=new d.sqlite3_kvvfs_methods(p.exports.sqlite3__wasm_kvvfs_methods());delete d.sqlite3_kvvfs_methods;const B=p.exports.sqlite3__wasm_kvvfsMakeKeyOnPstack,G=p.pstack,Y=V=>p.peek(V)===115?sessionStorage:localStorage,ie={xRead:(V,le,we,k)=>{const F=G.pointer,W=p.scopedAllocPush();try{const _e=B(V,le);if(!_e)return-3;const q=p.cstrToJs(_e),R=Y(V).getItem(q);if(!R)return-1;const b=R.length;if(k<=0)return b;if(k===1)return p.poke(we,0),b;const x=p.scopedAllocCString(R);return k>b+1&&(k=b+1),p.heap8u().copyWithin(we,x,x+k-1),p.poke(we+k-1,0),k-1}catch(_e){return console.error("kvstorageRead()",_e),-2}finally{G.restore(F),p.scopedAllocPop(W)}},xWrite:(V,le,we)=>{const k=G.pointer;try{const F=B(V,le);if(!F)return 1;const W=p.cstrToJs(F);return Y(V).setItem(W,p.cstrToJs(we)),0}catch(F){return console.error("kvstorageWrite()",F),d.SQLITE_IOERR}finally{G.restore(k)}},xDelete:(V,le)=>{const we=G.pointer;try{const k=B(V,le);return k?(Y(V).removeItem(p.cstrToJs(k)),0):1}catch(k){return console.error("kvstorageDelete()",k),d.SQLITE_IOERR}finally{G.restore(we)}}};for(const V of Object.keys(ie))D[D.memberKey(V)]=p.installFunction(D.memberSignature(V),ie[V])}else d.sqlite3_vfs_unregister(xe);p.xWrap.FuncPtrAdapter.warnOnUse=!0;const Q=c.StructBinder,K=function D(B,G,Y,ie=D.installMethodArgcCheck){if(B instanceof Q.StructType?!(Y instanceof Function)&&!p.isPtr(Y)&&h("Usage errror: expecting a Function or WASM pointer to one."):h("Usage error: target object is-not-a StructType."),arguments.length===1)return(k,F)=>D(B,k,F,ie);D.argcProxy||(D.argcProxy=function(k,F,W,_e){return function(...q){return W.length!==arguments.length&&h("Argument mismatch for",k.structInfo.name+"::"+F+": Native signature is:",_e),W.apply(this,q)}},D.removeFuncList=function(){this.ondispose.__removeFuncList&&(this.ondispose.__removeFuncList.forEach((k,F)=>{if(typeof k=="number")try{p.uninstallFunction(k)}catch{}}),delete this.ondispose.__removeFuncList)});const V=B.memberSignature(G);V.length<2&&h("Member",G,"does not have a function pointer signature:",V);const le=B.memberKey(G),we=ie&&!p.isPtr(Y)?D.argcProxy(B,le,Y,V):Y;if(p.isPtr(we))we&&!p.functionEntry(we)&&h("Pointer",we,"is not a WASM function table entry."),B[le]=we;else{const k=p.installFunction(we,B.memberSignature(G,!0));B[le]=k,(!B.ondispose||!B.ondispose.__removeFuncList)&&(B.addOnDispose("ondispose.__removeFuncList handler",D.removeFuncList),B.ondispose.__removeFuncList=[]),B.ondispose.__removeFuncList.push(le,k)}return(k,F)=>D(B,k,F,ie)};K.installMethodArgcCheck=!1;const oe=function(D,B,G=K.installMethodArgcCheck){const Y=new Map;for(const ie of Object.keys(B)){const V=B[ie],le=Y.get(V);if(le){const we=D.memberKey(ie);D[we]=D[D.memberKey(le)]}else K(D,ie,V,G),Y.set(V,ie)}return D};Q.StructType.prototype.installMethod=function(B,G,Y=K.installMethodArgcCheck){return arguments.length<3&&B&&typeof B=="object"?oe(this,...arguments):K(this,...arguments)},Q.StructType.prototype.installMethods=function(D,B=K.installMethodArgcCheck){return oe(this,D,B)}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(c){c.version={libVersion:"3.46.1",libVersionNumber:3046001,sourceId:"2024-08-13 09:16:08 c9c2ab54ba1f5f46360f1b4f35d849cd3f080e6fc2b6c60e91b16c63f69a1e33",downloadVersion:3460100}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(c){const h=(...q)=>{throw new c.SQLite3Error(...q)},d=c.capi,p=c.wasm,y=c.util,A=new WeakMap,P=new WeakMap,te=(q,R,b)=>{const x=Object.getOwnPropertyDescriptor(q,R);return x?x.value:b},ne=function(q,R){return R&&(q instanceof K&&(q=q.pointer),h(R,"sqlite3 result code",R+":",q?d.sqlite3_errmsg(q):d.sqlite3_errstr(R))),arguments[0]},pe=p.installFunction("i(ippp)",(function(q,R,b,x){d.SQLITE_TRACE_STMT===q&&console.log("SQL TRACE #"+ ++this.counter+" via sqlite3@"+R+":",p.cstrToJs(x))}).bind({counter:0})),xe=Object.create(null),Q=function q(...R){if(!q._name2vfs){q._name2vfs=Object.create(null);const at=typeof importScripts=="function"?Et=>h("The VFS for",Et,"is only available in the main window thread."):!1;q._name2vfs[":localStorage:"]={vfs:"kvvfs",filename:at||(()=>"local")},q._name2vfs[":sessionStorage:"]={vfs:"kvvfs",filename:at||(()=>"session")}}const b=q.normalizeArgs(...R);let x=b.filename,$=b.vfs,L=b.flags;(typeof x!="string"&&typeof x!="number"||typeof L!="string"||$&&typeof $!="string"&&typeof $!="number")&&(c.config.error("Invalid DB ctor args",b,arguments),h("Invalid arguments for DB constructor."));let me=typeof x=="number"?p.cstrToJs(x):x;const Pe=q._name2vfs[me];Pe&&($=Pe.vfs,x=me=Pe.filename(me));let nt,mt=0;L.indexOf("c")>=0&&(mt|=d.SQLITE_OPEN_CREATE|d.SQLITE_OPEN_READWRITE),L.indexOf("w")>=0&&(mt|=d.SQLITE_OPEN_READWRITE),mt===0&&(mt|=d.SQLITE_OPEN_READONLY),mt|=d.SQLITE_OPEN_EXRESCODE;const st=p.pstack.pointer;try{const at=p.pstack.allocPtr();let Et=d.sqlite3_open_v2(x,at,mt,$||0);nt=p.peekPtr(at),ne(nt,Et),d.sqlite3_extended_result_codes(nt,1),L.indexOf("t")>=0&&d.sqlite3_trace_v2(nt,d.SQLITE_TRACE_STMT,pe,nt)}catch(at){throw nt&&d.sqlite3_close_v2(nt),at}finally{p.pstack.restore(st)}this.filename=me,A.set(this,nt),P.set(this,Object.create(null));try{const at=d.sqlite3_js_db_vfs(nt)||h("Internal error: cannot get VFS for new db handle."),Et=xe[at];Et&&(Et instanceof Function?Et(this,c):ne(nt,d.sqlite3_exec(nt,Et,0,0,0)))}catch(at){throw this.close(),at}};Q.setVfsPostOpenSql=function(q,R){xe[q]=R},Q.normalizeArgs=function(q=":memory:",R="c",b=null){const x={};return arguments.length===1&&arguments[0]&&typeof arguments[0]=="object"?(Object.assign(x,arguments[0]),x.flags===void 0&&(x.flags="c"),x.vfs===void 0&&(x.vfs=null),x.filename===void 0&&(x.filename=":memory:")):(x.filename=q,x.flags=R,x.vfs=b),x};const K=function(...q){Q.apply(this,q)};K.dbCtorHelper=Q;const oe={null:1,number:2,string:3,boolean:4,blob:5};oe.undefined==oe.null,p.bigIntEnabled&&(oe.bigint=oe.number);const D=function(){oe!==arguments[2]&&h(d.SQLITE_MISUSE,"Do not call the Stmt constructor directly. Use DB.prepare()."),this.db=arguments[0],A.set(this,arguments[1]),this.parameterCount=d.sqlite3_bind_parameter_count(this.pointer)},B=function(q){return q.pointer||h("DB has been closed."),q},G=function(q,R){return(R!==(R|0)||R<0||R>=q.columnCount)&&h("Column index",R,"is out of range."),q},Y=function(q,R){const b=Object.create(null);switch(b.opt=Object.create(null),R.length){case 1:typeof R[0]=="string"||y.isSQLableTypedArray(R[0])||Array.isArray(R[0])?b.sql=R[0]:R[0]&&typeof R[0]=="object"&&(b.opt=R[0],b.sql=b.opt.sql);break;case 2:b.sql=R[0],b.opt=R[1];break;default:h("Invalid argument count for exec().")}b.sql=y.flexibleString(b.sql),typeof b.sql!="string"&&h("Missing SQL argument or unsupported SQL value type.");const x=b.opt;switch(x.returnValue){case"resultRows":x.resultRows||(x.resultRows=[]),b.returnVal=()=>x.resultRows;break;case"saveSql":x.saveSql||(x.saveSql=[]),b.returnVal=()=>x.saveSql;break;case void 0:case"this":b.returnVal=()=>q;break;default:h("Invalid returnValue value:",x.returnValue)}if(!x.callback&&!x.returnValue&&x.rowMode!==void 0&&(x.resultRows||(x.resultRows=[]),b.returnVal=()=>x.resultRows),x.callback||x.resultRows)switch(x.rowMode===void 0?"array":x.rowMode){case"object":b.cbArg=($,L)=>{L.columnNames||(L.columnNames=$.getColumnNames([]));const me=$.get([]),Pe=Object.create(null);for(const nt in L.columnNames)Pe[L.columnNames[nt]]=me[nt];return Pe};break;case"array":b.cbArg=$=>$.get([]);break;case"stmt":Array.isArray(x.resultRows)&&h("exec(): invalid rowMode for a resultRows array: must","be one of 'array', 'object',","a result column number, or column name reference."),b.cbArg=$=>$;break;default:if(y.isInt32(x.rowMode)){b.cbArg=$=>$.get(x.rowMode);break}else if(typeof x.rowMode=="string"&&x.rowMode.length>1&&x.rowMode[0]==="$"){const $=x.rowMode.substr(1);b.cbArg=L=>{const me=L.get(Object.create(null))[$];return me===void 0?h(d.SQLITE_NOTFOUND,"exec(): unknown result column:",$):me};break}h("Invalid rowMode:",x.rowMode)}return b},ie=(q,R,b,...x)=>{const $=q.prepare(R);try{const L=$.bind(b).step()?$.get(...x):void 0;return $.reset(),L}finally{$.finalize()}},V=(q,R,b,x)=>q.exec({sql:R,bind:b,rowMode:x,returnValue:"resultRows"});K.checkRc=(q,R)=>ne(q,R),K.prototype={isOpen:function(){return!!this.pointer},affirmOpen:function(){return B(this)},close:function(){if(this.pointer){if(this.onclose&&this.onclose.before instanceof Function)try{this.onclose.before(this)}catch{}const q=this.pointer;if(Object.keys(P.get(this)).forEach((R,b)=>{if(b&&b.pointer)try{b.finalize()}catch{}}),A.delete(this),P.delete(this),d.sqlite3_close_v2(q),this.onclose&&this.onclose.after instanceof Function)try{this.onclose.after(this)}catch{}delete this.filename}},changes:function(q=!1,R=!1){const b=B(this).pointer;return q?R?d.sqlite3_total_changes64(b):d.sqlite3_total_changes(b):R?d.sqlite3_changes64(b):d.sqlite3_changes(b)},dbFilename:function(q="main"){return d.sqlite3_db_filename(B(this).pointer,q)},dbName:function(q=0){return d.sqlite3_db_name(B(this).pointer,q)},dbVfsName:function(q=0){let R;const b=d.sqlite3_js_db_vfs(B(this).pointer,q);if(b){const x=new d.sqlite3_vfs(b);try{R=p.cstrToJs(x.$zName)}finally{x.dispose()}}return R},prepare:function(q){B(this);const R=p.pstack.pointer;let b,x;try{b=p.pstack.alloc(8),K.checkRc(this,d.sqlite3_prepare_v2(this.pointer,q,-1,b,null)),x=p.peekPtr(b)}finally{p.pstack.restore(R)}x||h("Cannot prepare empty SQL.");const $=new D(this,x,oe);return P.get(this)[x]=$,$},exec:function(){B(this);const q=Y(this,arguments);if(!q.sql)return h("exec() requires an SQL string.");const R=q.opt,b=R.callback,x=Array.isArray(R.resultRows)?R.resultRows:void 0;let $,L=R.bind,me=!!(q.cbArg||R.columnNames||x);const Pe=p.scopedAllocPush(),nt=Array.isArray(R.saveSql)?R.saveSql:void 0;try{const mt=y.isSQLableTypedArray(q.sql);let st=mt?q.sql.byteLength:p.jstrlen(q.sql);const at=p.scopedAlloc(2*p.ptrSizeof+(st+1)),Et=at+p.ptrSizeof;let Ct=Et+p.ptrSizeof;const Gt=Ct+st;for(mt?p.heap8().set(q.sql,Ct):p.jstrcpy(q.sql,p.heap8(),Ct,st,!1),p.poke(Ct+st,0);Ct&&p.peek(Ct,"i8");){p.pokePtr([at,Et],0),K.checkRc(this,d.sqlite3_prepare_v3(this.pointer,Ct,st,0,at,Et));const Yt=p.peekPtr(at);if(Ct=p.peekPtr(Et),st=Gt-Ct,!!Yt){if(nt&&nt.push(d.sqlite3_sql(Yt).trim()),$=new D(this,Yt,oe),L&&$.parameterCount&&($.bind(L),L=null),me&&$.columnCount){let wr=Array.isArray(R.columnNames)?0:1;if(me=!1,q.cbArg||x){const mn=Object.create(null);for(;$.step();$._lockedByExec=!1){wr++===0&&$.getColumnNames(mn.columnNames=R.columnNames||[]),$._lockedByExec=!0;const X=q.cbArg($,mn);if(x&&x.push(X),b&&b.call(R,X,$)===!1)break}$._lockedByExec=!1}wr===0&&$.getColumnNames(R.columnNames)}else $.step();$.reset().finalize(),$=null}}}finally{p.scopedAllocPop(Pe),$&&(delete $._lockedByExec,$.finalize())}return q.returnVal()},createFunction:function(R,b,x){const $=mn=>mn instanceof Function;switch(arguments.length){case 1:x=R,R=x.name,b=x.xFunc||0;break;case 2:$(b)||(x=b,b=x.xFunc||0);break}x||(x={}),typeof R!="string"&&h("Invalid arguments: missing function name.");let L=x.xStep||0,me=x.xFinal||0;const Pe=x.xValue||0,nt=x.xInverse||0;let mt;$(b)?(mt=!1,($(L)||$(me))&&h("Ambiguous arguments: scalar or aggregate?"),L=me=null):$(L)?($(me)||h("Missing xFinal() callback for aggregate or window UDF."),b=null):$(me)?h("Missing xStep() callback for aggregate or window UDF."):h("Missing function-type properties."),mt===!1?($(Pe)||$(nt))&&h("xValue and xInverse are not permitted for non-window UDFs."):$(Pe)?($(nt)||h("xInverse must be provided if xValue is."),mt=!0):$(nt)&&h("xValue must be provided if xInverse is.");const st=x.pApp;st!=null&&(typeof st!="number"||!y.isInt32(st))&&h("Invalid value for pApp property. Must be a legal WASM pointer value.");const at=x.xDestroy||0;at&&!$(at)&&h("xDestroy property must be a function.");let Et=0;te(x,"deterministic")&&(Et|=d.SQLITE_DETERMINISTIC),te(x,"directOnly")&&(Et|=d.SQLITE_DIRECTONLY),te(x,"innocuous")&&(Et|=d.SQLITE_INNOCUOUS),R=R.toLowerCase();const Ct=b||L,Gt=te(x,"arity"),Yt=typeof Gt=="number"?Gt:Ct.length?Ct.length-1:0;let wr;return mt?wr=d.sqlite3_create_window_function(this.pointer,R,Yt,d.SQLITE_UTF8|Et,st||0,L,me,Pe,nt,at):wr=d.sqlite3_create_function_v2(this.pointer,R,Yt,d.SQLITE_UTF8|Et,st||0,b,L,me,at),K.checkRc(this,wr),this},selectValue:function(q,R,b){return ie(this,q,R,0,b)},selectValues:function(q,R,b){const x=this.prepare(q),$=[];try{for(x.bind(R);x.step();)$.push(x.get(0,b));x.reset()}finally{x.finalize()}return $},selectArray:function(q,R){return ie(this,q,R,[])},selectObject:function(q,R){return ie(this,q,R,{})},selectArrays:function(q,R){return V(this,q,R,"array")},selectObjects:function(q,R){return V(this,q,R,"object")},openStatementCount:function(){return this.pointer?Object.keys(P.get(this)).length:0},transaction:function(q){let R="BEGIN";arguments.length>1&&(/[^a-zA-Z]/.test(arguments[0])&&h(d.SQLITE_MISUSE,"Invalid argument for BEGIN qualifier."),R+=" "+arguments[0],q=arguments[1]),B(this).exec(R);try{const b=q(this);return this.exec("COMMIT"),b}catch(b){throw this.exec("ROLLBACK"),b}},savepoint:function(q){B(this).exec("SAVEPOINT oo1");try{const R=q(this);return this.exec("RELEASE oo1"),R}catch(R){throw this.exec("ROLLBACK to SAVEPOINT oo1; RELEASE SAVEPOINT oo1"),R}},checkRc:function(q){return ne(this,q)}};const le=function(q){return q.pointer||h("Stmt has been closed."),q},we=function(q){let R=oe[q==null?"null":typeof q];switch(R){case oe.boolean:case oe.null:case oe.number:case oe.string:return R;case oe.bigint:if(p.bigIntEnabled)return R;default:return y.isBindableTypedArray(q)?oe.blob:void 0}},k=function(q){return we(q)||h("Unsupported bind() argument type:",typeof q)},F=function(q,R){const b=typeof R=="number"?R:d.sqlite3_bind_parameter_index(q.pointer,R);return b===0||!y.isInt32(b)?h("Invalid bind() parameter name: "+R):(b<1||b>q.parameterCount)&&h("Bind index",R,"is out of range."),b},W=function(q,R){return q._lockedByExec&&h("Operation is illegal when statement is locked:",R),q},_e=function q(R,b,x,$){W(le(R),"bind()"),q._||(q._tooBigInt=me=>h("BigInt value is too big to store without precision loss:",me),q._={string:function(me,Pe,nt,mt){const[st,at]=p.allocCString(nt,!0);return(mt?d.sqlite3_bind_blob:d.sqlite3_bind_text)(me.pointer,Pe,st,at,d.SQLITE_WASM_DEALLOC)}}),k($),b=F(R,b);let L=0;switch($==null?oe.null:x){case oe.null:L=d.sqlite3_bind_null(R.pointer,b);break;case oe.string:L=q._.string(R,b,$,!1);break;case oe.number:{let me;y.isInt32($)?me=d.sqlite3_bind_int:typeof $=="bigint"?y.bigIntFits64($)?p.bigIntEnabled?me=d.sqlite3_bind_int64:y.bigIntFitsDouble($)?($=Number($),me=d.sqlite3_bind_double):q._tooBigInt($):q._tooBigInt($):($=Number($),p.bigIntEnabled&&Number.isInteger($)?me=d.sqlite3_bind_int64:me=d.sqlite3_bind_double),L=me(R.pointer,b,$);break}case oe.boolean:L=d.sqlite3_bind_int(R.pointer,b,$?1:0);break;case oe.blob:{if(typeof $=="string"){L=q._.string(R,b,$,!0);break}else $ instanceof ArrayBuffer?$=new Uint8Array($):y.isBindableTypedArray($)||h("Binding a value as a blob requires","that it be a string, Uint8Array, Int8Array, or ArrayBuffer.");const me=p.alloc($.byteLength||1);p.heap8().set($.byteLength?$:[0],me),L=d.sqlite3_bind_blob(R.pointer,b,me,$.byteLength,d.SQLITE_WASM_DEALLOC);break}default:c.config.warn("Unsupported bind() argument type:",$),h("Unsupported bind() argument type: "+typeof $)}return L&&K.checkRc(R.db.pointer,L),R._mayGet=!1,R};D.prototype={finalize:function(){if(this.pointer){W(this,"finalize()");const q=d.sqlite3_finalize(this.pointer);return delete P.get(this.db)[this.pointer],A.delete(this),delete this._mayGet,delete this.parameterCount,delete this._lockedByExec,delete this.db,q}},clearBindings:function(){return W(le(this),"clearBindings()"),d.sqlite3_clear_bindings(this.pointer),this._mayGet=!1,this},reset:function(q){W(this,"reset()"),q&&this.clearBindings();const R=d.sqlite3_reset(le(this).pointer);return this._mayGet=!1,ne(this.db,R),this},bind:function(){le(this);let q,R;switch(arguments.length){case 1:q=1,R=arguments[0];break;case 2:q=arguments[0],R=arguments[1];break;default:h("Invalid bind() arguments.")}return R===void 0?this:(this.parameterCount||h("This statement has no bindable parameters."),this._mayGet=!1,R===null?_e(this,q,oe.null,R):Array.isArray(R)?(arguments.length!==1&&h("When binding an array, an index argument is not permitted."),R.forEach((b,x)=>_e(this,x+1,k(b),b)),this):(R instanceof ArrayBuffer&&(R=new Uint8Array(R)),typeof R=="object"&&!y.isBindableTypedArray(R)?(arguments.length!==1&&h("When binding an object, an index argument is not permitted."),Object.keys(R).forEach(b=>_e(this,b,k(R[b]),R[b])),this):_e(this,q,k(R),R)))},bindAsBlob:function(q,R){le(this),arguments.length===1&&(R=q,q=1);const b=k(R);return oe.string!==b&&oe.blob!==b&&oe.null!==b&&h("Invalid value type for bindAsBlob()"),_e(this,q,oe.blob,R)},step:function(){W(this,"step()");const q=d.sqlite3_step(le(this).pointer);switch(q){case d.SQLITE_DONE:return this._mayGet=!1;case d.SQLITE_ROW:return this._mayGet=!0;default:this._mayGet=!1,c.config.warn("sqlite3_step() rc=",q,d.sqlite3_js_rc_str(q),"SQL =",d.sqlite3_sql(this.pointer)),K.checkRc(this.db.pointer,q)}},stepReset:function(){return this.step(),this.reset()},stepFinalize:function(){try{const q=this.step();return this.reset(),q}finally{try{this.finalize()}catch{}}},get:function(q,R){if(le(this)._mayGet||h("Stmt.step() has not (recently) returned true."),Array.isArray(q)){let b=0;const x=this.columnCount;for(;b<x;)q[b]=this.get(b++);return q}else if(q&&typeof q=="object"){let b=0;const x=this.columnCount;for(;b<x;)q[d.sqlite3_column_name(this.pointer,b)]=this.get(b++);return q}switch(G(this,q),R===void 0?d.sqlite3_column_type(this.pointer,q):R){case d.SQLITE_NULL:return null;case d.SQLITE_INTEGER:if(p.bigIntEnabled){const b=d.sqlite3_column_int64(this.pointer,q);return b>=Number.MIN_SAFE_INTEGER&&b<=Number.MAX_SAFE_INTEGER?Number(b).valueOf():b}else{const b=d.sqlite3_column_double(this.pointer,q);return(b>Number.MAX_SAFE_INTEGER||b<Number.MIN_SAFE_INTEGER)&&h("Integer is out of range for JS integer range: "+b),y.isInt32(b)?b|0:b}case d.SQLITE_FLOAT:return d.sqlite3_column_double(this.pointer,q);case d.SQLITE_TEXT:return d.sqlite3_column_text(this.pointer,q);case d.SQLITE_BLOB:{const b=d.sqlite3_column_bytes(this.pointer,q),x=d.sqlite3_column_blob(this.pointer,q),$=new Uint8Array(b);return b&&$.set(p.heap8u().slice(x,x+b),0),b&&this.db._blobXfer instanceof Array&&this.db._blobXfer.push($.buffer),$}default:h("Don't know how to translate","type of result column #"+q+".")}h("Not reached.")},getInt:function(q){return this.get(q,d.SQLITE_INTEGER)},getFloat:function(q){return this.get(q,d.SQLITE_FLOAT)},getString:function(q){return this.get(q,d.SQLITE_TEXT)},getBlob:function(q){return this.get(q,d.SQLITE_BLOB)},getJSON:function(q){const R=this.get(q,d.SQLITE_STRING);return R===null?R:JSON.parse(R)},getColumnName:function(q){return d.sqlite3_column_name(G(le(this),q).pointer,q)},getColumnNames:function(q=[]){G(le(this),0);const R=this.columnCount;for(let b=0;b<R;++b)q.push(d.sqlite3_column_name(this.pointer,b));return q},getParamIndex:function(q){return le(this).parameterCount?d.sqlite3_bind_parameter_index(this.pointer,q):void 0}};{const q={enumerable:!0,get:function(){return A.get(this)},set:()=>h("The pointer property is read-only.")};Object.defineProperty(D.prototype,"pointer",q),Object.defineProperty(K.prototype,"pointer",q)}if(Object.defineProperty(D.prototype,"columnCount",{enumerable:!1,get:function(){return d.sqlite3_column_count(this.pointer)},set:()=>h("The columnCount property is read-only.")}),c.oo1={DB:K,Stmt:D},y.isUIThread()){c.oo1.JsStorageDb=function(R="session"){const b=Q.normalizeArgs(...arguments);R=b.filename,R!=="session"&&R!=="local"&&h("JsStorageDb db name must be one of 'session' or 'local'."),b.vfs="kvvfs",Q.call(this,b)};const q=c.oo1.JsStorageDb;q.prototype=Object.create(K.prototype),q.clearStorage=d.sqlite3_js_kvvfs_clear,q.prototype.clearStorage=function(){return q.clearStorage(B(this).filename)},q.storageSize=d.sqlite3_js_kvvfs_size,q.prototype.storageSize=function(){return q.storageSize(B(this).filename)}}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(c){const h=c.util;c.initWorker1API=(function(){const d=(...Q)=>{throw new Error(Q.join(" "))};globalThis.WorkerGlobalScope instanceof Function||d("initWorker1API() must be run from a Worker thread.");const p=this.sqlite3||d("Missing this.sqlite3 object."),y=p.oo1.DB,A=function(Q){let K=P.idMap.get(Q);return K||(K="db#"+ ++P.idSeq+"@"+Q.pointer,P.idMap.set(Q,K),K)},P={dbList:[],idSeq:0,idMap:new WeakMap,xfer:[],open:function(Q){const K=new y(Q);return this.dbs[A(K)]=K,this.dbList.indexOf(K)<0&&this.dbList.push(K),K},close:function(Q,K){if(Q){delete this.dbs[A(Q)];const oe=Q.filename,D=h.sqlite3__wasm_db_vfs(Q.pointer,0);Q.close();const B=this.dbList.indexOf(Q);B>=0&&this.dbList.splice(B,1),K&&oe&&D&&h.sqlite3__wasm_vfs_unlink(D,oe)}},post:function(Q,K){K&&K.length?(globalThis.postMessage(Q,Array.from(K)),K.length=0):globalThis.postMessage(Q)},dbs:Object.create(null),getDb:function(Q,K=!0){return this.dbs[Q]||(K?d("Unknown (or closed) DB ID:",Q):void 0)}},te=function(Q=P.dbList[0]){return Q&&Q.pointer?Q:d("DB is not opened.")},ne=function(Q,K=!0){const oe=P.getDb(Q.dbId,!1)||P.dbList[0];return K?te(oe):oe},pe=function(){return P.dbList[0]&&A(P.dbList[0])},xe={open:function(Q){const K=Object.create(null),oe=Q.args||Object.create(null);oe.simulateError&&d("Throwing because of simulateError flag.");const D=Object.create(null);K.vfs=oe.vfs,K.filename=oe.filename||"";const B=P.open(K);return D.filename=B.filename,D.persistent=!!p.capi.sqlite3_js_db_uses_vfs(B.pointer,"opfs"),D.dbId=A(B),D.vfs=B.dbVfsName(),D},close:function(Q){const K=ne(Q,!1),oe={filename:K&&K.filename};if(K){const D=Q.args&&typeof Q.args=="object"?!!Q.args.unlink:!1;P.close(K,D)}return oe},exec:function(Q){const K=typeof Q.args=="string"?{sql:Q.args}:Q.args||Object.create(null);K.rowMode==="stmt"?d("Invalid rowMode for 'exec': stmt mode","does not work in the Worker API."):K.sql||d("'exec' requires input SQL.");const oe=ne(Q);(K.callback||Array.isArray(K.resultRows))&&(oe._blobXfer=P.xfer);const D=K.callback;let B=0;const G=!!K.columnNames;typeof D=="string"&&(G||(K.columnNames=[]),K.callback=function(Y,ie){P.post({type:D,columnNames:K.columnNames,rowNumber:++B,row:Y},P.xfer)});try{const Y=K.countChanges?oe.changes(!0,K.countChanges===64):void 0;oe.exec(K),Y!==void 0&&(K.changeCount=oe.changes(!0,K.countChanges===64)-Y),K.callback instanceof Function&&(K.callback=D,P.post({type:D,columnNames:K.columnNames,rowNumber:null,row:void 0}))}finally{delete oe._blobXfer,K.callback&&(K.callback=D)}return K},"config-get":function(){const Q=Object.create(null),K=p.config;return["bigIntEnabled"].forEach(function(oe){Object.getOwnPropertyDescriptor(K,oe)&&(Q[oe]=K[oe])}),Q.version=p.version,Q.vfsList=p.capi.sqlite3_js_vfs_list(),Q.opfsEnabled=!!p.opfs,Q},export:function(Q){const K=ne(Q),oe={byteArray:p.capi.sqlite3_js_db_export(K.pointer),filename:K.filename,mimetype:"application/x-sqlite3"};return P.xfer.push(oe.byteArray.buffer),oe},toss:function(Q){d("Testing worker exception")},"opfs-tree":async function(Q){return p.opfs||d("OPFS support is unavailable."),await p.opfs.treeList()}};globalThis.onmessage=async function(Q){Q=Q.data;let K,oe=Q.dbId,D=Q.type;const B=performance.now();try{xe.hasOwnProperty(D)&&xe[D]instanceof Function?K=await xe[D](Q):d("Unknown db worker message type:",Q.type)}catch(G){D="error",K={operation:Q.type,message:G.message,errorClass:G.name,input:Q},G.stack&&(K.stack=typeof G.stack=="string"?G.stack.split(/\n\s*/):G.stack)}oe||(oe=K.dbId||pe()),P.post({type:D,dbId:oe,messageId:Q.messageId,workerReceivedTime:B,workerRespondTime:performance.now(),departureTime:Q.departureTime,result:K},P.xfer)},globalThis.postMessage({type:"sqlite3-api",result:"worker1-ready"})}).bind({sqlite3:c})}),globalThis.sqlite3ApiBootstrap.initializers.push(function(c){const h=c.wasm,d=c.capi,p=c.util.toss3,y=Object.create(null);c.vfs=y,d.sqlite3_vfs.prototype.registerVfs=function(A=!1){this instanceof c.capi.sqlite3_vfs||p("Expecting a sqlite3_vfs-type argument.");const P=d.sqlite3_vfs_register(this,A?1:0);return P&&p("sqlite3_vfs_register(",this,") failed with rc",P),this.pointer!==d.sqlite3_vfs_find(this.$zName)&&p("BUG: sqlite3_vfs_find(vfs.$zName) failed for just-installed VFS",this),this},y.installVfs=function(A){let P=0;const te=["io","vfs"];for(const ne of te){const pe=A[ne];pe&&(++P,pe.struct.installMethods(pe.methods,!!pe.applyArgcCheck),ne==="vfs"&&(!pe.struct.$zName&&typeof pe.name=="string"&&pe.struct.addOnDispose(pe.struct.$zName=h.allocCString(pe.name)),pe.struct.registerVfs(!!pe.asDefault)))}return P||p("Misuse: installVfs() options object requires at least","one of:",te),this}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(c){const h=c.wasm,d=c.capi,p=c.util.toss3,y=Object.create(null);c.vtab=y;const A=d.sqlite3_index_info;A.prototype.nthConstraint=function(ne,pe=!1){if(ne<0||ne>=this.$nConstraint)return!1;const xe=this.$aConstraint+A.sqlite3_index_constraint.structInfo.sizeof*ne;return pe?xe:new A.sqlite3_index_constraint(xe)},A.prototype.nthConstraintUsage=function(ne,pe=!1){if(ne<0||ne>=this.$nConstraint)return!1;const xe=this.$aConstraintUsage+A.sqlite3_index_constraint_usage.structInfo.sizeof*ne;return pe?xe:new A.sqlite3_index_constraint_usage(xe)},A.prototype.nthOrderBy=function(ne,pe=!1){if(ne<0||ne>=this.$nOrderBy)return!1;const xe=this.$aOrderBy+A.sqlite3_index_orderby.structInfo.sizeof*ne;return pe?xe:new A.sqlite3_index_orderby(xe)};const P=function(ne,pe){return(function(xe,Q=!1){if(arguments.length===0&&(xe=new pe),xe instanceof pe)return this.set(xe.pointer,xe),xe;h.isPtr(xe)||c.SQLite3Error.toss("Invalid argument to",ne+"()");let K=this.get(xe);return Q&&this.delete(xe),K}).bind(new Map)},te=function(ne,pe){const xe=P(ne,pe);return Object.assign(Object.create(null),{StructType:pe,create:Q=>{const K=xe();return h.pokePtr(Q,K.pointer),K},get:Q=>xe(Q),unget:Q=>xe(Q,!0),dispose:Q=>{const K=xe(Q,!0);K&&K.dispose()}})};y.xVtab=te("xVtab",d.sqlite3_vtab),y.xCursor=te("xCursor",d.sqlite3_vtab_cursor),y.xIndexInfo=ne=>new d.sqlite3_index_info(ne),y.xError=function ne(pe,xe,Q){if(ne.errorReporter instanceof Function)try{ne.errorReporter("sqlite3_module::"+pe+"(): "+xe.message)}catch{}let K;return xe instanceof c.WasmAllocError?K=d.SQLITE_NOMEM:arguments.length>2?K=Q:xe instanceof c.SQLite3Error&&(K=xe.resultCode),K||d.SQLITE_ERROR},y.xError.errorReporter=console.error.bind(console),y.xRowid=(ne,pe)=>h.poke(ne,pe,"i64"),y.setupModule=function(ne){let pe=!1;const xe=this instanceof d.sqlite3_module?this:ne.struct||(pe=new d.sqlite3_module);try{const Q=ne.methods||p("Missing 'methods' object.");for(const K of Object.entries({xConnect:"xCreate",xDisconnect:"xDestroy"})){const oe=K[0],D=K[1];Q[oe]===!0?Q[oe]=Q[D]:Q[D]===!0&&(Q[D]=Q[oe])}if(ne.catchExceptions){const K=function(B,G){return["xConnect","xCreate"].indexOf(B)>=0?function(Y,ie,V,le,we,k){try{return G(...arguments)||0}catch(F){return F instanceof c.WasmAllocError||(h.dealloc(h.peekPtr(k)),h.pokePtr(k,h.allocCString(F.message))),y.xError(B,F)}}:function(...Y){try{return G(...Y)||0}catch(ie){return y.xError(B,ie)}}},oe=["xCreate","xConnect","xBestIndex","xDisconnect","xDestroy","xOpen","xClose","xFilter","xNext","xEof","xColumn","xRowid","xUpdate","xBegin","xSync","xCommit","xRollback","xFindFunction","xRename","xSavepoint","xRelease","xRollbackTo","xShadowName"],D=Object.create(null);for(const B of oe){const G=Q[B];if(G instanceof Function)B==="xConnect"&&Q.xCreate===G?D[B]=Q.xCreate:B==="xCreate"&&Q.xConnect===G?D[B]=Q.xConnect:D[B]=K(B,G);else continue}xe.installMethods(D,!1)}else xe.installMethods(Q,!!ne.applyArgcCheck);if(xe.$iVersion===0){let K;typeof ne.iVersion=="number"?K=ne.iVersion:xe.$xShadowName?K=3:xe.$xSavePoint||xe.$xRelease||xe.$xRollbackTo?K=2:K=1,xe.$iVersion=K}}catch(Q){throw pe&&pe.dispose(),Q}return xe},d.sqlite3_module.prototype.setupModule=function(ne){return y.setupModule.call(this,ne)}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(c){const h=function d(p){var P;if(!globalThis.SharedArrayBuffer||!globalThis.Atomics)return Promise.reject(new Error("Cannot install OPFS: Missing SharedArrayBuffer and/or Atomics. The server must emit the COOP/COEP response headers to enable those. See https://sqlite.org/wasm/doc/trunk/persistence.md#coop-coep"));if(typeof WorkerGlobalScope>"u")return Promise.reject(new Error("The OPFS sqlite3_vfs cannot run in the main thread because it requires Atomics.wait()."));if(!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle||!globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle||!((P=navigator==null?void 0:navigator.storage)!=null&&P.getDirectory))return Promise.reject(new Error("Missing required OPFS APIs."));(!p||typeof p!="object")&&(p=Object.create(null));const y=new URL(globalThis.location.href).searchParams;return y.has("opfs-disable")?Promise.resolve(c):(p.verbose===void 0&&(p.verbose=y.has("opfs-verbose")?+y.get("opfs-verbose")||2:1),p.sanityChecks===void 0&&(p.sanityChecks=y.has("opfs-sanity-check")),p.proxyUri===void 0&&(p.proxyUri=d.defaultProxyUri),typeof p.proxyUri=="function"&&(p.proxyUri=p.proxyUri()),new Promise(function(te,ne){const pe=[c.config.error,c.config.warn,c.config.log],xe=(X,...ue)=>{p.verbose>X&&pe[X]("OPFS syncer:",...ue)},Q=(...X)=>xe(2,...X),K=(...X)=>xe(1,...X),oe=(...X)=>xe(0,...X),D=c.util.toss,B=c.capi,G=c.util,Y=c.wasm,ie=B.sqlite3_vfs,V=B.sqlite3_file,le=B.sqlite3_io_methods,we=Object.create(null),k=()=>{var X;return globalThis.FileSystemHandle&&globalThis.FileSystemDirectoryHandle&&globalThis.FileSystemFileHandle&&globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle&&((X=navigator==null?void 0:navigator.storage)==null?void 0:X.getDirectory)};we.metrics={dump:function(){let X,ue=0,ge=0,Ce=0;for(X in L.opIds){const Oe=me[X];ue+=Oe.count,ge+=Oe.time,Ce+=Oe.wait,Oe.avgTime=Oe.count&&Oe.time?Oe.time/Oe.count:0,Oe.avgWait=Oe.count&&Oe.wait?Oe.wait/Oe.count:0}c.config.log(globalThis.location.href,"metrics for",globalThis.location.href,":",me,`
Total of`,ue,"op(s) for",ge,"ms (incl. "+Ce+" ms of waiting on the async side)"),c.config.log("Serialization metrics:",me.s11n),b.postMessage({type:"opfs-async-metrics"})},reset:function(){let X;const ue=Ce=>Ce.count=Ce.time=Ce.wait=0;for(X in L.opIds)ue(me[X]=Object.create(null));let ge=me.s11n=Object.create(null);ge=ge.serialize=Object.create(null),ge.count=ge.time=0,ge=me.s11n.deserialize=Object.create(null),ge.count=ge.time=0}};const F=new le,W=new ie().addOnDispose(()=>F.dispose());let _e;const q=X=>(_e=!0,W.dispose(),ne(X)),R=()=>(_e=!1,te(c)),b=new Worker(new URL("/tea-tracker-test/assets/sqlite3-opfs-async-proxy-D34PESGD.js",self.location.href));setTimeout(()=>{_e===void 0&&q(new Error("Timeout while waiting for OPFS async proxy worker."))},4e3),b._originalOnError=b.onerror,b.onerror=function(X){oe("Error initializing OPFS asyncer:",X),q(new Error("Loading OPFS async Worker failed for unknown reasons."))};const x=B.sqlite3_vfs_find(null),$=x?new ie(x):null;F.$iVersion=1,W.$iVersion=2,W.$szOsFile=B.sqlite3_file.structInfo.sizeof,W.$mxPathname=1024,W.$zName=Y.allocCString("opfs"),W.$xDlOpen=W.$xDlError=W.$xDlSym=W.$xDlClose=null,W.addOnDispose("$zName",W.$zName,"cleanup default VFS wrapper",()=>$?$.dispose():null);const L=Object.create(null);L.verbose=p.verbose,L.littleEndian=(()=>{const X=new ArrayBuffer(2);return new DataView(X).setInt16(0,256,!0),new Int16Array(X)[0]===256})(),L.asyncIdleWaitTime=150,L.asyncS11nExceptions=1,L.fileBufferSize=1024*64,L.sabS11nOffset=L.fileBufferSize,L.sabS11nSize=W.$mxPathname*2,L.sabIO=new SharedArrayBuffer(L.fileBufferSize+L.sabS11nSize),L.opIds=Object.create(null);const me=Object.create(null);{let X=0;L.opIds.whichOp=X++,L.opIds.rc=X++,L.opIds.xAccess=X++,L.opIds.xClose=X++,L.opIds.xDelete=X++,L.opIds.xDeleteNoWait=X++,L.opIds.xFileSize=X++,L.opIds.xLock=X++,L.opIds.xOpen=X++,L.opIds.xRead=X++,L.opIds.xSleep=X++,L.opIds.xSync=X++,L.opIds.xTruncate=X++,L.opIds.xUnlock=X++,L.opIds.xWrite=X++,L.opIds.mkdir=X++,L.opIds["opfs-async-metrics"]=X++,L.opIds["opfs-async-shutdown"]=X++,L.opIds.retry=X++,L.sabOP=new SharedArrayBuffer(X*4),we.metrics.reset()}L.sq3Codes=Object.create(null),["SQLITE_ACCESS_EXISTS","SQLITE_ACCESS_READWRITE","SQLITE_BUSY","SQLITE_CANTOPEN","SQLITE_ERROR","SQLITE_IOERR","SQLITE_IOERR_ACCESS","SQLITE_IOERR_CLOSE","SQLITE_IOERR_DELETE","SQLITE_IOERR_FSYNC","SQLITE_IOERR_LOCK","SQLITE_IOERR_READ","SQLITE_IOERR_SHORT_READ","SQLITE_IOERR_TRUNCATE","SQLITE_IOERR_UNLOCK","SQLITE_IOERR_WRITE","SQLITE_LOCK_EXCLUSIVE","SQLITE_LOCK_NONE","SQLITE_LOCK_PENDING","SQLITE_LOCK_RESERVED","SQLITE_LOCK_SHARED","SQLITE_LOCKED","SQLITE_MISUSE","SQLITE_NOTFOUND","SQLITE_OPEN_CREATE","SQLITE_OPEN_DELETEONCLOSE","SQLITE_OPEN_MAIN_DB","SQLITE_OPEN_READONLY"].forEach(X=>{(L.sq3Codes[X]=B[X])===void 0&&D("Maintenance required: not found:",X)}),L.opfsFlags=Object.assign(Object.create(null),{OPFS_UNLOCK_ASAP:1,OPFS_UNLINK_BEFORE_OPEN:2,defaultUnlockAsap:!1});const Pe=(X,...ue)=>{const ge=L.opIds[X]||D("Invalid op ID:",X);L.s11n.serialize(...ue),Atomics.store(L.sabOPView,L.opIds.rc,-1),Atomics.store(L.sabOPView,L.opIds.whichOp,ge),Atomics.notify(L.sabOPView,L.opIds.whichOp);const Ce=performance.now();for(;Atomics.wait(L.sabOPView,L.opIds.rc,-1)!=="not-equal";);const Oe=Atomics.load(L.sabOPView,L.opIds.rc);if(me[X].wait+=performance.now()-Ce,Oe&&L.asyncS11nExceptions){const $e=L.s11n.deserialize();$e&&oe(X+"() async error:",...$e)}return Oe};we.debug={asyncShutdown:()=>{K("Shutting down OPFS async listener. The OPFS VFS will no longer work."),Pe("opfs-async-shutdown")},asyncRestart:()=>{K("Attempting to restart OPFS VFS async listener. Might work, might not."),b.postMessage({type:"opfs-async-restart"})}};const nt=()=>{if(L.s11n)return L.s11n;const X=new TextDecoder,ue=new TextEncoder("utf-8"),ge=new Uint8Array(L.sabIO,L.sabS11nOffset,L.sabS11nSize),Ce=new DataView(L.sabIO,L.sabS11nOffset,L.sabS11nSize);L.s11n=Object.create(null);const Oe=Object.create(null);Oe.number={id:1,size:8,getter:"getFloat64",setter:"setFloat64"},Oe.bigint={id:2,size:8,getter:"getBigInt64",setter:"setBigInt64"},Oe.boolean={id:3,size:4,getter:"getInt32",setter:"setInt32"},Oe.string={id:4};const $e=C=>Oe[typeof C]||D("Maintenance required: this value type cannot be serialized.",C),be=C=>{switch(C){case Oe.number.id:return Oe.number;case Oe.bigint.id:return Oe.bigint;case Oe.boolean.id:return Oe.boolean;case Oe.string.id:return Oe.string;default:D("Invalid type ID:",C)}};return L.s11n.deserialize=function(C=!1){++me.s11n.deserialize.count;const T=performance.now(),j=ge[0],H=j?[]:null;if(j){const re=[];let Ie=1,Ge,wt,$t;for(Ge=0;Ge<j;++Ge,++Ie)re.push(be(ge[Ie]));for(Ge=0;Ge<j;++Ge){const ds=re[Ge];ds.getter?($t=Ce[ds.getter](Ie,L.littleEndian),Ie+=ds.size):(wt=Ce.getInt32(Ie,L.littleEndian),Ie+=4,$t=X.decode(ge.slice(Ie,Ie+wt)),Ie+=wt),H.push($t)}}return C&&(ge[0]=0),me.s11n.deserialize.time+=performance.now()-T,H},L.s11n.serialize=function(...C){const T=performance.now();if(++me.s11n.serialize.count,C.length){const j=[];let H=0,re=1;for(ge[0]=C.length&255;H<C.length;++H,++re)j.push($e(C[H])),ge[re]=j[H].id;for(H=0;H<C.length;++H){const Ie=j[H];if(Ie.setter)Ce[Ie.setter](re,C[H],L.littleEndian),re+=Ie.size;else{const Ge=ue.encode(C[H]);Ce.setInt32(re,Ge.byteLength,L.littleEndian),re+=4,ge.set(Ge,re),re+=Ge.byteLength}}}else ge[0]=0;me.s11n.serialize.time+=performance.now()-T},L.s11n},mt=function X(ue=16){X._chars||(X._chars="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ012346789",X._n=X._chars.length);const ge=[];let Ce=0;for(;Ce<ue;++Ce){const Oe=Math.random()*(X._n*64)%X._n|0;ge[Ce]=X._chars[Oe]}return ge.join("")},st=Object.create(null),at=Object.create(null);at.op=void 0,at.start=void 0;const Et=X=>{at.start=performance.now(),at.op=X,++me[X].count},Ct=()=>me[at.op].time+=performance.now()-at.start,Gt={xCheckReservedLock:function(X,ue){return Y.poke(ue,0,"i32"),0},xClose:function(X){Et("xClose");let ue=0;const ge=st[X];return ge&&(delete st[X],ue=Pe("xClose",X),ge.sq3File&&ge.sq3File.dispose()),Ct(),ue},xDeviceCharacteristics:function(X){return B.SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN},xFileControl:function(X,ue,ge){return B.SQLITE_NOTFOUND},xFileSize:function(X,ue){Et("xFileSize");let ge=Pe("xFileSize",X);if(ge==0)try{const Ce=L.s11n.deserialize()[0];Y.poke(ue,Ce,"i64")}catch(Ce){oe("Unexpected error reading xFileSize() result:",Ce),ge=L.sq3Codes.SQLITE_IOERR}return Ct(),ge},xLock:function(X,ue){Et("xLock");const ge=st[X];let Ce=0;return ge.lockType?ge.lockType=ue:(Ce=Pe("xLock",X,ue),Ce===0&&(ge.lockType=ue)),Ct(),Ce},xRead:function(X,ue,ge,Ce){Et("xRead");const Oe=st[X];let $e;try{$e=Pe("xRead",X,ge,Number(Ce)),($e===0||B.SQLITE_IOERR_SHORT_READ===$e)&&Y.heap8u().set(Oe.sabView.subarray(0,ge),ue)}catch(be){oe("xRead(",arguments,") failed:",be,Oe),$e=B.SQLITE_IOERR_READ}return Ct(),$e},xSync:function(X,ue){Et("xSync"),++me.xSync.count;const ge=Pe("xSync",X,ue);return Ct(),ge},xTruncate:function(X,ue){Et("xTruncate");const ge=Pe("xTruncate",X,Number(ue));return Ct(),ge},xUnlock:function(X,ue){Et("xUnlock");const ge=st[X];let Ce=0;return B.SQLITE_LOCK_NONE===ue&&ge.lockType&&(Ce=Pe("xUnlock",X,ue)),Ce===0&&(ge.lockType=ue),Ct(),Ce},xWrite:function(X,ue,ge,Ce){Et("xWrite");const Oe=st[X];let $e;try{Oe.sabView.set(Y.heap8u().subarray(ue,ue+ge)),$e=Pe("xWrite",X,ge,Number(Ce))}catch(be){oe("xWrite(",arguments,") failed:",be,Oe),$e=B.SQLITE_IOERR_WRITE}return Ct(),$e}},Yt={xAccess:function(X,ue,ge,Ce){Et("xAccess");const Oe=Pe("xAccess",Y.cstrToJs(ue));return Y.poke(Ce,Oe?0:1,"i32"),Ct(),0},xCurrentTime:function(X,ue){return Y.poke(ue,24405875e-1+new Date().getTime()/864e5,"double"),0},xCurrentTimeInt64:function(X,ue){return Y.poke(ue,24405875e-1*864e5+new Date().getTime(),"i64"),0},xDelete:function(X,ue,ge){Et("xDelete");const Ce=Pe("xDelete",Y.cstrToJs(ue),ge,!1);return Ct(),Ce},xFullPathname:function(X,ue,ge,Ce){return Y.cstrncpy(Ce,ue,ge)<ge?0:B.SQLITE_CANTOPEN},xGetLastError:function(X,ue,ge){return K("OPFS xGetLastError() has nothing sensible to return."),0},xOpen:function(ue,ge,Ce,Oe,$e){Et("xOpen");let be=0;ge===0?ge=mt():Y.isPtr(ge)&&(B.sqlite3_uri_boolean(ge,"opfs-unlock-asap",0)&&(be|=L.opfsFlags.OPFS_UNLOCK_ASAP),B.sqlite3_uri_boolean(ge,"delete-before-open",0)&&(be|=L.opfsFlags.OPFS_UNLINK_BEFORE_OPEN),ge=Y.cstrToJs(ge));const C=Object.create(null);C.fid=Ce,C.filename=ge,C.sab=new SharedArrayBuffer(L.fileBufferSize),C.flags=Oe;const T=Pe("xOpen",Ce,ge,Oe,be);return T||(C.readOnly&&Y.poke($e,B.SQLITE_OPEN_READONLY,"i32"),st[Ce]=C,C.sabView=L.sabFileBufView,C.sq3File=new V(Ce),C.sq3File.$pMethods=F.pointer,C.lockType=B.SQLITE_LOCK_NONE),Ct(),T}};$&&(W.$xRandomness=$.$xRandomness,W.$xSleep=$.$xSleep),W.$xRandomness||(Yt.xRandomness=function(X,ue,ge){const Ce=Y.heap8u();let Oe=0;for(;Oe<ue;++Oe)Ce[ge+Oe]=Math.random()*255e3&255;return Oe}),W.$xSleep||(Yt.xSleep=function(X,ue){return Atomics.wait(L.sabOPView,L.opIds.xSleep,0,ue),0}),we.getResolvedPath=function(X,ue){const ge=new URL(X,"file://irrelevant").pathname;return ue?ge.split("/").filter(Ce=>!!Ce):ge},we.getDirForFilename=async function(ue,ge=!1){const Ce=we.getResolvedPath(ue,!0),Oe=Ce.pop();let $e=we.rootDirectory;for(const be of Ce)be&&($e=await $e.getDirectoryHandle(be,{create:!!ge}));return[$e,Oe]},we.mkdir=async function(X){try{return await we.getDirForFilename(X+"/filepart",!0),!0}catch{return!1}},we.entryExists=async function(X){try{const[ue,ge]=await we.getDirForFilename(X);return await ue.getFileHandle(ge),!0}catch{return!1}},we.randomFilename=mt,we.treeList=async function(){const X=async function ge(Ce,Oe){Oe.name=Ce.name,Oe.dirs=[],Oe.files=[];for await(const $e of Ce.values())if($e.kind==="directory"){const be=Object.create(null);Oe.dirs.push(be),await ge($e,be)}else Oe.files.push($e.name)},ue=Object.create(null);return await X(we.rootDirectory,ue),ue},we.rmfr=async function(){const X=we.rootDirectory,ue={recurse:!0};for await(const ge of X.values())X.removeEntry(ge.name,ue)},we.unlink=async function(X,ue=!1,ge=!1){try{const[Ce,Oe]=await we.getDirForFilename(X,!1);return await Ce.removeEntry(Oe,{recursive:ue}),!0}catch(Ce){if(ge)throw new Error("unlink(",arguments[0],") failed: "+Ce.message,{cause:Ce});return!1}},we.traverse=async function(X){const ue={recursive:!0,directory:we.rootDirectory};typeof X=="function"&&(X={callback:X}),X=Object.assign(ue,X||{}),async function Ce(Oe,$e){for await(const be of Oe.values()){if(X.callback(be,Oe,$e)===!1)return!1;if(X.recursive&&be.kind==="directory"&&await Ce(be,$e+1)===!1)break}}(X.directory,0)};const wr=async function(X,ue){const[ge,Ce]=await we.getDirForFilename(X,!0);let $e=await(await ge.getFileHandle(Ce,{create:!0})).createSyncAccessHandle(),be=0,C,T=!1;try{for($e.truncate(0);(C=await ue())!==void 0;)C instanceof ArrayBuffer&&(C=new Uint8Array(C)),be===0&&C.byteLength>=15&&(G.affirmDbHeader(C),T=!0),$e.write(C,{at:be}),be+=C.byteLength;if((be<512||be%512!==0)&&D("Input size",be,"is not correct for an SQLite database."),!T){const j=new Uint8Array(20);$e.read(j,{at:0}),G.affirmDbHeader(j)}return $e.write(new Uint8Array([1,1]),{at:18}),be}catch(j){throw await $e.close(),$e=void 0,await ge.removeEntry(Ce).catch(()=>{}),j}finally{$e&&await $e.close()}};if(we.importDb=async function(X,ue){if(ue instanceof Function)return wr(X,ue);ue instanceof ArrayBuffer&&(ue=new Uint8Array(ue)),G.affirmIsDb(ue);const ge=ue.byteLength,[Ce,Oe]=await we.getDirForFilename(X,!0);let $e,be=0;try{return $e=await(await Ce.getFileHandle(Oe,{create:!0})).createSyncAccessHandle(),$e.truncate(0),be=$e.write(ue,{at:0}),be!=ge&&D("Expected to write "+ge+" bytes but wrote "+be+"."),$e.write(new Uint8Array([1,1]),{at:18}),be}catch(C){throw $e&&(await $e.close(),$e=void 0),await Ce.removeEntry(Oe).catch(()=>{}),C}finally{$e&&await $e.close()}},c.oo1){const X=function(...ue){const ge=c.oo1.DB.dbCtorHelper.normalizeArgs(...ue);ge.vfs=W.$zName,c.oo1.DB.dbCtorHelper.call(this,ge)};X.prototype=Object.create(c.oo1.DB.prototype),c.oo1.OpfsDb=X,X.importDb=we.importDb,c.oo1.DB.dbCtorHelper.setVfsPostOpenSql(W.pointer,function(ue,ge){ge.capi.sqlite3_busy_timeout(ue,1e4),ge.capi.sqlite3_exec(ue,["pragma journal_mode=DELETE;","pragma cache_size=-16384;"],0,0,0)})}const mn=function(){const X=Y.scopedAllocPush(),ue=new V;try{const ge=ue.pointer,Ce=B.SQLITE_OPEN_CREATE|B.SQLITE_OPEN_READWRITE|B.SQLITE_OPEN_MAIN_DB,Oe=Y.scopedAlloc(8),$e="/sanity/check/file"+mt(8),be=Y.scopedAllocCString($e);let C;if(L.s11n.serialize("This is ä string."),C=L.s11n.deserialize(),Q("deserialize() says:",C),C[0]!=="This is ä string."&&D("String d13n error."),Yt.xAccess(W.pointer,be,0,Oe),C=Y.peek(Oe,"i32"),Q("xAccess(",$e,") exists ?=",C),C=Yt.xOpen(W.pointer,be,ge,Ce,Oe),Q("open rc =",C,"state.sabOPView[xOpen] =",L.sabOPView[L.opIds.xOpen]),C!==0){oe("open failed with code",C);return}Yt.xAccess(W.pointer,be,0,Oe),C=Y.peek(Oe,"i32"),C||D("xAccess() failed to detect file."),C=Gt.xSync(ue.pointer,0),C&&D("sync failed w/ rc",C),C=Gt.xTruncate(ue.pointer,1024),C&&D("truncate failed w/ rc",C),Y.poke(Oe,0,"i64"),C=Gt.xFileSize(ue.pointer,Oe),C&&D("xFileSize failed w/ rc",C),Q("xFileSize says:",Y.peek(Oe,"i64")),C=Gt.xWrite(ue.pointer,be,10,1),C&&D("xWrite() failed!");const T=Y.scopedAlloc(16);C=Gt.xRead(ue.pointer,T,6,2),Y.poke(T+6,0);let j=Y.cstrToJs(T);Q("xRead() got:",j),j!=="sanity"&&D("Unexpected xRead() value."),Yt.xSleep&&(Q("xSleep()ing before close()ing..."),Yt.xSleep(W.pointer,2e3),Q("waking up from xSleep()")),C=Gt.xClose(ge),Q("xClose rc =",C,"sabOPView =",L.sabOPView),Q("Deleting file:",$e),Yt.xDelete(W.pointer,be,4660),Yt.xAccess(W.pointer,be,0,Oe),C=Y.peek(Oe,"i32"),C&&D("Expecting 0 from xAccess(",$e,") after xDelete()."),K("End of OPFS sanity checks.")}finally{ue.dispose(),Y.scopedAllocPop(X)}};b.onmessage=function({data:X}){switch(X.type){case"opfs-unavailable":q(new Error(X.payload.join(" ")));break;case"opfs-async-loaded":b.postMessage({type:"opfs-async-init",args:L});break;case"opfs-async-inited":{if(_e===!0)break;try{c.vfs.installVfs({io:{struct:F,methods:Gt},vfs:{struct:W,methods:Yt}}),L.sabOPView=new Int32Array(L.sabOP),L.sabFileBufView=new Uint8Array(L.sabIO,0,L.fileBufferSize),L.sabS11nView=new Uint8Array(L.sabIO,L.sabS11nOffset,L.sabS11nSize),nt(),p.sanityChecks&&(K("Running sanity checks because of opfs-sanity-check URL arg..."),mn()),k()?navigator.storage.getDirectory().then(ue=>{b.onerror=b._originalOnError,delete b._originalOnError,c.opfs=we,we.rootDirectory=ue,Q("End of OPFS sqlite3_vfs setup.",W),R()}).catch(q):R()}catch(ue){oe(ue),q(ue)}break}default:{const ue="Unexpected message from the OPFS async worker: "+JSON.stringify(X);oe(ue),q(new Error(ue));break}}}}))};h.defaultProxyUri="sqlite3-opfs-async-proxy.js",globalThis.sqlite3ApiBootstrap.initializersAsync.push(async d=>{try{let p=h.defaultProxyUri;return d.scriptInfo.sqlite3Dir&&(h.defaultProxyUri=d.scriptInfo.sqlite3Dir+p),h().catch(y=>{d.config.warn("Ignoring inability to install OPFS sqlite3_vfs:",y.message)})}catch(p){return d.config.error("installOpfsVfs() exception:",p),Promise.reject(p)}})}),globalThis.sqlite3ApiBootstrap.initializers.push(function(c){var st,at,Et,Ct,Gt,Yt,wr,mn,X,ue,ge,Ce,B_,$e;const h=c.util.toss,d=c.util.toss3,p=Object.create(null),y=c.capi,A=c.util,P=c.wasm,te=4096,ne=512,pe=4,xe=8,Q=ne+pe,K=ne,oe=Q,D=te,B=y.SQLITE_OPEN_MAIN_DB|y.SQLITE_OPEN_MAIN_JOURNAL|y.SQLITE_OPEN_SUPER_JOURNAL|y.SQLITE_OPEN_WAL,G=".opaque",Y=()=>Math.random().toString(36).slice(2),ie=new TextDecoder,V=new TextEncoder,le=Object.assign(Object.create(null),{name:"opfs-sahpool",directory:void 0,initialCapacity:6,clearOnInit:!1,verbosity:2}),we=[c.config.error,c.config.warn,c.config.log];c.config.log;const k=c.config.warn;c.config.error;const F=new Map,W=be=>F.get(be),_e=(be,C)=>{C?F.set(be,C):F.delete(be)},q=new Map,R=be=>q.get(be),b=(be,C)=>{C?q.set(be,C):q.delete(be)},x={xCheckReservedLock:function(be,C){const T=R(be);return T.log("xCheckReservedLock"),T.storeErr(),P.poke32(C,1),0},xClose:function(be){const C=R(be);C.storeErr();const T=C.getOFileForS3File(be);if(T)try{C.log(`xClose ${T.path}`),C.mapS3FileToOFile(be,!1),T.sah.flush(),T.flags&y.SQLITE_OPEN_DELETEONCLOSE&&C.deletePath(T.path)}catch(j){return C.storeErr(j,y.SQLITE_IOERR)}return 0},xDeviceCharacteristics:function(be){return y.SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN},xFileControl:function(be,C,T){return y.SQLITE_NOTFOUND},xFileSize:function(be,C){const T=R(be);T.log("xFileSize");const H=T.getOFileForS3File(be).sah.getSize()-D;return P.poke64(C,BigInt(H)),0},xLock:function(be,C){const T=R(be);T.log(`xLock ${C}`),T.storeErr();const j=T.getOFileForS3File(be);return j.lockType=C,0},xRead:function(be,C,T,j){const H=R(be);H.storeErr();const re=H.getOFileForS3File(be);H.log(`xRead ${re.path} ${T} @ ${j}`);try{const Ie=re.sah.read(P.heap8u().subarray(C,C+T),{at:D+Number(j)});return Ie<T?(P.heap8u().fill(0,C+Ie,C+T),y.SQLITE_IOERR_SHORT_READ):0}catch(Ie){return H.storeErr(Ie,y.SQLITE_IOERR)}},xSectorSize:function(be){return te},xSync:function(be,C){const T=R(be);T.log(`xSync ${C}`),T.storeErr();const j=T.getOFileForS3File(be);try{return j.sah.flush(),0}catch(H){return T.storeErr(H,y.SQLITE_IOERR)}},xTruncate:function(be,C){const T=R(be);T.log(`xTruncate ${C}`),T.storeErr();const j=T.getOFileForS3File(be);try{return j.sah.truncate(D+Number(C)),0}catch(H){return T.storeErr(H,y.SQLITE_IOERR)}},xUnlock:function(be,C){const T=R(be);T.log("xUnlock");const j=T.getOFileForS3File(be);return j.lockType=C,0},xWrite:function(be,C,T,j){const H=R(be);H.storeErr();const re=H.getOFileForS3File(be);H.log(`xWrite ${re.path} ${T} ${j}`);try{const Ie=re.sah.write(P.heap8u().subarray(C,C+T),{at:D+Number(j)});return T===Ie?0:h("Unknown write() failure.")}catch(Ie){return H.storeErr(Ie,y.SQLITE_IOERR)}}},$=new y.sqlite3_io_methods;$.$iVersion=1,c.vfs.installVfs({io:{struct:$,methods:x}});const L={xAccess:function(be,C,T,j){const H=W(be);H.storeErr();try{const re=H.getPath(C);P.poke32(j,H.hasFilename(re)?1:0)}catch{P.poke32(j,0)}return 0},xCurrentTime:function(be,C){return P.poke(C,24405875e-1+new Date().getTime()/864e5,"double"),0},xCurrentTimeInt64:function(be,C){return P.poke(C,24405875e-1*864e5+new Date().getTime(),"i64"),0},xDelete:function(be,C,T){const j=W(be);j.log(`xDelete ${P.cstrToJs(C)}`),j.storeErr();try{return j.deletePath(j.getPath(C)),0}catch(H){return j.storeErr(H),y.SQLITE_IOERR_DELETE}},xFullPathname:function(be,C,T,j){return P.cstrncpy(j,C,T)<T?0:y.SQLITE_CANTOPEN},xGetLastError:function(be,C,T){const j=W(be),H=j.popErr();if(j.log(`xGetLastError ${C} e =`,H),H){const re=P.scopedAllocPush();try{const[Ie,Ge]=P.scopedAllocCString(H.message,!0);P.cstrncpy(T,Ie,C),Ge>C&&P.poke8(T+C-1,0)}catch{return y.SQLITE_NOMEM}finally{P.scopedAllocPop(re)}}return H?H.sqlite3Rc||y.SQLITE_IOERR:0},xOpen:function(C,T,j,H,re){const Ie=W(C);try{Ie.log(`xOpen ${P.cstrToJs(T)} ${H}`);const Ge=T&&P.peek8(T)?Ie.getPath(T):Y();let wt=Ie.getSAHForPath(Ge);!wt&&H&y.SQLITE_OPEN_CREATE&&(Ie.getFileCount()<Ie.getCapacity()?(wt=Ie.nextAvailableSAH(),Ie.setAssociatedPath(wt,Ge,H)):h("SAH pool is full. Cannot create file",Ge)),wt||h("file not found:",Ge);const $t={path:Ge,flags:H,sah:wt};Ie.mapS3FileToOFile(j,$t),$t.lockType=y.SQLITE_LOCK_NONE;const ds=new y.sqlite3_file(j);return ds.$pMethods=$.pointer,ds.dispose(),P.poke32(re,H),0}catch(Ge){return Ie.storeErr(Ge),y.SQLITE_CANTOPEN}}},me=function(be){c.capi.sqlite3_vfs_find(be)&&d("VFS name is already registered:",be);const C=new y.sqlite3_vfs,T=y.sqlite3_vfs_find(null),j=T?new y.sqlite3_vfs(T):null;return C.$iVersion=2,C.$szOsFile=y.sqlite3_file.structInfo.sizeof,C.$mxPathname=ne,C.addOnDispose(C.$zName=P.allocCString(be),()=>_e(C.pointer,0)),j&&(C.$xRandomness=j.$xRandomness,C.$xSleep=j.$xSleep,j.dispose()),!C.$xRandomness&&!L.xRandomness&&(L.xRandomness=function(H,re,Ie){const Ge=P.heap8u();let wt=0;for(;wt<re;++wt)Ge[Ie+wt]=Math.random()*255e3&255;return wt}),!C.$xSleep&&!L.xSleep&&(L.xSleep=(H,re)=>0),c.vfs.installVfs({vfs:{struct:C,methods:L}}),C};class Pe{constructor(C=Object.create(null)){ae(this,Ce);g(this,"vfsDir");ae(this,st,void 0);ae(this,at,void 0);ae(this,Et,void 0);ae(this,Ct,new Map);ae(this,Gt,new Map);ae(this,Yt,new Set);ae(this,wr,new Map);ae(this,mn,new Uint8Array(Q));ae(this,X,void 0);ae(this,ue,void 0);ae(this,ge,void 0);Ee(this,ge,C.verbosity??le.verbosity),this.vfsName=C.name||le.name,Ee(this,ue,me(this.vfsName)),_e(a(this,ue).pointer,this),this.vfsDir=C.directory||"."+this.vfsName,Ee(this,X,new DataView(a(this,mn).buffer,a(this,mn).byteOffset)),this.isReady=this.reset(!!(C.clearOnInit??le.clearOnInit)).then(()=>{if(this.$error)throw this.$error;return this.getCapacity()?Promise.resolve(void 0):this.addCapacity(C.initialCapacity||le.initialCapacity)})}log(...C){Lt(this,Ce,B_).call(this,2,...C)}warn(...C){Lt(this,Ce,B_).call(this,1,...C)}error(...C){Lt(this,Ce,B_).call(this,0,...C)}getVfs(){return a(this,ue)}getCapacity(){return a(this,Ct).size}getFileCount(){return a(this,Gt).size}getFileNames(){const C=[],T=a(this,Gt).keys();for(const j of T)C.push(j);return C}async addCapacity(C){for(let T=0;T<C;++T){const j=Y(),re=await(await a(this,at).getFileHandle(j,{create:!0})).createSyncAccessHandle();a(this,Ct).set(re,j),this.setAssociatedPath(re,"",0)}return this.getCapacity()}async reduceCapacity(C){let T=0;for(const j of Array.from(a(this,Yt))){if(T===C||this.getFileCount()===this.getCapacity())break;const H=a(this,Ct).get(j);j.close(),await a(this,at).removeEntry(H),a(this,Ct).delete(j),a(this,Yt).delete(j),++T}return T}releaseAccessHandles(){for(const C of a(this,Ct).keys())C.close();a(this,Ct).clear(),a(this,Gt).clear(),a(this,Yt).clear()}async acquireAccessHandles(C){const T=[];for await(const[j,H]of a(this,at))H.kind==="file"&&T.push([j,H]);return Promise.all(T.map(async([j,H])=>{try{const re=await H.createSyncAccessHandle();if(a(this,Ct).set(re,j),C)re.truncate(D),this.setAssociatedPath(re,"",0);else{const Ie=this.getAssociatedPath(re);Ie?a(this,Gt).set(Ie,re):a(this,Yt).add(re)}}catch(re){throw this.storeErr(re),this.releaseAccessHandles(),re}}))}getAssociatedPath(C){C.read(a(this,mn),{at:0});const T=a(this,X).getUint32(K);if(a(this,mn)[0]&&(T&y.SQLITE_OPEN_DELETEONCLOSE||!(T&B)))return k(`Removing file with unexpected flags ${T.toString(16)}`,a(this,mn)),this.setAssociatedPath(C,"",0),"";const j=new Uint32Array(xe/4);C.read(j,{at:oe});const H=this.computeDigest(a(this,mn));if(j.every((re,Ie)=>re===H[Ie])){const re=a(this,mn).findIndex(Ie=>Ie===0);return re===0&&C.truncate(D),re?ie.decode(a(this,mn).subarray(0,re)):""}else return k("Disassociating file with bad digest."),this.setAssociatedPath(C,"",0),""}setAssociatedPath(C,T,j){const H=V.encodeInto(T,a(this,mn));ne<=H.written+1&&h("Path too long:",T),a(this,mn).fill(0,H.written,ne),a(this,X).setUint32(K,j);const re=this.computeDigest(a(this,mn));C.write(a(this,mn),{at:0}),C.write(re,{at:oe}),C.flush(),T?(a(this,Gt).set(T,C),a(this,Yt).delete(C)):(C.truncate(D),a(this,Yt).add(C))}computeDigest(C){let T=3735928559,j=1103547991;for(const H of C)T=31*T+H*307,j=31*j+H*307;return new Uint32Array([T>>>0,j>>>0])}async reset(C){await this.isReady;let T=await navigator.storage.getDirectory(),j;for(const H of this.vfsDir.split("/"))H&&(j=T,T=await T.getDirectoryHandle(H,{create:!0}));return Ee(this,st,T),Ee(this,Et,j),Ee(this,at,await a(this,st).getDirectoryHandle(G,{create:!0})),this.releaseAccessHandles(),this.acquireAccessHandles(C)}getPath(C){return P.isPtr(C)&&(C=P.cstrToJs(C)),(C instanceof URL?C:new URL(C,"file://localhost/")).pathname}deletePath(C){const T=a(this,Gt).get(C);return T&&(a(this,Gt).delete(C),this.setAssociatedPath(T,"",0)),!!T}storeErr(C,T){return C&&(C.sqlite3Rc=T||y.SQLITE_IOERR,this.error(C)),this.$error=C,T}popErr(){const C=this.$error;return this.$error=void 0,C}nextAvailableSAH(){const[C]=a(this,Yt).keys();return C}getOFileForS3File(C){return a(this,wr).get(C)}mapS3FileToOFile(C,T){T?(a(this,wr).set(C,T),b(C,this)):(a(this,wr).delete(C),b(C,!1))}hasFilename(C){return a(this,Gt).has(C)}getSAHForPath(C){return a(this,Gt).get(C)}async removeVfs(){if(!a(this,ue).pointer||!a(this,at))return!1;y.sqlite3_vfs_unregister(a(this,ue).pointer),a(this,ue).dispose();try{this.releaseAccessHandles(),await a(this,st).removeEntry(G,{recursive:!0}),Ee(this,at,void 0),await a(this,Et).removeEntry(a(this,st).name,{recursive:!0}),Ee(this,st,Ee(this,Et,void 0))}catch(C){c.config.error(this.vfsName,"removeVfs() failed:",C)}return!0}exportFile(C){const T=a(this,Gt).get(C)||h("File not found:",C),j=T.getSize()-D,H=new Uint8Array(j>0?j:0);if(j>0){const re=T.read(H,{at:D});re!=j&&h("Expected to read "+j+" bytes but read "+re+".")}return H}async importDbChunked(C,T){const j=a(this,Gt).get(C)||this.nextAvailableSAH()||h("No available handles to import to.");j.truncate(0);let H=0,re,Ie=!1;try{for(;(re=await T())!==void 0;)re instanceof ArrayBuffer&&(re=new Uint8Array(re)),H===0&&re.byteLength>=15&&(A.affirmDbHeader(re),Ie=!0),j.write(re,{at:D+H}),H+=re.byteLength;if((H<512||H%512!==0)&&h("Input size",H,"is not correct for an SQLite database."),!Ie){const Ge=new Uint8Array(20);j.read(Ge,{at:0}),A.affirmDbHeader(Ge)}j.write(new Uint8Array([1,1]),{at:D+18})}catch(Ge){throw this.setAssociatedPath(j,"",0),Ge}return this.setAssociatedPath(j,C,y.SQLITE_OPEN_MAIN_DB),H}importDb(C,T){if(T instanceof ArrayBuffer)T=new Uint8Array(T);else if(T instanceof Function)return this.importDbChunked(C,T);const j=a(this,Gt).get(C)||this.nextAvailableSAH()||h("No available handles to import to."),H=T.byteLength;(H<512||H%512!=0)&&h("Byte array size is invalid for an SQLite db.");const re="SQLite format 3";for(let Ge=0;Ge<re.length;++Ge)re.charCodeAt(Ge)!==T[Ge]&&h("Input does not contain an SQLite database header.");const Ie=j.write(T,{at:D});return Ie!=H?(this.setAssociatedPath(j,"",0),h("Expected to write "+H+" bytes but wrote "+Ie+".")):(j.write(new Uint8Array([1,1]),{at:D+18}),this.setAssociatedPath(j,C,y.SQLITE_OPEN_MAIN_DB)),Ie}}st=new WeakMap,at=new WeakMap,Et=new WeakMap,Ct=new WeakMap,Gt=new WeakMap,Yt=new WeakMap,wr=new WeakMap,mn=new WeakMap,X=new WeakMap,ue=new WeakMap,ge=new WeakMap,Ce=new WeakSet,B_=function(C,...T){a(this,ge)>C&&we[C](this.vfsName+":",...T)};class nt{constructor(C){ae(this,$e,void 0);Ee(this,$e,C),this.vfsName=C.vfsName}async addCapacity(C){return a(this,$e).addCapacity(C)}async reduceCapacity(C){return a(this,$e).reduceCapacity(C)}getCapacity(){return a(this,$e).getCapacity(a(this,$e))}getFileCount(){return a(this,$e).getFileCount()}getFileNames(){return a(this,$e).getFileNames()}async reserveMinimumCapacity(C){const T=a(this,$e).getCapacity();return T<C?a(this,$e).addCapacity(C-T):T}exportFile(C){return a(this,$e).exportFile(C)}importDb(C,T){return a(this,$e).importDb(C,T)}async wipeFiles(){return a(this,$e).reset(!0)}unlink(C){return a(this,$e).deletePath(C)}async removeVfs(){return a(this,$e).removeVfs()}}$e=new WeakMap;const mt=async()=>{const be=await navigator.storage.getDirectory(),C=".opfs-sahpool-sync-check-"+Y(),H=(await(await be.getFileHandle(C,{create:!0})).createSyncAccessHandle()).close();return await H,await be.removeEntry(C),H!=null&&H.then&&h("The local OPFS API is too old for opfs-sahpool:","it has an async FileSystemSyncAccessHandle.close() method."),!0};c.installOpfsSAHPoolVfs=async function(be=Object.create(null)){var T;const C=be.name||le.name;return p[C]?p[C]:!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle||!globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle||!((T=navigator==null?void 0:navigator.storage)!=null&&T.getDirectory)?p[C]=Promise.reject(new Error("Missing required OPFS APIs.")):p[C]=mt().then(async function(){if(be.$testThrowInInit)throw be.$testThrowInInit;const j=new Pe(be);return j.isReady.then(async()=>{const H=new nt(j);if(c.oo1){const re=c.oo1,Ie=j.getVfs(),Ge=function(...wt){const $t=re.DB.dbCtorHelper.normalizeArgs(...wt);$t.vfs=Ie.$zName,re.DB.dbCtorHelper.call(this,$t)};Ge.prototype=Object.create(re.DB.prototype),H.OpfsSAHPoolDb=Ge,re.DB.dbCtorHelper.setVfsPostOpenSql(Ie.pointer,function(wt,$t){$t.capi.sqlite3_exec(wt,["pragma journal_mode=DELETE;","pragma cache_size=-16384;"],0,0,0)})}return j.log("VFS initialized."),H}).catch(async H=>{throw await j.removeVfs().catch(()=>{}),H})}).catch(j=>p[C]=Promise.reject(j))}}),typeof u<"u"){const c=Object.assign(Object.create(null),{exports:typeof wasmExports>"u"?u.asm:wasmExports,memory:u.wasmMemory},globalThis.sqlite3ApiConfig||{});globalThis.sqlite3ApiConfig=c;let h;try{h=globalThis.sqlite3ApiBootstrap()}catch(d){throw console.error("sqlite3ApiBootstrap() error:",d),d}finally{delete globalThis.sqlite3ApiBootstrap,delete globalThis.sqlite3ApiConfig}u.sqlite3=h}else console.warn("This is not running in an Emscripten module context, so","globalThis.sqlite3ApiBootstrap() is _not_ being called due to lack","of config info for the WASM environment.","It must be called manually.")}),n.ready}})();fE=function(){var n,r;const t=fE;if(!t)throw new Error("Expecting globalThis.sqlite3InitModule to be defined by the Emscripten build.");const e=globalThis.sqlite3InitModuleState=Object.assign(Object.create(null),{moduleScript:(n=globalThis==null?void 0:globalThis.document)==null?void 0:n.currentScript,isWorker:typeof WorkerGlobalScope<"u",location:globalThis.location,urlParams:(r=globalThis==null?void 0:globalThis.location)!=null&&r.href?new URL(globalThis.location.href).searchParams:new URLSearchParams});if(e.debugModule=e.urlParams.has("sqlite3.debugModule")?(...s)=>console.warn("sqlite3.debugModule:",...s):()=>{},e.urlParams.has("sqlite3.dir"))e.sqlite3Dir=e.urlParams.get("sqlite3.dir")+"/";else if(e.moduleScript){const s=e.moduleScript.src.split("/");s.pop(),e.sqlite3Dir=s.join("/")+"/"}if(globalThis.sqlite3InitModule=function s(...i){return t(...i).then(o=>{const l=o.sqlite3;l.scriptInfo=e,s.__isUnderTest&&(l.__isUnderTest=!0);const f=l.asyncPostInit;return delete l.asyncPostInit,f()}).catch(o=>{throw console.error("Exception loading sqlite3 module:",o),o})},globalThis.sqlite3InitModule.ready=t.ready,globalThis.sqlite3InitModuleState.moduleScript){const s=globalThis.sqlite3InitModuleState;let i=s.moduleScript.src.split("/");i.pop(),s.scriptDir=i.join("/")+"/"}return e.debugModule("sqlite3InitModuleState =",e),globalThis.sqlite3InitModule}();var Wte=fE;globalThis.sqlite3Worker1Promiser=function t(e=t.defaultConfig){if(arguments.length===1&&typeof arguments[0]=="function"){const N=e;e=Object.assign(Object.create(null),t.defaultConfig),e.onready=N}else e=Object.assign(Object.create(null),t.defaultConfig,e);const n=Object.create(null),r=function(){},s=e.onerror||r,i=e.debug||r,o=e.generateMessageId?void 0:Object.create(null),l=e.generateMessageId||function(N){return N.type+"#"+(o[N.type]=(o[N.type]||0)+1)},f=(...N)=>{throw new Error(N.join(" "))};e.worker||(e.worker=t.defaultConfig.worker),typeof e.worker=="function"&&(e.worker=e.worker());let m,S;return e.worker.onmessage=function(N){N=N.data,i("worker1.onmessage",N);let O=n[N.messageId];if(!O){if(N&&N.type==="sqlite3-api"&&N.result==="worker1-ready"){e.onready&&e.onready(S);return}if(O=n[N.type],O&&O.onrow){O.onrow(N);return}e.onunhandled?e.onunhandled(arguments[0]):s("sqlite3Worker1Promiser() unhandled worker message:",N);return}switch(delete n[N.messageId],N.type){case"error":O.reject(N);return;case"open":m||(m=N.dbId);break;case"close":N.dbId===m&&(m=void 0);break}try{O.resolve(N)}catch(M){O.reject(M)}},S=function(){let N;arguments.length===1?N=arguments[0]:arguments.length===2?(N=Object.create(null),N.type=arguments[0],N.args=arguments[1],N.dbId=N.args.dbId):f("Invalid arguments for sqlite3Worker1Promiser()-created factory."),!N.dbId&&N.type!=="open"&&(N.dbId=m),N.messageId=l(N),N.departureTime=performance.now();const O=Object.create(null);O.message=N;let M;N.type==="exec"&&N.args&&(typeof N.args.callback=="function"?(M=N.messageId+":row",O.onrow=N.args.callback,N.args.callback=M,n[M]=O):typeof N.args.callback=="string"&&f("exec callback may not be a string when using the Promise interface."));let z=new Promise(function(Z,J){O.resolve=Z,O.reject=J,n[N.messageId]=O,i("Posting",N.type,"message to Worker dbId="+(m||"default")+":",N),e.worker.postMessage(N)});return M&&(z=z.finally(()=>delete n[M])),z}},globalThis.sqlite3Worker1Promiser.defaultConfig={worker:function(){return new Worker(new URL("/tea-tracker-test/assets/sqlite3-worker1-bundler-friendly-C0SzgDV9.js",self.location.href),{type:"module"})},onerror:(...t)=>console.error("worker1 promiser error",...t)},sqlite3Worker1Promiser.v2=(function(t){let e;typeof t=="function"?(e=t,t={}):typeof(t==null?void 0:t.onready)=="function"&&(e=t.onready,delete t.onready);const n=Object.create(null);t=Object.assign(t||Object.create(null),{onready:async function(s){try{e&&await e(s),n.resolve(s)}catch(i){n.reject(i)}}});const r=new Promise(function(s,i){n.resolve=s,n.reject=i});try{this.original(t)}catch(s){n.reject(s)}return r}).bind({original:sqlite3Worker1Promiser}),sqlite3Worker1Promiser.v2,globalThis.sqlite3ApiConfig={warn:bo};const Bte=Nm(fc,Wt(function*(){const t=yield*Ws,e=Wte();return fc.of({createSqlite:Wt(function*(){const n=yield*Te(p_("SqliteBroadcastChannel"),Ute);n.onMessage=m=>{switch(m._tag){case"Exec":{r=[...r,m];break}case"ExecError":case"ExecSuccess":{r=ly(r,S=>S.id!==m.id),s(m);break}default:U_()}};let r=[];const s=m=>{const S=i.get(m.id);S&&(S(m),i.delete(m.id))},i=new Map,o=yield*Ko,l=Vw(o);rr("SqliteWeb connection lock request").pipe(an(p_("SqliteConnection")),Te(m=>sc(S=>{navigator.locks.request(m,()=>new Promise(()=>{S(Im(()=>e))}))})),on(rr("SqliteWeb connection lock granted")),Te(m=>Im(()=>m.installOpfsSAHPoolVfs({name:o.name})).pipe(Me(S=>({sqlite:new S.OpfsSAHPoolDb("/evolu1.db"),sqlite3:m})))),on(({sqlite:m,sqlite3:S})=>{const N=(O,M)=>Hw({try:()=>O.sql===JC.sql?[{file:S.capi.sqlite3_js_db_export(m)}]:m.exec(O.sql,{returnValue:"resultRows",rowMode:"object",bind:G9(O.parameters||[])}),catch:jS}).pipe(nG(O),rS({onSuccess:z=>{n.postMessage({_tag:"ExecSuccess",id:M,result:{rows:z,changes:m.changes()}})},onFailure:z=>{n.postMessage({_tag:"ExecError",id:M,error:z})}}),l.runSync);n.onMessage=O=>{switch(O._tag){case"Exec":N(O.query,O.id);break;case"ExecSuccess":case"ExecError":s(O);break;default:U_()}},r.forEach(O=>{N(O.query,O.id)}),r=[]})).pipe(Xw(Ko,o),l.runPromise);const f=yield*p_("SqliteTransaction");return Jn.of({exec:m=>Te(t.nanoid,S=>sc(N=>{i.set(S,O=>{switch(O._tag){case"ExecSuccess":N(Tt(O.result));break;case"ExecError":N(Kw(O.error));break}}),n.postMessage({_tag:"Exec",id:S,query:m})})),transaction:m=>S=>Gw(sc(N=>{navigator.locks.request(f,{mode:m==="last"?"exclusive":m},()=>new Promise(O=>{N(Tt(O))}))}),()=>S,N=>Rt(()=>{m!=="last"&&N()})),export:()=>Te(t.nanoid,m=>sc(S=>{i.set(m,N=>{switch(N._tag){case"ExecSuccess":S(Tt(N.result.rows[0].file));break;case"ExecError":S(Kw(N.error));break}}),n.postMessage({_tag:"Exec",id:m,query:JC})}))})})})})),Ute=t=>Rt(()=>{const e=new BroadcastChannel(t),n={postMessage:r=>{e.postMessage(r),n.onMessage(r)},onMessage:bo};return e.onmessage=r=>{n.onMessage(r.data)},n}),JC={sql:"export database"},jte=rc(EA,{createSync:Rt(()=>Mte(new Worker(new URL("/tea-tracker-test/assets/Sync.worker-CaKwryCk.js",self.location.href),{type:"module"})))});$Z.pipe(ci(fO(fc.Common.pipe(dO(Bte),dO(HC)),HC,ea.Live,jte,Lte)),ui,Dte)})();
