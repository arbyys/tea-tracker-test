import{d as j,u as O,e as R,s as fe,r as u,v as ee,o as _,h as B,f as n,q as S,t as w,a as e,b as t,w as l,x as V,y as D,c as T,n as ae,m as L,F as N,i as q,z as ve,A as M,B as me,C as pe,D as E,P as _e,E as ye,G as Y,H as ge,_ as W,I as te,J as se,K as ne,L as oe,M as ue,N as G,O as re,j as le,Q as ie,S as H,R as de,T as Ie,U as be,V as xe,W as we,X as Te,Y as he,Z as Ce,$ as J,a0 as Se,a1 as ke,a2 as $e,a3 as Be,a4 as Ve,a5 as Qe,a6 as Ee,a7 as ze,a8 as De,a9 as Ne,aa as Me,ab as Ue,ac as Fe,k as Le,ad as je}from"./index-BEZ7m8M5.js";import{b as K,l as Oe,c as ce,d as X,e as Z}from"./Queries-sW0fxRQQ.js";const Re={class:"text-light-tint ml-6"},Ae={class:"text-secondary"},Pe={class:"mt-8"},Ge={class:"flex flex-col items-center"},He={class:"text-4xl font-bold mb-4 font-mono"},qe={class:"mt-8 w-3/4 mx-auto"},We={key:0,class:"ml-4 mt-5"},Ye={class:"font-medium"},Je={class:"font-medium"},Ke={class:"ml-3 opacity-65 font-mono"},Xe={class:"mt-14"},Ze={class:"flex gap-4 justify-center w-3/4 mx-auto"},et={class:"flex flex-col text-left"},tt={class:"inline-flex items-center mt-1.5 opacity-70"},lt={class:"flex flex-col text-left"},at={class:"inline-flex items-center mt-1.5 opacity-70"},st=j({__name:"CurrentInfusion",props:{currentInfusion:{}},setup(z){O();const i=R.getEvolu(),g=z,{currentInfusion:o}=fe(g),d=u(),r=u(0),I=u(!1),y=u(null);i.subscribeQuery(K(o.value.id))(()=>{const{rows:s}=i.getQuery(K(o.value.id));d.value=s}),i.loadQuery(K(o.value.id)).then(({rows:s})=>{d.value=s});const h=ee(()=>m(r.value,!0)),x=s=>{(s.code==="Space"||s.key===" ")&&(s.preventDefault(),c())};window.addEventListener("keyup",x);const m=(s,a=!1)=>{const C=String(Math.floor(s/6e4)).padStart(2,"0"),b=String(Math.floor(s%6e4/1e3)).padStart(2,"0"),Q=String(Math.floor(s%1e3/10)).padStart(2,"0");return a?`${C}:${b}:${Q}`:`${C}:${b}`};function c(){I.value?k():U()}function U(){I.value=!0,y.value=setInterval(()=>{r.value+=10},10)}async function k(){I.value=!1,y.value!==null&&clearInterval(y.value);let s=0;await i.loadQuery(Oe).then(({rows:a})=>{a.length&&a[0].order&&(s=a[0].order)}),i.create("_currentBrews",{currentInfusionId:o.value.id,order:E(_e)(s+1),length:E(ye)(r.value)}),r.value=0}const f=async()=>new Promise(async s=>{await(await ge.create({header:"Confirm",message:"Are you sure you want to do this?",buttons:[{text:"No",role:"cancel",handler:()=>s(!1)},{text:"Yes",handler:()=>s(!0)}]})).present()}),v=async()=>{var C;const s=(C=o.value)==null?void 0:C.id;if(!s)return;i.update("_currentInfusion",{id:s,isDeleted:Y(!0)});const a=await i.loadQuery(i.createQuery(b=>b.selectFrom("_currentBrews").where("currentInfusionId","is",s).select("id")));a&&a.rows&&a.rows.forEach(b=>{i.update("_currentBrews",{id:b.id,isDeleted:Y(!0)})})},F=async()=>{var Q;const s=(Q=o.value)==null?void 0:Q.id;if(!s||!await f()||!o.value||!o.value.tea_id)return;const{id:C}=i.create("infusions",{teaId:o.value.tea_id,endedAt:Y(new Date)}),b=await i.loadQuery(i.createQuery($=>$.selectFrom("_currentBrews").where("currentInfusionId","is",s).select(["id","length","order"])));b&&b.rows&&b.rows.forEach($=>{!$.length||!$.order||i.create("brews",{infusionId:C,length:$.length,order:$.order})}),v()},p=async()=>{await f()&&v()};return(s,a)=>{var C,b,Q,$;return _(),B(N,null,[a[9]||(a[9]=n("h1",null,"Current infusion",-1)),n("h5",Re,[a[2]||(a[2]=S(" with ")),n("span",Ae,w((C=e(o))==null?void 0:C.tea_title)+" "+w((b=e(o))==null?void 0:b.tea_subtitle),1),S(" ("+w((Q=e(o))==null?void 0:Q.tea_type_name)+") ",1)]),n("section",Pe,[n("div",Ge,[n("div",He,w(h.value),1),t(e(V),{onClick:c,expand:"full",size:"large",class:"w-40 mt-2"},{default:l(()=>[S(w(I.value?"Stop":"Start"),1)]),_:1})]),n("div",qe,[a[4]||(a[4]=n("h3",{class:"text-secondary"},"Brews:",-1)),($=d.value)!=null&&$.length?D("",!0):(_(),B("div",We," No brews have been started yet ")),t(e(ve),{inset:!0},{default:l(()=>{var A;return[(A=d.value)!=null&&A.length&&I.value?(_(),T(e(L),{key:0},{default:l(()=>[t(e(ae),{class:"opacity-25"},{default:l(()=>[n("span",Ye,w(d.value.length+1)+". brew:",1),a[3]||(a[3]=n("span",{class:"ml-3 opacity-65 font-mono"},"??:??",-1))]),_:1})]),_:1})):D("",!0),(_(!0),B(N,null,q(d.value,(P,wt)=>(_(),T(e(L),{key:P.id},{default:l(()=>[t(e(ae),null,{default:l(()=>[n("span",Je,w(P.order)+". brew:",1),n("span",Ke,w(P.length?m(P.length):"??:??"),1)]),_:2},1024)]),_:2},1024))),128))]}),_:1})])]),n("div",Xe,[n("div",Ze,[t(e(V),{fill:"outline",color:"danger",onClick:a[0]||(a[0]=A=>p()),class:"bg-[#1f0204] w-full"},{default:l(()=>[n("div",et,[a[6]||(a[6]=n("span",{class:"text-xl"},"Cancel infusion",-1)),n("div",tt,[t(e(M),{class:"size-5",slot:"start",icon:e(me)},null,8,["icon"]),a[5]||(a[5]=n("span",{class:"text-xs ml-2"}," Don't save ",-1))])])]),_:1}),t(e(V),{onClick:a[1]||(a[1]=A=>F()),class:"flex items-center] w-full"},{default:l(()=>[n("div",lt,[a[8]||(a[8]=n("span",{class:"text-xl"},"Save + end infusion",-1)),n("div",at,[t(e(M),{class:"size-5",slot:"start",icon:e(pe)},null,8,["icon"]),a[7]||(a[7]=n("span",{class:"text-xs ml-2"}," Sync to cloud ",-1))])])]),_:1})])])],64)}}}),nt=W(st,[["__scopeId","data-v-db21414b"]]),ot={class:"flex flex-col h-full"},ut={class:"flex-1"},rt={class:"mt-auto"},it=j({__name:"CreateTea",setup(z){O();const i=u(),g=R.getEvolu(),o=u(),d=u(),r=u(),I=u();g.loadQuery(ce).then(({rows:x})=>{I.value=x});const y=()=>i.value.$el.dismiss(null,"cancel"),h=async()=>{!o.value||!r.value||(console.log(r.value),g.create("teas",{title:E(H)(o.value),subtitle:d.value?E(H)(d.value):null,teaTypeId:r.value.id}),y())};return(x,m)=>(_(),T(e(ie),{ref_key:"modal",ref:i,trigger:"open-create-tea",id:"create-tea-modal"},{default:l(()=>[t(e(ue),null,{default:l(()=>[t(e(te),null,{default:l(()=>[t(e(se),{slot:"end"},{default:l(()=>[t(e(V),{onClick:m[0]||(m[0]=c=>y())},{default:l(()=>[t(e(M),{icon:e(ne)},null,8,["icon"])]),_:1})]),_:1}),t(e(oe),{color:"secondary"},{default:l(()=>m[5]||(m[5]=[S("Create new tea")])),_:1})]),_:1})]),_:1}),t(e(le),{class:"ion-padding"},{default:l(()=>[n("div",ot,[n("div",ut,[t(e(G),{class:"mt-3",label:"Tea name","label-placement":"floating",fill:"outline",placeholder:"Earl Grey",modelValue:o.value,"onUpdate:modelValue":m[1]||(m[1]=c=>o.value=c)},null,8,["modelValue"]),t(e(G),{class:"mt-6",label:"Tea subtitle (optional)","label-placement":"floating",fill:"outline",placeholder:"Ceylon",modelValue:d.value,"onUpdate:modelValue":m[2]||(m[2]=c=>d.value=c)},null,8,["modelValue"]),t(e(L),{class:"mt-6"},{default:l(()=>[t(e(re),{justify:"start",color:"primary","aria-label":"teatype",label:"Type of tea",placeholder:"Select",interface:"popover",modelValue:r.value,"onUpdate:modelValue":m[3]||(m[3]=c=>r.value=c)},{default:l(()=>[(_(!0),B(N,null,q(I.value,c=>(_(),T(e(de),{value:c},{default:l(()=>[S(w(c.name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),n("div",rt,[t(e(V),{expand:"block",onClick:m[4]||(m[4]=c=>h()),class:"flex items-center mt-8"},{default:l(()=>m[6]||(m[6]=[n("span",{class:""},"Create",-1)])),_:1})])])]),_:1})]),_:1},512))}}),dt=W(it,[["__scopeId","data-v-a18e299e"]]),ct={class:"flex flex-col h-full"},ft={class:"flex-1"},vt={class:"mt-auto"},mt=j({__name:"EditTea",props:{editingId:{},selectedTitle:{},selectedSubtitle:{},selectedTeaType:{}},emits:["toggle"],setup(z,{emit:i}){O();const g=u(),o=R.getEvolu(),d=z,r=i,I=u(d.editingId),y=u(d.selectedTitle);console.log("INStit",y.value);const h=u(d.selectedSubtitle),x=u(d.selectedTeaType),m=u();o.loadQuery(ce).then(({rows:k})=>{m.value=k});const c=()=>{g.value.$el.dismiss(null,"cancel")},U=async()=>{if(!y.value||!x.value)return;const k=u(),f=v=>o.createQuery(F=>F.selectFrom("teaTypes").where("name","is",E(Ie)(v)).selectAll());console.log("ga",x.value),await o.loadQuery(f(x.value)).then(({rows:v})=>{v.length&&v[0].id&&(k.value=v[0].id)}),k.value&&o.update("teas",{id:I.value,title:E(H)(y.value),subtitle:h.value?E(H)(h.value):null,teaTypeId:k.value}),c()};return(k,f)=>(_(),T(e(ie),{ref_key:"modal",ref:g,id:"edit-tea-modal",onWillDismiss:f[5]||(f[5]=v=>r("toggle"))},{default:l(()=>[t(e(ue),null,{default:l(()=>[t(e(te),null,{default:l(()=>[t(e(se),{slot:"end"},{default:l(()=>[t(e(V),{onClick:f[0]||(f[0]=v=>c())},{default:l(()=>[t(e(M),{icon:e(ne)},null,8,["icon"])]),_:1})]),_:1}),t(e(oe),{color:"secondary"},{default:l(()=>f[6]||(f[6]=[S("Edit tea")])),_:1})]),_:1})]),_:1}),t(e(le),{class:"ion-padding"},{default:l(()=>[n("div",ct,[n("div",ft,[t(e(G),{class:"mt-3",label:"Tea name","label-placement":"floating",fill:"outline",placeholder:"Title",modelValue:y.value,"onUpdate:modelValue":f[1]||(f[1]=v=>y.value=v)},null,8,["modelValue"]),t(e(G),{class:"mt-6",label:"Tea subtitle (optional)","label-placement":"floating",fill:"outline",placeholder:"Subtitle",modelValue:h.value,"onUpdate:modelValue":f[2]||(f[2]=v=>h.value=v)},null,8,["modelValue"]),t(e(L),{class:"mt-6"},{default:l(()=>[t(e(re),{justify:"start",color:"primary","aria-label":"teatype",label:"Type of tea",placeholder:"Select",interface:"popover",modelValue:x.value,"onUpdate:modelValue":f[3]||(f[3]=v=>x.value=v)},{default:l(()=>[(_(!0),B(N,null,q(m.value,v=>(_(),T(e(de),{value:v.name},{default:l(()=>[S(w(v.name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),n("div",vt,[t(e(V),{expand:"block",onClick:f[4]||(f[4]=v=>U()),class:"flex items-center mt-8"},{default:l(()=>f[7]||(f[7]=[n("span",{class:""},"Save",-1)])),_:1})])])]),_:1})]),_:1},512))}}),pt=W(mt,[["__scopeId","data-v-3a48961f"]]),_t={key:0,class:"absolute z-50 w-full h-full bg-gray-800 bg-opacity-40 text-gray-400 text-xl uppercase flex items-center justify-center"},yt={class:"edit-btn absolute top-1 right-1 z-50"},gt=j({__name:"SelectTea",setup(z,{expose:i}){O();const g=u([]),o=u(""),d=R.getEvolu(),r=u(),I=u(),y=u(),h=u(),x=u();d.subscribeQuery(X)(()=>{const{rows:p}=d.getQuery(X);g.value=p}),i({refreshTeas:()=>{d.loadQuery(X).then(({rows:p})=>{g.value=p})}});const c=u(),U=p=>{o.value=p.target.value.toLowerCase().trim()},k=async()=>{c.value&&d.create("_currentInfusion",{teaId:c.value})},f=ee(()=>o?g.value.filter(p=>p.title&&p.title.toLowerCase().indexOf(o.value)>-1):g.value),v=()=>{r.value=!r.value},F=async p=>{console.log(p),!(!p||!p.id||!p.tea_title||!p.tea_type_name)&&(I.value=p.tea_id,y.value=p.tea_title,h.value=p.tea_subtitle??void 0,x.value=p.tea_type_name,console.log("tit",y.value),v())};return(p,s)=>(_(),B(N,null,[s[3]||(s[3]=n("h1",null,"New infusion - select tea",-1)),t(e(L),{class:"pt-5"},{default:l(()=>[t(e(be),{placeholder:"Search teas",class:"pr-8 lg:pr-10","show-clear-button":"always",debounce:250,onIonInput:s[0]||(s[0]=a=>U(a))}),t(e(xe),{horizontal:"end"},{default:l(()=>[t(e(we),{size:"small",color:"secondary",class:"mr-[-5px]",id:"open-create-tea"},{default:l(()=>[t(e(M),{icon:e(Te)},null,8,["icon"])]),_:1})]),_:1})]),_:1}),t(e(Ce),{fixed:!0,class:"mt-3"},{default:l(()=>[t(e(he),null,{default:l(()=>[(_(!0),B(N,null,q(f.value,(a,C)=>(_(),T(e(Se),{size:"12","size-sm":"6","size-lg":"4"},{default:l(()=>[t(e(ke),{class:$e(["tea-card relative bg-[#1f1f1f] border border-[#2f2f2f] min-h-40 flex flex-wrap content-between rounded-xl rounded-b-2xl transition-transform hover:scale-105 hover:cursor-pointer",{"border-2 border-gray-700":a.tea_id==c.value}]),onClick:b=>c.value=a.tea_id==c.value?void 0:a.tea_id},{default:l(()=>[t(J,null,{default:l(()=>[a.tea_id==c.value?(_(),B("div",_t,s[1]||(s[1]=[n("div",{class:"flex justify-center items-center w-full h-1/6 bg-gray-700 bg-opacity-70 py-5"}," Selected ",-1)]))):D("",!0)]),_:2},1024),t(J,null,{default:l(()=>[n("div",yt,[t(e(V),{size:"small",color:"secondary",onClick:Be(b=>F(a),["stop"]),id:"open-edit-tea"},{default:l(()=>[t(e(M),{icon:e(Ve)},null,8,["icon"])]),_:2},1032,["onClick"])])]),_:2},1024),t(e(Qe),{class:"w-full bg-dark min-h-20"},{default:l(()=>[t(e(Ee),{color:"primary"},{default:l(()=>[S(w(a.tea_title),1)]),_:2},1024),t(e(ze),{class:"opacity-60 text-primary-shade"},{default:l(()=>[S(w(a.tea_subtitle??"–"),1)]),_:2},1024)]),_:2},1024),t(e(De),{class:"w-full mb-1 text-gray-500"},{default:l(()=>[S(w(a.tea_type_name),1)]),_:2},1024)]),_:2},1032,["class","onClick"])]),_:2},1024))),256))]),_:1})]),_:1}),t(dt),I.value&&y.value&&x.value?(_(),T(pt,{key:I.value,"is-open":r.value,onToggle:v,"editing-id":I.value,"selected-title":y.value,"selected-subtitle":h.value,"selected-tea-type":x.value},null,8,["is-open","editing-id","selected-title","selected-subtitle","selected-tea-type"])):D("",!0),t(J,null,{default:l(()=>[c.value?(_(),T(e(V),{key:0,size:"large",class:"fixed bottom-2 right-2 sm:bottom-4 sm:right-4 lg:bottom-4 lg:right-8",onClick:k},{default:l(()=>s[2]||(s[2]=[S(" Begin infusion ")])),_:1})):D("",!0)]),_:1})],64))}}),It=W(gt,[["__scopeId","data-v-1a17d2bb"]]),bt={id:"main",class:"pb-4"},xt={key:0,class:"text-center mt-8"},Ct=j({__name:"Infusion",setup(z){O();const i=u(),g=R.getEvolu(),o=u(),d=ee(()=>{var r;return!!((r=o.value)!=null&&r.length)});return Ne(d,async r=>{await je(),i.value&&i.value.refreshTeas()},{immediate:!0,deep:!0}),g.loadQuery(Z).then(({rows:r})=>{o.value=r}),g.subscribeQuery(Z)(()=>{const{rows:r}=g.getQuery(Z);o.value=r}),(r,I)=>(_(),T(e(Le),null,{default:l(()=>[t(e(te)),t(e(le),{class:"ion-padding"},{default:l(()=>[n("main",bt,[o.value?D("",!0):(_(),B("div",xt,[t(e(Me),{name:"dots",class:"size-28"})])),Ue(n("div",null,[o.value&&d.value?(_(),T(nt,{key:0,currentInfusion:o.value[0]},null,8,["currentInfusion"])):(_(),T(It,{key:1,ref_key:"selectTeaRef",ref:i},null,512))],512),[[Fe,!!o.value]])])]),_:1})]),_:1}))}});export{Ct as default};
