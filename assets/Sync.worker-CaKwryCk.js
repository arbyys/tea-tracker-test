var $L=Object.defineProperty;var RL=(Te,h,L)=>h in Te?$L(Te,h,{enumerable:!0,configurable:!0,writable:!0,value:L}):Te[h]=L;var u=(Te,h,L)=>(RL(Te,typeof h!="symbol"?h+"":h,L),L),h0=(Te,h,L)=>{if(!h.has(Te))throw TypeError("Cannot "+L)};var d0=(Te,h,L)=>(h0(Te,h,"read from private field"),L?L.call(Te):h.get(Te)),m0=(Te,h,L)=>{if(h.has(Te))throw TypeError("Cannot add the same private member more than once");h instanceof WeakSet?h.add(Te):h.set(Te,L)},g0=(Te,h,L,Ln)=>(h0(Te,h,"write to private field"),Ln?Ln.call(Te,L):h.set(Te,L),L);(function(){"use strict";var Zo,b3,_3,S3,w3,k3,E3,O3,I3,T3,$3,R3,F3,N3,v3,C3,A3,x3,M3,P3,L3,D3,U3,B3,j3,K3,q3,V3,J3,z3,W3,H3,G3,Y3,X3,Q3,Z3,eL,tL,nL,rL,sL,oL,iL,cL,aL,uL,lL,fL,hL,dL,mL,gL,pL,yL,bL,_L,SL,wL,kL,EL,OL,IL,TL;const Te=e=>typeof e=="function",h=function(e,t){if(typeof e=="function")return function(){return e(arguments)?t.apply(this,arguments):n=>t(n,...arguments)};switch(e){case 0:case 1:throw new RangeError(`Invalid arity ${e}`);case 2:return function(n,r){return arguments.length>=2?t(n,r):function(s){return t(s,n)}};case 3:return function(n,r,s){return arguments.length>=3?t(n,r,s):function(o){return t(o,n,r)}};case 4:return function(n,r,s,o){return arguments.length>=4?t(n,r,s,o):function(i){return t(i,n,r,s)}};case 5:return function(n,r,s,o,i){return arguments.length>=5?t(n,r,s,o,i):function(c){return t(c,n,r,s,o)}};default:return function(){if(arguments.length>=e)return t.apply(this,arguments);const n=arguments;return function(r){return t(r,...n)}}}},L=e=>e,Ln=e=>()=>e,Sh=Ln(!0),ei=Ln(!1),wh=Ln(void 0),ka=wh,y0=e=>{throw new Error("Called `absurd` function which should be uncallable")};function d(e,t,n,r,s,o,i,c,a){switch(arguments.length){case 1:return e;case 2:return t(e);case 3:return n(t(e));case 4:return r(n(t(e)));case 5:return s(r(n(t(e))));case 6:return o(s(r(n(t(e)))));case 7:return i(o(s(r(n(t(e))))));case 8:return c(i(o(s(r(n(t(e)))))));case 9:return a(c(i(o(s(r(n(t(e))))))));default:{let l=arguments[0];for(let f=1;f<arguments.length;f++)l=arguments[f](l);return l}}}let b0="3.9.2";const ti=()=>b0,Ea=Symbol.for(`effect/GlobalValue/globalStoreId/${ti()}`);Ea in globalThis||(globalThis[Ea]=new Map);const Oa=globalThis[Ea],W=(e,t)=>(Oa.has(e)||Oa.set(e,t()),Oa.get(e)),Pt=e=>typeof e=="string",Dn=e=>typeof e=="number",ni=e=>typeof e=="boolean",ri=e=>typeof e=="bigint",Ia=e=>typeof e=="symbol",vs=Te,_0=e=>e===void 0,S0=e=>!1,kh=e=>typeof e=="object"&&e!==null,dr=e=>kh(e)||vs(e),K=h(2,(e,t)=>dr(e)&&t in e),Ta=h(2,(e,t)=>K(e,"_tag")&&e._tag===t),mr=e=>e==null,w0=e=>e!=null,k0=e=>e instanceof Uint8Array,E0=e=>e instanceof Date,Eh=e=>K(e,Symbol.iterator),O0=e=>kh(e)&&!Array.isArray(e),I0=e=>K(e,"then")&&vs(e.then),si=e=>`BUG: ${e} - please report an issue at https://github.com/Effect-TS/effect/issues`;let T0=class p0{constructor(t){u(this,"self");u(this,"called",!1);this.self=t}next(t){return this.called?{value:t,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(t){return{value:t,done:!0}}throw(t){throw t}[Symbol.iterator](){return new p0(this.self)}};const $0=335903614,R0=4150755663,F0=1481765933,N0=1284865837,v0=9007199254740992,C0=134217728;class A0{constructor(t,n,r,s){u(this,"_state");return mr(n)&&mr(t)?(n=Math.random()*4294967295>>>0,t=0):mr(n)&&(n=t,t=0),mr(s)&&mr(r)?(s=this._state?this._state[3]:R0,r=this._state?this._state[2]:$0):mr(s)&&(s=r,r=0),this._state=new Int32Array([0,0,r>>>0,((s||0)|1)>>>0]),this._next(),Oh(this._state,this._state[0],this._state[1],t>>>0,n>>>0),this._next(),this}getState(){return[this._state[0],this._state[1],this._state[2],this._state[3]]}setState(t){this._state[0]=t[0],this._state[1]=t[1],this._state[2]=t[2],this._state[3]=t[3]|1}integer(t){return Math.round(this.number()*Number.MAX_SAFE_INTEGER)%t}number(){const t=(this._next()&67108863)*1,n=(this._next()&134217727)*1;return(t*C0+n)/v0}_next(){const t=this._state[0]>>>0,n=this._state[1]>>>0;x0(this._state,t,n,F0,N0),Oh(this._state,this._state[0],this._state[1],this._state[2],this._state[3]);let r=t>>>18,s=(n>>>18|t<<14)>>>0;r=(r^t)>>>0,s=(s^n)>>>0;const o=(s>>>27|r<<5)>>>0,i=t>>>27,c=(-i>>>0&31)>>>0;return(o>>>i|o<<c)>>>0}}function x0(e,t,n,r,s){let o=(n>>>16)*(s&65535)>>>0,i=(n&65535)*(s>>>16)>>>0,c=(n&65535)*(s&65535)>>>0,a=(n>>>16)*(s>>>16)+((i>>>16)+(o>>>16))>>>0;i=i<<16>>>0,c=c+i>>>0,c>>>0<i>>>0&&(a=a+1>>>0),o=o<<16>>>0,c=c+o>>>0,c>>>0<o>>>0&&(a=a+1>>>0),a=a+Math.imul(n,r)>>>0,a=a+Math.imul(t,s)>>>0,e[0]=a,e[1]=c}function Oh(e,t,n,r,s){let o=t+r>>>0;const i=n+s>>>0;i>>>0<n>>>0&&(o=o+1|0),e[0]=o,e[1]=i}const $a=Symbol.for("effect/Utils/YieldWrap");class Cs{constructor(t){m0(this,Zo,void 0);g0(this,Zo,t)}[$a](){return d0(this,Zo)}}Zo=new WeakMap;function M0(e){if(typeof e=="object"&&e!==null&&$a in e)return e[$a]();throw new Error(si("yieldWrapGet"))}const bt=W("effect/Utils/isStructuralRegion",()=>({enabled:!1,tester:void 0})),Ge=(e=>{const t={[e](n){return n()}};return function(n){return t[e](n)}})("effect_internal_function"),Ra=W(Symbol.for("effect/Hash/randomHashCache"),()=>new WeakMap),G=Symbol.for("effect/Hash"),N=e=>{if(bt.enabled===!0)return 0;switch(typeof e){case"number":return Na(e);case"bigint":return ve(e.toString(10));case"boolean":return ve(String(e));case"symbol":return ve(String(e));case"string":return ve(e);case"undefined":return ve("undefined");case"function":case"object":return e===null?ve("null"):e instanceof Date?N(e.toISOString()):P0(e)?e[G]():Fa(e);default:throw new Error(`BUG: unhandled typeof ${typeof e} - please report an issue at https://github.com/Effect-TS/effect/issues`)}},Fa=e=>(Ra.has(e)||Ra.set(e,Na(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER))),Ra.get(e)),ee=e=>t=>t*53^e,oi=e=>e&3221225471|e>>>1&1073741824,P0=e=>K(e,G),Na=e=>{if(e!==e||e===1/0)return 0;let t=e|0;for(t!==e&&(t^=e*4294967295);e>4294967295;)t^=e/=4294967295;return oi(t)},ve=e=>{let t=5381,n=e.length;for(;n;)t=t*33^e.charCodeAt(--n);return oi(t)},L0=(e,t)=>{let n=12289;for(let r=0;r<t.length;r++)n^=d(ve(t[r]),ee(N(e[t[r]])));return oi(n)},Ih=e=>L0(e,Object.keys(e)),As=e=>{let t=6151;for(let n=0;n<e.length;n++)t=d(t,ee(N(e[n])));return oi(t)},Ee=function(){if(arguments.length===1){const n=arguments[0];return function(r){return Object.defineProperty(n,G,{value(){return r},enumerable:!1}),r}}const e=arguments[0],t=arguments[1];return Object.defineProperty(e,G,{value(){return t},enumerable:!1}),t},H=Symbol.for("effect/Equal");function J(){return arguments.length===1?e=>ii(e,arguments[0]):ii(arguments[0],arguments[1])}function ii(e,t){if(e===t)return!0;const n=typeof e;if(n!==typeof t)return!1;if(n==="object"||n==="function"){if(e!==null&&t!==null){if(ci(e)&&ci(t))return N(e)===N(t)&&e[H](t)?!0:bt.enabled&&bt.tester?bt.tester(e,t):!1;if(e instanceof Date&&t instanceof Date)return e.toISOString()===t.toISOString()}if(bt.enabled){if(Array.isArray(e)&&Array.isArray(t))return e.length===t.length&&e.every((r,s)=>ii(r,t[s]));if(Object.getPrototypeOf(e)===Object.prototype&&Object.getPrototypeOf(e)===Object.prototype){const r=Object.keys(e),s=Object.keys(t);if(r.length===s.length){for(const o of r)if(!(o in t&&ii(e[o],t[o])))return bt.tester?bt.tester(e,t):!1;return!0}}return bt.tester?bt.tester(e,t):!1}}return bt.enabled&&bt.tester?bt.tester(e,t):!1}const ci=e=>K(e,H),va=()=>J,he=Symbol.for("nodejs.util.inspect.custom"),ye=e=>K(e,"toJSON")&&vs(e.toJSON)&&e.toJSON.length===0?e.toJSON():Array.isArray(e)?e.map(ye):e,Ie=e=>JSON.stringify(e,null,2),ai={toJSON(){return ye(this)},[he](){return this.toJSON()},toString(){return Ie(this.toJSON())}};let D0=class{[he](){return this.toJSON()}toString(){return Ie(this.toJSON())}};const xs=(e,t=2)=>{if(typeof e=="string")return e;try{return typeof e=="object"?U0(e,t):String(e)}catch{return String(e)}},U0=(e,t)=>{let n=[];const r=JSON.stringify(e,(s,o)=>typeof o=="object"&&o!==null?n.includes(o)?void 0:n.push(o)&&o:o,t);return n=void 0,r},v=(e,t)=>{switch(t.length){case 0:return e;case 1:return t[0](e);case 2:return t[1](t[0](e));case 3:return t[2](t[1](t[0](e)));case 4:return t[3](t[2](t[1](t[0](e))));case 5:return t[4](t[3](t[2](t[1](t[0](e)))));case 6:return t[5](t[4](t[3](t[2](t[1](t[0](e))))));case 7:return t[6](t[5](t[4](t[3](t[2](t[1](t[0](e)))))));case 8:return t[7](t[6](t[5](t[4](t[3](t[2](t[1](t[0](e))))))));case 9:return t[8](t[7](t[6](t[5](t[4](t[3](t[2](t[1](t[0](e)))))))));default:{let n=e;for(let r=0,s=t.length;r<s;r++)n=t[r](n);return n}}},Ms="Async",Ca="Commit",Me="Failure",ui="OnFailure",li="OnSuccess",fi="OnSuccessAndFailure",Pe="Success",Th="Sync",B0="Tag",gr="UpdateRuntimeFlags",hi="While",$h="WithRuntime",di="Yield",Aa="RevertFlags",j0=Symbol.for("effect/Effect"),K0=Symbol.for("effect/Stream"),q0=Symbol.for("effect/Sink"),V0=Symbol.for("effect/Channel"),pr={_R:e=>e,_E:e=>e,_A:e=>e,_V:ti()},J0={_A:e=>e,_In:e=>e,_L:e=>e,_E:e=>e,_R:e=>e},z0={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutElem:e=>e,_OutDone:e=>e},Ps={[j0]:pr,[K0]:pr,[q0]:J0,[V0]:z0,[H](e){return this===e},[G](){return Ee(this,Fa(this))},[Symbol.iterator](){return new T0(new Cs(this))},pipe(){return v(this,arguments)}},xa={[G](){return Ee(this,Ih(this))},[H](e){const t=Object.keys(this),n=Object.keys(e);if(t.length!==n.length)return!1;for(const r of t)if(!(r in e&&J(this[r],e[r])))return!1;return!0}},yr={...Ps,_op:Ca},W0={...yr,...xa},H0=function(){function e(){}return e.prototype=yr,e}(),Rh=Symbol.for("effect/Option"),Fh={...Ps,[Rh]:{_A:e=>e},[he](){return this.toJSON()},toString(){return Ie(this.toJSON())}},G0=Object.assign(Object.create(Fh),{_tag:"Some",_op:"Some",[H](e){return Nh(e)&&vh(e)&&J(this.value,e.value)},[G](){return Ee(this,ee(N(this._tag))(N(this.value)))},toJSON(){return{_id:"Option",_tag:this._tag,value:ye(this.value)}}}),Y0=N("None"),X0=Object.assign(Object.create(Fh),{_tag:"None",_op:"None",[H](e){return Nh(e)&&Ma(e)},[G](){return Y0},toJSON(){return{_id:"Option",_tag:this._tag}}}),Nh=e=>K(e,Rh),Ma=e=>e._tag==="None",vh=e=>e._tag==="Some",mi=Object.create(X0),br=e=>{const t=Object.create(G0);return t.value=e,t},Ch=Symbol.for("effect/Context/Tag"),Ah={...Ps,_op:"Tag",[Symbol.for("effect/STM")]:pr,[Ch]:{_Service:e=>e,_Identifier:e=>e},toString(){return Ie(this.toJSON())},toJSON(){return{_id:"Tag",key:this.key,stack:this.stack}},[he](){return this.toJSON()},of(e){return e},context(e){return Ph(this,e)}},Q0=e=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=2;const n=new Error;Error.stackTraceLimit=t;const r=Object.create(Ah);return Object.defineProperty(r,"stack",{get(){return n.stack}}),r.key=e,r},Z0=e=>()=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=2;const n=new Error;Error.stackTraceLimit=t;function r(){}return Object.setPrototypeOf(r,Ah),r.key=e,Object.defineProperty(r,"stack",{get(){return n.stack}}),r},xh=Symbol.for("effect/Context"),ew={[xh]:{_Services:e=>e},[H](e){if(Mh(e)&&this.unsafeMap.size===e.unsafeMap.size){for(const t of this.unsafeMap.keys())if(!e.unsafeMap.has(t)||!J(this.unsafeMap.get(t),e.unsafeMap.get(t)))return!1;return!0}return!1},[G](){return Ee(this,Na(this.unsafeMap.size))},pipe(){return v(this,arguments)},toString(){return Ie(this.toJSON())},toJSON(){return{_id:"Context",services:Array.from(this.unsafeMap).map(ye)}},[he](){return this.toJSON()}},_r=e=>{const t=Object.create(ew);return t.unsafeMap=e,t},tw=e=>{const t=new Error(`Service not found${e.key?`: ${String(e.key)}`:""}`);if(e.stack){const n=e.stack.split(`
`);if(n.length>2){const r=n[2].match(/at (.*)/);r&&(t.message=t.message+` (defined at ${r[1]})`)}}if(t.stack){const n=t.stack.split(`
`);n.splice(1,3),t.stack=n.join(`
`)}return t},Mh=e=>K(e,xh),nw=e=>K(e,Ch),rw=_r(new Map),sw=()=>rw,Ph=(e,t)=>_r(new Map([[e.key,t]])),ow=h(3,(e,t,n)=>{const r=new Map(e.unsafeMap);return r.set(t.key,n),_r(r)}),Lh=h(2,(e,t)=>{if(!e.unsafeMap.has(t.key))throw tw(t);return e.unsafeMap.get(t.key)}),iw=Lh,cw=h(2,(e,t)=>e.unsafeMap.has(t.key)?br(e.unsafeMap.get(t.key)):mi),aw=h(2,(e,t)=>{const n=new Map(e.unsafeMap);for(const[r,s]of t.unsafeMap)n.set(r,s);return _r(n)}),_t=Q0,uw=Mh,Dh=nw,dn=sw,Pa=Ph,mn=ow,Ls=iw,La=Lh,Sr=cw,Ds=aw,gi=Z0,Da=e=>(t,n)=>t===n||e(t,n),lw=h(2,(e,t)=>Da((n,r)=>e(t(n),t(r)))),fw=e=>Da((t,n)=>{if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(!e(t[r],n[r]))return!1;return!0}),Uh=Symbol.for("effect/Either"),Bh={...Ps,[Uh]:{_R:e=>e},[he](){return this.toJSON()},toString(){return Ie(this.toJSON())}},hw=Object.assign(Object.create(Bh),{_tag:"Right",_op:"Right",[H](e){return Ua(e)&&Kh(e)&&J(this.right,e.right)},[G](){return ee(N(this._tag))(N(this.right))},toJSON(){return{_id:"Either",_tag:this._tag,right:ye(this.right)}}}),dw=Object.assign(Object.create(Bh),{_tag:"Left",_op:"Left",[H](e){return Ua(e)&&jh(e)&&J(this.left,e.left)},[G](){return ee(N(this._tag))(N(this.left))},toJSON(){return{_id:"Either",_tag:this._tag,left:ye(this.left)}}}),Ua=e=>K(e,Uh),jh=e=>e._tag==="Left",Kh=e=>e._tag==="Right",qh=e=>{const t=Object.create(dw);return t.left=e,t},Vh=e=>{const t=Object.create(hw);return t.right=e,t},mw=h(2,(e,t)=>Ma(e)?qh(t()):Vh(e.value)),Jh=e=>(t,n)=>t===n?0:e(t,n),gw=Jh((e,t)=>e<t?-1:1),zh=h(2,(e,t)=>Jh((n,r)=>e(t(n),t(r)))),pw=e=>h(2,(t,n)=>e(t,n)===1),O=()=>mi,T=br,$e=Ma,le=vh,Ke=h(2,(e,{onNone:t,onSome:n})=>$e(e)?t():n(e.value)),be=h(2,(e,t)=>$e(e)?t():e.value),pi=h(2,(e,t)=>$e(e)?t():e),yw=h(2,(e,t)=>$e(e)?T(t()):e),Us=e=>e==null?O():T(e),Wt=be(wh),bw=e=>(...t)=>{try{return T(e(...t))}catch{return O()}},Wh=h(2,(e,t)=>{if(le(e))return e.value;throw t()})(()=>new Error("getOrThrow called on a None")),Bs=h(2,(e,t)=>$e(e)?O():T(t(e.value))),yi=h(2,(e,t)=>$e(e)?O():t(e.value)),_w=h(2,(e,t)=>$e(e)?O():t(e.value)),Sw=(e=>h(2,(t,n)=>$e(t)?!1:e(t.value,n)))(va()),ww=h(2,(e,t)=>$e(e)?!1:t(e.value)),Ba=Symbol.for("effect/Duration"),kw=BigInt(0),Hh=BigInt(24),bi=BigInt(60),ja=BigInt(1e3),Gh=BigInt(1e6),Ka=BigInt(1e9),Yh=/^(-?\d+(?:\.\d+)?)\s+(nanos?|micros?|millis?|seconds?|minutes?|hours?|days?|weeks?)$/,Lt=e=>{if(Qh(e))return e;if(Dn(e))return _i(e);if(ri(e))return qa(e);if(Array.isArray(e)){if(e.length===2&&Dn(e[0])&&Dn(e[1]))return qa(BigInt(e[0])*Ka+BigInt(e[1]))}else if(Pt(e)){Yh.lastIndex=0;const t=Yh.exec(e);if(t){const[n,r,s]=t,o=Number(r);switch(s){case"nano":case"nanos":return qa(BigInt(r));case"micro":case"micros":return Tw(BigInt(r));case"milli":case"millis":return _i(o);case"second":case"seconds":return Zh(o);case"minute":case"minutes":return $w(o);case"hour":case"hours":return Rw(o);case"day":case"days":return Fw(o);case"week":case"weeks":return Nw(o)}}}throw new Error("Invalid DurationInput")},Xh={_tag:"Millis",millis:0},Ew={_tag:"Infinity"},Ow={[Ba]:Ba,[G](){return Ee(this,Ih(this.value))},[H](e){return Qh(e)&&Pw(this,e)},toString(){return`Duration(${Dw(this)})`},toJSON(){switch(this.value._tag){case"Millis":return{_id:"Duration",_tag:"Millis",millis:this.value.millis};case"Nanos":return{_id:"Duration",_tag:"Nanos",hrtime:Cw(this)};case"Infinity":return{_id:"Duration",_tag:"Infinity"}}},[he](){return this.toJSON()},pipe(){return v(this,arguments)}},Ht=e=>{const t=Object.create(Ow);return Dn(e)?isNaN(e)||e<=0?t.value=Xh:Number.isFinite(e)?Number.isInteger(e)?t.value={_tag:"Millis",millis:e}:t.value={_tag:"Nanos",nanos:BigInt(Math.round(e*1e6))}:t.value=Ew:e<=kw?t.value=Xh:t.value={_tag:"Nanos",nanos:e},t},Qh=e=>K(e,Ba),Iw=Ht(0),qa=e=>Ht(e),Tw=e=>Ht(e*ja),_i=e=>Ht(e),Zh=e=>Ht(e*1e3),$w=e=>Ht(e*6e4),Rw=e=>Ht(e*36e5),Fw=e=>Ht(e*864e5),Nw=e=>Ht(e*6048e5),Va=e=>Aw(e,{onMillis:t=>t,onNanos:t=>Number(t)/1e6}),vw=e=>{const t=Lt(e);switch(t.value._tag){case"Infinity":throw new Error("Cannot convert infinite duration to nanos");case"Nanos":return t.value.nanos;case"Millis":return BigInt(Math.round(t.value.millis*1e6))}},Cw=e=>{const t=Lt(e);switch(t.value._tag){case"Infinity":return[1/0,0];case"Nanos":return[Number(t.value.nanos/Ka),Number(t.value.nanos%Ka)];case"Millis":return[Math.floor(t.value.millis/1e3),Math.round(t.value.millis%1e3*1e6)]}},Aw=h(2,(e,t)=>{const n=Lt(e);switch(n.value._tag){case"Nanos":return t.onNanos(n.value.nanos);case"Infinity":return t.onMillis(1/0);case"Millis":return t.onMillis(n.value.millis)}}),ed=h(3,(e,t,n)=>{const r=Lt(e),s=Lt(t);if(r.value._tag==="Infinity"||s.value._tag==="Infinity")return n.onMillis(Va(r),Va(s));if(r.value._tag==="Nanos"||s.value._tag==="Nanos"){const o=r.value._tag==="Nanos"?r.value.nanos:BigInt(Math.round(r.value.millis*1e6)),i=s.value._tag==="Nanos"?s.value.nanos:BigInt(Math.round(s.value.millis*1e6));return n.onNanos(o,i)}return n.onMillis(r.value.millis,s.value.millis)}),xw=(e,t)=>ed(e,t,{onMillis:(n,r)=>n===r,onNanos:(n,r)=>n===r}),Mw=h(2,(e,t)=>ed(e,t,{onMillis:(n,r)=>n>=r,onNanos:(n,r)=>n>=r})),Pw=h(2,(e,t)=>xw(Lt(e),Lt(t))),Lw=e=>{const t=Lt(e);if(t.value._tag==="Infinity")return{days:1/0,hours:1/0,minutes:1/0,seconds:1/0,millis:1/0,nanos:1/0};const n=vw(t),r=n/Gh,s=r/ja,o=s/bi,i=o/bi,c=i/Hh;return{days:Number(c),hours:Number(i%Hh),minutes:Number(o%bi),seconds:Number(s%bi),millis:Number(r%ja),nanos:Number(n%Gh)}},Dw=e=>{const t=Lt(e);if(t.value._tag==="Infinity")return"Infinity";const n=Lw(t),r=[];return n.days!==0&&r.push(`${n.days}d`),n.hours!==0&&r.push(`${n.hours}h`),n.minutes!==0&&r.push(`${n.minutes}m`),n.seconds!==0&&r.push(`${n.seconds}s`),n.millis!==0&&r.push(`${n.millis}ms`),n.nanos!==0&&r.push(`${n.nanos}ns`),r.join(" ")},se=Vh,q=qh,Uw=mw,Bw=Ua,Ye=jh,gn=Kh,St=h(2,(e,{onLeft:t,onRight:n})=>Ye(e)?t(e.left):n(e.right)),jw=St({onLeft:L,onRight:L}),Kw=h(2,(e,t)=>{if(gn(e))return e.right;throw t(e.left)}),td=e=>e.length>0,qw=(...e)=>e,Vw=h(2,(e,t)=>{const n={...e};for(const r of Jw(e))n[r]=t(e[r],r);return n}),Jw=e=>Object.keys(e),Si=e=>new Array(e),zw=(e,t)=>{const n=Math.max(1,Math.floor(e)),r=new Array(n);for(let s=0;s<n;s++)r[s]=t(s);return r},ge=e=>Array.isArray(e)?e:Array.from(e),Ww=e=>Array.isArray(e)?e:[e],Hw=h(2,(e,{onEmpty:t,onNonEmpty:n})=>Le(e)?n(nt(e),Un(e)):t()),wi=h(2,(e,t)=>[t,...e]),Gw=h(2,(e,t)=>[...e,t]),Ja=h(2,(e,t)=>ge(e).concat(ge(t))),za=Array.isArray,Yw=e=>e.length===0,ki=td,Le=td,nd=(e,t)=>e<0||e>=t.length,Xw=(e,t)=>Math.floor(Math.min(Math.max(0,e),t.length)),Qw=h(2,(e,t)=>{const n=Math.floor(t);return nd(n,e)?O():T(e[n])}),rd=h(2,(e,t)=>{const n=Math.floor(t);if(nd(n,e))throw new Error(`Index ${n} out of bounds`);return e[n]}),js=Qw(0),nt=rd(0),Zw=e=>Le(e)?T(sd(e)):O(),sd=e=>e[e.length-1],Un=e=>e.slice(1),ek=(e,t)=>{let n=0;for(const r of e){if(!t(r,n))break;n++}return n},tk=h(2,(e,t)=>cd(e,ek(e,t))),nk=h(2,(e,t)=>{const n=ge(e);return n.slice(Xw(t,n),n.length)}),od=e=>Array.from(e).reverse(),Ks=h(2,(e,t)=>{const n=Array.from(e);return n.sort(t),n}),id=h(2,(e,t)=>rk(e,t,qw)),rk=h(3,(e,t,n)=>{const r=ge(e),s=ge(t);if(Le(r)&&Le(s)){const o=[n(nt(r),nt(s))],i=Math.min(r.length,s.length);for(let c=1;c<i;c++)o[c]=n(r[c],s[c]);return o}return[]}),sk=va(),cd=h(2,(e,t)=>{const n=Array.from(e),r=Math.floor(t);return Le(n)?r>=1?ok(n,r):[[],n]:[n,[]]}),ok=h(2,(e,t)=>{const n=Math.max(1,Math.floor(t));return n>=e.length?[qs(e),[]]:[wi(e.slice(1,n),nt(e)),e.slice(n)]}),qs=e=>e.slice(),ik=h(3,(e,t,n)=>{const r=ge(e),s=ge(t);return Le(r)?Le(s)?hd(n)(Ja(r,s)):r:s}),Ei=h(2,(e,t)=>ik(e,t,sk)),pn=()=>[],Tt=e=>[e],Bn=h(2,(e,t)=>e.map(t)),ad=h(2,(e,t)=>{if(Yw(e))return[];const n=[];for(let r=0;r<e.length;r++){const s=t(e[r],r);for(let o=0;o<s.length;o++)n.push(s[o])}return n}),ck=ad(L),ud=h(2,(e,t)=>{const n=ge(e),r=[];for(let s=0;s<n.length;s++){const o=t(n[s],s);le(o)&&r.push(o.value)}return r}),ld=h(2,(e,t)=>{const n=ge(e),r=[];for(let s=0;s<n.length;s++)t(n[s],s)&&r.push(n[s]);return r}),Wa=h(3,(e,t,n)=>ge(e).reduce((r,s,o)=>n(r,s,o),t)),fd=(e,t)=>{const n=[];let r=e,s;for(;le(s=t(r));){const[o,i]=s.value;n.push(o),r=i}return n},Ha=fw,hd=h(2,(e,t)=>{const n=ge(e);if(Le(n)){const r=[nt(n)],s=Un(n);for(const o of s)r.every(i=>!t(o,i))&&r.push(o);return r}return[]}),ak=e=>hd(e,va()),wr=h(2,(e,t)=>ge(e).join(t)),dd=Symbol.for("effect/Chunk");function uk(e,t,n,r,s){for(let o=t;o<Math.min(e.length,t+s);o++)n[r+o-t]=e[o];return n}const md=[],lk=(e=>Da((t,n)=>t.length===n.length&&Ut(t).every((r,s)=>e(r,yn(n,s)))))(J),fk={[dd]:{_A:e=>e},toString(){return Ie(this.toJSON())},toJSON(){return{_id:"Chunk",values:Ut(this).map(ye)}},[he](){return this.toJSON()},[H](e){return gd(e)&&lk(this,e)},[G](){return Ee(this,As(Ut(this)))},[Symbol.iterator](){switch(this.backing._tag){case"IArray":return this.backing.array[Symbol.iterator]();case"IEmpty":return md[Symbol.iterator]();default:return Ut(this)[Symbol.iterator]()}},pipe(){return v(this,arguments)}},Ce=e=>{const t=Object.create(fk);switch(t.backing=e,e._tag){case"IEmpty":{t.length=0,t.depth=0,t.left=t,t.right=t;break}case"IConcat":{t.length=e.left.length+e.right.length,t.depth=1+Math.max(e.left.depth,e.right.depth),t.left=e.left,t.right=e.right;break}case"IArray":{t.length=e.array.length,t.depth=0,t.left=Dt,t.right=Dt;break}case"ISingleton":{t.length=1,t.depth=0,t.left=Dt,t.right=Dt;break}case"ISlice":{t.length=e.length,t.depth=e.chunk.depth+1,t.left=Dt,t.right=Dt;break}}return t},gd=e=>K(e,dd),Dt=Ce({_tag:"IEmpty"}),ut=()=>Dt,Ga=(...e)=>e.length===1?De(e[0]):dk(e),De=e=>Ce({_tag:"ISingleton",a:e}),Oi=e=>gd(e)?e:Ce({_tag:"IArray",array:ge(e)}),Ya=(e,t,n)=>{switch(e.backing._tag){case"IArray":{uk(e.backing.array,0,t,n,e.length);break}case"IConcat":{Ya(e.left,t,n),Ya(e.right,t,n+e.left.length);break}case"ISingleton":{t[n]=e.backing.a;break}case"ISlice":{let r=0,s=n;for(;r<e.length;)t[s]=yn(e,r),r+=1,s+=1;break}}},Ut=e=>{switch(e.backing._tag){case"IEmpty":return md;case"IArray":return e.backing.array;default:{const t=new Array(e.length);return Ya(e,t,0),e.backing={_tag:"IArray",array:t},e.left=Dt,e.right=Dt,e.depth=0,t}}},Gt=e=>{switch(e.backing._tag){case"IEmpty":case"ISingleton":return e;case"IArray":return Ce({_tag:"IArray",array:od(e.backing.array)});case"IConcat":return Ce({_tag:"IConcat",left:Gt(e.backing.right),right:Gt(e.backing.left)});case"ISlice":return Vs(od(Ut(e)))}},hk=h(2,(e,t)=>t<0||t>=e.length?O():T(yn(e,t))),Vs=e=>Ce({_tag:"IArray",array:e}),dk=e=>Vs(e),yn=h(2,(e,t)=>{switch(e.backing._tag){case"IEmpty":throw new Error("Index out of bounds");case"ISingleton":{if(t!==0)throw new Error("Index out of bounds");return e.backing.a}case"IArray":{if(t>=e.length||t<0)throw new Error("Index out of bounds");return e.backing.array[t]}case"IConcat":return t<e.left.length?yn(e.left,t):yn(e.right,t-e.left.length);case"ISlice":return yn(e.backing.chunk,t+e.backing.offset)}}),Xa=h(2,(e,t)=>rt(e,De(t))),Xe=h(2,(e,t)=>rt(De(t),e)),Qa=h(2,(e,t)=>{if(t<=0)return e;if(t>=e.length)return Dt;switch(e.backing._tag){case"ISlice":return Ce({_tag:"ISlice",chunk:e.backing.chunk,offset:e.backing.offset+t,length:e.backing.length-t});case"IConcat":return t>e.left.length?Qa(e.right,t-e.left.length):Ce({_tag:"IConcat",left:Qa(e.left,t),right:e.right});default:return Ce({_tag:"ISlice",chunk:e,offset:t,length:e.length-t})}}),rt=h(2,(e,t)=>{if(e.backing._tag==="IEmpty")return t;if(t.backing._tag==="IEmpty")return e;const n=t.depth-e.depth;if(Math.abs(n)<=1)return Ce({_tag:"IConcat",left:e,right:t});if(n<-1)if(e.left.depth>=e.right.depth){const r=rt(e.right,t);return Ce({_tag:"IConcat",left:e.left,right:r})}else{const r=rt(e.right.right,t);if(r.depth===e.depth-3){const s=Ce({_tag:"IConcat",left:e.right.left,right:r});return Ce({_tag:"IConcat",left:e.left,right:s})}else{const s=Ce({_tag:"IConcat",left:e.left,right:e.right.left});return Ce({_tag:"IConcat",left:s,right:r})}}else if(t.right.depth>=t.left.depth){const r=rt(e,t.left);return Ce({_tag:"IConcat",left:r,right:t.right})}else{const r=rt(e,t.left.left);if(r.depth===t.depth-3){const s=Ce({_tag:"IConcat",left:r,right:t.left.right});return Ce({_tag:"IConcat",left:s,right:t.right})}else{const s=Ce({_tag:"IConcat",left:t.left.right,right:t.right});return Ce({_tag:"IConcat",left:r,right:s})}}}),pd=h(2,(e,t)=>Vs(ld(e,t))),Za=e=>e.length===0,Yt=e=>e.length>0,yd=hk(0),bd=e=>yn(e,0),Bt=bd,_d=h(2,(e,t)=>e.backing._tag==="ISingleton"?De(t(e.backing.a,0)):Vs(d(Ut(e),Bn((n,r)=>t(n,r))))),Xt=e=>Qa(e,1),mk=Wa,jn=5,eu=Math.pow(2,jn),gk=eu-1,pk=eu/2,yk=eu/4;function bk(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,e&127}function kr(e,t){return t>>>e&gk}function Er(e){return 1<<e}function Sd(e,t){return bk(e&t-1)}const _k=(e,t)=>({value:e,previous:t});function Or(e,t,n,r){let s=r;if(!e){const o=r.length;s=new Array(o);for(let i=0;i<o;++i)s[i]=r[i]}return s[t]=n,s}function wd(e,t,n){const r=n.length-1;let s=0,o=0,i=n;if(e)s=o=t;else for(i=new Array(r);s<t;)i[o++]=n[s++];for(++s;s<=r;)i[o++]=n[s++];return e&&(i.length=r),i}function Sk(e,t,n,r){const s=r.length;if(e){let a=s;for(;a>=t;)r[a--]=r[a];return r[t]=n,r}let o=0,i=0;const c=new Array(s+1);for(;o<t;)c[i++]=r[o++];for(c[t]=n;o<s;)c[++i]=r[o++];return c}class bn{constructor(){u(this,"_tag","EmptyNode")}modify(t,n,r,s,o,i){const c=r(O());return $e(c)?new bn:(++i.value,new Kn(t,s,o,c))}}function $t(e){return Ta(e,"EmptyNode")}function wk(e){return $t(e)||e._tag==="LeafNode"||e._tag==="CollisionNode"}function Ii(e,t){return $t(e)?!1:t===e.edit}class Kn{constructor(t,n,r,s){u(this,"edit");u(this,"hash");u(this,"key");u(this,"value");u(this,"_tag","LeafNode");this.edit=t,this.hash=n,this.key=r,this.value=s}modify(t,n,r,s,o,i){if(J(o,this.key)){const a=r(this.value);return a===this.value?this:$e(a)?(--i.value,new bn):Ii(this,t)?(this.value=a,this):new Kn(t,s,o,a)}const c=r(O());return $e(c)?this:(++i.value,kd(t,n,this.hash,this,s,new Kn(t,s,o,c)))}}class tu{constructor(t,n,r){u(this,"edit");u(this,"hash");u(this,"children");u(this,"_tag","CollisionNode");this.edit=t,this.hash=n,this.children=r}modify(t,n,r,s,o,i){if(s===this.hash){const a=Ii(this,t),l=this.updateCollisionList(a,t,this.hash,this.children,r,o,i);return l===this.children?this:l.length>1?new tu(t,this.hash,l):l[0]}const c=r(O());return $e(c)?this:(++i.value,kd(t,n,this.hash,this,s,new Kn(t,s,o,c)))}updateCollisionList(t,n,r,s,o,i,c){const a=s.length;for(let f=0;f<a;++f){const m=s[f];if("key"in m&&J(i,m.key)){const g=m.value,p=o(g);return p===g?s:$e(p)?(--c.value,wd(t,f,s)):Or(t,f,new Kn(n,r,i,p),s)}}const l=o(O());return $e(l)?s:(++c.value,Or(t,a,new Kn(n,r,i,l),s))}}class Ir{constructor(t,n,r){u(this,"edit");u(this,"mask");u(this,"children");u(this,"_tag","IndexedNode");this.edit=t,this.mask=n,this.children=r}modify(t,n,r,s,o,i){const c=this.mask,a=this.children,l=kr(n,s),f=Er(l),m=Sd(c,f),g=c&f,p=Ii(this,t);if(!g){const I=new bn().modify(t,n+jn,r,s,o,i);return I?a.length>=pk?Ek(t,l,I,c,a):new Ir(t,c|f,Sk(p,m,I,a)):this}const y=a[m],k=y.modify(t,n+jn,r,s,o,i);if(y===k)return this;let b=c,_;if($t(k)){if(b&=~f,!b)return new bn;if(a.length<=2&&wk(a[m^1]))return a[m^1];_=wd(p,m,a)}else _=Or(p,m,k,a);return p?(this.mask=b,this.children=_,this):new Ir(t,b,_)}}class nu{constructor(t,n,r){u(this,"edit");u(this,"size");u(this,"children");u(this,"_tag","ArrayNode");this.edit=t,this.size=n,this.children=r}modify(t,n,r,s,o,i){let c=this.size;const a=this.children,l=kr(n,s),f=a[l],m=(f||new bn).modify(t,n+jn,r,s,o,i);if(f===m)return this;const g=Ii(this,t);let p;if($t(f)&&!$t(m))++c,p=Or(g,l,m,a);else if(!$t(f)&&$t(m)){if(--c,c<=yk)return kk(t,c,l,a);p=Or(g,l,new bn,a)}else p=Or(g,l,m,a);return g?(this.size=c,this.children=p,this):new nu(t,c,p)}}function kk(e,t,n,r){const s=new Array(t-1);let o=0,i=0;for(let c=0,a=r.length;c<a;++c)if(c!==n){const l=r[c];l&&!$t(l)&&(s[o++]=l,i|=1<<c)}return new Ir(e,i,s)}function Ek(e,t,n,r,s){const o=[];let i=r,c=0;for(let a=0;i;++a)i&1&&(o[a]=s[c++]),i>>>=1;return o[t]=n,new nu(e,c+1,o)}function Ok(e,t,n,r,s,o){if(n===s)return new tu(e,n,[o,r]);const i=kr(t,n),c=kr(t,s);if(i===c)return a=>new Ir(e,Er(i)|Er(c),[a]);{const a=i<c?[r,o]:[o,r];return new Ir(e,Er(i)|Er(c),a)}}function kd(e,t,n,r,s,o){let i,c=t;for(;;){const a=Ok(e,c,n,r,s,o);if(typeof a=="function")i=_k(a,i),c=c+jn;else{let l=a;for(;i!=null;)l=i.value(l),i=i.previous;return l}}}const Ed="effect/HashMap",ru=Symbol.for(Ed),Ik={[ru]:ru,[Symbol.iterator](){return new Ti(this,(e,t)=>[e,t])},[G](){let e=N(Ed);for(const t of this)e^=d(N(t[0]),ee(N(t[1])));return Ee(this,e)},[H](e){if(Rk(e)){if(e._size!==this._size)return!1;for(const t of this){const n=d(e,ou(t[0],N(t[0])));if($e(n))return!1;if(!J(t[1],n.value))return!1}return!0}return!1},toString(){return Ie(this.toJSON())},toJSON(){return{_id:"HashMap",values:Array.from(this).map(ye)}},[he](){return this.toJSON()},pipe(){return v(this,arguments)}},su=(e,t,n,r)=>{const s=Object.create(Ik);return s._editable=e,s._edit=t,s._root=n,s._size=r,s};class Ti{constructor(t,n){u(this,"map");u(this,"f");u(this,"v");this.map=t,this.f=n,this.v=Od(this.map._root,this.f,void 0)}next(){if($e(this.v))return{done:!0,value:void 0};const t=this.v.value;return this.v=$i(t.cont),{done:!1,value:t.value}}[Symbol.iterator](){return new Ti(this.map,this.f)}}const $i=e=>e?Id(e[0],e[1],e[2],e[3],e[4]):O(),Od=(e,t,n=void 0)=>{switch(e._tag){case"LeafNode":return le(e.value)?T({value:t(e.key,e.value.value),cont:n}):$i(n);case"CollisionNode":case"ArrayNode":case"IndexedNode":{const r=e.children;return Id(r.length,r,0,t,n)}default:return $i(n)}},Id=(e,t,n,r,s)=>{for(;n<e;){const o=t[n++];if(o&&!$t(o))return Od(o,r,[e,t,n,r,s])}return $i(s)},Tk=su(!1,0,new bn,0),Ri=()=>Tk,$k=e=>{const t=$d(Ri());for(const n of e)Js(t,n[0],n[1]);return Ak(t)},Rk=e=>K(e,ru),Fk=e=>e&&$t(e._root),Nk=h(2,(e,t)=>ou(e,t,N(t))),ou=h(3,(e,t,n)=>{let r=e._root,s=0;for(;;)switch(r._tag){case"LeafNode":return J(t,r.key)?r.value:O();case"CollisionNode":{if(n===r.hash){const o=r.children;for(let i=0,c=o.length;i<c;++i){const a=o[i];if("key"in a&&J(t,a.key))return a.value}}return O()}case"IndexedNode":{const o=kr(s,n),i=Er(o);if(r.mask&i){r=r.children[Sd(r.mask,i)],s+=jn;break}return O()}case"ArrayNode":{if(r=r.children[kr(s,n)],r){s+=jn;break}return O()}default:return O()}}),vk=h(2,(e,t)=>le(ou(e,t,N(t)))),Js=h(3,(e,t,n)=>iu(e,t,()=>T(n))),Ck=h(3,(e,t,n)=>e._editable?(e._root=t,e._size=n,e):t===e._root?e:su(e._editable,e._edit,t,n)),Td=e=>new Ti(e,t=>t),Fi=e=>e._size,$d=e=>su(!0,e._edit+1,e._root,e._size),Ak=e=>(e._editable=!1,e),iu=h(3,(e,t,n)=>xk(e,t,N(t),n)),xk=h(4,(e,t,n,r)=>{const s={value:e._size},o=e._root.modify(e._editable?e._edit:NaN,0,r,n,t,s);return d(e,Ck(o,s.value))}),Rd=h(2,(e,t)=>iu(e,t,O)),Mk=h(2,(e,t)=>Ni(e,Ri(),(n,r,s)=>Js(n,s,t(r,s)))),Fd=h(2,(e,t)=>Ni(e,void 0,(n,r,s)=>t(r,s))),Ni=h(3,(e,t,n)=>{const r=e._root;if(r._tag==="LeafNode")return le(r.value)?n(t,r.value.value,r.key):t;if(r._tag==="EmptyNode")return t;const s=[r.children];let o;for(;o=s.pop();)for(let i=0,c=o.length;i<c;){const a=o[i++];a&&!$t(a)&&(a._tag==="LeafNode"?le(a.value)&&(t=n(t,a.value.value,a.key)):s.push(a.children))}return t}),Nd="effect/HashSet",cu=Symbol.for(Nd),Pk={[cu]:cu,[Symbol.iterator](){return Td(this._keyMap)},[G](){return Ee(this,ee(N(this._keyMap))(N(Nd)))},[H](e){return Lk(e)?Fi(this._keyMap)===Fi(e._keyMap)&&J(this._keyMap,e._keyMap):!1},toString(){return Ie(this.toJSON())},toJSON(){return{_id:"HashSet",values:Array.from(this).map(ye)}},[he](){return this.toJSON()},pipe(){return v(this,arguments)}},vi=e=>{const t=Object.create(Pk);return t._keyMap=e,t},Lk=e=>K(e,cu),Dk=vi(Ri()),Ci=()=>Dk,Uk=e=>{const t=au(Ci());for(const n of e)zs(t,n);return uu(t)},Bk=(...e)=>{const t=au(Ci());for(const n of e)zs(t,n);return uu(t)},jk=h(2,(e,t)=>vk(e._keyMap,t)),Kk=e=>Fi(e._keyMap),au=e=>vi($d(e._keyMap)),uu=e=>(e._keyMap._editable=!1,e),vd=h(2,(e,t)=>{const n=au(e);return t(n),uu(n)}),zs=h(2,(e,t)=>e._keyMap._editable?(Js(t,!0)(e._keyMap),e):vi(Js(t,!0)(e._keyMap))),Cd=h(2,(e,t)=>e._keyMap._editable?(Rd(t)(e._keyMap),e):vi(Rd(t)(e._keyMap))),qk=h(2,(e,t)=>vd(e,n=>{for(const r of t)Cd(n,r)})),Vk=h(2,(e,t)=>vd(Ci(),n=>{Jk(e,r=>zs(n,r));for(const r of t)zs(n,r)})),Jk=h(2,(e,t)=>Fd(e._keyMap,(n,r)=>t(r))),zk=h(3,(e,t,n)=>Ni(e._keyMap,t,(r,s,o)=>n(r,o))),qn=Ci,Wk=Uk,lu=Bk,Hk=jk,Ad=Kk,Tr=zs,fu=Cd,xd=qk,Ws=Vk,Ai=zk,Md=Symbol.for("effect/MutableRef"),Gk={[Md]:Md,toString(){return Ie(this.toJSON())},toJSON(){return{_id:"MutableRef",current:ye(this.current)}},[he](){return this.toJSON()},pipe(){return v(this,arguments)}},Hs=e=>{const t=Object.create(Gk);return t.current=e,t},Yk=h(3,(e,t,n)=>J(t,e.current)?(e.current=n,!0):!1),xe=e=>e.current,Gs=h(2,(e,t)=>(e.current=t,e)),xi="effect/FiberId",Vn=Symbol.for(xi),$r="None",hu="Runtime",du="Composite",Xk=ve(`${xi}-${$r}`);let Qk=class{constructor(){u(this,b3,Vn);u(this,"_tag",$r);u(this,"id",-1);u(this,"startTimeMillis",-1)}[(b3=Vn,G)](){return Xk}[H](t){return mu(t)&&t._tag===$r}toString(){return Ie(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag}}[he](){return this.toJSON()}};class Zk{constructor(t,n){u(this,"id");u(this,"startTimeMillis");u(this,_3,Vn);u(this,"_tag",hu);this.id=t,this.startTimeMillis=n}[(_3=Vn,G)](){return Ee(this,ve(`${xi}-${this._tag}-${this.id}-${this.startTimeMillis}`))}[H](t){return mu(t)&&t._tag===hu&&this.id===t.id&&this.startTimeMillis===t.startTimeMillis}toString(){return Ie(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,id:this.id,startTimeMillis:this.startTimeMillis}}[he](){return this.toJSON()}}let eE=class{constructor(t,n){u(this,"left");u(this,"right");u(this,S3,Vn);u(this,"_tag",du);u(this,"_hash");this.left=t,this.right=n}[(S3=Vn,G)](){return d(ve(`${xi}-${this._tag}`),ee(N(this.left)),ee(N(this.right)),Ee(this))}[H](t){return mu(t)&&t._tag===du&&J(this.left,t.left)&&J(this.right,t.right)}toString(){return Ie(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,left:ye(this.left),right:ye(this.right)}}[he](){return this.toJSON()}};const tE=new Qk,mu=e=>K(e,Vn),nE=h(2,(e,t)=>e._tag===$r?t:t._tag===$r?e:new eE(e,t)),gu=e=>{switch(e._tag){case $r:return qn();case hu:return lu(e.id);case du:return d(gu(e.left),Ws(gu(e.right)))}},Pd=W(Symbol.for("effect/Fiber/Id/_fiberCounter"),()=>Hs(0)),Ld=e=>Array.from(gu(e)).map(n=>`#${n}`).join(","),rE=()=>{const e=xe(Pd);return d(Pd,Gs(e+1)),new Zk(e,Date.now())},Jn=tE,sE=nE,oE=Ld,Dd=rE,Mi=Ri,iE=$k,cE=Fk,Ud=Nk,Bd=Js,jd=Td,aE=Fi,uE=iu,lE=Mk,fE=Fd,Kd=Ni,Ys=Symbol.for("effect/List"),pu=e=>ge(e),hE=(e=>lw(Ha(e),pu))(J),dE={[Ys]:Ys,_tag:"Cons",toString(){return Ie(this.toJSON())},toJSON(){return{_id:"List",_tag:"Cons",values:pu(this).map(ye)}},[he](){return this.toJSON()},[H](e){return Vd(e)&&this._tag===e._tag&&hE(this,e)},[G](){return Ee(this,As(pu(this)))},[Symbol.iterator](){let e=!1,t=this;return{next(){if(e)return this.return();if(t._tag==="Nil")return e=!0,this.return();const n=t.head;return t=t.tail,{done:e,value:n}},return(n){return e||(e=!0),{done:!0,value:n}}}},pipe(){return v(this,arguments)}},Pi=(e,t)=>{const n=Object.create(dE);return n.head=e,n.tail=t,n},mE=ve("Nil"),gE={[Ys]:Ys,_tag:"Nil",toString(){return Ie(this.toJSON())},toJSON(){return{_id:"List",_tag:"Nil"}},[he](){return this.toJSON()},[G](){return mE},[H](e){return Vd(e)&&this._tag===e._tag},[Symbol.iterator](){return{next(){return{done:!0,value:void 0}}}},pipe(){return v(this,arguments)}},qd=Object.create(gE),Vd=e=>K(e,Ys),Qt=e=>e._tag==="Nil",Jd=e=>e._tag==="Cons",pE=()=>qd,zn=(e,t)=>Pi(e,t),Rr=pE,yu=e=>Pi(e,qd),yE=h(2,(e,t)=>_E(t,e)),bE=h(2,(e,t)=>zn(t,e)),_E=h(2,(e,t)=>{if(Qt(e))return t;if(Qt(t))return e;{const n=Pi(t.head,e);let r=n,s=t.tail;for(;!Qt(s);){const o=Pi(s.head,e);r.tail=o,r=o,s=s.tail}return n}}),SE=h(3,(e,t,n)=>{let r=t,s=e;for(;!Qt(s);)r=n(r,s.head),s=s.tail;return r}),wE=e=>{let t=Rr(),n=e;for(;!Qt(n);)t=bE(t,n.head),n=n.tail;return t},bu=function(){function e(t){t&&Object.assign(this,t)}return e.prototype=xa,e}(),kE=Symbol.for("effect/DifferContextPatch");function zd(e){return e}const Xs={...bu.prototype,[kE]:{_Value:zd,_Patch:zd}},EE=Object.create(Object.assign(Object.create(Xs),{_tag:"Empty"})),Wd=()=>EE,OE=Object.assign(Object.create(Xs),{_tag:"AndThen"}),IE=(e,t)=>{const n=Object.create(OE);return n.first=e,n.second=t,n},TE=Object.assign(Object.create(Xs),{_tag:"AddService"}),$E=(e,t)=>{const n=Object.create(TE);return n.key=e,n.service=t,n},RE=Object.assign(Object.create(Xs),{_tag:"RemoveService"}),FE=e=>{const t=Object.create(RE);return t.key=e,t},NE=Object.assign(Object.create(Xs),{_tag:"UpdateService"}),vE=(e,t)=>{const n=Object.create(NE);return n.key=e,n.update=t,n},CE=(e,t)=>{const n=new Map(e.unsafeMap);let r=Wd();for(const[s,o]of t.unsafeMap.entries())if(n.has(s)){const i=n.get(s);n.delete(s),J(i,o)||(r=Li(vE(s,()=>o))(r))}else n.delete(s),r=Li($E(s,o))(r);for(const[s]of n.entries())r=Li(FE(s))(r);return r},Li=h(2,(e,t)=>IE(e,t)),AE=h(2,(e,t)=>{if(e._tag==="Empty")return t;let n=!1,r=De(e);const s=new Map(t.unsafeMap);for(;Yt(r);){const i=Bt(r),c=Xt(r);switch(i._tag){case"Empty":{r=c;break}case"AddService":{s.set(i.key,i.service),r=c;break}case"AndThen":{r=Xe(Xe(c,i.second),i.first);break}case"RemoveService":{s.delete(i.key),r=c;break}case"UpdateService":{s.set(i.key,i.update(s.get(i.key))),n=!0,r=c;break}}}if(!n)return _r(s);const o=new Map;for(const[i]of t.unsafeMap)s.has(i)&&(o.set(i,s.get(i)),s.delete(i));for(const[i,c]of s)o.set(i,c);return _r(o)}),xE=Symbol.for("effect/DifferHashSetPatch");function _u(e){return e}const Di={...bu.prototype,[xE]:{_Value:_u,_Key:_u,_Patch:_u}},ME=Object.create(Object.assign(Object.create(Di),{_tag:"Empty"})),Hd=()=>ME,PE=Object.assign(Object.create(Di),{_tag:"AndThen"}),LE=(e,t)=>{const n=Object.create(PE);return n.first=e,n.second=t,n},DE=Object.assign(Object.create(Di),{_tag:"Add"}),UE=e=>{const t=Object.create(DE);return t.value=e,t},BE=Object.assign(Object.create(Di),{_tag:"Remove"}),jE=e=>{const t=Object.create(BE);return t.value=e,t},KE=(e,t)=>{const[n,r]=Ai([e,Hd()],([s,o],i)=>Hk(i)(s)?[fu(i)(s),o]:[s,Su(UE(i))(o)])(t);return Ai(r,(s,o)=>Su(jE(o))(s))(n)},Su=h(2,(e,t)=>LE(e,t)),qE=h(2,(e,t)=>{if(e._tag==="Empty")return t;let n=t,r=De(e);for(;Yt(r);){const s=Bt(r),o=Xt(r);switch(s._tag){case"Empty":{r=o;break}case"AndThen":{r=Xe(s.first)(Xe(s.second)(o));break}case"Add":{n=Tr(s.value)(n),r=o;break}case"Remove":n=fu(s.value)(n),r=o}}return n}),VE=Symbol.for("effect/DifferReadonlyArrayPatch");function Gd(e){return e}const Qs={...bu.prototype,[VE]:{_Value:Gd,_Patch:Gd}},JE=Object.create(Object.assign(Object.create(Qs),{_tag:"Empty"})),Yd=()=>JE,zE=Object.assign(Object.create(Qs),{_tag:"AndThen"}),WE=(e,t)=>{const n=Object.create(zE);return n.first=e,n.second=t,n},HE=Object.assign(Object.create(Qs),{_tag:"Append"}),GE=e=>{const t=Object.create(HE);return t.values=e,t},YE=Object.assign(Object.create(Qs),{_tag:"Slice"}),XE=(e,t)=>{const n=Object.create(YE);return n.from=e,n.until=t,n},QE=Object.assign(Object.create(Qs),{_tag:"Update"}),ZE=(e,t)=>{const n=Object.create(QE);return n.index=e,n.patch=t,n},e1=e=>{let t=0,n=Yd();for(;t<e.oldValue.length&&t<e.newValue.length;){const r=e.oldValue[t],s=e.newValue[t],o=e.differ.diff(r,s);J(o,e.differ.empty)||(n=Ui(n,ZE(t,o))),t=t+1}return t<e.oldValue.length&&(n=Ui(n,XE(0,t))),t<e.newValue.length&&(n=Ui(n,GE(nk(t)(e.newValue)))),n},Ui=h(2,(e,t)=>WE(e,t)),t1=h(3,(e,t,n)=>{if(e._tag==="Empty")return t;let r=t.slice(),s=Tt(e);for(;ki(s);){const o=nt(s),i=Un(s);switch(o._tag){case"Empty":{s=i;break}case"AndThen":{i.unshift(o.first,o.second),s=i;break}case"Append":{for(const c of o.values)r.push(c);s=i;break}case"Slice":{r=r.slice(o.from,o.until),s=i;break}case"Update":{r[o.index]=n.patch(o.patch,r[o.index]),s=i;break}}}return r}),n1={[Symbol.for("effect/Differ")]:{_P:L,_V:L}},Fr=e=>{const t=Object.create(n1);return t.empty=e.empty,t.diff=e.diff,t.combine=e.combine,t.patch=e.patch,t},r1=()=>Fr({empty:Wd(),combine:(e,t)=>Li(t)(e),diff:(e,t)=>CE(e,t),patch:(e,t)=>AE(t)(e)}),s1=()=>Fr({empty:Hd(),combine:(e,t)=>Su(t)(e),diff:(e,t)=>KE(e,t),patch:(e,t)=>qE(t)(e)}),o1=e=>Fr({empty:Yd(),combine:(t,n)=>Ui(t,n),diff:(t,n)=>e1({oldValue:t,newValue:n,differ:e}),patch:(t,n)=>t1(t,n,e)}),Xd=()=>i1((e,t)=>t),i1=e=>Fr({empty:L,combine:(t,n)=>t===L?n:n===L?t:r=>n(t(r)),diff:(t,n)=>J(t,n)?L:Ln(n),patch:(t,n)=>e(n,t(n))}),Zs=255,Qd=8,wu=e=>e&Zs,ku=e=>e>>Qd&Zs,eo=(e,t)=>(e&Zs)+((t&e&Zs)<<Qd),c1=eo(0,0),a1=e=>eo(e,e),u1=e=>eo(e,0),l1=h(2,(e,t)=>eo(wu(e)&~t,ku(e))),f1=h(2,(e,t)=>e|t),h1=e=>~e>>>0&Zs,d1=0,Nr=1,m1=2,Zd=4,Eu=16,em=32,g1=e=>Bi(e,em),p1=h(2,(e,t)=>e|t),_n=e=>tm(e)&&!b1(e),tm=e=>Bi(e,Nr),Bi=h(2,(e,t)=>(e&t)!==0),nm=(...e)=>e.reduce((t,n)=>t|n,0),y1=nm(d1),rm=e=>Bi(e,Zd),b1=e=>Bi(e,Eu),Sn=h(2,(e,t)=>eo(e^t,t)),vr=h(2,(e,t)=>e&(h1(wu(t))|ku(t))|wu(t)&ku(t)),sm=Fr({empty:c1,diff:(e,t)=>Sn(e,t),combine:(e,t)=>f1(t)(e),patch:(e,t)=>vr(t,e)}),_1=a1,om=u1,im=l1,cm=(e,t)=>({_tag:"Par",left:e,right:t}),ji=(e,t)=>({_tag:"Seq",left:e,right:t}),S1=e=>{let t=yu(e),n=Rr();for(;;){const[r,s]=SE(t,[am(),Rr()],([o,i],c)=>{const[a,l]=w1(c);return[T1(o,a),yE(i,l)]});if(n=k1(n,r),Qt(s))return wE(n);t=s}throw new Error("BUG: BlockedRequests.flatten - please report an issue at https://github.com/Effect-TS/effect/issues")},w1=e=>{let t=e,n=am(),r=Rr(),s=Rr();for(;;)switch(t._tag){case"Empty":{if(Qt(r))return[n,s];t=r.head,r=r.tail;break}case"Par":{r=zn(t.right,r),t=t.left;break}case"Seq":{const o=t.left,i=t.right;switch(o._tag){case"Empty":{t=i;break}case"Par":{const c=o.left,a=o.right;t=cm(ji(c,i),ji(a,i));break}case"Seq":{const c=o.left,a=o.right;t=ji(c,ji(a,i));break}case"Single":{t=o,s=zn(i,s);break}}break}case"Single":{if(n=I1(n,t),Qt(r))return[n,s];t=r.head,r=r.tail;break}}throw new Error("BUG: BlockedRequests.step - please report an issue at https://github.com/Effect-TS/effect/issues")},k1=(e,t)=>{if(Qt(e))return yu(Iu(t));if($1(t))return e;const n=A1(e.head),r=R1(t);return n.length===1&&r.length===1&&J(n[0],r[0])?zn(C1(e.head,Iu(t)),e.tail):zn(Iu(t),e)},E1=Symbol.for("effect/RequestBlock/RequestBlockParallel"),O1={_R:e=>e};class Ou{constructor(t){u(this,"map");u(this,w3,O1);this.map=t}}w3=E1;const am=()=>new Ou(Mi()),I1=(e,t)=>new Ou(uE(e.map,t.dataSource,n=>yw(Bs(n,Xa(t.blockedRequest)),()=>De(t.blockedRequest)))),T1=(e,t)=>new Ou(Kd(e.map,t.map,(n,r,s)=>Bd(n,s,Ke(Ud(n,s),{onNone:()=>r,onSome:o=>rt(r,o)})))),$1=e=>cE(e.map),R1=e=>Array.from(jd(e.map)),Iu=e=>v1(lE(e.map,t=>De(t))),F1=Symbol.for("effect/RequestBlock/RequestBlockSequential"),N1={_R:e=>e};class um{constructor(t){u(this,"map");u(this,k3,N1);this.map=t}}k3=F1;const v1=e=>new um(e),C1=(e,t)=>new um(Kd(t.map,e.map,(n,r,s)=>Bd(n,s,Ke(Ud(n,s),{onNone:()=>ut(),onSome:o=>rt(o,r)})))),A1=e=>Array.from(jd(e.map)),x1=e=>Array.from(e.map),Cr="Die",Ar="Empty",xr="Fail",Mr="Interrupt",Pr="Parallel",Lr="Sequential",lm="effect/Cause",fm=Symbol.for(lm),M1={_E:e=>e},Dr={[fm]:M1,[G](){return d(N(lm),ee(N(z1(this))),Ee(this))},[H](e){return hm(e)&&J1(this,e)},pipe(){return v(this,arguments)},toJSON(){switch(this._tag){case"Empty":return{_id:"Cause",_tag:this._tag};case"Die":return{_id:"Cause",_tag:this._tag,defect:ye(this.defect)};case"Interrupt":return{_id:"Cause",_tag:this._tag,fiberId:this.fiberId.toJSON()};case"Fail":return{_id:"Cause",_tag:this._tag,failure:ye(this.error)};case"Sequential":case"Parallel":return{_id:"Cause",_tag:this._tag,left:ye(this.left),right:ye(this.right)}}},toString(){return Vi(this)},[he](){return this.toJSON()}},Wn=(()=>{const e=Object.create(Dr);return e._tag=Ar,e})(),Hn=e=>{const t=Object.create(Dr);return t._tag=xr,t.error=e,t},st=e=>{const t=Object.create(Dr);return t._tag=Cr,t.defect=e,t},Rt=e=>{const t=Object.create(Dr);return t._tag=Mr,t.fiberId=e,t},Zt=(e,t)=>{const n=Object.create(Dr);return n._tag=Pr,n.left=e,n.right=t,n},qe=(e,t)=>{const n=Object.create(Dr);return n._tag=Lr,n.left=e,n.right=t,n},hm=e=>K(e,fm),dm=e=>e._tag===Cr,P1=e=>e._tag===Ar?!0:Ur(e,!0,(t,n)=>{switch(n._tag){case Ar:return T(t);case Cr:case xr:case Mr:return T(!1);default:return O()}}),mm=e=>le(B1(e)),Tu=e=>Fu(void 0,H1)(e),L1=e=>Gt(Ur(e,ut(),(t,n)=>n._tag===xr?T(d(t,Xe(n.error))):O())),gm=e=>Gt(Ur(e,ut(),(t,n)=>n._tag===Cr?T(d(t,Xe(n.defect))):O())),D1=e=>Ur(e,qn(),(t,n)=>n._tag===Mr?T(d(t,Tr(n.fiberId))):O()),U1=e=>Ki(e,t=>t._tag===xr?T(t.error):O()),$u=e=>{const t=U1(e);switch(t._tag){case"None":return se(e);case"Some":return q(t.value)}},B1=e=>Ki(e,t=>t._tag===Mr?T(t.fiberId):O()),j1=e=>qi(e,{onEmpty:O(),onFail:t=>T(st(t)),onDie:t=>T(st(t)),onInterrupt:()=>O(),onSequential:(t,n)=>le(t)&&le(n)?T(qe(t.value,n.value)):le(t)&&$e(n)?T(t.value):$e(t)&&le(n)?T(n.value):O(),onParallel:(t,n)=>le(t)&&le(n)?T(Zt(t.value,n.value)):le(t)&&$e(n)?T(t.value):$e(t)&&le(n)?T(n.value):O()}),pm=e=>qi(e,{onEmpty:Wn,onFail:()=>Wn,onDie:t=>st(t),onInterrupt:t=>Rt(t),onSequential:qe,onParallel:Zt}),K1=e=>qi(e,{onEmpty:Wn,onFail:t=>st(t),onDie:t=>st(t),onInterrupt:t=>Rt(t),onSequential:(t,n)=>qe(t,n),onParallel:(t,n)=>Zt(t,n)}),q1=h(2,(e,t)=>V1(e,n=>Hn(t(n)))),V1=h(2,(e,t)=>qi(e,{onEmpty:Wn,onFail:n=>t(n),onDie:n=>st(n),onInterrupt:n=>Rt(n),onSequential:(n,r)=>qe(n,r),onParallel:(n,r)=>Zt(n,r)})),J1=(e,t)=>{let n=De(e),r=De(t);for(;Yt(n)&&Yt(r);){const[s,o]=d(Bt(n),Ur([qn(),ut()],([a,l],f)=>{const[m,g]=Ru(f);return T([d(a,Ws(m)),d(l,rt(g))])})),[i,c]=d(Bt(r),Ur([qn(),ut()],([a,l],f)=>{const[m,g]=Ru(f);return T([d(a,Ws(m)),d(l,rt(g))])}));if(!J(s,i))return!1;n=o,r=c}return!0},z1=e=>W1(De(e),ut()),W1=(e,t)=>{for(;;){const[n,r]=d(e,Wa([qn(),ut()],([o,i],c)=>{const[a,l]=Ru(c);return[d(o,Ws(a)),d(i,rt(l))]})),s=Ad(n)>0?d(t,Xe(n)):t;if(Za(r))return Gt(s);e=r,t=s}throw new Error(si("Cause.flattenCauseLoop"))},Ki=h(2,(e,t)=>{const n=[e];for(;n.length>0;){const r=n.pop(),s=t(r);switch(s._tag){case"None":{switch(r._tag){case Lr:case Pr:{n.push(r.right),n.push(r.left);break}}break}case"Some":return s}}return O()}),Ru=e=>{let t=e;const n=[];let r=qn(),s=ut();for(;t!==void 0;)switch(t._tag){case Ar:{if(n.length===0)return[r,s];t=n.pop();break}case xr:{if(r=Tr(r,Ga(t._tag,t.error)),n.length===0)return[r,s];t=n.pop();break}case Cr:{if(r=Tr(r,Ga(t._tag,t.defect)),n.length===0)return[r,s];t=n.pop();break}case Mr:{if(r=Tr(r,Ga(t._tag,t.fiberId)),n.length===0)return[r,s];t=n.pop();break}case Lr:{switch(t.left._tag){case Ar:{t=t.right;break}case Lr:{t=qe(t.left.left,qe(t.left.right,t.right));break}case Pr:{t=Zt(qe(t.left.left,t.right),qe(t.left.right,t.right));break}default:{s=Xe(s,t.right),t=t.left;break}}break}case Pr:{n.push(t.right),t=t.left;break}}throw new Error(si("Cause.evaluateCauseLoop"))},H1={emptyCase:Sh,failCase:ei,dieCase:ei,interruptCase:Sh,sequentialCase:(e,t,n)=>t&&n,parallelCase:(e,t,n)=>t&&n},ym="SequentialCase",bm="ParallelCase",qi=h(2,(e,{onDie:t,onEmpty:n,onFail:r,onInterrupt:s,onParallel:o,onSequential:i})=>Fu(e,void 0,{emptyCase:()=>n,failCase:(c,a)=>r(a),dieCase:(c,a)=>t(a),interruptCase:(c,a)=>s(a),sequentialCase:(c,a,l)=>i(a,l),parallelCase:(c,a,l)=>o(a,l)})),Ur=h(3,(e,t,n)=>{let r=t,s=e;const o=[];for(;s!==void 0;){const i=n(r,s);switch(r=le(i)?i.value:r,s._tag){case Lr:{o.push(s.right),s=s.left;break}case Pr:{o.push(s.right),s=s.left;break}default:{s=void 0;break}}s===void 0&&o.length>0&&(s=o.pop())}return r}),Fu=h(3,(e,t,n)=>{const r=[e],s=[];for(;r.length>0;){const i=r.pop();switch(i._tag){case Ar:{s.push(se(n.emptyCase(t)));break}case xr:{s.push(se(n.failCase(t,i.error)));break}case Cr:{s.push(se(n.dieCase(t,i.defect)));break}case Mr:{s.push(se(n.interruptCase(t,i.fiberId)));break}case Lr:{r.push(i.right),r.push(i.left),s.push(q({_tag:ym}));break}case Pr:{r.push(i.right),r.push(i.left),s.push(q({_tag:bm}));break}}}const o=[];for(;s.length>0;){const i=s.pop();switch(i._tag){case"Left":{switch(i.left._tag){case ym:{const c=o.pop(),a=o.pop(),l=n.sequentialCase(t,c,a);o.push(l);break}case bm:{const c=o.pop(),a=o.pop(),l=n.parallelCase(t,c,a);o.push(l);break}}break}case"Right":{o.push(i.right);break}}}if(o.length===0)throw new Error("BUG: Cause.reduceWithContext - please report an issue at https://github.com/Effect-TS/effect/issues");return o.pop()}),Vi=(e,t)=>Tu(e)?"All fibers interrupted without errors.":wm(e).map(function(n){return(t==null?void 0:t.renderErrorCause)!==!0||n.cause===void 0?n.stack:`${n.stack} {
${_m(n.cause,"  ")}
}`}).join(`
`),_m=(e,t)=>{const n=e.stack.split(`
`);let r=`${t}[cause]: ${n[0]}`;for(let s=1,o=n.length;s<o;s++)r+=`
${t}${n[s]}`;return e.cause&&(r+=` {
${_m(e.cause,`${t}  `)}
${t}}`),r};class Ji extends globalThis.Error{constructor(n){const r=typeof n=="object"&&n!==null,s=Error.stackTraceLimit;Error.stackTraceLimit=1;super(G1(n),r&&"cause"in n&&typeof n.cause<"u"?{cause:new Ji(n.cause)}:void 0);u(this,"span");this.message===""&&(this.message="An error has occurred"),Error.stackTraceLimit=s,this.name=n instanceof Error?n.name:"Error",r&&(Sm in n&&(this.span=n[Sm]),Object.keys(n).forEach(o=>{o in this||(this[o]=n[o])})),this.stack=X1(`${this.name}: ${this.message}`,n instanceof Error&&n.stack?n.stack:"",this.span)}}const G1=e=>{if(typeof e=="string")return e;if(typeof e=="object"&&e!==null&&e instanceof Error)return e.message;try{if(K(e,"toString")&&vs(e.toString)&&e.toString!==Object.prototype.toString&&e.toString!==globalThis.Array.prototype.toString)return e.toString()}catch{}return JSON.stringify(e)},Y1=/\((.*)\)/,zi=W("effect/Tracer/spanToTrace",()=>new WeakMap),X1=(e,t,n)=>{const r=[e],s=t.startsWith(e)?t.slice(e.length).split(`
`):t.split(`
`);for(let o=1;o<s.length&&!s[o].includes("Generator.next");o++){if(s[o].includes("effect_internal_function")){r.pop();break}r.push(s[o].replace(/at .*effect_instruction_i.*\((.*)\)/,"at $1").replace(/EffectPrimitive\.\w+/,"<anonymous>"))}if(n){let o=n,i=0;for(;o&&o._tag==="Span"&&i<10;){const c=zi.get(o);if(typeof c=="function"){const a=c();if(typeof a=="string"){const l=a.match(Y1),f=l?l[1]:a.replace(/^at /,"");r.push(`    at ${o.name} (${f})`)}else r.push(`    at ${o.name}`)}else r.push(`    at ${o.name}`);o=Wt(o.parent),i++}}return r.join(`
`)},Sm=Symbol.for("effect/SpanAnnotation"),wm=e=>Fu(e,void 0,{emptyCase:()=>[],dieCase:(t,n)=>[new Ji(n)],failCase:(t,n)=>[new Ji(n)],interruptCase:()=>[],parallelCase:(t,n,r)=>[...n,...r],sequentialCase:(t,n,r)=>[...n,...r]}),to="Pending",Wi="Done",Q1=Symbol.for("effect/Deferred"),Z1={_E:e=>e,_A:e=>e},eO=e=>({_tag:to,joiners:e}),km=e=>({_tag:Wi,effect:e});class Br{constructor(t){u(this,"self");u(this,"called",!1);this.self=t}next(t){return this.called?{value:t,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(t){return{value:t,done:!0}}throw(t){throw t}[Symbol.iterator](){return new Br(this.self)}}const Nu=Symbol.for("effect/EffectError"),tO=e=>K(e,Nu),nO=e=>({[Nu]:Nu,_tag:"EffectError",cause:e}),Em=(e,t)=>{const n=new Ue("Blocked");return n.effect_instruction_i0=e,n.effect_instruction_i1=t,n},rO=e=>{const t=new Ue("RunBlocked");return t.effect_instruction_i0=e,t},jr=Symbol.for("effect/Effect");class sO{constructor(t,n){u(this,"patch");u(this,"op");u(this,"_op",Aa);this.patch=t,this.op=n}}class Ue{constructor(t){u(this,"_op");u(this,"effect_instruction_i0");u(this,"effect_instruction_i1");u(this,"effect_instruction_i2");u(this,"trace");u(this,E3,pr);this._op=t}[(E3=jr,H)](t){return this===t}[G](){return Ee(this,Fa(this))}pipe(){return v(this,arguments)}toJSON(){return{_id:"Effect",_op:this._op,effect_instruction_i0:ye(this.effect_instruction_i0),effect_instruction_i1:ye(this.effect_instruction_i1),effect_instruction_i2:ye(this.effect_instruction_i2)}}toString(){return Ie(this.toJSON())}[he](){return this.toJSON()}[Symbol.iterator](){return new Br(new Cs(this))}}class Om{constructor(t){u(this,"_op");u(this,"effect_instruction_i0");u(this,"effect_instruction_i1");u(this,"effect_instruction_i2");u(this,"trace");u(this,O3,pr);this._op=t,this._tag=t}[(O3=jr,H)](t){return qu(t)&&t._op==="Failure"&&J(this.effect_instruction_i0,t.effect_instruction_i0)}[G](){return d(ve(this._tag),ee(N(this.effect_instruction_i0)),Ee(this))}get cause(){return this.effect_instruction_i0}pipe(){return v(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,cause:this.cause.toJSON()}}toString(){return Ie(this.toJSON())}[he](){return this.toJSON()}[Symbol.iterator](){return new Br(new Cs(this))}}class Im{constructor(t){u(this,"_op");u(this,"effect_instruction_i0");u(this,"effect_instruction_i1");u(this,"effect_instruction_i2");u(this,"trace");u(this,I3,pr);this._op=t,this._tag=t}[(I3=jr,H)](t){return qu(t)&&t._op==="Success"&&J(this.effect_instruction_i0,t.effect_instruction_i0)}[G](){return d(ve(this._tag),ee(N(this.effect_instruction_i0)),Ee(this))}get value(){return this.effect_instruction_i0}pipe(){return v(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,value:ye(this.value)}}toString(){return Ie(this.toJSON())}[he](){return this.toJSON()}[Symbol.iterator](){return new Br(new Cs(this))}}const wn=e=>K(e,jr),oe=e=>{const t=new Ue($h);return t.effect_instruction_i0=e,t},Tm=h(3,(e,t,n)=>kt(r=>w(e,s=>w(kn(te(()=>r(t(s)))),o=>te(()=>n(s,o)).pipe(lt({onFailure:i=>{switch(o._tag){case Me:return Se(Zt(o.effect_instruction_i0,i));case Pe:return Se(i)}},onSuccess:()=>o})))))),Ve=h(2,(e,t)=>w(e,()=>R(t))),wt=e=>Ve(e,void 0),$m=function(){const e=new Ue(Ca);switch(arguments.length){case 2:{e.effect_instruction_i0=arguments[0],e.commit=arguments[1];break}case 3:{e.effect_instruction_i0=arguments[0],e.effect_instruction_i1=arguments[1],e.commit=arguments[2];break}case 4:{e.effect_instruction_i0=arguments[0],e.effect_instruction_i1=arguments[1],e.effect_instruction_i2=arguments[2],e.commit=arguments[3];break}default:throw new Error(si("you're not supposed to end up here"))}return e},oO=(e,t=Jn)=>{const n=new Ue(Ms);let r;return n.effect_instruction_i0=s=>{r=e(s)},n.effect_instruction_i1=t,ec(n,s=>wn(r)?r:we)},et=(e,t=Jn)=>$m(e,function(){let n,r;function s(a){n?n(a):r===void 0&&(r=a)}const o=new Ue(Ms);o.effect_instruction_i0=a=>{n=a,r&&a(r)},o.effect_instruction_i1=t;let i,c;return this.effect_instruction_i0.length!==1?(c=new AbortController,i=Ge(()=>this.effect_instruction_i0(s,c.signal))):i=Ge(()=>this.effect_instruction_i0(s)),i||c?ec(o,a=>(c&&c.abort(),i??we)):o}),Hi=h(2,(e,t)=>{const n=new Ue(ui);return n.effect_instruction_i0=e,n.effect_instruction_i1=t,n}),no=h(2,(e,t)=>en(e,{onFailure:t,onSuccess:R})),Rm=h(3,(e,t,n)=>Hi(e,r=>{const s=$u(r);switch(s._tag){case"Left":return t(s.left)?n(s.left):Se(r);case"Right":return Se(s.right)}})),Gi=Symbol.for("effect/SpanAnnotation"),Fm=Symbol.for("effect/OriginalAnnotation"),vu=(e,t)=>le(t)?new Proxy(e,{has(n,r){return r===Gi||r===Fm||r in n},get(n,r){return r===Gi?t.value:r===Fm?e:n[r]}}):e,ro=e=>dr(e)&&!(Gi in e)?oe(t=>Se(st(vu(e,Xu(t))))):Se(st(e)),Nm=e=>vm(()=>st(new LO(e))),Kr=e=>en(e,{onFailure:t=>R(q(t)),onSuccess:t=>R(se(t))}),kn=e=>Cm(e,{onFailure:de,onSuccess:ke}),_e=e=>dr(e)&&!(Gi in e)?oe(t=>Se(Hn(vu(e,Xu(t))))):Se(Hn(e)),Gn=e=>w(E(e),_e),Se=e=>{const t=new Om(Me);return t.effect_instruction_i0=e,t},vm=e=>w(E(e),Se),Yi=oe(e=>R(e.id())),so=e=>oe(t=>e(t.id())),w=h(2,(e,t)=>{const n=new Ue(li);return n.effect_instruction_i0=e,n.effect_instruction_i1=t,n}),iO=e=>{const t=new Ue("OnStep");return t.effect_instruction_i0=e,t},Xi=e=>w(e,L),Cm=h(2,(e,t)=>lt(e,{onFailure:n=>R(t.onFailure(n)),onSuccess:n=>R(t.onSuccess(n))})),lt=h(2,(e,t)=>{const n=new Ue(fi);return n.effect_instruction_i0=e,n.effect_instruction_i1=t.onFailure,n.effect_instruction_i2=t.onSuccess,n}),en=h(2,(e,t)=>lt(e,{onFailure:n=>{if(gm(n).length>0)return Se(K1(n));const s=L1(n);return s.length>0?t.onFailure(bd(s)):Se(n)},onSuccess:t.onSuccess})),tn=h(2,(e,t)=>te(()=>{const n=ge(e),r=Si(n.length);let s=0;return Ve(xu({while:()=>s<n.length,body:()=>t(n[s],s),step:o=>{r[s++]=o}}),r)})),Qi=h(2,(e,t)=>te(()=>{const n=ge(e);let r=0;return xu({while:()=>r<n.length,body:()=>t(n[r],r),step:()=>{r++}})})),nn=w(Yi,e=>Am(e)),Am=e=>Se(Rt(e)),Cu=e=>{const t=new Ue(gr);return t.effect_instruction_i0=_1(Nr),t.effect_instruction_i1=()=>e,t},cO=h(2,(e,t)=>kt(n=>w(kn(n(e)),r=>HO(t,r)))),X=h(2,(e,t)=>w(e,n=>E(()=>t(n)))),xm=h(2,(e,t)=>en(e,{onFailure:n=>Gn(()=>t.onFailure(n)),onSuccess:n=>E(()=>t.onSuccess(n))})),Zi=h(2,(e,t)=>lt(e,{onFailure:n=>{const r=$u(n);switch(r._tag){case"Left":return Gn(()=>t(r.left));case"Right":return Se(r.right)}},onSuccess:R})),En=h(2,(e,t)=>kt(n=>lt(n(e),{onFailure:r=>{const s=de(r);return lt(t(s),{onFailure:o=>de(qe(r,o)),onSuccess:()=>s})},onSuccess:r=>{const s=ke(r);return Qe(t(s),s)}}))),ec=h(2,(e,t)=>En(e,ac({onFailure:n=>Tu(n)?wt(t(D1(n))):we,onSuccess:()=>we}))),aO=h(2,(e,t)=>dO(e,t,R)),uO=e=>lO(e,L),lO=h(2,(e,t)=>en(e,{onFailure:n=>ro(t(n)),onSuccess:R})),fO=oe((e,t)=>R(t.runtimeFlags)),R=e=>{const t=new Im(Pe);return t.effect_instruction_i0=e,t},te=e=>w(E(e),L),E=e=>{const t=new Ue(Th);return t.effect_instruction_i0=e,t},oo=h(e=>e.length===3||e.length===2&&!(dr(e[1])&&"onlyEffect"in e[1]),(e,t)=>w(e,n=>{const r=typeof t=="function"?t(n):t;return wn(r)?Ve(r,n):I0(r)?et(s=>{r.then(o=>s(R(n)),o=>s(_e(new Vr(o))))}):R(n)})),hO=e=>oe(t=>{const n=t.getFiberRef(Uu),r=d(n,be(()=>t.scope()));return e(uo(Uu,T(r)))}),dO=h(3,(e,t,n)=>lt(e,{onFailure:r=>gm(r).length>0?Se(Wh(j1(r))):t(),onSuccess:n})),io=e=>{const t=new Ue(gr);return t.effect_instruction_i0=om(Nr),t.effect_instruction_i1=()=>e,t},kt=e=>$m(e,function(){const t=new Ue(gr);return t.effect_instruction_i0=om(Nr),t.effect_instruction_i1=n=>tm(n)?Ge(()=>this.effect_instruction_i0(Cu)):Ge(()=>this.effect_instruction_i0(io)),t}),we=R(void 0),Mm=e=>{const t=new Ue(gr);return t.effect_instruction_i0=e,t.effect_instruction_i1=void 0,t},Au=h(2,(e,t)=>w(t,n=>n?d(e,X(T)):R(O()))),xu=e=>{const t=new Ue(hi);return t.effect_instruction_i0=e.while,t.effect_instruction_i1=e.body,t.effect_instruction_i2=e.step,t},mO=h(2,(e,t)=>{const n=new Ue(gr);return n.effect_instruction_i0=t,n.effect_instruction_i1=()=>e,n}),Mu=e=>{const t=new Ue(di);return typeof(e==null?void 0:e.priority)<"u"?vO(t,e.priority):t},tc=h(2,(e,t)=>w(e,n=>X(t,r=>[n,r]))),Pm=h(2,(e,t)=>w(e,n=>Ve(t,n))),Qe=h(2,(e,t)=>w(e,()=>t)),Lm=h(3,(e,t,n)=>w(e,r=>X(t,s=>n(r,s)))),Pu=et(()=>{const e=setInterval(()=>{},2147483647);return E(()=>clearInterval(e))}),Lu=e=>w(Yi,t=>d(e,co(t))),co=h(2,(e,t)=>w(e.interruptAsFork(t),()=>e.await)),gO={_tag:"All",syslog:0,label:"ALL",ordinal:Number.MIN_SAFE_INTEGER,pipe(){return v(this,arguments)}},pO={_tag:"Fatal",syslog:2,label:"FATAL",ordinal:5e4,pipe(){return v(this,arguments)}},yO={_tag:"Error",syslog:3,label:"ERROR",ordinal:4e4,pipe(){return v(this,arguments)}},bO={_tag:"Warning",syslog:4,label:"WARN",ordinal:3e4,pipe(){return v(this,arguments)}},Dm={_tag:"Info",syslog:6,label:"INFO",ordinal:2e4,pipe(){return v(this,arguments)}},Um={_tag:"Debug",syslog:7,label:"DEBUG",ordinal:1e4,pipe(){return v(this,arguments)}},_O={_tag:"Trace",syslog:7,label:"TRACE",ordinal:0,pipe(){return v(this,arguments)}},SO={_tag:"None",syslog:7,label:"OFF",ordinal:Number.MAX_SAFE_INTEGER,pipe(){return v(this,arguments)}},wO=Symbol.for("effect/FiberRef"),kO={_A:e=>e},nc=e=>oe(t=>ke(t.getFiberRef(e))),ao=h(2,(e,t)=>w(nc(e),t)),rc=h(2,(e,t)=>EO(e,()=>[void 0,t])),EO=h(2,(e,t)=>oe(n=>{const[r,s]=t(n.getFiberRef(e));return n.setFiberRef(e,s),R(r)})),uo=h(3,(e,t,n)=>Tm(Pm(nc(t),rc(t,n)),()=>e,r=>rc(t,r))),OO=h(3,(e,t,n)=>ao(t,r=>uo(e,t,n(r)))),Be=(e,t)=>qr(e,{differ:Xd(),fork:(t==null?void 0:t.fork)??L,join:t==null?void 0:t.join}),IO=e=>{const t=s1();return qr(e,{differ:t,fork:t.empty})},TO=e=>{const t=o1(Xd());return qr(e,{differ:t,fork:t.empty})},Bm=e=>{const t=r1();return qr(e,{differ:t,fork:t.empty})},qr=(e,t)=>({...yr,[wO]:kO,initial:e,commit(){return nc(this)},diff:(r,s)=>t.differ.diff(r,s),combine:(r,s)=>t.differ.combine(r,s),patch:r=>s=>t.differ.patch(r,s),fork:t.fork,join:t.join??((r,s)=>s)}),$O=e=>qr(e,{differ:sm,fork:sm.empty}),Ft=W(Symbol.for("effect/FiberRef/currentContext"),()=>Bm(dn())),lo=W(Symbol.for("effect/FiberRef/currentSchedulingPriority"),()=>Be(0)),jm=W(Symbol.for("effect/FiberRef/currentMaxOpsBeforeYield"),()=>Be(2048)),RO=W(Symbol.for("effect/FiberRef/currentLogAnnotation"),()=>Be(Mi())),FO=W(Symbol.for("effect/FiberRef/currentLogLevel"),()=>Be(Dm)),NO=W(Symbol.for("effect/FiberRef/currentLogSpan"),()=>Be(Rr())),vO=h(2,(e,t)=>uo(e,lo,t)),CO=W(Symbol.for("effect/FiberRef/currentConcurrency"),()=>Be("unbounded")),AO=W(Symbol.for("effect/FiberRef/currentRequestBatching"),()=>Be(!0)),xO=W(Symbol.for("effect/FiberRef/currentUnhandledErrorLogLevel"),()=>Be(T(Um))),Du=W(Symbol.for("effect/FiberRef/currentMetricLabels"),()=>TO(pn())),Uu=W(Symbol.for("effect/FiberRef/currentForkScopeOverride"),()=>Be(O(),{fork:()=>O(),join:(e,t)=>e})),sc=W(Symbol.for("effect/FiberRef/currentInterruptedCause"),()=>Be(Wn,{fork:()=>Wn,join:(e,t)=>e})),Km=W(Symbol.for("effect/FiberRef/currentTracerEnabled"),()=>Be(!0)),qm=W(Symbol.for("effect/FiberRef/currentTracerTiming"),()=>Be(!0)),MO=W(Symbol.for("effect/FiberRef/currentTracerSpanAnnotations"),()=>Be(Mi())),PO=W(Symbol.for("effect/FiberRef/currentTracerSpanLinks"),()=>Be(ut())),Vm=Symbol.for("effect/Scope"),Jm=Symbol.for("effect/CloseableScope"),zm=(e,t)=>e.addFinalizer(()=>wt(t)),Bu=(e,t)=>e.addFinalizer(t),oc=(e,t)=>e.close(t),ic=(e,t)=>e.fork(t),ju=function(){class e extends globalThis.Error{commit(){return _e(this)}toJSON(){return{...this}}[he](){return this.toString!==globalThis.Error.prototype.toString?this.stack?`${this.toString()}
${this.stack.split(`
`).slice(1).join(`
`)}`:this.toString():"Bun"in globalThis?Vi(Hn(this),{renderErrorCause:!0}):this}}return Object.assign(e.prototype,W0),e}(),Wm=(e,t)=>{class n extends ju{constructor(){super(...arguments);u(this,"_tag",t)}}return Object.assign(n.prototype,e),n.prototype.name=t,n},Hm=Symbol.for("effect/Cause/errors/RuntimeException"),LO=Wm({[Hm]:Hm},"RuntimeException"),DO=Symbol.for("effect/Cause/errors/InterruptedException"),UO=e=>K(e,DO),Gm=Symbol.for("effect/Cause/errors/NoSuchElement"),Ku=Wm({[Gm]:Gm},"NoSuchElementException"),Ym=Symbol.for("effect/Cause/errors/UnknownException"),Vr=function(){class e extends ju{constructor(r,s){super(s??"An unknown error occurred",{cause:r});u(this,"cause");u(this,"_tag","UnknownException");u(this,"error");this.cause=r,this.error=r}}return Object.assign(e.prototype,{[Ym]:Ym,name:"UnknownException"}),e}(),qu=e=>wn(e)&&"_tag"in e&&(e._tag==="Success"||e._tag==="Failure"),Xm=e=>e._tag==="Failure",BO=h(2,(e,t)=>{switch(e._tag){case Me:return de(e.effect_instruction_i0);case Pe:return ke(t)}}),Vu=e=>BO(e,void 0),Yn=(e,t)=>zO(e,t!=null&&t.parallel?Zt:qe),Jr=e=>de(st(e)),Ju=e=>de(Hn(e)),de=e=>{const t=new Om(Me);return t.effect_instruction_i0=e,t},jO=h(2,(e,t)=>{switch(e._tag){case Me:return de(e.effect_instruction_i0);case Pe:return t(e.effect_instruction_i0)}}),KO=e=>d(e,jO(L)),qO=e=>de(Rt(e)),cc=h(2,(e,t)=>{switch(e._tag){case Me:return de(e.effect_instruction_i0);case Pe:return ke(t(e.effect_instruction_i0))}}),ac=h(2,(e,{onFailure:t,onSuccess:n})=>{switch(e._tag){case Me:return t(e.effect_instruction_i0);case Pe:return n(e.effect_instruction_i0)}}),zu=h(2,(e,{onFailure:t,onSuccess:n})=>{switch(e._tag){case Me:return t(e.effect_instruction_i0);case Pe:return n(e.effect_instruction_i0)}}),ke=e=>{const t=new Im(Pe);return t.effect_instruction_i0=e,t},ft=ke(void 0),VO=h(2,(e,t)=>Wu(e,t,{onSuccess:(n,r)=>[n,r],onFailure:qe})),JO=h(2,(e,t)=>Wu(e,t,{onSuccess:(n,r)=>r,onFailure:qe})),Wu=h(3,(e,t,{onFailure:n,onSuccess:r})=>{switch(e._tag){case Me:switch(t._tag){case Pe:return de(e.effect_instruction_i0);case Me:return de(n(e.effect_instruction_i0,t.effect_instruction_i0))}case Pe:switch(t._tag){case Pe:return ke(r(e.effect_instruction_i0,t.effect_instruction_i0));case Me:return de(t.effect_instruction_i0)}}}),zO=(e,t)=>{const n=Oi(e);return Yt(n)?d(Xt(n),Wa(d(Bt(n),cc(De)),(r,s)=>d(r,Wu(s,{onSuccess:(o,i)=>d(o,Xe(i)),onFailure:t}))),cc(Gt),cc(r=>Ut(r)),T):O()},uc=e=>({...yr,[Q1]:Z1,state:Hs(eO([])),commit(){return On(this)},blockingOn:e}),lc=()=>w(Yi,e=>WO(e)),WO=e=>E(()=>uc(e)),On=e=>et(t=>{const n=xe(e.state);switch(n._tag){case Wi:return t(n.effect);case to:return n.joiners.push(t),YO(e,t)}},e.blockingOn),fc=h(2,(e,t)=>E(()=>{const n=xe(e.state);switch(n._tag){case Wi:return!1;case to:{Gs(e.state,km(t));for(let r=0,s=n.joiners.length;r<s;r++)n.joiners[r](t);return!0}}})),HO=h(2,(e,t)=>fc(e,t)),Qm=h(2,(e,t)=>fc(e,Se(t))),Zm=h(2,(e,t)=>fc(e,Am(t))),GO=e=>E(()=>xe(e.state)._tag===Wi),Hu=h(2,(e,t)=>fc(e,R(t))),Gu=(e,t)=>{const n=xe(e.state);if(n._tag===to){Gs(e.state,km(t));for(let r=0,s=n.joiners.length;r<s;r++)n.joiners[r](t)}},YO=(e,t)=>E(()=>{const n=xe(e.state);if(n._tag===to){const r=n.joiners.indexOf(t);r>=0&&n.joiners.splice(r,1)}}),XO=oe(e=>ke(e.currentContext)),eg=()=>XO,zr=e=>w(eg(),e),fo=h(2,(e,t)=>uo(Ft,t)(e)),Yu=h(2,(e,t)=>OO(Ft,n=>Ds(n,t))(e)),tg=h(2,(e,t)=>zr(n=>fo(e,t(n)))),Xu=e=>{const t=e.currentSpan;return t!==void 0&&t._tag==="Span"?T(t):O()},QO={_tag:"Span",spanId:"noop",traceId:"noop",name:"noop",sampled:!1,parent:O(),context:dn(),status:{_tag:"Ended",startTime:BigInt(0),endTime:BigInt(0),exit:ft},attributes:new Map,links:[],kind:"internal",attribute(){},event(){},end(){}},ZO=e=>{const t=Object.create(QO);return t.name=e,t},ng=Symbol.for("effect/Clock"),Wr=_t("effect/Clock"),eI=2**31-1,rg={unsafeSchedule(e,t){const n=Va(t);if(n>eI)return ei;let r=!1;const s=setTimeout(()=>{r=!0,e()},n);return()=>(clearTimeout(s),!r)}},sg=function(){const e=BigInt(1e6);if(typeof performance>"u")return()=>BigInt(Date.now())*e;if(typeof performance.timeOrigin=="number"&&performance.timeOrigin===0)return()=>BigInt(Math.round(performance.now()*1e6));const t=BigInt(Date.now())*e-BigInt(Math.round(performance.now()*1e6));return()=>t+BigInt(Math.round(performance.now()*1e6))}(),tI=function(){const e=typeof process=="object"&&"hrtime"in process&&typeof process.hrtime.bigint=="function"?process.hrtime:void 0;if(!e)return sg;const t=sg()-e.bigint();return()=>t+e.bigint()}();class nI{constructor(){u(this,T3,ng);u(this,"currentTimeMillis",E(()=>this.unsafeCurrentTimeMillis()));u(this,"currentTimeNanos",E(()=>this.unsafeCurrentTimeNanos()))}unsafeCurrentTimeMillis(){return Date.now()}unsafeCurrentTimeNanos(){return tI()}scheduler(){return R(rg)}sleep(t){return et(n=>{const r=rg.unsafeSchedule(()=>n(we),t);return wt(E(r))})}}T3=ng;const rI=()=>new nI,Hr=gw,sI=e=>{if(e==="NaN")return br(NaN);if(e==="Infinity")return br(1/0);if(e==="-Infinity")return br(-1/0);if(e.trim()==="")return mi;const t=Number(e);return Number.isNaN(t)?mi:br(t)},Qu=e=>e.replace(/[/\\^$*+?.()|[\]{}]/g,"\\$&"),og="And",ig="Or",cg="InvalidData",ag="MissingData",ug="SourceUnavailable",lg="Unsupported",fg=Symbol.for("effect/ConfigError"),Gr={_tag:"ConfigError",[fg]:fg},hg=(e,t)=>{const n=Object.create(Gr);return n._op=og,n.left=e,n.right=t,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} and ${this.right}`}}),n},dg=(e,t)=>{const n=Object.create(Gr);return n._op=ig,n.left=e,n.right=t,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} or ${this.right}`}}),n},oI=(e,t,n={pathDelim:"."})=>{const r=Object.create(Gr);return r._op=cg,r.path=e,r.message=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Invalid data at ${d(this.path,wr(n.pathDelim))}: "${this.message}")`}}),r},Xn=(e,t,n={pathDelim:"."})=>{const r=Object.create(Gr);return r._op=ag,r.path=e,r.message=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Missing data at ${d(this.path,wr(n.pathDelim))}: "${this.message}")`}}),r},iI=(e,t,n,r={pathDelim:"."})=>{const s=Object.create(Gr);return s._op=ug,s.path=e,s.message=t,s.cause=n,Object.defineProperty(s,"toString",{enumerable:!1,value(){return`(Source unavailable at ${d(this.path,wr(r.pathDelim))}: "${this.message}")`}}),s},cI=(e,t,n={pathDelim:"."})=>{const r=Object.create(Gr);return r._op=lg,r.path=e,r.message=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Unsupported operation at ${d(this.path,wr(n.pathDelim))}: "${this.message}")`}}),r},Qn=h(2,(e,t)=>{switch(e._op){case og:return hg(Qn(e.left,t),Qn(e.right,t));case ig:return dg(Qn(e.left,t),Qn(e.right,t));case cg:return oI([...t,...e.path],e.message);case ag:return Xn([...t,...e.path],e.message);case ug:return iI([...t,...e.path],e.message,e.cause);case lg:return cI([...t,...e.path],e.message)}}),aI={_tag:"Empty"},Zu=h(2,(e,t)=>{let n=yu(t),r=e;for(;Jd(n);){const s=n.head;switch(s._tag){case"Empty":{n=n.tail;break}case"AndThen":{n=zn(s.first,zn(s.second,n.tail));break}case"MapName":{r=Bn(r,s.f),n=n.tail;break}case"Nested":{r=wi(r,s.name),n=n.tail;break}case"Unnested":{if(d(js(r),Sw(s.name)))r=Un(r),n=n.tail;else return q(Xn(r,`Expected ${s.name} to be in path in ConfigProvider#unnested`));break}}}return se(r)}),uI="Constant",lI="Fail",fI="Fallback",hI="Described",dI="Lazy",mI="MapOrFail",gI="Nested",pI="Primitive",yI="Sequence",bI="HashMap",_I="ZipWith";var mg={};const hc=(e,t)=>[...e,...t],gg=Symbol.for("effect/ConfigProvider"),SI=_t("effect/ConfigProvider"),pg=Symbol.for("effect/ConfigProviderFlat"),wI=e=>({[gg]:gg,pipe(){return v(this,arguments)},...e}),kI=e=>({[pg]:pg,patch:e.patch,load:(t,n,r=!0)=>e.load(t,n,r),enumerateChildren:e.enumerateChildren}),EI=e=>wI({load:t=>w(Et(e,pn(),t,!1),n=>Ke(js(n),{onNone:()=>_e(Xn(pn(),`Expected a single value having structure: ${t}`)),onSome:R})),flattened:e}),OI=e=>{const{pathDelim:t,seqDelim:n}=Object.assign({},{pathDelim:"_",seqDelim:","},e),r=a=>d(a,wr(t)),s=a=>a.split(t),o=()=>typeof process<"u"&&"env"in process&&typeof mg=="object"?mg:{};return EI(kI({load:(a,l,f=!0)=>{const m=r(a),g=o(),p=m in g?T(g[m]):O();return d(p,Zi(()=>Xn(a,`Expected ${m} to exist in the process context`)),w(y=>FI(y,a,l,n,f)))},enumerateChildren:a=>E(()=>{const l=o(),g=Object.keys(l).map(p=>s(p.toUpperCase())).filter(p=>{for(let y=0;y<a.length;y++){const k=d(a,rd(y)),b=p[y];if(b===void 0||k!==b)return!1}return!0}).flatMap(p=>p.slice(a.length,a.length+1));return Wk(g)}),patch:aI}))},II=(e,t,n,r)=>{const s=fd(n.length,a=>a>=r.length?O():T([e(a),a+1])),o=fd(r.length,a=>a>=n.length?O():T([t(a),a+1])),i=hc(n,s),c=hc(r,o);return[i,c]},TI=(e,t)=>{let n=t;if(n._tag==="Nested"){const r=e.slice();for(;n._tag==="Nested";)r.push(n.name),n=n.config;return r}return e},Et=(e,t,n,r)=>{const s=n;switch(s._tag){case uI:return R(Tt(s.value));case hI:return te(()=>Et(e,t,s.config,r));case lI:return _e(Xn(t,s.message));case fI:return d(te(()=>Et(e,t,s.first,r)),no(o=>s.condition(o)?d(Et(e,t,s.second,r),no(i=>_e(dg(o,i)))):_e(o)));case dI:return te(()=>Et(e,t,s.config(),r));case mI:return te(()=>d(Et(e,t,s.original,r),w(tn(o=>d(s.mapOrFail(o),Zi(Qn(TI(t,s.original))))))));case gI:return te(()=>Et(e,hc(t,Tt(s.name)),s.config,r));case pI:return d(Zu(t,e.patch),w(o=>d(e.load(o,s,r),w(i=>{if(i.length===0){const c=d(Zw(o),be(()=>"<n/a>"));return _e(Xn([],`Expected ${s.description} with name ${c}`))}return R(i)}))));case yI:return d(Zu(t,e.patch),w(o=>d(e.enumerateChildren(o),w(vI),w(i=>i.length===0?te(()=>X(Et(e,t,s.config,!0),Tt)):d(tn(i,c=>Et(e,Gw(t,`[${c}]`),s.config,!0)),X(c=>{const a=ck(c);return a.length===0?Tt(pn()):Tt(a)}))))));case bI:return te(()=>d(Zu(t,e.patch),w(o=>d(e.enumerateChildren(o),w(i=>d(i,tn(c=>Et(e,hc(o,Tt(c)),s.valueConfig,r)),X(c=>c.length===0?Tt(Mi()):d(NI(c),Bn(a=>iE(id(ge(i),a)))))))))));case _I:return te(()=>d(Et(e,t,s.left,r),Kr,w(o=>d(Et(e,t,s.right,r),Kr,w(i=>{if(Ye(o)&&Ye(i))return _e(hg(o.left,i.left));if(Ye(o)&&gn(i))return _e(o.left);if(gn(o)&&Ye(i))return _e(i.left);if(gn(o)&&gn(i)){const c=d(t,wr(".")),a=$I(t,c),[l,f]=II(a,a,d(o.right,Bn(se)),d(i.right,Bn(se)));return d(l,id(f),tn(([m,g])=>d(tc(m,g),X(([p,y])=>s.zip(p,y)))))}throw new Error("BUG: ConfigProvider.fromFlatLoop - please report an issue at https://github.com/Effect-TS/effect/issues")})))))}},$I=(e,t)=>n=>q(Xn(e,`The element at index ${n} in a sequence at path "${t}" was missing`)),RI=(e,t)=>e.split(new RegExp(`\\s*${Qu(t)}\\s*`)),FI=(e,t,n,r,s)=>s?d(RI(e,r),tn(o=>n.parse(o.trim())),Zi(Qn(t))):d(n.parse(e),xm({onFailure:Qn(t),onSuccess:Tt})),NI=e=>Object.keys(e[0]).map(t=>e.map(n=>n[t])),vI=e=>d(tn(e,AI),xm({onFailure:()=>pn(),onSuccess:Ks(Hr)}),Kr,X(jw)),CI=/^(\[(\d+)\])$/,AI=e=>{const t=e.match(CI);if(t!==null){const n=t[2];return d(n!==void 0&&n.length>0?T(n):O(),yi(xI))}return O()},xI=e=>{const t=Number.parseInt(e);return Number.isNaN(t)?O():T(t)},yg=Symbol.for("effect/Console"),bg=_t("effect/Console"),MI={[yg]:yg,assert(e,...t){return E(()=>{console.assert(e,...t)})},clear:E(()=>{console.clear()}),count(e){return E(()=>{console.count(e)})},countReset(e){return E(()=>{console.countReset(e)})},debug(...e){return E(()=>{console.debug(...e)})},dir(e,t){return E(()=>{console.dir(e,t)})},dirxml(...e){return E(()=>{console.dirxml(...e)})},error(...e){return E(()=>{console.error(...e)})},group(e){return e!=null&&e.collapsed?E(()=>console.groupCollapsed(e==null?void 0:e.label)):E(()=>console.group(e==null?void 0:e.label))},groupEnd:E(()=>{console.groupEnd()}),info(...e){return E(()=>{console.info(...e)})},log(...e){return E(()=>{console.log(...e)})},table(e,t){return E(()=>{console.table(e,t)})},time(e){return E(()=>console.time(e))},timeEnd(e){return E(()=>console.timeEnd(e))},timeLog(e,...t){return E(()=>{console.timeLog(e,...t)})},trace(...e){return E(()=>{console.trace(...e)})},warn(...e){return E(()=>{console.warn(...e)})},unsafe:console},_g=Symbol.for("effect/Random"),PI=_t("effect/Random");class LI{constructor(t){u(this,"seed");u(this,$3,_g);u(this,"PRNG");this.seed=t,this.PRNG=new A0(t)}get next(){return E(()=>this.PRNG.number())}get nextBoolean(){return X(this.next,t=>t>.5)}get nextInt(){return E(()=>this.PRNG.integer(Number.MAX_SAFE_INTEGER))}nextRange(t,n){return X(this.next,r=>(n-t)*r+t)}nextIntBetween(t,n){return E(()=>this.PRNG.integer(n-t)+t)}shuffle(t){return DI(t,n=>this.nextIntBetween(0,n))}}$3=_g;const DI=(e,t)=>te(()=>d(E(()=>Array.from(e)),w(n=>{const r=[];for(let s=n.length;s>=2;s=s-1)r.push(s);return d(r,Qi(s=>d(t(s),X(o=>UI(n,s-1,o)))),Ve(Oi(n)))}))),UI=(e,t,n)=>{const r=e[t];return e[t]=e[n],e[n]=r,e},BI=e=>new LI(N(e)),Sg=Symbol.for("effect/Tracer"),jI=e=>({[Sg]:Sg,...e}),el=_t("effect/Tracer"),dc=_t("effect/ParentSpan"),wg=function(){const e="abcdef0123456789",t=e.length;return function(n){let r="";for(let s=0;s<n;s++)r+=e.charAt(Math.floor(Math.random()*t));return r}}();class KI{constructor(t,n,r,s,o,i){u(this,"name");u(this,"parent");u(this,"context");u(this,"links");u(this,"startTime");u(this,"kind");u(this,"_tag","Span");u(this,"spanId");u(this,"traceId","native");u(this,"sampled",!0);u(this,"status");u(this,"attributes");u(this,"events",[]);this.name=t,this.parent=n,this.context=r,this.links=s,this.startTime=o,this.kind=i,this.status={_tag:"Started",startTime:o},this.attributes=new Map,this.traceId=n._tag==="Some"?n.value.traceId:wg(32),this.spanId=wg(16)}end(t,n){this.status={_tag:"Ended",endTime:t,exit:n,startTime:this.status.startTime}}attribute(t,n){this.attributes.set(t,n)}event(t,n,r){this.events.push([t,n,r??{}])}}const qI=jI({span:(e,t,n,r,s,o)=>new KI(e,t,n,r,s,o),context:e=>e()}),VI=e=>{if((e==null?void 0:e.captureStackTrace)===!1)return e;if((e==null?void 0:e.captureStackTrace)!==void 0&&typeof e.captureStackTrace!="boolean")return e;const t=Error.stackTraceLimit;Error.stackTraceLimit=3;const n=new Error;Error.stackTraceLimit=t;let r=!1;return{...e,captureStackTrace:()=>{if(r!==!1)return r;if(n.stack!==void 0){const s=n.stack.split(`
`);if(s[3]!==void 0)return r=s[3].trim(),r}}}},JI=d(dn(),mn(Wr,rI()),mn(bg,MI),mn(PI,BI(Math.random())),mn(SI,OI()),mn(el,qI)),Yr=W(Symbol.for("effect/DefaultServices/currentServices"),()=>Bm(JI)),zI=e=>{const t=Lt(e);return kg(n=>n.sleep(t))},WI=e=>oe(t=>e(t.currentDefaultServices)),kg=e=>WI(t=>e(t.unsafeMap.get(Wr.key))),HI=kg(e=>e.currentTimeMillis),In=lc,ht=On,GI=Qm,Eg=GO,Tn=Hu,YI=Ps,Og=yr,XI=H0;class mc extends XI{}const Ig="Sequential",Tg="Parallel",QI="ParallelN",ho={_tag:Ig},ZI={_tag:Tg},eT=e=>({_tag:QI,parallelism:e}),tT=e=>e._tag===Ig,nT=e=>e._tag===Tg,tl=ho,nl=ZI,rl=eT;function rT(e){return new $n(e)}function sT(){return rT(new Map)}const $g=Symbol.for("effect/FiberRefs");class $n{constructor(t){u(this,"locals");u(this,R3,$g);this.locals=t}pipe(){return v(this,arguments)}}R3=$g;const oT=(e,t,n,r=!1)=>{const s=e;let o=t,i=n,c=r,a;for(;a===void 0;)if(Le(o)&&Le(i)){const l=nt(o)[0],f=Un(o),m=nt(i)[0],g=nt(i)[1],p=Un(i);l.startTimeMillis<m.startTimeMillis?(i=p,c=!0):l.startTimeMillis>m.startTimeMillis?o=f:l.id<m.id?(i=p,c=!0):l.id>m.id?o=f:a=[g,c]}else a=[s.initial,!0];return a},iT=h(3,(e,t,n)=>{const r=new Map(e.locals);return n.locals.forEach((s,o)=>{const i=s[0][1];if(!s[0][0][H](t)){if(!r.has(o)){if(J(i,o.initial))return;r.set(o,[[t,o.join(o.initial,i)]]);return}const c=r.get(o),[a,l]=oT(o,c,s);if(l){const f=o.diff(a,i),m=c[0][1],g=o.join(m,o.patch(f)(m));if(!J(m,g)){let p;const y=c[0][0];y[H](t)?p=[[y,g],...c.slice(1)]:p=[[t,g],...c],r.set(o,p)}}}}),new $n(r)}),cT=h(2,(e,t)=>{const n=new Map;return Rg(e,n,t),new $n(n)}),Rg=(e,t,n)=>{e.locals.forEach((r,s)=>{const o=r[0][1],i=s.patch(s.fork)(o);J(o,i)?t.set(s,r):t.set(s,[[n,i],...r])})},Fg=h(2,(e,t)=>{const n=new Map(e.locals);return n.delete(t),new $n(n)}),Ng=h(2,(e,t)=>e.locals.has(t)?T(nt(e.locals.get(t))[1]):O()),mo=h(2,(e,t)=>d(Ng(e,t),be(()=>t.initial))),sl=h(2,(e,{fiberId:t,fiberRef:n,value:r})=>{if(e.locals.size===0)return new $n(new Map([[n,[[t,r]]]]));const s=new Map(e.locals);return ol(s,t,n,r),new $n(s)}),ol=(e,t,n,r)=>{const s=e.get(n)??[];let o;if(Le(s)){const[i,c]=nt(s);if(i[H](t)){if(J(c,r))return;o=[[t,r],...s.slice(1)]}else o=[[t,r],...s]}else o=[[t,r]];e.set(n,o)},aT=h(2,(e,{entries:t,forkAs:n})=>{if(e.locals.size===0)return new $n(new Map(t));const r=new Map(e.locals);return n!==void 0&&Rg(e,r,n),t.forEach(([s,o])=>{o.length===1?ol(r,o[0][0],s,o[0][1]):o.forEach(([i,c])=>{ol(r,i,s,c)})}),new $n(r)}),vg=Ng,uT=mo,lT=aT,fT=sT,Cg="Empty",Ag="Add",xg="Remove",Mg="Update",Pg="AndThen",hT={_tag:Cg},il=(e,t)=>{const n=new Map(e.locals);let r=hT;for(const[s,o]of t.locals.entries()){const i=nt(o)[1],c=n.get(s);if(c!==void 0){const a=nt(c)[1];J(a,i)||(r=cl({_tag:Mg,fiberRef:s,patch:s.diff(a,i)})(r))}else r=cl({_tag:Ag,fiberRef:s,value:i})(r);n.delete(s)}for(const[s]of n.entries())r=cl({_tag:xg,fiberRef:s})(r);return r},cl=h(2,(e,t)=>({_tag:Pg,first:e,second:t})),Lg=h(3,(e,t,n)=>{let r=n,s=Tt(e);for(;Le(s);){const o=nt(s),i=Un(s);switch(o._tag){case Cg:{s=i;break}case Ag:{r=sl(r,{fiberId:t,fiberRef:o.fiberRef,value:o.value}),s=i;break}case xg:{r=Fg(r,o.fiberRef),s=i;break}case Mg:{const c=mo(r,o.fiberRef);r=sl(r,{fiberId:t,fiberRef:o.fiberRef,value:o.fiberRef.patch(o.patch)(c)}),s=i;break}case Pg:{s=wi(o.first)(wi(o.second)(i));break}}}return r}),go=il,po=Lg,gc="effect/FiberStatus",Zn=Symbol.for(gc),pc="Done",Dg="Running",Ug="Suspended",dT=ve(`${gc}-${pc}`);let mT=class{constructor(){u(this,F3,Zn);u(this,"_tag",pc)}[(F3=Zn,G)](){return dT}[H](t){return al(t)&&t._tag===pc}};class gT{constructor(t){u(this,"runtimeFlags");u(this,N3,Zn);u(this,"_tag",Dg);this.runtimeFlags=t}[(N3=Zn,G)](){return d(N(gc),ee(N(this._tag)),ee(N(this.runtimeFlags)),Ee(this))}[H](t){return al(t)&&t._tag===Dg&&this.runtimeFlags===t.runtimeFlags}}class pT{constructor(t,n){u(this,"runtimeFlags");u(this,"blockingOn");u(this,v3,Zn);u(this,"_tag",Ug);this.runtimeFlags=t,this.blockingOn=n}[(v3=Zn,G)](){return d(N(gc),ee(N(this._tag)),ee(N(this.runtimeFlags)),ee(N(this.blockingOn)),Ee(this))}[H](t){return al(t)&&t._tag===Ug&&this.runtimeFlags===t.runtimeFlags&&J(this.blockingOn,t.blockingOn)}}const yT=new mT,bT=e=>new gT(e),_T=(e,t)=>new pT(e,t),al=e=>K(e,Zn),ST=e=>e._tag===pc,wT=yT,Bg=bT,kT=_T,ET=ST,OT=gO,IT=pO,TT=yO,jg=bO,$T=Dm,ul=Um,Kg=_O,qg=SO,RT=pw(d(Hr,zh(e=>e.ordinal))),FT=e=>{switch(e){case"All":return OT;case"Debug":return ul;case"Error":return TT;case"Fatal":return IT;case"Info":return $T;case"Trace":return Kg;case"None":return qg;case"Warning":return jg}},NT=Symbol.for("effect/Micro"),yc=Symbol.for("effect/Micro/runSymbol"),Vg={...YI,_op:"Micro",[NT]:{_A:L,_E:L,_R:L},[Symbol.iterator](){return new Br(new Cs(this))}},Jg=Symbol.for("effect/Micro/MicroCause"),vT={_E:L};class zg extends globalThis.Error{constructor(n,r,s){const o=`MicroCause.${n}`;let i,c,a;if(r instanceof globalThis.Error){i=`(${o}) ${r.name}`,c=r.message;const l=c.split(`
`).length;a=r.stack?`(${o}) ${r.stack.split(`
`).slice(0,l+3).join(`
`)}`:`${i}: ${c}`}else i=o,c=xs(r,0),a=`${i}: ${c}`;s.length>0&&(a+=`
    ${s.join(`
    `)}`);super(c);u(this,"_tag");u(this,"traces");u(this,C3);this._tag=n,this.traces=s,this[Jg]=vT,this.name=i,this.stack=a}pipe(){return v(this,arguments)}toString(){return this.stack}[(C3=Jg,he)](){return this.stack}}class CT extends zg{constructor(n,r=[]){super("Die",n,r);u(this,"defect");this.defect=n}}const AT=(e,t=[])=>new CT(e,t);class xT extends zg{constructor(t=[]){super("Interrupt","interrupted",t)}}const MT=q(((e=[])=>new xT(e))()),PT=e=>q(AT(e)),LT={[Symbol.for("effect/Micro/Env")]:{_R:L},pipe(){return v(this,arguments)}},Wg=e=>{const t=Object.create(LT);return t.refs=e,t},DT=()=>{const e=new AbortController,t=Object.create(null);return t[Yg.key]=e,t[Xg.key]=e.signal,t[Zg.key]=new Hg,Wg(t)},ll=h(2,(e,t)=>t.key in e.refs?e.refs[t.key]:t.initial),UT=h(3,(e,t,n)=>{const r=Object.assign(Object.create(null),e.refs);return r[t.key]=n,Wg(r)}),BT=e=>WT((t,n)=>n(se(ll(t,e)))),jT="setImmediate"in globalThis?globalThis.setImmediate:e=>setTimeout(e,0);class Hg{constructor(){u(this,"tasks",[]);u(this,"running",!1);u(this,"afterScheduled",()=>{this.running=!1,this.runTasks()})}scheduleTask(t,n){this.tasks.push(t),this.running||(this.running=!0,jT(this.afterScheduled))}runTasks(){const t=this.tasks;this.tasks=[];for(let n=0,r=t.length;n<r;n++)t[n]()}shouldYield(t){return!1}flush(){for(;this.tasks.length>0;)this.runTasks()}}const Gg=Symbol.for("effect/Micro/EnvRef"),KT={...Vg,[Gg]:Gg,[yc](e,t){BT(this)[yc](e,t)}},Xr=(e,t)=>W(e,()=>{const n=Object.create(KT);return n.key=e,n.initial=t(),n}),Yg=Xr("effect/Micro/currentAbortController",()=>{}),Xg=Xr("effect/Micro/currentAbortSignal",()=>{}),qT=Xr("effect/Micro/currentContext",()=>dn()),Qg=Xr("effect/Micro/currentMaxDepthBeforeYield",()=>2048),VT=Xr("effect/Micro/currentInterruptible",()=>!0),Zg=Xr("effect/Micro/currentScheduler",()=>new Hg),Qr=W("effect/Micro/microDepthState",()=>({depth:0,maxDepthBeforeYield:Qg.initial})),JT=e=>{const t=Object.create(Vg);return t[yc]=e,t},zT=(e,t)=>JT(function n(r,s){if(r.refs[VT.key]!==!1&&r.refs[Xg.key].aborted)return s(MT);Qr.depth++,Qr.depth===1&&(Qr.maxDepthBeforeYield=ll(r,Qg));const o=r.refs[Zg.key];if(Qr.depth>=Qr.maxDepthBeforeYield||o.shouldYield(r))o.scheduleTask(()=>n(r,s),0);else try{e(r,s)}catch(i){s(PT(i))}Qr.depth--}),WT=e=>zT(e),bc=Symbol.for("effect/Readable"),ep=Symbol.for("effect/Ref"),tp={_A:e=>e};class HT extends mc{constructor(n){super();u(this,"ref");u(this,A3,tp);u(this,x3,bc);u(this,"get");this.ref=n,this.get=E(()=>xe(this.ref))}commit(){return this.get}modify(n){return E(()=>{const r=xe(this.ref),[s,o]=n(r);return r!==o&&Gs(o)(this.ref),s})}}A3=ep,x3=bc;const np=e=>new HT(Hs(e)),_c=e=>E(()=>np(e)),Rn=e=>e.get,Sc=h(2,(e,t)=>e.modify(()=>[void 0,t])),GT=h(2,(e,t)=>e.modify(n=>[n,t])),rp=h(2,(e,t)=>e.modify(t)),fl=h(2,(e,t)=>e.modify(n=>[void 0,t(n)])),hl=_c,YT=Rn,XT=GT,yo=rp,QT=fl;class sp{constructor(){u(this,"buckets",[])}scheduleTask(t,n){const r=this.buckets.length;let s,o=0;for(;o<r&&this.buckets[o][0]<=n;o++)s=this.buckets[o];s&&s[0]===n?s[1].push(t):o===r?this.buckets.push([n,[t]]):this.buckets.splice(o,0,[n,[t]])}}class ZT{constructor(t){u(this,"maxNextTickBeforeTimer");u(this,"running",!1);u(this,"tasks",new sp);this.maxNextTickBeforeTimer=t}starveInternal(t){const n=this.tasks.buckets;this.tasks.buckets=[];for(const[r,s]of n)for(let o=0;o<s.length;o++)s[o]();this.tasks.buckets.length===0?this.running=!1:this.starve(t)}starve(t=0){t>=this.maxNextTickBeforeTimer?setTimeout(()=>this.starveInternal(0),0):Promise.resolve(void 0).then(()=>this.starveInternal(t+1))}shouldYield(t){return t.currentOpCount>t.getFiberRef(jm)?t.getFiberRef(lo):!1}scheduleTask(t,n){this.tasks.scheduleTask(t,n),this.running||(this.running=!0,this.starve())}}const op=W(Symbol.for("effect/Scheduler/defaultScheduler"),()=>new ZT(2048));class e${constructor(){u(this,"tasks",new sp);u(this,"deferred",!1)}scheduleTask(t,n){this.deferred?op.scheduleTask(t,n):this.tasks.scheduleTask(t,n)}shouldYield(t){return t.currentOpCount>t.getFiberRef(jm)?t.getFiberRef(lo):!1}flush(){for(;this.tasks.buckets.length>0;){const t=this.tasks.buckets;this.tasks.buckets=[];for(const[n,r]of t)for(let s=0;s<r.length;s++)r[s]()}this.deferred=!0}}const dl=W(Symbol.for("effect/FiberRef/currentScheduler"),()=>Be(op)),ip=W(Symbol.for("effect/FiberRef/currentRequestMap"),()=>Be(new Map)),cp=(e,t,n,r)=>{switch(e){case void 0:return t();case"unbounded":return n();case"inherit":return ao(CO,s=>s==="unbounded"?n():s>1?r(s):t());default:return e>1?r(e):t()}},t$=zI,n$=HI,r$=Wr,s$=e=>t=>`${t.label.replace(/[\s="]/g,"_")}=${e-t.startTime}ms`,ap="effect/MetricLabel",ml=Symbol.for(ap);class o${constructor(t,n){u(this,"key");u(this,"value");u(this,M3,ml);u(this,"_hash");this.key=t,this.value=n,this._hash=ve(ap+this.key+this.value)}[(M3=ml,G)](){return this._hash}[H](t){return c$(t)&&this.key===t.key&&this.value===t.value}pipe(){return v(this,arguments)}}const i$=(e,t)=>new o$(e,t),c$=e=>K(e,ml),a$=e=>X(e,T),up=e=>{let t,n;return typeof e=="function"?t=e:(t=e.try,n=e.catch),E(()=>{try{return t()}catch(r){throw nO(Hn(n?n(r):new Vr(r)))}})},u$=h(2,(e,t)=>Hi(e,n=>{const r=Ki(n,s=>dm(s)?T(s):O());switch(r._tag){case"None":return Se(n);case"Some":return t(r.value.defect)}})),l$=h(3,(e,t,n)=>Rm(e,Ta(t),n)),f$=h(2,(e,t)=>{let n;return Rm(e,r=>(n??(n=Object.keys(t)),K(r,"_tag")&&Pt(r._tag)&&n.includes(r._tag)),r=>t[r._tag](r))}),h$=e=>gp(e,fp,il),d$=e=>gp(e,tc(fp,fO),([t,n],[r,s])=>[il(t,r),Sn(n,s)]),lp=h(2,(e,t)=>en(e,{onFailure:n=>R(t.onFailure(n)),onSuccess:n=>R(t.onSuccess(n))})),m$=function(){let e;return arguments.length===1?e=arguments[0]:e=arguments[1].bind(arguments[0]),te(()=>{const t=e(d),n=Ge(()=>t.next()),r=s=>s.done?R(s.value):w(M0(s.value),o=>r(Ge(()=>t.next(o))));return r(n)})},fp=oe(e=>R(e.getFiberRefs())),g$=e=>lp(e,{onFailure:ka,onSuccess:ka}),p$=(e=>(...t)=>{const n=Us(e);let r;for(let s=0,o=t.length;s<o;s++){const i=t[s];hm(i)&&(r!==void 0?r=qe(r,i):r=i,t=[...t.slice(0,s),...t.slice(s+1)],s--)}return r===void 0&&(r=Wn),oe(s=>(s.log(t,r,n),we))})(ul),hp=h(2,(e,t)=>lt(e,{onFailure:n=>vm(()=>t(n)),onSuccess:R})),dp=e=>d(lc(),w(t=>d(d$(e),cO(t),b$,X(n=>Qe(n,d(On(t),w(([r,s])=>Ve(tc(mp(r[0]),Mm(r[1])),s)))))))),y$=e=>X(e,t=>!t),b$=e=>X(hl(!0),t=>wt(Au(e,XT(t,!1)))),mp=e=>T$((t,n)=>d(e,Lg(t,n))),_$=e=>e.length>=1?et((t,n)=>{try{e(n).then(r=>t(ke(r)),r=>t(Jr(r)))}catch(r){t(Jr(r))}}):et(t=>{try{e().then(n=>t(ke(n)),n=>t(Jr(n)))}catch(n){t(Jr(n))}}),S$=h(3,(e,t,n)=>zr(r=>fo(e,mn(r,t,n)))),w$=t$,k$=R(O()),gp=h(3,(e,t,n)=>w(t,r=>w(e,s=>X(t,o=>[n(r,o),s])))),E$=h(2,(e,t)=>lt(e,{onFailure:n=>Qe(t(n),Se(n)),onSuccess:R})),O$=e=>{let t,n;return typeof e=="function"?t=e:(t=e.try,n=e.catch),t.length>=1?et((r,s)=>{try{t(s).then(o=>r(ke(o)),o=>r(n?Gn(()=>n(o)):_e(new Vr(o))))}catch(o){r(n?Gn(()=>n(o)):_e(new Vr(o)))}}):et(r=>{try{t().then(s=>r(ke(s)),s=>r(n?Gn(()=>n(s)):_e(new Vr(s))))}catch(s){r(n?Gn(()=>n(s)):_e(new Vr(s)))}})},I$=h(2,(e,t)=>w(e,n=>up({try:()=>t.try(n),catch:t.catch}))),T$=e=>oe(t=>(t.setFiberRefs(e(t.id(),t.getFiberRefs())),we)),$$=h(2,(e,t)=>te(()=>t()?X(e,T):R(O()))),pp=BigInt(0),R$=(e,t,n)=>{if(e.getFiberRef(Km)===!1)return ZO(t);const s=e.getFiberRef(Ft),o=e.getFiberRef(Yr),i=Ls(o,el),c=Ls(o,r$),a=e.getFiberRef(qm),l=e.getFiberRefs(),f=vg(l,MO),m=vg(l,PO),g=n.parent?T(n.parent):n.root?O():Sr(s,dc),p=m._tag==="Some"?n.links!==void 0?[...Ut(m.value),...n.links??[]]:Ut(m.value):n.links??pn(),y=i.span(t,g,n.context??dn(),p,a?c.unsafeCurrentTimeNanos():pp,n.kind??"internal");return typeof n.captureStackTrace=="function"&&zi.set(y,n.captureStackTrace),f._tag==="Some"&&fE(f.value,(k,b)=>y.attribute(b,k)),n.attributes!==void 0&&Object.entries(n.attributes).forEach(([k,b])=>y.attribute(k,b)),y},F$=(e,t,n,r)=>E(()=>{e.status._tag!=="Ended"&&(Xm(t)&&zi.has(e)&&e.attribute("code.stacktrace",zi.get(e)()),e.end(r?n.unsafeCurrentTimeNanos():pp,t))}),N$=(e,...t)=>{const n=VI(t.length===1?void 0:t[0]),r=t[t.length-1];return oe(s=>{const o=R$(s,e,n),i=s.getFiberRef(qm),c=Ls(s.getFiberRef(Yr),Wr);return En(r(o),a=>F$(o,a,c,i))})},v$=h(2,(e,t)=>S$(e,dc,t)),C$=Xm,A$=Yn,x$=Jr,M$=Ju,Nt=de,P$=KO,L$=cc,rn=ac,jt=ke,gl=ft,yp=VO,bo=JO,pl="InterruptSignal",yl="Stateful",bl="Resume",_l="YieldNow",Sl=e=>({_tag:pl,cause:e}),wc=e=>({_tag:yl,onFiber:e}),Zr=e=>({_tag:bl,effect:e}),D$=()=>({_tag:_l}),kc=Symbol.for("effect/FiberScope");class U${constructor(){u(this,P3,kc);u(this,"fiberId",Jn);u(this,"roots",new Set)}add(t,n){this.roots.add(n),n.addObserver(()=>{this.roots.delete(n)})}}P3=kc;class B${constructor(t,n){u(this,"fiberId");u(this,"parent");u(this,L3,kc);this.fiberId=t,this.parent=n}add(t,n){this.parent.tell(wc(r=>{r.addChild(n),n.addObserver(()=>{r.removeChild(n)})}))}}L3=kc;const j$=e=>new B$(e.id(),e),wl=W(Symbol.for("effect/FiberScope/Global"),()=>new U$),bp=Symbol.for("effect/Fiber"),_p={_E:e=>e,_A:e=>e},K$={[bp]:_p,pipe(){return v(this,arguments)}},q$=Symbol.for("effect/Fiber"),V$=e=>e.await,es=e=>Pm(Xi(e.await),e.inheritAll);({...yr,...K$});const er="effect/FiberCurrent",J$=Symbol.for("effect/Logger"),z$={_Message:e=>e,_Output:e=>e},Ec=e=>({[J$]:z$,log:e,pipe(){return v(this,arguments)}}),W$=Ec(({annotations:e,cause:t,date:n,fiberId:r,logLevel:s,message:o,spans:i})=>{const c=n.getTime();let l=[`timestamp=${n.toISOString()}`,`level=${s.label}`,`fiber=${Ld(r)}`].join(" ");const f=Ww(o);for(let m=0;m<f.length;m++){const g=xs(f[m]);g.length>0&&(l=l+" message=",l=kl(g,l))}if(t!=null&&t._tag!=="Empty"&&(l=l+" cause=",l=kl(Vi(t,{renderErrorCause:!0}),l)),Jd(i)){l=l+" ";let m=!0;for(const g of i)m?m=!1:l=l+" ",l=l+d(g,s$(c))}if(aE(e)>0){l=l+" ";let m=!0;for(const[g,p]of e)m?m=!1:l=l+" ",l=l+Y$(g),l=l+"=",l=kl(xs(p),l)}return l}),H$=e=>`"${e.replace(/\\([\s\S])|(")/g,"\\$1$2")}"`,G$=/^[^\s"=]+$/,kl=(e,t)=>t+(e.match(G$)?e:H$(e)),Y$=e=>e.replace(/[\s="]/g,"_");typeof process=="object"&&process!==null&&typeof process.stdout=="object"&&process.stdout!==null&&process.stdout.isTTY;const Sp="effect/MetricBoundaries",El=Symbol.for(Sp);class X${constructor(t){u(this,"values");u(this,D3,El);u(this,"_hash");this.values=t,this._hash=d(ve(Sp),ee(As(this.values)))}[(D3=El,G)](){return this._hash}[H](t){return Q$(t)&&J(this.values,t.values)}pipe(){return v(this,arguments)}}const Q$=e=>K(e,El),Z$=e=>{const t=d(e,Ja(De(Number.POSITIVE_INFINITY)),ak);return new X$(t)},eR=e=>d(zw(e.count-1,t=>e.start*Math.pow(e.factor,t)),Vs,Z$),wp=Symbol.for("effect/MetricKeyType"),kp="effect/MetricKeyType/Counter",Ol=Symbol.for(kp),tR=Symbol.for("effect/MetricKeyType/Frequency"),nR=Symbol.for("effect/MetricKeyType/Gauge"),Ep="effect/MetricKeyType/Histogram",Il=Symbol.for(Ep),rR=Symbol.for("effect/MetricKeyType/Summary"),Op={_In:e=>e,_Out:e=>e};class sR{constructor(t,n){u(this,"incremental");u(this,"bigint");u(this,U3,Op);u(this,B3,Ol);u(this,"_hash");this.incremental=t,this.bigint=n,this._hash=ve(kp)}[(U3=wp,B3=Ol,G)](){return this._hash}[H](t){return Ip(t)}pipe(){return v(this,arguments)}}class oR{constructor(t){u(this,"boundaries");u(this,j3,Op);u(this,K3,Il);u(this,"_hash");this.boundaries=t,this._hash=d(ve(Ep),ee(N(this.boundaries)))}[(j3=wp,K3=Il,G)](){return this._hash}[H](t){return Tp(t)&&J(this.boundaries,t.boundaries)}pipe(){return v(this,arguments)}}const iR=e=>new sR((e==null?void 0:e.incremental)??!1,(e==null?void 0:e.bigint)??!1),cR=e=>new oR(e),Ip=e=>K(e,Ol),aR=e=>K(e,tR),uR=e=>K(e,nR),Tp=e=>K(e,Il),lR=e=>K(e,rR),$p=Symbol.for("effect/MetricKey"),fR={_Type:e=>e},hR=Ha(J);class Tl{constructor(t,n,r,s=[]){u(this,"name");u(this,"keyType");u(this,"description");u(this,"tags");u(this,q3,fR);u(this,"_hash");this.name=t,this.keyType=n,this.description=r,this.tags=s,this._hash=d(ve(this.name+this.description),ee(N(this.keyType)),ee(As(this.tags)))}[(q3=$p,G)](){return this._hash}[H](t){return dR(t)&&this.name===t.name&&J(this.keyType,t.keyType)&&J(this.description,t.description)&&hR(this.tags,t.tags)}pipe(){return v(this,arguments)}}const dR=e=>K(e,$p),mR=(e,t)=>new Tl(e,iR(t),Us(t==null?void 0:t.description)),gR=(e,t,n)=>new Tl(e,cR(t),Us(n)),pR=h(2,(e,t)=>t.length===0?e:new Tl(e.name,e.keyType,e.description,Ei(e.tags,t))),Rp=Symbol.for("effect/MutableHashMap"),yR={[Rp]:Rp,[Symbol.iterator](){return new $l(this)},toString(){return Ie(this.toJSON())},toJSON(){return{_id:"MutableHashMap",values:Array.from(this).map(ye)}},[he](){return this.toJSON()},pipe(){return v(this,arguments)}};class $l{constructor(t){u(this,"self");u(this,"referentialIterator");u(this,"bucketIterator");this.self=t,this.referentialIterator=t.referential[Symbol.iterator]()}next(){if(this.bucketIterator!==void 0)return this.bucketIterator.next();const t=this.referentialIterator.next();return t.done?(this.bucketIterator=new bR(this.self.buckets.values()),this.next()):t}[Symbol.iterator](){return new $l(this.self)}}class bR{constructor(t){u(this,"backing");u(this,"currentBucket");this.backing=t}next(){if(this.currentBucket===void 0){const n=this.backing.next();if(n.done)return n;this.currentBucket=n.value[Symbol.iterator]()}const t=this.currentBucket.next();return t.done?(this.currentBucket=void 0,this.next()):t}}const _R=()=>{const e=Object.create(yR);return e.referential=new Map,e.buckets=new Map,e.bucketsSize=0,e},tr=h(2,(e,t)=>{if(ci(t)===!1)return e.referential.has(t)?T(e.referential.get(t)):O();const n=t[G](),r=e.buckets.get(n);return r===void 0?O():SR(e,r,t)}),SR=(e,t,n,r=!1)=>{for(let s=0,o=t.length;s<o;s++)if(n[H](t[s][0])){const i=t[s][1];return r&&(t.splice(s,1),e.bucketsSize--),T(i)}return O()},_o=h(2,(e,t)=>le(tr(e,t))),So=h(3,(e,t,n)=>{if(ci(t)===!1)return e.referential.set(t,n),e;const r=t[G](),s=e.buckets.get(r);return s===void 0?(e.buckets.set(r,[[t,n]]),e.bucketsSize++,e):(wR(e,s,t),s.push([t,n]),e.bucketsSize++,e)}),wR=(e,t,n)=>{for(let r=0,s=t.length;r<s;r++)if(n[H](t[r][0])){t.splice(r,1),e.bucketsSize--;return}},wo=Symbol.for("effect/MetricState"),Fp="effect/MetricState/Counter",Rl=Symbol.for(Fp),Np="effect/MetricState/Frequency",Fl=Symbol.for(Np),vp="effect/MetricState/Gauge",Nl=Symbol.for(vp),Cp="effect/MetricState/Histogram",vl=Symbol.for(Cp),Ap="effect/MetricState/Summary",Cl=Symbol.for(Ap),ko={_A:e=>e};class kR{constructor(t){u(this,"count");u(this,V3,ko);u(this,J3,Rl);this.count=t}[(V3=wo,J3=Rl,G)](){return d(N(Fp),ee(N(this.count)),Ee(this))}[H](t){return AR(t)&&this.count===t.count}pipe(){return v(this,arguments)}}const ER=Ha(J);class OR{constructor(t){u(this,"occurrences");u(this,z3,ko);u(this,W3,Fl);u(this,"_hash");this.occurrences=t}[(z3=wo,W3=Fl,G)](){return d(ve(Np),ee(As(ge(this.occurrences.entries()))),Ee(this))}[H](t){return xR(t)&&ER(ge(this.occurrences.entries()),ge(t.occurrences.entries()))}pipe(){return v(this,arguments)}}class IR{constructor(t){u(this,"value");u(this,H3,ko);u(this,G3,Nl);this.value=t}[(H3=wo,G3=Nl,G)](){return d(N(vp),ee(N(this.value)),Ee(this))}[H](t){return MR(t)&&this.value===t.value}pipe(){return v(this,arguments)}}class TR{constructor(t,n,r,s,o){u(this,"buckets");u(this,"count");u(this,"min");u(this,"max");u(this,"sum");u(this,Y3,ko);u(this,X3,vl);this.buckets=t,this.count=n,this.min=r,this.max=s,this.sum=o}[(Y3=wo,X3=vl,G)](){return d(N(Cp),ee(N(this.buckets)),ee(N(this.count)),ee(N(this.min)),ee(N(this.max)),ee(N(this.sum)),Ee(this))}[H](t){return PR(t)&&J(this.buckets,t.buckets)&&this.count===t.count&&this.min===t.min&&this.max===t.max&&this.sum===t.sum}pipe(){return v(this,arguments)}}class $R{constructor(t,n,r,s,o,i){u(this,"error");u(this,"quantiles");u(this,"count");u(this,"min");u(this,"max");u(this,"sum");u(this,Q3,ko);u(this,Z3,Cl);this.error=t,this.quantiles=n,this.count=r,this.min=s,this.max=o,this.sum=i}[(Q3=wo,Z3=Cl,G)](){return d(N(Ap),ee(N(this.error)),ee(N(this.quantiles)),ee(N(this.count)),ee(N(this.min)),ee(N(this.max)),ee(N(this.sum)),Ee(this))}[H](t){return LR(t)&&this.error===t.error&&J(this.quantiles,t.quantiles)&&this.count===t.count&&this.min===t.min&&this.max===t.max&&this.sum===t.sum}pipe(){return v(this,arguments)}}const RR=e=>new kR(e),FR=e=>new OR(e),NR=e=>new IR(e),vR=e=>new TR(e.buckets,e.count,e.min,e.max,e.sum),CR=e=>new $R(e.error,e.quantiles,e.count,e.min,e.max,e.sum),AR=e=>K(e,Rl),xR=e=>K(e,Fl),MR=e=>K(e,Nl),PR=e=>K(e,vl),LR=e=>K(e,Cl),DR=Symbol.for("effect/MetricHook"),UR={_In:e=>e,_Out:e=>e},Eo=e=>({[DR]:UR,pipe(){return v(this,arguments)},...e}),xp=BigInt(0),BR=e=>{let t=e.keyType.bigint?xp:0;const n=e.keyType.incremental?e.keyType.bigint?s=>s>=xp:s=>s>=0:s=>!0,r=s=>{n(s)&&(t=t+s)};return Eo({get:()=>RR(t),update:r,modify:r})},jR=e=>{const t=new Map;for(const r of e.keyType.preregisteredWords)t.set(r,0);const n=r=>{const s=t.get(r)??0;t.set(r,s+1)};return Eo({get:()=>FR(t),update:n,modify:n})},KR=(e,t)=>{let n=t;return Eo({get:()=>NR(n),update:r=>{n=r},modify:r=>{n=n+r}})},qR=e=>{const t=e.keyType.boundaries.values,n=t.length,r=new Uint32Array(n+1),s=new Float32Array(n);let o=0,i=0,c=Number.MAX_VALUE,a=Number.MIN_VALUE;d(t,Ks(Hr),Bn((m,g)=>{s[g]=m}));const l=m=>{let g=0,p=n;for(;g!==p;){const y=Math.floor(g+(p-g)/2),k=s[y];m<=k?p=y:g=y,p===g+1&&(m<=s[g]?p=g:g=p)}r[g]=r[g]+1,o=o+1,i=i+m,m<c&&(c=m),m>a&&(a=m)},f=()=>{const m=Si(n);let g=0;for(let p=0;p<n;p++){const y=s[p],k=r[p];g=g+k,m[p]=[y,g]}return m};return Eo({get:()=>vR({buckets:f(),count:o,min:c,max:a,sum:i}),update:l,modify:l})},VR=e=>{const{error:t,maxAge:n,maxSize:r,quantiles:s}=e.keyType,o=d(s,Ks(Hr)),i=Si(r);let c=0,a=0,l=0,f=Number.MAX_VALUE,m=Number.MIN_VALUE;const g=y=>{const k=[];let b=0;for(;b!==r-1;){const _=i[b];if(_!=null){const[I,$]=_,A=_i(y-I);Mw(A,Iw)&&A<=n&&k.push($)}b=b+1}return JR(t,o,Ks(k,Hr))},p=(y,k)=>{if(r>0){c=c+1;const b=c%r;i[b]=[k,y]}a=a+1,l=l+y,y<f&&(f=y),y>m&&(m=y)};return Eo({get:()=>CR({error:t,quantiles:g(Date.now()),count:a,min:f,max:m,sum:l}),update:([y,k])=>p(y,k),modify:([y,k])=>p(y,k)})},JR=(e,t,n)=>{const r=n.length;if(!Le(t))return pn();const s=t[0],o=t.slice(1),i=Mp(e,r,O(),0,s,n),c=Tt(i);return o.forEach(a=>{c.push(Mp(e,r,i.value,i.consumed,a,i.rest))}),Bn(c,a=>[a.quantile,a.value])},Mp=(e,t,n,r,s,o)=>{let i=e,c=t,a=n,l=r,f=s,m=o,g=e,p=t,y=n,k=r,b=s,_=o;for(;;){if(!Le(m))return{quantile:f,value:O(),consumed:l,rest:[]};if(f===1)return{quantile:f,value:T(sd(m)),consumed:l+m.length,rest:[]};const I=tk(m,M=>M<=m[0]),$=f*c,A=i/2*$,V=l+I[0].length,D=Math.abs(V-$);if(V<$-A){g=i,p=c,y=js(m),k=V,b=f,_=I[1],i=g,c=p,a=y,l=k,f=b,m=_;continue}if(V>$+A)return{quantile:f,value:a,consumed:l,rest:m};switch(a._tag){case"None":{g=i,p=c,y=js(m),k=V,b=f,_=I[1],i=g,c=p,a=y,l=k,f=b,m=_;continue}case"Some":{const M=Math.abs($-a.value);if(D<M){g=i,p=c,y=js(m),k=V,b=f,_=I[1],i=g,c=p,a=y,l=k,f=b,m=_;continue}return{quantile:f,value:T(a.value),consumed:l,rest:m}}}}throw new Error("BUG: MetricHook.resolveQuantiles - please report an issue at https://github.com/Effect-TS/effect/issues")},zR=Symbol.for("effect/MetricPair"),WR={_Type:e=>e},HR=(e,t)=>({[zR]:WR,metricKey:e,metricState:t,pipe(){return v(this,arguments)}}),Pp=Symbol.for("effect/MetricRegistry");class GR{constructor(){u(this,eL,Pp);u(this,"map",_R())}snapshot(){const t=[];for(const[n,r]of this.map)t.push(HR(n,r.get()));return t}get(t){const n=d(this.map,tr(t),Wt);if(n==null){if(Ip(t.keyType))return this.getCounter(t);if(uR(t.keyType))return this.getGauge(t);if(aR(t.keyType))return this.getFrequency(t);if(Tp(t.keyType))return this.getHistogram(t);if(lR(t.keyType))return this.getSummary(t);throw new Error("BUG: MetricRegistry.get - unknown MetricKeyType - please report an issue at https://github.com/Effect-TS/effect/issues")}else return n}getCounter(t){let n=d(this.map,tr(t),Wt);if(n==null){const r=BR(t);d(this.map,_o(t))||d(this.map,So(t,r)),n=r}return n}getFrequency(t){let n=d(this.map,tr(t),Wt);if(n==null){const r=jR(t);d(this.map,_o(t))||d(this.map,So(t,r)),n=r}return n}getGauge(t){let n=d(this.map,tr(t),Wt);if(n==null){const r=KR(t,t.keyType.bigint?BigInt(0):0);d(this.map,_o(t))||d(this.map,So(t,r)),n=r}return n}getHistogram(t){let n=d(this.map,tr(t),Wt);if(n==null){const r=qR(t);d(this.map,_o(t))||d(this.map,So(t,r)),n=r}return n}getSummary(t){let n=d(this.map,tr(t),Wt);if(n==null){const r=VR(t);d(this.map,_o(t))||d(this.map,So(t,r)),n=r}return n}}eL=Pp;const YR=()=>new GR,XR=Symbol.for("effect/Metric"),QR={_Type:e=>e,_In:e=>e,_Out:e=>e},Lp=W(Symbol.for("effect/Metric/globalMetricRegistry"),()=>YR()),Dp=function(e,t,n,r){const s=Object.assign(o=>oo(o,i=>nF(s,i)),{[XR]:QR,keyType:e,unsafeUpdate:t,unsafeValue:n,unsafeModify:r,register(){return this.unsafeValue([]),this},pipe(){return v(this,arguments)}});return s},Oc=(e,t)=>Up(mR(e,t)),Up=e=>{let t;const n=new WeakMap,r=s=>{if(s.length===0)return t!==void 0||(t=Lp.get(e)),t;let o=n.get(s);return o!==void 0||(o=Lp.get(pR(e,s)),n.set(s,o)),o};return Dp(e.keyType,(s,o)=>r(o).update(s),s=>r(s).get(),(s,o)=>r(o).modify(s))},ZR=(e,t,n)=>Up(gR(e,t,n)),eF=h(3,(e,t,n)=>tF(e,[i$(t,n)])),tF=h(2,(e,t)=>Dp(e.keyType,(n,r)=>e.unsafeUpdate(n,Ei(t,r)),n=>e.unsafeValue(Ei(t,n)),(n,r)=>e.unsafeModify(n,Ei(t,r)))),nF=h(2,(e,t)=>ao(Du,n=>E(()=>e.unsafeUpdate(t,n)))),rF=Symbol.for("effect/Request"),sF={_E:e=>e,_A:e=>e};({...xa,[rF]:0});const oF=h(2,(e,t)=>ao(ip,n=>E(()=>{if(n.has(e)){const r=n.get(e);r.state.completed||(r.state.completed=!0,Gu(r.result,t))}}))),Ic=Symbol.for("effect/Supervisor"),Al={_T:e=>e},bh=class bh{constructor(t,n){u(this,"underlying");u(this,"value0");u(this,tL,Al);this.underlying=t,this.value0=n}get value(){return this.value0}onStart(t,n,r,s){this.underlying.onStart(t,n,r,s)}onEnd(t,n){this.underlying.onEnd(t,n)}onEffect(t,n){this.underlying.onEffect(t,n)}onSuspend(t){this.underlying.onSuspend(t)}onResume(t){this.underlying.onResume(t)}map(t){return new bh(this,d(this.value,X(t)))}zip(t){return new $c(this,t)}};tL=Ic;let Tc=bh;const _h=class _h{constructor(t,n){u(this,"left");u(this,"right");u(this,"_tag","Zip");u(this,nL,Al);this.left=t,this.right=n}get value(){return tc(this.left.value,this.right.value)}onStart(t,n,r,s){this.left.onStart(t,n,r,s),this.right.onStart(t,n,r,s)}onEnd(t,n){this.left.onEnd(t,n),this.right.onEnd(t,n)}onEffect(t,n){this.left.onEffect(t,n),this.right.onEffect(t,n)}onSuspend(t){this.left.onSuspend(t),this.right.onSuspend(t)}onResume(t){this.left.onResume(t),this.right.onResume(t)}map(t){return new Tc(this,d(this.value,X(t)))}zip(t){return new _h(this,t)}};nL=Ic;let $c=_h;const Bp=e=>K(e,Ic)&&Ta(e,"Zip");class iF{constructor(t){u(this,"effect");u(this,rL,Al);this.effect=t}get value(){return this.effect}onStart(t,n,r,s){}onEnd(t,n){}onEffect(t,n){}onSuspend(t){}onResume(t){}map(t){return new Tc(this,d(this.value,X(t)))}zip(t){return new $c(this,t)}onRun(t,n){return t()}}rL=Ic;const cF=e=>new iF(e),Rc=W("effect/Supervisor/none",()=>cF(we)),aF=Fr,jp="Empty",Kp="AddSupervisor",qp="RemoveSupervisor",Vp="AndThen",Oo={_tag:jp},Fc=(e,t)=>({_tag:Vp,first:e,second:t}),uF=(e,t)=>lF(t,De(e)),lF=(e,t)=>{let n=e,r=t;for(;Yt(r);){const s=Bt(r);switch(s._tag){case jp:{r=Xt(r);break}case Kp:{n=n.zip(s.supervisor),r=Xt(r);break}case qp:{n=xl(n,s.supervisor),r=Xt(r);break}case Vp:{r=Xe(s.first)(Xe(s.second)(Xt(r)));break}}}return n},xl=(e,t)=>J(e,t)?Rc:Bp(e)?xl(e.left,t).zip(xl(e.right,t)):e,Nc=e=>J(e,Rc)?qn():Bp(e)?d(Nc(e.left),Ws(Nc(e.right))):lu(e),fF=aF({empty:Oo,patch:uF,combine:Fc,diff:(e,t)=>{if(J(e,t))return Oo;const n=Nc(e),r=Nc(t),s=d(r,xd(n),Ai(Oo,(i,c)=>Fc(i,{_tag:Kp,supervisor:c}))),o=d(n,xd(r),Ai(Oo,(i,c)=>Fc(i,{_tag:qp,supervisor:c})));return Fc(s,o)}}),hF=Oc("effect_fiber_started",{incremental:!0}),Jp=Oc("effect_fiber_active"),dF=Oc("effect_fiber_successes",{incremental:!0}),mF=Oc("effect_fiber_failures",{incremental:!0}),gF=eF(ZR("effect_fiber_lifetimes",eR({start:.5,factor:2,count:35})),"time_unit","milliseconds"),Io="Continue",pF="Done",zp="Yield",yF={_E:e=>e,_A:e=>e},To=e=>{throw new Error(`BUG: FiberRuntime - ${xs(e)} - please report an issue at https://github.com/Effect-TS/effect/issues`)},Fn=Symbol.for("effect/internal/fiberRuntime/YieldedOp"),sn=W("effect/internal/fiberRuntime/yieldedOpChannel",()=>({currentOp:null})),vc={[li]:(e,t,n)=>Ge(()=>t.effect_instruction_i1(n)),OnStep:(e,t,n)=>ke(ke(n)),[fi]:(e,t,n)=>Ge(()=>t.effect_instruction_i2(n)),[Aa]:(e,t,n)=>(e.patchRuntimeFlags(e.currentRuntimeFlags,t.patch),_n(e.currentRuntimeFlags)&&e.isInterrupted()?de(e.getInterruptedCause()):ke(n)),[hi]:(e,t,n)=>(Ge(()=>t.effect_instruction_i2(n)),Ge(()=>t.effect_instruction_i0())?(e.pushStack(t),Ge(()=>t.effect_instruction_i1())):we)},bF={[pl]:(e,t,n,r)=>(e.processNewInterruptSignal(r.cause),_n(t)?de(r.cause):n),[bl]:(e,t,n,r)=>{throw new Error("It is illegal to have multiple concurrent run loops in a single fiber")},[yl]:(e,t,n,r)=>(r.onFiber(e,Bg(t)),n),[_l]:(e,t,n,r)=>w(Mu(),()=>n)},_F=e=>Qi(S1(e),t=>on(x1(t),([n,r])=>{const s=new Map,o=[];for(const c of r){o.push(Ut(c));for(const a of c)s.set(a.request,a)}const i=o.flat();return uo(UF(n.runAll(o),i,()=>i.forEach(c=>{c.listeners.interrupted=!0})),ip,s)},!1,!1));class Wp extends mc{constructor(n,r,s){super();u(this,sL,_p);u(this,oL,yF);u(this,"_fiberRefs");u(this,"_fiberId");u(this,"_queue",new Array);u(this,"_children",null);u(this,"_observers",new Array);u(this,"_running",!1);u(this,"_stack",[]);u(this,"_asyncInterruptor",null);u(this,"_asyncBlockingOn",null);u(this,"_exitValue",null);u(this,"_steps",[]);u(this,"_isYielding",!1);u(this,"currentRuntimeFlags");u(this,"currentOpCount",0);u(this,"currentSupervisor");u(this,"currentScheduler");u(this,"currentTracer");u(this,"currentSpan");u(this,"currentContext");u(this,"currentDefaultServices");u(this,"run",()=>{this.drainQueueOnCurrentThread()});if(this.currentRuntimeFlags=s,this._fiberId=n,this._fiberRefs=r,rm(s)){const o=this.getFiberRef(Du);hF.unsafeUpdate(1,o),Jp.unsafeUpdate(1,o)}this.refreshRefCache()}commit(){return es(this)}id(){return this._fiberId}resume(n){this.tell(Zr(n))}get status(){return this.ask((n,r)=>r)}get runtimeFlags(){return this.ask((n,r)=>ET(r)?n.currentRuntimeFlags:r.runtimeFlags)}scope(){return j$(this)}get children(){return this.ask(n=>Array.from(n.getChildren()))}getChildren(){return this._children===null&&(this._children=new Set),this._children}getInterruptedCause(){return this.getFiberRef(sc)}fiberRefs(){return this.ask(n=>n.getFiberRefs())}ask(n){return te(()=>{const r=uc(this._fiberId);return this.tell(wc((s,o)=>{Gu(r,E(()=>n(s,o)))})),On(r)})}tell(n){this._queue.push(n),this._running||(this._running=!0,this.drainQueueLaterOnExecutor())}get await(){return et(n=>{const r=s=>n(R(s));return this.tell(wc((s,o)=>{s._exitValue!==null?r(this._exitValue):s.addObserver(r)})),E(()=>this.tell(wc((s,o)=>{s.removeObserver(r)})))},this.id())}get inheritAll(){return oe((n,r)=>{const s=n.id(),o=n.getFiberRefs(),i=r.runtimeFlags,c=this.getFiberRefs(),a=iT(o,s,c);n.setFiberRefs(a);const l=n.getFiberRef(iy),f=d(Sn(i,l),im(Nr),im(Eu));return Mm(f)})}get poll(){return E(()=>Us(this._exitValue))}unsafePoll(){return this._exitValue}interruptAsFork(n){return E(()=>this.tell(Sl(Rt(n))))}unsafeInterruptAsFork(n){this.tell(Sl(Rt(n)))}addObserver(n){this._exitValue!==null?n(this._exitValue):this._observers.push(n)}removeObserver(n){this._observers=this._observers.filter(r=>r!==n)}getFiberRefs(){return this.setFiberRef(iy,this.currentRuntimeFlags),this._fiberRefs}unsafeDeleteFiberRef(n){this._fiberRefs=Fg(this._fiberRefs,n)}getFiberRef(n){return this._fiberRefs.locals.has(n)?this._fiberRefs.locals.get(n)[0][1]:n.initial}setFiberRef(n,r){this._fiberRefs=sl(this._fiberRefs,{fiberId:this._fiberId,fiberRef:n,value:r}),this.refreshRefCache()}refreshRefCache(){this.currentDefaultServices=this.getFiberRef(Yr),this.currentTracer=this.currentDefaultServices.unsafeMap.get(el.key),this.currentSupervisor=this.getFiberRef(PF),this.currentScheduler=this.getFiberRef(dl),this.currentContext=this.getFiberRef(Ft),this.currentSpan=this.currentContext.unsafeMap.get(dc.key)}setFiberRefs(n){this._fiberRefs=n,this.refreshRefCache()}addChild(n){this.getChildren().add(n)}removeChild(n){this.getChildren().delete(n)}drainQueueOnCurrentThread(){let n=!0;for(;n;){let r=Io;const s=globalThis[er];globalThis[er]=this;try{for(;r===Io;)r=this._queue.length===0?pF:this.evaluateMessageWhileSuspended(this._queue.splice(0,1)[0])}finally{this._running=!1,globalThis[er]=s}this._queue.length>0&&!this._running?(this._running=!0,r===zp?(this.drainQueueLaterOnExecutor(),n=!1):n=!0):n=!1}}drainQueueLaterOnExecutor(){this.currentScheduler.scheduleTask(this.run,this.getFiberRef(lo))}drainQueueWhileRunning(n,r){let s=r;for(;this._queue.length>0;){const o=this._queue.splice(0,1)[0];s=bF[o._tag](this,n,s,o)}return s}isInterrupted(){return!P1(this.getFiberRef(sc))}addInterruptedCause(n){const r=this.getFiberRef(sc);this.setFiberRef(sc,qe(r,n))}processNewInterruptSignal(n){this.addInterruptedCause(n),this.sendInterruptSignalToAllChildren()}sendInterruptSignalToAllChildren(){if(this._children===null||this._children.size===0)return!1;let n=!1;for(const r of this._children)r.tell(Sl(Rt(this.id()))),n=!0;return n}interruptAllChildren(){if(this.sendInterruptSignalToAllChildren()){const n=this._children.values();this._children=null;let r=!1;return xu({while:()=>!r,body:()=>{const o=n.next();return o.done?E(()=>{r=!0}):wt(o.value.await)},step:()=>{}})}return null}reportExitValue(n){if(rm(this.currentRuntimeFlags)){const r=this.getFiberRef(Du),s=this.id().startTimeMillis,o=Date.now();switch(gF.unsafeUpdate(o-s,r),Jp.unsafeUpdate(-1,r),n._tag){case Pe:{dF.unsafeUpdate(1,r);break}case Me:{mF.unsafeUpdate(1,r);break}}}if(n._tag==="Failure"){const r=this.getFiberRef(xO);!Tu(n.cause)&&r._tag==="Some"&&this.log("Fiber terminated with an unhandled error",n.cause,r)}}setExitValue(n){this._exitValue=n,this.reportExitValue(n);for(let r=this._observers.length-1;r>=0;r--)this._observers[r](n)}getLoggers(){return this.getFiberRef(Ml)}log(n,r,s){const o=le(s)?s.value:this.getFiberRef(FO),i=this.getFiberRef(Hp);if(RT(i,o))return;const c=this.getFiberRef(NO),a=this.getFiberRef(RO),l=this.getLoggers(),f=this.getFiberRefs();if(Ad(l)>0){const m=Ls(this.getFiberRef(Yr),Wr),g=new Date(m.unsafeCurrentTimeMillis());for(const p of l)p.log({fiberId:this.id(),logLevel:o,message:n,cause:r,context:f,spans:c,annotations:a,date:g})}}evaluateMessageWhileSuspended(n){switch(n._tag){case _l:return zp;case pl:return this.processNewInterruptSignal(n.cause),this._asyncInterruptor!==null&&(this._asyncInterruptor(de(n.cause)),this._asyncInterruptor=null),Io;case bl:return this._asyncInterruptor=null,this._asyncBlockingOn=null,this.evaluateEffect(n.effect),Io;case yl:return n.onFiber(this,this._exitValue!==null?wT:kT(this.currentRuntimeFlags,this._asyncBlockingOn)),Io;default:return To(n)}}evaluateEffect(n){this.currentSupervisor.onResume(this);try{let r=_n(this.currentRuntimeFlags)&&this.isInterrupted()?de(this.getInterruptedCause()):n;for(;r!==null;){const s=r,o=this.runLoop(s);if(o===Fn){const i=sn.currentOp;sn.currentOp=null,i._op===di?g1(this.currentRuntimeFlags)?(this.tell(D$()),this.tell(Zr(ft)),r=null):r=ft:i._op===Ms&&(r=null)}else{this.currentRuntimeFlags=d(this.currentRuntimeFlags,p1(Eu));const i=this.interruptAllChildren();i!==null?r=w(i,()=>o):(this._queue.length===0?this.setExitValue(o):this.tell(Zr(o)),r=null)}}}finally{this.currentSupervisor.onSuspend(this)}}start(n){if(this._running)this.tell(Zr(n));else{this._running=!0;const r=globalThis[er];globalThis[er]=this;try{this.evaluateEffect(n)}finally{this._running=!1,globalThis[er]=r,this._queue.length>0&&this.drainQueueLaterOnExecutor()}}}startFork(n){this.tell(Zr(n))}patchRuntimeFlags(n,r){const s=vr(n,r);return globalThis[er]=this,this.currentRuntimeFlags=s,s}initiateAsync(n,r){let s=!1;const o=i=>{s||(s=!0,this.tell(Zr(i)))};_n(n)&&(this._asyncInterruptor=o);try{r(o)}catch(i){o(Se(st(i)))}}pushStack(n){this._stack.push(n),n._op==="OnStep"&&this._steps.push({refs:this.getFiberRefs(),flags:this.currentRuntimeFlags})}popStack(){const n=this._stack.pop();if(n)return n._op==="OnStep"&&this._steps.pop(),n}getNextSuccessCont(){let n=this.popStack();for(;n;){if(n._op!==ui)return n;n=this.popStack()}}getNextFailCont(){let n=this.popStack();for(;n;){if(n._op!==li&&n._op!==hi)return n;n=this.popStack()}}[(sL=bp,oL=q$,B0)](n){return E(()=>La(this.currentContext,n))}Left(n){return _e(n.left)}None(n){return _e(new Ku)}Right(n){return ke(n.right)}Some(n){return ke(n.value)}Micro(n){return oO(r=>{const s=DT().pipe(UT(qT,this.getFiberRef(Ft)));let o=r;return n[yc](s,i=>{if(i._tag==="Right")return o(ke(i.right));switch(i.left._tag){case"Interrupt":return o(de(Rt(Jn)));case"Fail":return o(_e(i.left.error));case"Die":return o(ro(i.left.defect))}}),et(i=>{o=c=>{i(we)},ll(s,Yg).abort()})})}[Th](n){const r=Ge(()=>n.effect_instruction_i0()),s=this.getNextSuccessCont();return s!==void 0?(s._op in vc||To(s),vc[s._op](this,s,r)):(sn.currentOp=ke(r),Fn)}[Pe](n){const r=n,s=this.getNextSuccessCont();return s!==void 0?(s._op in vc||To(s),vc[s._op](this,s,r.effect_instruction_i0)):(sn.currentOp=r,Fn)}[Me](n){const r=n.effect_instruction_i0,s=this.getNextFailCont();if(s!==void 0)switch(s._op){case ui:case fi:return _n(this.currentRuntimeFlags)&&this.isInterrupted()?de(pm(r)):Ge(()=>s.effect_instruction_i1(r));case"OnStep":return _n(this.currentRuntimeFlags)&&this.isInterrupted()?de(pm(r)):ke(de(r));case Aa:return this.patchRuntimeFlags(this.currentRuntimeFlags,s.patch),_n(this.currentRuntimeFlags)&&this.isInterrupted()?de(qe(r,this.getInterruptedCause())):de(r);default:To(s)}else return sn.currentOp=de(r),Fn}[$h](n){return Ge(()=>n.effect_instruction_i0(this,Bg(this.currentRuntimeFlags)))}Blocked(n){const r=this.getFiberRefs(),s=this.currentRuntimeFlags;if(this._steps.length>0){const o=[],i=this._steps[this._steps.length-1];let c=this.popStack();for(;c&&c._op!=="OnStep";)o.push(c),c=this.popStack();this.setFiberRefs(i.refs),this.currentRuntimeFlags=i.flags;const a=go(i.refs,r),l=Sn(i.flags,s);return ke(Em(n.effect_instruction_i0,oe(f=>{for(;o.length>0;)f.pushStack(o.pop());return f.setFiberRefs(po(f.id(),f.getFiberRefs())(a)),f.currentRuntimeFlags=vr(l)(f.currentRuntimeFlags),n.effect_instruction_i1})))}return kt(o=>w(Cc(rO(n.effect_instruction_i0)),()=>o(n.effect_instruction_i1)))}RunBlocked(n){return _F(n.effect_instruction_i0)}[gr](n){const r=n.effect_instruction_i0,s=this.currentRuntimeFlags,o=vr(s,r);if(_n(o)&&this.isInterrupted())return de(this.getInterruptedCause());if(this.patchRuntimeFlags(this.currentRuntimeFlags,r),n.effect_instruction_i1){const i=Sn(o,s);return this.pushStack(new sO(i,n)),Ge(()=>n.effect_instruction_i1(s))}else return ft}[li](n){return this.pushStack(n),n.effect_instruction_i0}OnStep(n){return this.pushStack(n),n.effect_instruction_i0}[ui](n){return this.pushStack(n),n.effect_instruction_i0}[fi](n){return this.pushStack(n),n.effect_instruction_i0}[Ms](n){return this._asyncBlockingOn=n.effect_instruction_i1,this.initiateAsync(this.currentRuntimeFlags,n.effect_instruction_i0),sn.currentOp=n,Fn}[di](n){return this._isYielding=!1,sn.currentOp=n,Fn}[hi](n){const r=n.effect_instruction_i0,s=n.effect_instruction_i1;return r()?(this.pushStack(n),s()):ft}[Ca](n){return Ge(()=>n.commit())}runLoop(n){let r=n;for(this.currentOpCount=0;;){if(this.currentRuntimeFlags&m1&&this.currentSupervisor.onEffect(this,r),this._queue.length>0&&(r=this.drainQueueWhileRunning(this.currentRuntimeFlags,r)),!this._isYielding){this.currentOpCount+=1;const s=this.currentScheduler.shouldYield(this);if(s!==!1){this._isYielding=!0,this.currentOpCount=0;const o=r;r=w(Mu({priority:s}),()=>o)}}try{if((!("_op"in r)||!(r._op in this))&&To(r),r=this.currentTracer.context(()=>ti()!==r[jr]._V?Nm(`Cannot execute an Effect versioned ${r[jr]._V} with a Runtime of version ${ti()}`):this[r._op](r),this),r===Fn){const s=sn.currentOp;return s._op===di||s._op===Ms?Fn:(sn.currentOp=null,s._op===Pe||s._op===Me?s:de(st(s)))}}catch(s){tO(s)?r=de(s.cause):UO(s)?r=de(qe(st(s),Rt(Jn))):r=ro(s)}}}}const Hp=W("effect/FiberRef/currentMinimumLogLevel",()=>Be(FT("Info"))),SF=e=>Ec(t=>{const n=uT(t.context,Yr);Ls(n,bg).unsafe.log(e.log(t))}),Gp=W(Symbol.for("effect/Logger/defaultLogger"),()=>SF(W$)),wF=W(Symbol.for("effect/Logger/tracerLogger"),()=>Ec(({annotations:e,cause:t,context:n,fiberId:r,logLevel:s,message:o})=>{const i=Sr(mo(n,Ft),dc);if(i._tag==="None"||i.value._tag==="ExternalSpan")return;const c=La(mo(n,Yr),Wr),a={};for(const[l,f]of e)a[l]=f;a["effect.fiberId"]=oE(r),a["effect.logLevel"]=s.label,t!==null&&t._tag!=="Empty"&&(a["effect.cause"]=Vi(t,{renderErrorCause:!0})),i.value.event(xs(Array.isArray(o)?o[0]:o),c.unsafeCurrentTimeNanos(),a)})),Ml=W(Symbol.for("effect/FiberRef/currentLoggers"),()=>IO(lu(Gp,wF))),Yp=h(e=>wn(e[0]),(e,t)=>io(oo(e,n=>kF(r=>t(n,r))))),kF=e=>oe(t=>{const n=t.getFiberRefs(),r=t.currentRuntimeFlags;return w(ny,s=>Bu(s,o=>oe(i=>{const c=i.getFiberRefs(),a=i.currentRuntimeFlags,l=go(c,n),f=Sn(a,r),m=go(n,c);return i.setFiberRefs(po(l,i.id(),n)),Ro(mO(e(o),f),E(()=>{i.setFiberRefs(po(m,i.id(),i.getFiberRefs()))}))})))}),EF=e=>{if(Array.isArray(e)||Eh(e))return[e,O()];const t=Object.keys(e),n=t.length;return[t.map(r=>e[r]),T(r=>{const s={};for(let o=0;o<n;o++)s[t[o]]=r[o];return s})]},OF=(e,t,n)=>{const r=[];for(const s of e)r.push(Kr(s));return w(ts(r,L,{concurrency:n==null?void 0:n.concurrency,batching:n==null?void 0:n.batching}),s=>{const o=O(),i=s.length,c=new Array(i),a=new Array(i);let l=!1;for(let f=0;f<i;f++){const m=s[f];m._tag==="Left"?(c[f]=T(m.left),l=!0):(a[f]=m.right,c[f]=o)}return l?t._tag==="Some"?_e(t.value(c)):_e(c):n!=null&&n.discard?we:t._tag==="Some"?R(t.value(a)):R(a)})},IF=(e,t,n)=>{const r=[];for(const s of e)r.push(Kr(s));return n!=null&&n.discard?ts(r,L,{concurrency:n==null?void 0:n.concurrency,batching:n==null?void 0:n.batching,discard:!0}):X(ts(r,L,{concurrency:n==null?void 0:n.concurrency,batching:n==null?void 0:n.batching}),s=>t._tag==="Some"?t.value(s):s)},Xp=(e,t)=>{const[n,r]=EF(e);return(t==null?void 0:t.mode)==="validate"?OF(n,r,t):(t==null?void 0:t.mode)==="either"?IF(n,r,t):(t==null?void 0:t.discard)!==!0&&r._tag==="Some"?X(ts(n,L,t),r.value):ts(n,L,t)},ts=h(e=>Eh(e[0]),(e,t,n)=>oe(r=>{const s=(n==null?void 0:n.batching)===!0||(n==null?void 0:n.batching)==="inherit"&&r.getFiberRef(AO);return n!=null&&n.discard?cp(n.concurrency,()=>ns(tl,n==null?void 0:n.concurrentFinalizers)(o=>s?on(e,(i,c)=>o(t(i,c)),!0,!1,1):Qi(e,(i,c)=>o(t(i,c)))),()=>ns(nl,n==null?void 0:n.concurrentFinalizers)(o=>on(e,(i,c)=>o(t(i,c)),s,!1)),o=>ns(rl(o),n==null?void 0:n.concurrentFinalizers)(i=>on(e,(c,a)=>i(t(c,a)),s,!1,o))):cp(n==null?void 0:n.concurrency,()=>ns(tl,n==null?void 0:n.concurrentFinalizers)(o=>s?Pl(e,1,(i,c)=>o(t(i,c)),!0):tn(e,(i,c)=>o(t(i,c)))),()=>ns(nl,n==null?void 0:n.concurrentFinalizers)(o=>Qp(e,(i,c)=>o(t(i,c)),s)),o=>ns(rl(o),n==null?void 0:n.concurrentFinalizers)(i=>Pl(e,o,(c,a)=>i(t(c,a)),s)))})),Qp=(e,t,n)=>te(()=>{const r=ge(e),s=new Array(r.length);return Qe(on(r,(i,c)=>w(t(i,c),a=>E(()=>s[c]=a)),n,!1),R(s))}),on=(e,t,n,r,s)=>kt(o=>hO(i=>oe(c=>{let a=Array.from(e).reverse(),l=a.length;if(l===0)return we;let f=0,m=!1;const g=s?Math.min(a.length,s):a.length,p=new Set,y=new Array,k=()=>p.forEach(P=>{P.currentScheduler.scheduleTask(()=>{P.unsafeInterruptAsFork(c.id())},0)}),b=new Array,_=new Array,I=new Array,$=()=>{const P=y.filter(({exit:B})=>B._tag==="Failure").sort((B,U)=>B.index<U.index?-1:B.index===U.index?0:1).map(({exit:B})=>B);return P.length===0&&P.push(ft),P},A=(P,B=!1)=>{const U=io(i(P)),C=$F(U,c,c.currentRuntimeFlags,wl);return c.currentScheduler.scheduleTask(()=>{B&&C.unsafeInterruptAsFork(c.id()),C.resume(U)},0),C},V=()=>{r||(l-=a.length,a=[]),m=!0,k()},D=n?iO:kn,M=A(et(P=>{const B=(C,z)=>{C._op==="Blocked"?I.push(C):(y.push({index:z,exit:C}),C._op==="Failure"&&!m&&V())},U=()=>{if(a.length>0){const C=a.pop();let z=f++;const Z=()=>{const Q=a.pop();return z=f++,w(Mu(),()=>w(D(o(t(Q,z))),ne))},ne=Q=>a.length>0&&(B(Q,z),a.length>0)?Z():R(Q),ae=w(D(o(t(C,z))),ne),re=A(ae);b.push(re),p.add(re),m&&re.currentScheduler.scheduleTask(()=>{re.unsafeInterruptAsFork(c.id())},0),re.addObserver(Q=>{let ue;if(Q._op==="Failure"?ue=Q:ue=Q.effect_instruction_i0,_.push(re),p.delete(re),B(ue,z),y.length===l)P(R(be(Yn($(),{parallel:!0}),()=>ft)));else if(I.length+y.length===l){const x=I.map(pe=>pe.effect_instruction_i0).reduce(cm);P(R(Em(x,on([be(Yn($(),{parallel:!0}),()=>ft),...I.map(pe=>pe.effect_instruction_i1)],pe=>pe,n,!0,s))))}else U()})}};for(let C=0;C<g;C++)U()}));return wt(En(Xi(o(es(M))),ac({onFailure:()=>{V();const P=I.length+1,B=Math.min(typeof s=="number"?s:I.length,I.length),U=Array.from(I);return et(C=>{const z=[];let Z=0,ne=0;const ae=(Q,ue)=>x=>{z[Q]=x,Z++,Z===P&&C(Wh(Yn(z,{parallel:!0}))),U.length>0&&ue&&re()},re=()=>{A(U.pop(),!0).addObserver(ae(ne,!0)),ne++};M.addObserver(ae(ne,!1)),ne++;for(let Q=0;Q<B;Q++)re()})},onSuccess:()=>tn(_,P=>P.inheritAll)})))}))),Pl=(e,t,n,r)=>te(()=>{const s=ge(e),o=new Array(s.length);return Qe(on(s,(c,a)=>X(n(c,a),l=>o[a]=l),r,!1,t),R(o))}),Cc=e=>RF(e,wl),TF=(e,t,n,r=null)=>{const s=Ac(e,t,n,r);return s.resume(e),s},$F=(e,t,n,r=null)=>Ac(e,t,n,r),Ac=(e,t,n,r=null)=>{const s=Dd(),o=t.getFiberRefs(),i=cT(o,s),c=new Wp(s,i,n),a=mo(i,Ft),l=c.currentSupervisor;return l.onStart(a,e,T(t),c),c.addObserver(m=>l.onEnd(m,c)),(r!==null?r:d(t.getFiberRef(Uu),be(()=>t.scope()))).add(n,c),c},RF=(e,t)=>oe((n,r)=>R(TF(e,n,r.runtimeFlags,t))),Zp=e=>zr(t=>Ke(Sr(t,Nn),{onNone:()=>e,onSome:n=>{switch(n.strategy._tag){case"Parallel":return e;case"Sequential":case"ParallelN":return w(ic(n,nl),r=>rs(e,r))}}})),ey=e=>t=>zr(n=>Ke(Sr(n,Nn),{onNone:()=>t,onSome:r=>r.strategy._tag==="ParallelN"&&r.strategy.parallelism===e?t:w(ic(r,rl(e)),s=>rs(t,s))})),ns=(e,t)=>n=>zr(r=>Ke(Sr(r,Nn),{onNone:()=>n(L),onSome:s=>{if(t===!0){const o=e._tag==="Parallel"?Zp:e._tag==="Sequential"?ty:ey(e.parallelism);switch(s.strategy._tag){case"Parallel":return o(n(Zp));case"Sequential":return o(n(ty));case"ParallelN":return o(n(ey(s.strategy.parallelism)))}}else return n(L)}})),Ll=e=>w(Nn,e),FF=e=>w($o(),t=>xF(e,t)),ty=e=>zr(t=>Ke(Sr(t,Nn),{onNone:()=>e,onSome:n=>{switch(n.strategy._tag){case"Sequential":return e;case"Parallel":case"ParallelN":return w(ic(n,tl),r=>rs(e,r))}}})),NF=h(e=>wn(e[1]),(e,t,n)=>xc(e,t,(r,s)=>[r,s],n)),vF=h(e=>wn(e[1]),(e,t,n)=>(n==null?void 0:n.concurrent)!==!0&&((n==null?void 0:n.batching)===void 0||n.batching===!1)?Qe(e,t):xc(e,t,(r,s)=>s,n)),xc=h(e=>wn(e[1]),(e,t,n,r)=>X(Xp([e,t],{concurrency:r!=null&&r.concurrent?2:1,batching:r==null?void 0:r.batching,concurrentFinalizers:r==null?void 0:r.concurrentFinalizers}),([s,o])=>n(s,o))),Nn=_t("effect/Scope"),ny=Nn,CF=(e,t)=>{e.state._tag==="Open"&&e.state.finalizers.add(t)},AF={[Vm]:Vm,[Jm]:Jm,pipe(){return v(this,arguments)},fork(e){return E(()=>{const t=ry(e);if(this.state._tag==="Closed")return t.state=this.state,t;const n=r=>t.close(r);return this.state.finalizers.add(n),CF(t,r=>E(()=>{this.state._tag==="Open"&&this.state.finalizers.delete(n)})),t})},close(e){return te(()=>{if(this.state._tag==="Closed")return we;const t=Array.from(this.state.finalizers.values()).reverse();return this.state={_tag:"Closed",exit:e},t.length===0?we:tT(this.strategy)?d(tn(t,n=>kn(n(e))),w(n=>d(Yn(n),Bs(Vu),be(()=>ft)))):nT(this.strategy)?d(Qp(t,n=>kn(n(e)),!1),w(n=>d(Yn(n,{parallel:!0}),Bs(Vu),be(()=>ft)))):d(Pl(t,this.strategy.parallelism,n=>kn(n(e)),!1),w(n=>d(Yn(n,{parallel:!0}),Bs(Vu),be(()=>ft))))})},addFinalizer(e){return te(()=>this.state._tag==="Closed"?e(this.state.exit):(this.state.finalizers.add(e),we))}},ry=(e=ho)=>{const t=Object.create(AF);return t.strategy=e,t.state={_tag:"Open",finalizers:new Set},t},$o=(e=ho)=>E(()=>ry(e)),rs=h(2,(e,t)=>tg(e,Ds(Pa(Nn,t)))),xF=h(2,(e,t)=>d(e,rs(t),En(n=>t.close(n)))),MF=e=>qr(e,{differ:fF,fork:Oo}),sy=h(2,(e,t)=>wt(Yp(w(nc(e),n=>Ve(rc(e,t),n)),n=>rc(e,n)))),oy=h(2,(e,t)=>ao(e,n=>sy(e,t(n)))),iy=$O(y1),PF=MF(Rc),cy=h(3,(e,t,n)=>DF(e,t,{onSelfWin:(r,s)=>w(r.await,o=>{switch(o._tag){case Pe:return w(r.inheritAll,()=>n.onSelfDone(o,s));case Me:return n.onSelfDone(o,s)}}),onOtherWin:(r,s)=>w(r.await,o=>{switch(o._tag){case Pe:return w(r.inheritAll,()=>n.onOtherDone(o,s));case Me:return n.onOtherDone(o,s)}})})),LF=h(2,(e,t)=>so(n=>cy(e,t,{onSelfDone:(r,s)=>zu(r,{onFailure:o=>d(es(s),hp(i=>Zt(o,i))),onSuccess:o=>d(s,co(n),Ve(o))}),onOtherDone:(r,s)=>zu(r,{onFailure:o=>d(es(s),hp(i=>Zt(i,o))),onSuccess:o=>d(s,co(n),Ve(o))})}))),DF=h(3,(e,t,n)=>oe((r,s)=>{const o=s.runtimeFlags,i=Hs(!0),c=Ac(e,r,o,n.selfScope),a=Ac(t,r,o,n.otherScope);return et(l=>{c.addObserver(()=>ay(c,a,n.onSelfWin,i,l)),a.addObserver(()=>ay(a,c,n.onOtherWin,i,l)),c.startFork(e),a.startFork(t)},sE(c.id(),a.id()))})),ay=(e,t,n,r,s)=>{Yk(!0,!1)(r)&&s(n(e,t))},Ro=h(2,(e,t)=>kt(n=>lt(n(e),{onFailure:r=>lt(t,{onFailure:s=>Se(qe(r,s)),onSuccess:()=>Se(r)}),onSuccess:r=>Ve(t,r)}))),UF=(e,t,n)=>so(r=>w(w(Cc(Cu(e)),s=>et(o=>{const i=t.map(l=>l.listeners.count),c=()=>{i.every(l=>l===0)&&t.every(l=>l.result.state.current._tag==="Pending"?!0:!!(l.result.state.current._tag==="Done"&&qu(l.result.state.current.effect)&&l.result.state.current.effect._tag==="Failure"&&mm(l.result.state.current.effect.cause)))&&(a.forEach(l=>l()),n==null||n(),o(Lu(s)))};s.addObserver(l=>{a.forEach(f=>f()),o(l)});const a=t.map((l,f)=>{const m=g=>{i[f]=g,c()};return l.listeners.addObserver(m),()=>l.listeners.removeObserver(m)});return c(),E(()=>{a.forEach(l=>l())})})),()=>te(()=>{const s=t.flatMap(o=>o.state.completed?[]:[o]);return Qi(s,o=>oF(o.request,qO(r)))}))),uy=Hn,BF=st,jF=Rt,KF=mm,ly=$u,qF=q1,Mc=Symbol.for("effect/ScheduleInterval"),fy={[Mc]:Mc,startMillis:0,endMillis:0},hy=(e,t)=>e>t?fy:{[Mc]:Mc,startMillis:e,endMillis:t},VF=h(2,(e,t)=>JF(e,t)===e),JF=h(2,(e,t)=>e.endMillis<=t.startMillis?e:t.endMillis<=e.startMillis?t:e.startMillis<t.startMillis?e:t.startMillis<e.startMillis?t:e.endMillis<=t.endMillis?e:t),zF=e=>e.startMillis>=e.endMillis,WF=h(2,(e,t)=>{const n=Math.max(e.startMillis,t.startMillis),r=Math.min(e.endMillis,t.endMillis);return hy(n,r)}),HF=e=>hy(e,Number.POSITIVE_INFINITY),dy=fy,GF=VF,YF=zF,XF=WF,QF=HF,my=Symbol.for("effect/ScheduleIntervals"),gy=e=>({[my]:my,intervals:e}),ZF=h(2,(e,t)=>eN(e.intervals,t.intervals,ut())),eN=(e,t,n)=>{let r=e,s=t,o=n;for(;Yt(r)&&Yt(s);){const i=d(Bt(r),XF(Bt(s))),c=YF(i)?o:d(o,Xe(i));d(Bt(r),GF(Bt(s)))?r=Xt(r):s=Xt(s),o=c}return gy(Gt(o))},Dl=e=>d(e.intervals,yd,be(()=>dy)).startMillis,tN=e=>d(e.intervals,yd,be(()=>dy)).endMillis,nN=h(2,(e,t)=>Dl(e)<Dl(t)),rN=e=>Yt(e.intervals),sN=gy,oN=ZF,iN=Dl,py=tN,cN=nN,aN=rN,Ul="Continue",yy="Done",uN=e=>({_tag:Ul,intervals:e}),lN=e=>({_tag:Ul,intervals:sN(De(e))}),fN={_tag:yy},hN=e=>e._tag===Ul,dN=e=>e._tag===yy,mN=uN,gN=lN,Fo=fN,by=hN,Pc=dN,pN=Nn,yN=zm,ss=oc,Bl=rs,bN=ic,_y=$o,Sy=Symbol.for("effect/Schedule"),_N=e=>K(e,Sy),SN=Symbol.for("effect/ScheduleDriver"),wN={_Out:e=>e,_In:e=>e,_R:e=>e},kN={_Out:e=>e,_In:e=>e,_R:e=>e};class EN{constructor(t,n){u(this,"initial");u(this,"step");u(this,iL,wN);this.initial=t,this.step=n}pipe(){return v(this,arguments)}}iL=Sy;class ON{constructor(t,n){u(this,"schedule");u(this,"ref");u(this,cL,kN);this.schedule=t,this.ref=n}get state(){return X(Rn(this.ref),t=>t[1])}get last(){return w(Rn(this.ref),([t,n])=>{switch(t._tag){case"None":return Gn(()=>new Ku);case"Some":return R(t.value)}})}get reset(){return Sc(this.ref,[O(),this.schedule.initial])}next(t){return d(X(Rn(this.ref),n=>n[1]),w(n=>d(n$,w(r=>d(te(()=>this.schedule.step(r,t,n)),w(([s,o,i])=>{const c=Sc(this.ref,[T(o),s]);if(Pc(i))return Qe(c,_e(O()));const a=iN(i.intervals)-r;return a<=0?Ve(c,o):d(c,Qe(w$(_i(a))),Ve(o))}))))))}}cL=SN;const No=(e,t)=>new EN(e,t),IN=h(2,(e,t)=>jl(e,(n,r)=>E(()=>t(n,r)))),jl=h(2,(e,t)=>No(e.initial,(n,r,s)=>w(e.step(n,r,s),([o,i,c])=>Pc(c)?R([o,i,Fo]):X(t(r,i),a=>a?[o,i,c]:[o,i,Fo])))),TN=e=>d(_c([O(),e.initial]),X(t=>new ON(e,t))),$N=h(2,(e,t)=>RN(e,t,oN)),RN=h(3,(e,t,n)=>No([e.initial,t.initial],(r,s,o)=>d(Lm(e.step(r,s,o[0]),t.step(r,s,o[1]),(i,c)=>[i,c]),w(([[i,c,a],[l,f,m]])=>by(a)&&by(m)?Kl(e,t,s,i,c,a.intervals,l,f,m.intervals,n):R([[i,l],[c,f],Fo]))))),Kl=(e,t,n,r,s,o,i,c,a,l)=>{const f=l(o,a);return aN(f)?R([[r,i],[s,c],mN(f)]):d(o,cN(a))?w(e.step(py(o),n,r),([m,g,p])=>Pc(p)?R([[m,i],[g,c],Fo]):Kl(e,t,n,m,g,p.intervals,i,c,a,l)):w(t.step(py(a),n,i),([m,g,p])=>Pc(p)?R([[r,m],[s,g],Fo]):Kl(e,t,n,r,s,o,m,g,p.intervals,l))},FN=h(2,(e,t)=>NN(e,n=>E(()=>t(n)))),NN=h(2,(e,t)=>No(e.initial,(n,r,s)=>w(e.step(n,r,s),([o,i,c])=>X(t(i),a=>[o,a,c])))),vN=e=>No(e.initial,(t,n,r)=>d(e.step(t,n,r),X(([s,o,i])=>[s,n,i]))),CN=e=>PN(Oy,t=>t<e),AN=(e,t)=>No(e,(n,r,s)=>E(()=>[t(s),s,gN(QF(n))])),xN=h(2,(e,t)=>jl(e,(n,r)=>y$(t(n)))),MN=h(2,(e,t)=>jl(e,(n,r)=>t(n))),PN=h(2,(e,t)=>IN(e,(n,r)=>t(r))),Lc=Symbol.for("effect/Schedule/ScheduleDefect");class LN{constructor(t){u(this,"error");u(this,aL);this.error=t,this[Lc]=Lc}}aL=Lc;const DN=e=>K(e,Lc),wy=e=>no(e,t=>ro(new LN(t))),UN=e=>Hi(e,t=>Ke(Ki(t,n=>dm(n)&&DN(n.defect)?T(n.defect):O()),{onNone:()=>Se(t),onSome:n=>_e(n.error)})),ky=h(2,(e,t)=>jN(e,t,(n,r)=>_e(n))),BN=h(2,(e,t)=>{if(_N(t))return ky(e,t);const n=t.schedule??vN(Oy),r=t.while?MN(n,i=>{const c=t.while(i);return typeof c=="boolean"?R(c):wy(c)}):n,s=t.until?xN(r,i=>{const c=t.until(i);return typeof c=="boolean"?R(c):wy(c)}):r,o=t.times?$N(s,CN(t.times)).pipe(FN(i=>i[0])):s;return UN(ky(e,o))}),jN=h(3,(e,t,n)=>w(TN(t),r=>en(e,{onFailure:s=>n(s,O()),onSuccess:s=>Ey(e,r,n,s)}))),Ey=(e,t,n,r)=>en(t.next(r),{onFailure:()=>uO(t.last),onSuccess:s=>en(e,{onFailure:o=>n(o,T(s)),onSuccess:o=>Ey(e,t,n,o)})}),Oy=AN(0,e=>e+1);class KN{constructor(t){u(this,"permits");u(this,"waiters",new Set);u(this,"taken",0);u(this,"take",t=>et(n=>{if(this.free<t){const r=()=>{this.free<t||(this.waiters.delete(r),this.taken+=t,n(R(t)))};return this.waiters.add(r),E(()=>{this.waiters.delete(r)})}return this.taken+=t,n(R(t))}));u(this,"updateTaken",t=>oe(n=>(this.taken=t(this.taken),this.waiters.size>0&&n.getFiberRef(dl).scheduleTask(()=>{const r=this.waiters.values();let s=r.next();for(;s.done===!1&&this.free>0;)s.value(),s=r.next()},n.getFiberRef(lo)),R(this.free))));u(this,"release",t=>this.updateTaken(n=>n-t));u(this,"releaseAll",this.updateTaken(t=>0));u(this,"withPermits",t=>n=>kt(r=>w(r(this.take(t)),s=>Ro(r(n),this.release(s)))));u(this,"withPermitsIfAvailable",t=>n=>kt(r=>te(()=>this.free<t?k$:(this.taken+=t,Ro(r(a$(n)),this.release(t))))));this.permits=t}get free(){return this.permits-this.taken}}const Iy=e=>new KN(e),qN=e=>E(()=>Iy(e)),Ty=h(2,(e,t)=>kt(n=>w(t.fork(ho),r=>d(n(e),En(s=>r.close(s)),Cc,oo(s=>r.addFinalizer(()=>so(o=>J(o,s.id())?we:wt(Lu(s))))))))),VN=e=>Ll(t=>Ty(e,t)),JN=Symbol.for("effect/Ref/SynchronizedRef"),zN={_A:e=>e};class WN extends mc{constructor(n,r){super();u(this,"ref");u(this,"withLock");u(this,uL,zN);u(this,lL,tp);u(this,fL,bc);u(this,"get");this.ref=n,this.withLock=r,this.get=Rn(this.ref)}commit(){return this.get}modify(n){return this.modifyEffect(r=>R(n(r)))}modifyEffect(n){return this.withLock(d(w(Rn(this.ref),n),w(([r,s])=>Ve(Sc(this.ref,s),r))))}}uL=JN,lL=ep,fL=bc;const HN=e=>E(()=>$y(e)),$y=e=>{const t=np(e),n=Iy(1);return new WN(t,n.withPermits(1))},ql=Symbol.for("effect/ManagedRuntime"),GN="Fold",YN="Fresh",XN="FromEffect",QN="Scoped",ZN="Suspend",e2="ZipWith",t2=V$,os=Lu,n2=co,Ry=es,is=e=>(t,n)=>{const r=Dd(),s=[[Ft,[[r,e.context]]]];n!=null&&n.scheduler&&s.push([dl,[[r,n.scheduler]]]);let o=lT(e.fiberRefs,{entries:s,forkAs:r});n!=null&&n.updateRefs&&(o=n.updateRefs(o,r));const i=new Wp(r,o,e.runtimeFlags);let c=t;n!=null&&n.scope&&(c=w(bN(n.scope,ho),l=>Qe(zm(l,so(f=>J(f,i.id())?we:co(i,f))),En(t,f=>ss(l,f)))));const a=i.currentSupervisor;return a!==Rc&&(a.onStart(e.context,c,O(),i),i.addObserver(l=>a.onEnd(l,i))),wl.add(e.runtimeFlags,i),(n==null?void 0:n.immediate)===!1?i.resume(c):i.start(c),i},Vl=e=>(t,n={})=>{const r=is(e)(t,n);return n.onExit&&r.addObserver(s=>{n.onExit(s)}),(s,o)=>Vl(e)(d(r,n2(s??Jn)),{...o,onExit:o!=null&&o.onExit?i=>o.onExit(P$(i)):void 0})},Jl=e=>t=>{const n=Hl(e)(t);if(n._tag==="Failure")throw Fy(n.effect_instruction_i0);return n.effect_instruction_i0};class r2 extends Error{constructor(n){super(`Fiber #${n.id().id} cannot be resolved synchronously. This is caused by using runSync on an effect that performs async work`);u(this,"fiber");u(this,"_tag","AsyncFiberException");this.fiber=n,this.name=this._tag,this.stack=this.message}}const s2=e=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=0;const n=new r2(e);return Error.stackTraceLimit=t,n},zl=Symbol.for("effect/Runtime/FiberFailure"),Wl=Symbol.for("effect/Runtime/FiberFailure/Cause");class o2 extends Error{constructor(n){super();u(this,hL);u(this,dL);this[zl]=zl,this[Wl]=n;const r=wm(n);if(r.length>0){const s=r[0];this.name=s.name,this.message=s.message,this.stack=s.stack}this.name=`(FiberFailure) ${this.name}`,(this.message===void 0||this.message.length===0)&&(this.message="An error has occurred")}toJSON(){return{_id:"FiberFailure",cause:this[Wl].toJSON()}}toString(){return"(FiberFailure) "+(this.stack??this.message)}[(hL=zl,dL=Wl,he)](){return this.toString()}}const Fy=e=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=0;const n=new o2(e);return Error.stackTraceLimit=t,n},Ny=e=>{const t=e;switch(t._op){case"Failure":case"Success":return t;case"Left":return Ju(t.left);case"Right":return ke(t.right);case"Some":return ke(t.value);case"None":return Ju(Ku())}},Hl=e=>t=>{const n=Ny(t);if(n)return n;const r=new e$,s=is(e)(t,{scheduler:r});r.flush();const o=s.unsafePoll();return o||Jr(vu(s2(s),Xu(s)))},vy=e=>(t,n)=>Gl(e)(t,n).then(r=>{switch(r._tag){case Pe:return r.effect_instruction_i0;case Me:throw Fy(r.effect_instruction_i0)}}),Gl=e=>(t,n)=>new Promise(r=>{const s=Ny(t);s&&r(s);const o=is(e)(t);o.addObserver(i=>{r(i)}),(n==null?void 0:n.signal)!==void 0&&(n.signal.aborted?o.unsafeInterruptAsFork(o.id()):n.signal.addEventListener("abort",()=>{o.unsafeInterruptAsFork(o.id())},{once:!0}))});class Cy{constructor(t,n,r){u(this,"context");u(this,"runtimeFlags");u(this,"fiberRefs");this.context=t,this.runtimeFlags=n,this.fiberRefs=r}pipe(){return v(this,arguments)}}const i2=e=>new Cy(e.context,e.runtimeFlags,e.fiberRefs),Ay=()=>oe((e,t)=>R(new Cy(e.getFiberRef(Ft),t.runtimeFlags,e.getFiberRefs()))),vn=i2({context:dn(),runtimeFlags:nm(Nr,em,Zd),fiberRefs:fT()}),c2=is(vn),Yl=vy(vn),a2=Gl(vn),Dc=Jl(vn),u2=Hl(vn),l2=h(2,(e,t)=>e.modifyEffect(t)),xy=Symbol.for("effect/Layer"),f2={_RIn:e=>e,_E:e=>e,_ROut:e=>e},vo={[xy]:f2,pipe(){return v(this,arguments)}},Xl=Symbol.for("effect/Layer/MemoMap"),h2=e=>K(e,xy),d2=e=>e._op_layer===YN;class My{constructor(t){u(this,"ref");u(this,mL);this.ref=t,this[Xl]=Xl}getOrElseMemoize(t,n){return d(l2(this.ref,r=>{const s=r.get(t);if(s!==void 0){const[o,i]=s,c=d(o,w(([a,l])=>d(mp(a),Ve(l))),En(ac({onFailure:()=>we,onSuccess:()=>Bu(n,i)})));return R([c,r])}return d(_c(0),w(o=>d(lc(),w(i=>d(_c(()=>we),X(c=>{const a=kt(f=>d($o(),w(m=>d(f(w(Ql(t,m,!0),g=>h$(g(this)))),kn,w(g=>{switch(g._tag){case Me:return d(Qm(i,g.effect_instruction_i0),Qe(oc(m,g)),Qe(Se(g.effect_instruction_i0)));case Pe:return d(Sc(c,p=>d(oc(m,p),Au(rp(o,y=>[y===1,y-1])),wt)),Qe(fl(o,p=>p+1)),Qe(Bu(n,p=>d(E(()=>r.delete(t)),Qe(Rn(c)),w(y=>y(p))))),Qe(Hu(i,g.effect_instruction_i0)),Ve(g.effect_instruction_i0[1]))}}))))),l=[d(On(i),En(zu({onFailure:()=>we,onSuccess:()=>fl(o,f=>f+1)}))),f=>d(Rn(c),w(m=>m(f)))];return[a,d2(t)?r:r.set(t,l)]}))))))}),Xi)}}mL=Xl;const m2=te(()=>X(HN(new Map),e=>new My(e))),g2=()=>new My($y(new Map)),Py=h(2,(e,t)=>w(m2,n=>w(Ql(e,t),r=>r(n)))),p2=h(3,(e,t,n)=>w(Ql(e,n),r=>r(t))),Ql=(e,t,n=!1)=>{const r=e;switch(r._op_layer){case"Locally":return E(()=>s=>r.f(s.getOrElseMemoize(r.self,t)));case"ExtendScope":return E(()=>s=>Ll(o=>s.getOrElseMemoize(r.layer,o)));case"Fold":return E(()=>s=>d(s.getOrElseMemoize(r.layer,t),lt({onFailure:o=>s.getOrElseMemoize(r.failureK(o),t),onSuccess:o=>s.getOrElseMemoize(r.successK(o),t)})));case"Fresh":return E(()=>s=>d(r.layer,Py(t)));case"FromEffect":return E(n?()=>s=>r.effect:()=>s=>s.getOrElseMemoize(e,t));case"Provide":return E(()=>s=>d(s.getOrElseMemoize(r.first,t),w(o=>d(s.getOrElseMemoize(r.second,t),fo(o)))));case"Scoped":return E(n?()=>s=>rs(r.effect,t):()=>s=>s.getOrElseMemoize(e,t));case"Suspend":return E(()=>s=>s.getOrElseMemoize(r.evaluate(),t));case"ProvideMerge":return E(()=>s=>d(s.getOrElseMemoize(r.first,t),Lm(s.getOrElseMemoize(r.second,t),r.zipK)));case"ZipWith":return E(()=>s=>d(s.getOrElseMemoize(r.first,t),xc(s.getOrElseMemoize(r.second,t),r.zipK,{concurrent:!0})))}},y2=e=>Ly(uy(e)),Ly=e=>Zl(Se(e)),b2=h(2,(e,t)=>w2(e,{onFailure:y2,onSuccess:t})),_2=h(2,(e,t)=>{const n=Dh(e),r=n?e:t;return Zl(X(n?t:e,o=>Pa(r,o)))});function Zl(e){const t=Object.create(vo);return t._op_layer=XN,t.effect=e,t}const S2=h(2,(e,{onFailure:t,onSuccess:n})=>{const r=Object.create(vo);return r._op_layer=GN,r.layer=e,r.failureK=t,r.successK=n,r}),w2=h(2,(e,{onFailure:t,onSuccess:n})=>S2(e,{onFailure:r=>{const s=ly(r);switch(s._tag){case"Left":return t(s.left);case"Right":return Ly(s.right)}},onSuccess:n})),k2=h(2,(e,t)=>$2(e,t,(n,r)=>Ds(n,r))),Dy=(...e)=>{let t=e[0];for(let n=1;n<e.length;n++)t=k2(t,e[n]);return t},ef=e=>E2(d(e,Ve(dn()))),E2=e=>{const t=Object.create(vo);return t._op_layer=QN,t.effect=e,t},O2=h(2,(e,t)=>{const n=Dh(e);return Zl(R(Pa(n?e:t,n?t:e)))}),I2=e=>{const t=Object.create(vo);return t._op_layer=ZN,t.evaluate=e,t},T2=h(2,(e,t)=>w(Ll(n=>p2(e,t,n)),n=>d(Ay(),fo(n)))),$2=h(3,(e,t,n)=>I2(()=>{const r=Object.create(vo);return r._op_layer=e2,r.first=e,r.second=t,r.zipK=n,r})),Uy=h(2,(e,t)=>Tm($o(),n=>w(Py(t,n),r=>Yu(e,r)),(n,r)=>oc(n,r))),By=h(2,(e,t)=>{const n=go(vn.fiberRefs,t.fiberRefs),r=Sn(vn.runtimeFlags,t.runtimeFlags);return kt(s=>oe(o=>{const i=o.getFiberRef(Ft),c=o.getFiberRefs(),a=po(o.id(),c)(n),l=o.currentRuntimeFlags,f=vr(r)(l),m=go(a,c),g=Sn(f,l);return o.setFiberRefs(a),o.currentRuntimeFlags=f,Ro(Yu(s(e),Ds(i,t.context)),oe(p=>(p.setFiberRefs(po(p.id(),p.getFiberRefs())(m)),p.currentRuntimeFlags=vr(g)(p.currentRuntimeFlags),we)))}))}),R2=h(2,(e,t)=>Array.isArray(t)?Uy(e,Dy(...t)):h2(t)?Uy(e,t):uw(t)?Yu(e,t):ql in t?w(t.runtimeEffect,n=>By(e,n)):By(e,t)),F2=e=>ef(sy(Hp,e)),N2=e=>ef(oy(Ml,Tr(e))),v2=e=>ef(oy(Ml,fu(e))),C2=h(2,(e,t)=>b2(v2(e),()=>N2(t))),jy=Symbol.for("effect/MutableList"),A2={[jy]:jy,[Symbol.iterator](){let e=!1,t=this.head;return{next(){if(e)return this.return();if(t==null)return e=!0,this.return();const n=t.value;return t=t.next,{done:e,value:n}},return(n){return e||(e=!0),{done:!0,value:n}}}},toString(){return Ie(this.toJSON())},toJSON(){return{_id:"MutableList",values:Array.from(this).map(ye)}},[he](){return this.toJSON()},pipe(){return v(this,arguments)}},x2=e=>({value:e,removed:!1,prev:void 0,next:void 0}),M2=()=>{const e=Object.create(A2);return e.head=void 0,e.tail=void 0,e._length=0,e},Ky=e=>tf(e)===0,tf=e=>e._length,P2=h(2,(e,t)=>{const n=x2(t);return e.head===void 0&&(e.head=n),e.tail===void 0||(e.tail.next=n,n.prev=e.tail),e.tail=n,e._length+=1,e}),L2=e=>{const t=e.head;if(t!==void 0)return D2(e,t),t.value},D2=(e,t)=>{t.removed||(t.removed=!0,t.prev!==void 0&&t.next!==void 0?(t.prev.next=t.next,t.next.prev=t.prev):t.prev!==void 0?(e.tail=t.prev,t.prev.next=void 0):t.next!==void 0?(e.head=t.next,t.next.prev=void 0):(e.tail=void 0,e.head=void 0),e._length>0&&(e._length-=1))},qy=Symbol.for("effect/MutableQueue"),ot=Symbol.for("effect/mutable/MutableQueue/Empty"),U2={[qy]:qy,[Symbol.iterator](){return Array.from(this.queue)[Symbol.iterator]()},toString(){return Ie(this.toJSON())},toJSON(){return{_id:"MutableQueue",values:Array.from(this).map(ye)}},[he](){return this.toJSON()},pipe(){return v(this,arguments)}},Vy=e=>{const t=Object.create(U2);return t.queue=M2(),t.capacity=e,t},B2=e=>Vy(e),nf=()=>Vy(void 0),rf=e=>tf(e.queue),sf=e=>Ky(e.queue),j2=e=>e.capacity===void 0?1/0:e.capacity,Co=h(2,(e,t)=>{const n=tf(e.queue);return e.capacity!==void 0&&n===e.capacity?!1:(P2(t)(e.queue),!0)}),Jy=h(2,(e,t)=>{const n=t[Symbol.iterator]();let r,s=ut(),o=!0;for(;o&&(r=n.next())&&!r.done;)o=Co(r.value)(e);for(;r!=null&&!r.done;)s=Xe(r.value)(s),r=n.next();return Gt(s)}),Cn=h(2,(e,t)=>Ky(e.queue)?t:L2(e.queue)),of=h(2,(e,t)=>{let n=ut(),r=0;for(;r<t;){const s=Cn(ot)(e);if(s===ot)break;n=Xe(s)(n),r+=1}return Gt(n)}),K2=_2,q2=Dy,cf=O2,V2=Ec,J2=C2,z2=Gp,W2=F2;function cs(e,t){return w(e.runtimeEffect,n=>oe(r=>(r.setFiberRefs(n.fiberRefs),r.currentRuntimeFlags=n.runtimeFlags,fo(t,n.context))))}const H2={...Og,[ql]:ql,pipe(){return v(this,arguments)},commit(){return this.runtimeEffect}},G2=(e,t)=>{t=t??g2();const n=Dc($o()),r=Dc(dp(oo(Bl(T2(e,t),n),o=>{s.cachedRuntime=o}))),s=Object.assign(Object.create(H2),{memoMap:t,scope:n,runtimeEffect:r,cachedRuntime:void 0,runtime(){return s.cachedRuntime===void 0?Yl(s.runtimeEffect):Promise.resolve(s.cachedRuntime)},dispose(){return Yl(s.disposeEffect)},disposeEffect:te(()=>(s.runtime=ro("ManagedRuntime disposed"),s.cachedRuntime=void 0,ss(s.scope,ft))),runFork(o,i){return s.cachedRuntime===void 0?c2(cs(s,o),i):is(s.cachedRuntime)(o,i)},runSyncExit(o){return s.cachedRuntime===void 0?u2(cs(s,o)):Hl(s.cachedRuntime)(o)},runSync(o){return s.cachedRuntime===void 0?Dc(cs(s,o)):Jl(s.cachedRuntime)(o)},runPromiseExit(o,i){return s.cachedRuntime===void 0?a2(cs(s,o),i):Gl(s.cachedRuntime)(o,i)},runCallback(o,i){return s.cachedRuntime===void 0?Vl(vn)(cs(s,o),i):Vl(s.cachedRuntime)(o,i)},runPromise(o,i){return s.cachedRuntime===void 0?Yl(cs(s,o),i):vy(s.cachedRuntime)(o,i)}});return s},Y2={[Symbol.for("@effect/matcher/Matcher")]:{_input:L,_filters:L,_result:L,_return:L},_tag:"ValueMatcher",add(e){return this.value._tag==="Right"?this:e._tag==="When"&&e.guard(this.provided)===!0?af(this.provided,se(e.evaluate(this.provided))):e._tag==="Not"&&e.guard(this.provided)===!1?af(this.provided,se(e.evaluate(this.provided))):this},pipe(){return v(this,arguments)}};function af(e,t){const n=Object.create(Y2);return n.provided=e,n.value=t,n}const X2=(e,t)=>({_tag:"When",guard:e,evaluate:t}),uf=e=>{if(typeof e=="function")return e;if(Array.isArray(e)){const t=e.map(uf),n=t.length;return r=>{if(!Array.isArray(r))return!1;for(let s=0;s<n;s++)if(t[s](r[s])===!1)return!1;return!0}}else if(e!==null&&typeof e=="object"){const t=Object.entries(e).map(([r,s])=>[r,uf(s)]),n=t.length;return r=>{if(typeof r!="object"||r===null)return!1;for(let s=0;s<n;s++){const[o,i]=t[s];if(!(o in r)||i(r[o])===!1)return!1}return!0}}return t=>t===e},Q2=e=>af(e,q(e)),Z2=(e,t)=>n=>n.add(X2(uf(e),t)),ev=e=>{if(e._tag==="ValueMatcher")return e.value;const t=e.cases.length;if(t===1){const n=e.cases[0];return r=>n._tag==="When"&&n.guard(r)===!0||n._tag==="Not"&&n.guard(r)===!1?se(n.evaluate(r)):q(r)}return n=>{for(let r=0;r<t;r++){const s=e.cases[r];if(s._tag==="When"&&s.guard(n)===!0)return se(s.evaluate(n));if(s._tag==="Not"&&s.guard(n)===!1)return se(s.evaluate(n))}return q(n)}},zy="effect/Match/exhaustive: absurd",tv=e=>{const t=ev(e);if(Bw(t)){if(t._tag==="Right")return t.right;throw new Error(zy)}return n=>{const r=t(n);if(r._tag==="Right")return r.right;throw new Error(zy)}},nv=Q2,Uc=Z2,rv=tv,Wy=_t("Config"),sv={reloadUrl:"/",syncUrl:"https://evolu.world",name:"Evolu",maxDrift:5*60*1e3,minimumLogLevel:"none"},ov=e=>{const t={...sv,...e},n=cf(Wy,t),r=nv(t.minimumLogLevel).pipe(Uc("debug",()=>ul),Uc("none",()=>qg),Uc("trace",()=>Kg),Uc("warning",()=>jg),rv),s=t.minimumLogLevel==="none"?n:q2(n,W2(r),J2(z2,iv(t.name)));return G2(s)},iv=e=>V2(({logLevel:t,message:n,date:r})=>{const s=t._tag==="Warning"?"warn":t._tag==="Error"?"error":"log",o=r.getHours().toString().padStart(2,"0"),i=r.getMinutes().toString().padStart(2,"0"),c=r.getSeconds().toString().padStart(2,"0"),a=r.getMilliseconds().toString().padStart(3,"0"),l=`${o}:${i}:${c}:${a}`,f=Array.isArray(n)?n:[n];globalThis.console[s](`${l} [${e}]`,...f)}),Hy="effect/Redacted",Bc=W("effect/Redacted/redactedRegistry",()=>new WeakMap),Gy=Symbol.for(Hy),cv={[Gy]:{_A:e=>e},pipe(){return v(this,arguments)},toString(){return"<redacted>"},toJSON(){return"<redacted>"},[G](){return d(N(Hy),ee(N(Bc.get(this))),Ee(this))},[H](e){return av(e)&&J(Bc.get(this),Bc.get(e))}},av=e=>K(e,Gy),uv=e=>{const t=Object.create(cv);return Bc.set(t,e),t},Yy=function(){const e=Symbol.for("effect/Data/Error/plainArgs");return class extends ju{constructor(n){super(n==null?void 0:n.message,n!=null&&n.cause?{cause:n.cause}:void 0),n&&(Object.assign(this,n),Object.defineProperty(this,e,{value:n,enumerable:!1}))}toJSON(){return{...this[e],...this}}}}(),lv=e=>{class t extends Yy{constructor(){super(...arguments);u(this,"_tag",e)}}return t.prototype.name=e,t},Ao=wn,lf=dp,fv=Xp,Kt=ts,hv=oe,qt=_e,xo=Se,dv=Nm,as=m$,mv=_$,ce=R,je=te,Ae=E,fe=we,Mo=no,Xy=Hi,gv=u$,ff=l$,pv=f$,yv=g$,bv=up,_v=I$,Po=O$,us=nn,nr=Cu,jc=io,Sv=kt,hf=Ve,Qy=wt,Y=X,df=Zi,Kc=Yp,qc=Ro,wv=ny,mf=FF,kv=so,Zy=Cc,eb=Ty,gf=VN,Ev=eg,Ov=tg,Lo=R2,rr=Kr,Ot=kn,Iv=$$,j=w,ls=Xi,pf=LF,tb=cy,Do=oo,nb=E$,rb=BN,Tv=lp,yf=Cm,cn=lt,$v=en,bf=p$,Rv=aO,Fv=Ay,Nv=qN,An=Dc,sb=NF,dt=vF,Vc=xc,vv=N$,Cv=v$,ob=uv,ib=(e,t)=>{switch(t._tag){case"StringKeyword":case"TemplateLiteral":return Object.keys(e);case"SymbolKeyword":return Object.getOwnPropertySymbols(e);case"Refinement":return ib(e,t.from)}},Jc=e=>Object.keys(e).concat(Object.getOwnPropertySymbols(e)),cb=e=>{let t=!1,n;return()=>(t||(n=e(),t=!0),n)},Av=e=>{try{return e.toISOString()}catch{return String(e)}},sr=e=>{if(Pt(e))return JSON.stringify(e);if(Dn(e)||e==null||ni(e)||Ia(e))return String(e);if(E0(e))return Av(e);if(ri(e))return String(e)+"n";if(!za(e)&&K(e,"toString")&&vs(e.toString)&&e.toString!==Object.prototype.toString)return e.toString();try{return JSON.stringify(e),za(e)?`[${e.map(sr).join(",")}]`:`{${Jc(e).map(t=>`${Pt(t)?JSON.stringify(t):String(t)}:${sr(e[t])}`).join(",")}}`}catch{return String(e)}},xv=e=>typeof e=="string"?JSON.stringify(e):String(e),ab=e=>Array.isArray(e),Mv=e=>!Array.isArray(e),ub=e=>`[${xv(e)}]`,Pv=e=>ab(e)?e.map(ub).join(""):ub(e),zc=(e,t,n,r)=>{let s=e;return t!==void 0&&(s+=`
details: ${t}`),s},lb=e=>zc("Duplicate index signature",`${e} index signature`),Lv=zc("Unsupported index signature parameter","An index signature parameter type must be `string`, `symbol`, a template literal type or a refinement of the previous types"),Dv=zc("Invalid element","A required element cannot follow an optional element. ts(1257)"),Uv=e=>zc("Duplicate property signature",`Duplicate key ${sr(e)}`),fb=Symbol.for("@effect/schema/annotation/Brand"),hb=Symbol.for("@effect/schema/annotation/Type"),db=Symbol.for("@effect/schema/annotation/Message"),mb=Symbol.for("@effect/schema/annotation/MissingMessage"),gb=Symbol.for("@effect/schema/annotation/Identifier"),or=Symbol.for("@effect/schema/annotation/Title"),Wc=Symbol.for("@effect/schema/annotation/Description"),Bv=Symbol.for("@effect/schema/annotation/Examples"),jv=Symbol.for("@effect/schema/annotation/Default"),Kv=Symbol.for("@effect/schema/annotation/JSONSchema"),qv=Symbol.for("@effect/schema/annotation/Documentation"),pb=Symbol.for("@effect/schema/annotation/Concurrency"),yb=Symbol.for("@effect/schema/annotation/Batching"),bb=Symbol.for("@effect/schema/annotation/ParseIssueTitle"),_b=Symbol.for("@effect/schema/annotation/ParseOptions"),Sb=Symbol.for("@effect/schema/annotation/DecodingFallback"),Vv=Symbol.for("@effect/schema/annotation/Surrogate"),Jv=Symbol.for("@effect/schema/annotation/StableFilter"),it=h(2,(e,t)=>Object.prototype.hasOwnProperty.call(e.annotations,t)?T(e.annotations[t]):O()),zv=it(fb),Wv=it(db),Hv=it(mb),Gv=it(or),wb=it(gb),Yv=it(Wc),Xv=it(pb),Qv=it(yb),Zv=it(bb),eC=it(_b),tC=it(Sb),nC=it(Vv),rC=it(Jv),sC=e=>ww(rC(e),t=>t===!0),kb=Symbol.for("@effect/schema/annotation/JSONIdentifier"),oC=it(kb);class Eb{constructor(t,n,r,s={}){u(this,"typeParameters");u(this,"decodeUnknown");u(this,"encodeUnknown");u(this,"annotations");u(this,"_tag","Declaration");this.typeParameters=t,this.decodeUnknown=n,this.encodeUnknown=r,this.annotations=s}toString(){return be(vt(this),()=>"<declaration schema>")}toJSON(){return{_tag:this._tag,typeParameters:this.typeParameters.map(t=>t.toJSON()),annotations:Je(this.annotations)}}}const fs=e=>t=>t._tag===e;class iC{constructor(t,n={}){u(this,"literal");u(this,"annotations");u(this,"_tag","Literal");this.literal=t,this.annotations=n}toString(){return be(vt(this),()=>sr(this.literal))}toJSON(){return{_tag:this._tag,literal:ri(this.literal)?String(this.literal):this.literal,annotations:Je(this.annotations)}}}const Ob=fs("Literal");class cC{constructor(t,n={}){u(this,"symbol");u(this,"annotations");u(this,"_tag","UniqueSymbol");this.symbol=t,this.annotations=n}toString(){return be(vt(this),()=>sr(this.symbol))}toJSON(){return{_tag:this._tag,symbol:String(this.symbol),annotations:Je(this.annotations)}}}class aC{constructor(t={}){u(this,"annotations");u(this,"_tag","NeverKeyword");this.annotations=t}toString(){return Uo(this)}toJSON(){return{_tag:this._tag,annotations:Je(this.annotations)}}}const uC=new aC({[or]:"never"});class lC{constructor(t={}){u(this,"annotations");u(this,"_tag","UnknownKeyword");this.annotations=t}toString(){return Uo(this)}toJSON(){return{_tag:this._tag,annotations:Je(this.annotations)}}}const fC=new lC({[or]:"unknown"});class hC{constructor(t={}){u(this,"annotations");u(this,"_tag","AnyKeyword");this.annotations=t}toString(){return Uo(this)}toJSON(){return{_tag:this._tag,annotations:Je(this.annotations)}}}const dC=new hC({[or]:"any"});class mC{constructor(t={}){u(this,"annotations");u(this,"_tag","StringKeyword");this.annotations=t}toString(){return Uo(this)}toJSON(){return{_tag:this._tag,annotations:Je(this.annotations)}}}const gC=new mC({[or]:"string",[Wc]:"a string"}),Ib=fs("StringKeyword");class pC{constructor(t={}){u(this,"annotations");u(this,"_tag","NumberKeyword");this.annotations=t}toString(){return Uo(this)}toJSON(){return{_tag:this._tag,annotations:Je(this.annotations)}}}const yC=new pC({[or]:"number",[Wc]:"a number"}),bC=fs("NumberKeyword"),_C=fs("SymbolKeyword");let _f=class{constructor(t,n={}){u(this,"type");u(this,"annotations");this.type=t,this.annotations=n}toJSON(){return{type:this.type.toJSON(),annotations:Je(this.annotations)}}toString(){return String(this.type)}};class Sf extends _f{constructor(n,r,s={}){super(n,s);u(this,"isOptional");this.isOptional=r}toJSON(){return{type:this.type.toJSON(),isOptional:this.isOptional,annotations:Je(this.annotations)}}toString(){return String(this.type)+(this.isOptional?"?":"")}}const Tb=e=>e.map(t=>t.type);class $b{constructor(t,n,r,s={}){u(this,"elements");u(this,"rest");u(this,"isReadonly");u(this,"annotations");u(this,"_tag","TupleType");this.elements=t,this.rest=n,this.isReadonly=r,this.annotations=s;let o=!1,i=!1;for(const c of t)if(c.isOptional)o=!0;else if(o){i=!0;break}if(i||o&&n.length>1)throw new Error(Dv)}toString(){return be(vt(this),()=>SC(this))}toJSON(){return{_tag:this._tag,elements:this.elements.map(t=>t.toJSON()),rest:this.rest.map(t=>t.toJSON()),isReadonly:this.isReadonly,annotations:Je(this.annotations)}}}const SC=e=>{const t=e.elements.map(String).join(", ");return Hw(e.rest,{onEmpty:()=>`readonly [${t}]`,onNonEmpty:(n,r)=>{const s=String(n),o=s.includes(" | ")?`(${s})`:s;if(r.length>0){const i=r.map(String).join(", ");return e.elements.length>0?`readonly [${t}, ...${o}[], ${i}]`:`readonly [...${o}[], ${i}]`}else return e.elements.length>0?`readonly [${t}, ...${o}[]]`:`ReadonlyArray<${s}>`}})};class Hc extends Sf{constructor(n,r,s,o,i){super(r,s,i);u(this,"name");u(this,"isReadonly");this.name=n,this.isReadonly=o}toString(){return(this.isReadonly?"readonly ":"")+String(this.name)+(this.isOptional?"?":"")+": "+this.type}toJSON(){return{name:String(this.name),type:this.type.toJSON(),isOptional:this.isOptional,isReadonly:this.isReadonly,annotations:Je(this.annotations)}}}const Rb=e=>{switch(e._tag){case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":return!0;case"Refinement":return Rb(e.from)}return!1};class Fb{constructor(t,n,r){u(this,"type");u(this,"isReadonly");u(this,"parameter");if(this.type=n,this.isReadonly=r,Rb(t))this.parameter=t;else throw new Error(Lv)}toString(){return(this.isReadonly?"readonly ":"")+`[x: ${this.parameter}]: ${this.type}`}toJSON(){return{parameter:this.parameter.toJSON(),type:this.type.toJSON(),isReadonly:this.isReadonly}}}class Gc{constructor(t,n,r={}){u(this,"annotations");u(this,"_tag","TypeLiteral");u(this,"propertySignatures");u(this,"indexSignatures");this.annotations=r;const s={};for(let i=0;i<t.length;i++){const c=t[i].name;if(Object.prototype.hasOwnProperty.call(s,c))throw new Error(Uv(c));s[c]=null}const o={string:!1,symbol:!1};for(let i=0;i<n.length;i++){const c=Mb(n[i].parameter);if(Ib(c)){if(o.string)throw new Error(lb("string"));o.string=!0}else if(_C(c)){if(o.symbol)throw new Error(lb("symbol"));o.symbol=!0}}this.propertySignatures=t,this.indexSignatures=n}toString(){return be(vt(this),()=>wC(this))}toJSON(){return{_tag:this._tag,propertySignatures:this.propertySignatures.map(t=>t.toJSON()),indexSignatures:this.indexSignatures.map(t=>t.toJSON()),annotations:Je(this.annotations)}}}const Nb=e=>e.map(String).join("; "),wC=e=>{if(e.propertySignatures.length>0){const t=e.propertySignatures.map(String).join("; ");return e.indexSignatures.length>0?`{ ${t}; ${Nb(e.indexSignatures)} }`:`{ ${t} }`}else return e.indexSignatures.length>0?`{ ${Nb(e.indexSignatures)} }`:"{}"},kC=Ks(zh(Hr,e=>{switch(e._tag){case"AnyKeyword":return 0;case"UnknownKeyword":return 1;case"ObjectKeyword":return 2;case"StringKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"SymbolKeyword":return 3}return 4})),EC={string:"StringKeyword",number:"NumberKeyword",boolean:"BooleanKeyword",bigint:"BigIntKeyword"},vb=e=>ad(e,t=>TC(t)?vb(t.types):[t]),OC=e=>{const t=kC(e),n=[],r={},s=[];for(const o of t)switch(o._tag){case"NeverKeyword":break;case"AnyKeyword":return[dC];case"UnknownKeyword":return[fC];case"ObjectKeyword":case"UndefinedKeyword":case"VoidKeyword":case"StringKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"SymbolKeyword":{r[o._tag]||(r[o._tag]=o,n.push(o));break}case"Literal":{const i=typeof o.literal;switch(i){case"string":case"number":case"bigint":case"boolean":{const c=EC[i];!r[c]&&!s.includes(o.literal)&&(s.push(o.literal),n.push(o));break}case"object":{s.includes(o.literal)||(s.push(o.literal),n.push(o));break}}break}case"UniqueSymbol":{!r.SymbolKeyword&&!s.includes(o.symbol)&&(s.push(o.symbol),n.push(o));break}case"TupleType":{r.ObjectKeyword||n.push(o);break}case"TypeLiteral":{o.propertySignatures.length===0&&o.indexSignatures.length===0?r["{}"]||(r["{}"]=o,n.push(o)):r.ObjectKeyword||n.push(o);break}default:n.push(o)}return n},Os=class Os{constructor(t,n={}){u(this,"types");u(this,"annotations");u(this,"_tag","Union");this.types=t,this.annotations=n}toString(){return be(vt(this),()=>this.types.map(String).join(" | "))}toJSON(){return{_tag:this._tag,types:this.types.map(t=>t.toJSON()),annotations:Je(this.annotations)}}};u(Os,"make",(t,n)=>IC(t)?new Os(t,n):t.length===1?t[0]:uC),u(Os,"unify",(t,n)=>Os.make(OC(vb(t)),n));let ir=Os;const IC=e=>e.length>1,TC=fs("Union"),wf=W(Symbol.for("@effect/schema/AST/toJSONMemoMap"),()=>new WeakMap);class Cb{constructor(t,n={}){u(this,"f");u(this,"annotations");u(this,"_tag","Suspend");this.f=t,this.annotations=n,this.f=cb(t)}toString(){return vt(this).pipe(pi(()=>yi(bw(this.f)(),t=>vt(t))),be(()=>"<suspended schema>"))}toJSON(){const t=this.f();let n=wf.get(t);return n||(wf.set(t,{_tag:this._tag}),n={_tag:this._tag,ast:t.toJSON(),annotations:Je(this.annotations)},wf.set(t,n),n)}}let Ab=class{constructor(t,n,r={}){u(this,"from");u(this,"filter");u(this,"annotations");u(this,"_tag","Refinement");this.from=t,this.filter=n,this.annotations=r}toString(){return be(vt(this),()=>`{ ${this.from} | filter }`)}toJSON(){return{_tag:this._tag,from:this.from.toJSON(),annotations:Je(this.annotations)}}};const $C=fs("Refinement"),kf={};let RC=class{constructor(t,n,r,s={}){u(this,"from");u(this,"to");u(this,"transformation");u(this,"annotations");u(this,"_tag","Transformation");this.from=t,this.to=n,this.transformation=r,this.annotations=s}toString(){return be(vt(this),()=>`(${String(this.from)} <-> ${String(this.to)})`)}toJSON(){return{_tag:this._tag,from:this.from.toJSON(),to:this.to.toJSON(),annotations:Je(this.annotations)}}};class FC{constructor(t,n){u(this,"decode");u(this,"encode");u(this,"_tag","FinalTransformation");this.decode=t,this.encode=n}}const Ef=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e);return n.annotations.value={...e.annotations,...t},Object.create(Object.getPrototypeOf(e),n)},NC=".*",vC="[+-]?\\d*\\.?\\d+(?:[Ee][+-]?\\d+)?",CC=e=>{let t=`^${Qu(e.head)}`;for(const n of e.spans)Ib(n.type)?t+=NC:bC(n.type)&&(t+=vC),t+=Qu(n.literal);return t+="$",new RegExp(t)},mt=e=>{switch(e._tag){case"Declaration":{const t=It(e.typeParameters,mt);return t===e.typeParameters?e:new Eb(t,e.decodeUnknown,e.encodeUnknown,e.annotations)}case"TupleType":{const t=It(e.elements,s=>{const o=mt(s.type);return o===s.type?s:new Sf(o,s.isOptional)}),n=Tb(e.rest),r=It(n,mt);return t===e.elements&&r===n?e:new $b(t,r.map(s=>new _f(s)),e.isReadonly,e.annotations)}case"TypeLiteral":{const t=It(e.propertySignatures,r=>{const s=mt(r.type);return s===r.type?r:new Hc(r.name,s,r.isOptional,r.isReadonly)}),n=It(e.indexSignatures,r=>{const s=mt(r.type);return s===r.type?r:new Fb(r.parameter,s,r.isReadonly)});return t===e.propertySignatures&&n===e.indexSignatures?e:new Gc(t,n,e.annotations)}case"Union":{const t=It(e.types,mt);return t===e.types?e:ir.make(t,e.annotations)}case"Suspend":return new Cb(()=>mt(e.f()),e.annotations);case"Refinement":{const t=mt(e.from);return t===e.from?e:new Ab(t,e.filter,e.annotations)}case"Transformation":return mt(e.to)}return e},AC=e=>pi(oC(e),()=>wb(e)),Yc=e=>Ke(AC(e),{onNone:()=>{},onSome:t=>({[kb]:t})});function It(e,t){let n=!1;const r=Si(e.length);for(let s=0;s<e.length;s++){const o=e[s],i=t(o);i!==o&&(n=!0),r[s]=i}return n?r:e}const Vt=(e,t)=>{switch(e._tag){case"Declaration":{const n=It(e.typeParameters,r=>Vt(r));return n===e.typeParameters?e:new Eb(n,e.decodeUnknown,e.encodeUnknown,e.annotations)}case"TupleType":{const n=It(e.elements,o=>{const i=Vt(o.type);return i===o.type?o:new Sf(i,o.isOptional)}),r=Tb(e.rest),s=It(r,o=>Vt(o));return n===e.elements&&s===r?e:new $b(n,s.map(o=>new _f(o)),e.isReadonly,Yc(e))}case"TypeLiteral":{const n=It(e.propertySignatures,s=>{const o=Vt(s.type);return o===s.type?s:new Hc(s.name,o,s.isOptional,s.isReadonly)}),r=It(e.indexSignatures,s=>{const o=Vt(s.type);return o===s.type?s:new Fb(s.parameter,o,s.isReadonly)});return n===e.propertySignatures&&r===e.indexSignatures?e:new Gc(n,r,Yc(e))}case"Union":{const n=It(e.types,r=>Vt(r));return n===e.types?e:ir.make(n,Yc(e))}case"Suspend":return new Cb(()=>Vt(e.f()),Yc(e));case"Refinement":return Vt(e.from);case"Transformation":return Vt(e.from)}return e},xb=e=>Vt(e),Je=e=>{const t={};for(const n of Object.getOwnPropertySymbols(e))t[String(n)]=e[n];return t},Mb=e=>{switch(e._tag){case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":return e;case"Refinement":return Mb(e.from)}},Uo=e=>be(vt(e),()=>e._tag),vt=e=>wb(e).pipe(pi(()=>Gv(e)),pi(()=>Yv(e))),xC=Symbol.for("@effect/schema/TypeId/GreaterThan"),MC=Symbol.for("@effect/schema/TypeId/LessThan"),PC=Symbol.for("@effect/schema/TypeId/Between"),LC=Symbol.for("@effect/schema/ArbitraryHookId"),gt=(e,t=[])=>({value:e,forest:t}),DC=e=>Y(hs(e),t=>BC(t)),UC=e=>An(DC(e)),BC=e=>e.value+Pb(`
`,e.forest),Pb=(e,t)=>{let n="";const r=t.length;let s;for(let o=0;o<r;o++){s=t[o];const i=o===r-1;n+=e+(i?"└":"├")+"─ "+s.value,n+=Pb(e+(r>1&&!i?"│  ":"   "),s.forest)}return n},jC=e=>{switch(e){case"Encoded":return"Encoded side transformation failure";case"Transformation":return"Transformation process failure";case"Type":return"Type side transformation failure"}},KC=e=>{switch(e){case"From":return"From side refinement failure";case"Predicate":return"Predicate refinement failure"}},Lb=e=>"ast"in e?T(e.ast):O(),qC=e=>Lb(e).pipe(yi(Wv),j(t=>{const n=t(e);return Pt(n)?ce({message:n,override:!1}):Ao(n)?Y(n,r=>({message:r,override:!1})):Pt(n.message)?ce({message:n.message,override:n.override}):Y(n.message,r=>({message:r,override:n.override}))})),Of=e=>t=>t._tag===e,VC=Of("Composite"),Db=Of("Refinement"),Ub=Of("Transformation"),If=e=>qC(e).pipe(j(t=>!t.override&&(VC(e)||Db(e)&&e.kind==="From"||Ub(e)&&e.kind!=="Transformation")?Ub(e)||Db(e)?If(e.issue):O():ce(t.message))),Bb=e=>Lb(e).pipe(yi(Zv),_w(t=>Us(t(e)))),JC=e=>If(e).pipe(Rv(()=>Bb(e)),Mo(()=>ce(e.message??`Expected ${String(e.ast)}, actual ${sr(e.actual)}`))),Xc=e=>be(Bb(e),()=>String(e.ast)),zC=e=>e.message??"is forbidden",WC=e=>e.message??"is unexpected",HC=e=>Hv(e.ast).pipe(j(t=>{const n=t();return Pt(n)?ce(n):n}),Mo(()=>ce(e.message??"is missing"))),Tf=(e,t)=>$v(If(e),{onFailure:t,onSuccess:n=>ce(gt(n))}),hs=e=>{switch(e._tag){case"Type":return Y(JC(e),gt);case"Forbidden":return ce(gt(Xc(e),[gt(zC(e))]));case"Unexpected":return ce(gt(WC(e)));case"Missing":return Y(HC(e),gt);case"Transformation":return Tf(e,()=>Y(hs(e.issue),t=>gt(Xc(e),[gt(jC(e.kind),[t])])));case"Refinement":return Tf(e,()=>Y(hs(e.issue),t=>gt(Xc(e),[gt(KC(e.kind),[t])])));case"Pointer":return Y(hs(e.issue),t=>gt(Pv(e.path),[t]));case"Composite":{const t=Xc(e);return Tf(e,()=>ab(e.issues)?Y(Kt(e.issues,hs),n=>gt(t,n)):Y(hs(e.issues),n=>gt(t,[n])))}}};class ze{constructor(t,n,r){u(this,"path");u(this,"actual");u(this,"issue");u(this,"_tag","Pointer");this.path=t,this.actual=n,this.issue=r}}class jb{constructor(t,n){u(this,"actual");u(this,"message");u(this,"_tag","Unexpected");this.actual=t,this.message=n}}class Bo{constructor(t,n){u(this,"ast");u(this,"message");u(this,"_tag","Missing");u(this,"actual");this.ast=t,this.message=n}}class Re{constructor(t,n,r,s){u(this,"ast");u(this,"actual");u(this,"issues");u(this,"output");u(this,"_tag","Composite");this.ast=t,this.actual=n,this.issues=r,this.output=s}}class $f{constructor(t,n,r,s){u(this,"ast");u(this,"actual");u(this,"kind");u(this,"issue");u(this,"_tag","Refinement");this.ast=t,this.actual=n,this.kind=r,this.issue=s}}class Rf{constructor(t,n,r,s){u(this,"ast");u(this,"actual");u(this,"kind");u(this,"issue");u(this,"_tag","Transformation");this.ast=t,this.actual=n,this.kind=r,this.issue=s}}class Jt{constructor(t,n,r){u(this,"ast");u(this,"actual");u(this,"message");u(this,"_tag","Type");this.ast=t,this.actual=n,this.message=r}}class GC{constructor(t,n,r){u(this,"ast");u(this,"actual");u(this,"message");u(this,"_tag","Forbidden");this.ast=t,this.actual=n,this.message=r}}const Kb=Symbol.for("@effect/schema/ParseErrorTypeId");class YC extends lv("ParseError"){constructor(){super(...arguments);u(this,gL,Kb)}get message(){return this.toString()}toString(){return UC(this.issue)}toJSON(){return{_id:"ParseError",message:this.toString()}}[(gL=Kb,he)](){return this.toJSON()}}const qb=e=>new YC({issue:e}),XC=se,QC=Uw,Qc=h(2,(e,t)=>{const n=e;return n._tag==="Left"?n:n._tag==="Right"?t(n.right):j(e,t)}),ZC=h(2,(e,t)=>{const n=e;return n._tag==="Left"?n:n._tag==="Right"?se(t(n.right)):Y(e,t)}),Zc=h(2,(e,t)=>{const n=e;return n._tag==="Left"?q(t(n.left)):n._tag==="Right"?n:df(e,t)}),an=e=>{const t=e;if(t._tag==="Left"||t._tag==="Right")return t},Vb=h(2,(e,t)=>{const n=e;return n._tag==="Left"?t(n.left):n._tag==="Right"?n:Mo(e,t)}),Ff=(e,t)=>t===void 0||Dn(t)?e:e===void 0?t:{...e,...t},eA=(e,t,n)=>{const r=We(e,t);return(s,o)=>r(s,Ff(n,o))},Nf=(e,t,n)=>{const r=eA(e,t,n);return(s,o)=>Kw(r(s,o),qb)},tA=(e,t,n)=>{const r=We(e,t);return(s,o)=>r(s,{...Ff(n,o),isEffectAllowed:!0})},nA=(e,t)=>Nf(e.ast,!0,t),rA=(e,t)=>tA(e.ast,!0,t),sA=(e,t)=>Nf(e.ast,!1,t),jo=nA,Jb=(e,t)=>Nf(mt(e.ast),!0,t),oA=sA,iA=W(Symbol.for("@effect/schema/Parser/decodeMemoMap"),()=>new WeakMap),cA=W(Symbol.for("@effect/schema/Parser/encodeMemoMap"),()=>new WeakMap),We=(e,t)=>{const n=t?iA:cA,r=n.get(e);if(r)return r;const s=aA(e,t),o=eC(e),i=le(o)?(l,f)=>s(l,Ff(f,o.value)):s,c=tC(e),a=t&&le(c)?(l,f)=>qo(Vb(i(l,f),c.value),e,l,f):i;return n.set(e,a),a},vf=e=>Wt(Xv(e)),Cf=e=>Wt(Qv(e)),aA=(e,t)=>{switch(e._tag){case"Refinement":if(t){const n=We(e.from,!0);return(r,s)=>{s=s??kf;const o=(s==null?void 0:s.errors)==="all",i=Qc(Vb(n(r,s),c=>{const a=new $f(e,r,"From",c);return o&&sC(e)?Ke(e.filter(r,s,e),{onNone:()=>q(a),onSome:l=>q(new Re(e,r,[a,new $f(e,r,"Predicate",l)]))}):q(a)}),c=>Ke(e.filter(c,s,e),{onNone:()=>se(c),onSome:a=>q(new $f(e,r,"Predicate",a))}));return qo(i,e,r,s)}}else{const n=We(mt(e),!0),r=We(zb(e.from),!1);return(s,o)=>qo(Qc(n(s,o),i=>r(i,o)),e,s,o)}case"Transformation":{const n=hA(e.transformation,t),r=t?We(e.from,!0):We(e.to,!1),s=t?We(e.to,!0):We(e.from,!1);return(o,i)=>qo(Qc(Zc(r(o,i),c=>new Rf(e,o,t?"Encoded":"Type",c)),c=>Qc(Zc(n(c,i??kf,e,o),a=>new Rf(e,o,"Transformation",a)),a=>Zc(s(a,i),l=>new Rf(e,o,t?"Type":"Encoded",l)))),e,o,i)}case"Declaration":{const n=t?e.decodeUnknown(...e.typeParameters):e.encodeUnknown(...e.typeParameters);return(r,s)=>qo(n(r,s??kf,e),e,r,s)}case"Literal":return pt(e,n=>n===e.literal);case"UniqueSymbol":return pt(e,n=>n===e.symbol);case"UndefinedKeyword":return pt(e,_0);case"NeverKeyword":return pt(e,S0);case"UnknownKeyword":case"AnyKeyword":case"VoidKeyword":return se;case"StringKeyword":return pt(e,Pt);case"NumberKeyword":return pt(e,Dn);case"BooleanKeyword":return pt(e,ni);case"BigIntKeyword":return pt(e,ri);case"SymbolKeyword":return pt(e,Ia);case"ObjectKeyword":return pt(e,dr);case"Enums":return pt(e,n=>e.enums.some(([r,s])=>s===n));case"TemplateLiteral":{const n=CC(e);return pt(e,r=>Pt(r)&&n.test(r))}case"TupleType":{const n=e.elements.map(l=>We(l.type,t)),r=e.rest.map(l=>We(l.type,t));let s=e.elements.filter(l=>!l.isOptional);e.rest.length>0&&(s=s.concat(e.rest.slice(1)));const o=s.length,i=e.elements.length>0?e.elements.map((l,f)=>f).join(" | "):"never",c=vf(e),a=Cf(e);return(l,f)=>{if(!za(l))return q(new Jt(e,l));const m=(f==null?void 0:f.errors)==="all",g=[];let p=0;const y=[],k=l.length;for(let $=k;$<=o-1;$++){const A=new ze($,l,new Bo(s[$-k]));if(m){g.push([p++,A]);continue}else return q(new Re(e,l,A,y))}if(e.rest.length===0)for(let $=e.elements.length;$<=k-1;$++){const A=new ze($,l,new jb(l[$],`is unexpected, expected: ${i}`));if(m){g.push([p++,A]);continue}else return q(new Re(e,l,A,y))}let b=0,_;for(;b<n.length;b++)if(k<b+1){if(e.elements[b].isOptional)continue}else{const $=n[b],A=$(l[b],f),V=an(A);if(V){if(Ye(V)){const D=new ze(b,l,V.left);if(m){g.push([p++,D]);continue}else return q(new Re(e,l,D,Ct(y)))}y.push([p++,V.right])}else{const D=p++,M=b;_||(_=[]),_.push(({es:P,output:B})=>j(rr(A),U=>{if(Ye(U)){const C=new ze(M,l,U.left);return m?(P.push([D,C]),fe):q(new Re(e,l,C,Ct(B)))}return B.push([D,U.right]),fe}))}}if(Le(r)){const[$,...A]=r;for(;b<k-A.length;b++){const V=$(l[b],f),D=an(V);if(D)if(Ye(D)){const M=new ze(b,l,D.left);if(m){g.push([p++,M]);continue}else return q(new Re(e,l,M,Ct(y)))}else y.push([p++,D.right]);else{const M=p++,P=b;_||(_=[]),_.push(({es:B,output:U})=>j(rr(V),C=>{if(Ye(C)){const z=new ze(P,l,C.left);return m?(B.push([M,z]),fe):q(new Re(e,l,z,Ct(U)))}else return U.push([M,C.right]),fe}))}}for(let V=0;V<A.length;V++)if(b+=V,!(k<b+1)){const D=A[V](l[b],f),M=an(D);if(M){if(Ye(M)){const P=new ze(b,l,M.left);if(m){g.push([p++,P]);continue}else return q(new Re(e,l,P,Ct(y)))}y.push([p++,M.right])}else{const P=p++,B=b;_||(_=[]),_.push(({es:U,output:C})=>j(rr(D),z=>{if(Ye(z)){const Z=new ze(B,l,z.left);return m?(U.push([P,Z]),fe):q(new Re(e,l,Z,Ct(C)))}return C.push([P,z.right]),fe}))}}}const I=({es:$,output:A})=>ki($)?q(new Re(e,l,Ct($),Ct(A))):se(Ct(A));if(_&&_.length>0){const $=_;return je(()=>{const A={es:qs(g),output:qs(y)};return j(Kt($,V=>V(A),{concurrency:c,batching:a,discard:!0}),()=>I(A))})}return I({output:y,es:g})}}case"TypeLiteral":{if(e.propertySignatures.length===0&&e.indexSignatures.length===0)return pt(e,w0);const n=[],r={},s=[];for(const f of e.propertySignatures)n.push([We(f.type,t),f]),r[f.name]=null,s.push(f.name);const o=e.indexSignatures.map(f=>[We(f.parameter,t),We(f.type,t),f.parameter]),i=ir.make(e.indexSignatures.map(f=>f.parameter).concat(s.map(f=>Ia(f)?new cC(f):new iC(f)))),c=We(i,t),a=vf(e),l=Cf(e);return(f,m)=>{if(!O0(f))return q(new Jt(e,f));const g=(m==null?void 0:m.errors)==="all",p=[];let y=0;const k=(m==null?void 0:m.onExcessProperty)==="error",b=(m==null?void 0:m.onExcessProperty)==="preserve",_={};let I;if(k||b){I=Jc(f);for(const D of I){const M=an(c(D,m));if(Ye(M))if(k){const P=new ze(D,f,new jb(f[D],`is unexpected, expected: ${String(i)}`));if(g){p.push([y++,P]);continue}else return q(new Re(e,f,P,_))}else _[D]=f[D]}}let $;const A=(m==null?void 0:m.exact)===!0;for(let D=0;D<n.length;D++){const M=n[D][1],P=M.name,B=Object.prototype.hasOwnProperty.call(f,P);if(!B){if(M.isOptional)continue;if(A){const Z=new ze(P,f,new Bo(M));if(g){p.push([y++,Z]);continue}else return q(new Re(e,f,Z,_))}}const U=n[D][0],C=U(f[P],m),z=an(C);if(z){if(Ye(z)){const Z=new ze(P,f,B?z.left:new Bo(M));if(g){p.push([y++,Z]);continue}else return q(new Re(e,f,Z,_))}_[P]=z.right}else{const Z=y++,ne=P;$||($=[]),$.push(({es:ae,output:re})=>j(rr(C),Q=>{if(Ye(Q)){const ue=new ze(ne,f,B?Q.left:new Bo(M));return g?(ae.push([Z,ue]),fe):q(new Re(e,f,ue,re))}return re[ne]=Q.right,fe}))}}for(let D=0;D<o.length;D++){const M=o[D],P=M[0],B=M[1],U=ib(f,M[2]);for(const C of U){const z=an(P(C,m));if(z&&gn(z)){const Z=B(f[C],m),ne=an(Z);if(ne)if(Ye(ne)){const ae=new ze(C,f,ne.left);if(g){p.push([y++,ae]);continue}else return q(new Re(e,f,ae,_))}else Object.prototype.hasOwnProperty.call(r,C)||(_[C]=ne.right);else{const ae=y++,re=C;$||($=[]),$.push(({es:Q,output:ue})=>j(rr(Z),x=>{if(Ye(x)){const pe=new ze(re,f,x.left);return g?(Q.push([ae,pe]),fe):q(new Re(e,f,pe,ue))}else return Object.prototype.hasOwnProperty.call(r,C)||(ue[C]=x.right),fe}))}}}}const V=({es:D,output:M})=>{if(ki(D))return q(new Re(e,f,Ct(D),M));if((m==null?void 0:m.propertyOrder)==="original"){const P=I||Jc(f);for(const U of s)P.indexOf(U)===-1&&P.push(U);const B={};for(const U of P)Object.prototype.hasOwnProperty.call(M,U)&&(B[U]=M[U]);return se(B)}return se(M)};if($&&$.length>0){const D=$;return je(()=>{const M={es:qs(p),output:Object.assign({},_)};return j(Kt(D,P=>P(M),{concurrency:a,batching:l,discard:!0}),()=>V(M))})}return V({es:p,output:_})}}case"Union":{const n=lA(e.types,t),r=Jc(n.keys),s=r.length,o=new Map;for(let a=0;a<e.types.length;a++)o.set(e.types[a],We(e.types[a],t));const i=vf(e)??1,c=Cf(e);return(a,l)=>{const f=[];let m=0,g=[];if(s>0)if(uA(a))for(let k=0;k<s;k++){const b=r[k],_=n.keys[b].buckets;if(Object.prototype.hasOwnProperty.call(a,b)){const I=String(a[b]);if(Object.prototype.hasOwnProperty.call(_,I))g=g.concat(_[I]);else{const $=ir.make(n.keys[b].literals);f.push([m++,new Re(new Gc([new Hc(b,$,!1,!0)],[]),a,new ze(b,a,new Jt($,a[b])))])}}else{const I=ir.make(n.keys[b].literals),$=new Hc(b,I,!1,!0);f.push([m++,new Re(new Gc([$],[]),a,new ze(b,a,new Bo($)))])}}else f.push([m++,new Jt(e,a)]);n.otherwise.length>0&&(g=g.concat(n.otherwise));let p;for(let k=0;k<g.length;k++){const b=g[k],_=o.get(b)(a,l),I=!p||p.length===0?an(_):void 0;if(I){if(gn(I))return I;f.push([m++,I.left])}else{const $=m++;p||(p=[]),p.push(A=>je(()=>"finalResult"in A?fe:j(rr(_),V=>(gn(V)?A.finalResult=V:A.es.push([$,V.left]),fe))))}}const y=k=>ki(k)?k.length===1&&k[0][1]._tag==="Type"?q(k[0][1]):q(new Re(e,a,Ct(k))):q(new Jt(e,a));if(p&&p.length>0){const k=p;return je(()=>{const b={es:qs(f)};return j(Kt(k,_=>_(b),{concurrency:i,batching:c,discard:!0}),()=>"finalResult"in b?b.finalResult:y(b.es))})}return y(f)}}case"Suspend":{const n=cb(()=>We(Ef(e.f(),e.annotations),t));return(r,s)=>n()(r,s)}}},uA=e=>typeof e=="object"&&e!==null,pt=(e,t)=>n=>t(n)?se(n):q(new Jt(e,n)),Ko=(e,t)=>{switch(e._tag){case"Declaration":{const n=nC(e);if(le(n))return Ko(n.value,t);break}case"TypeLiteral":{const n=[];for(let r=0;r<e.propertySignatures.length;r++){const s=e.propertySignatures[r],o=t?xb(s.type):mt(s.type);Ob(o)&&!s.isOptional&&n.push([s.name,o])}return n}case"TupleType":{const n=[];for(let r=0;r<e.elements.length;r++){const s=e.elements[r],o=t?xb(s.type):mt(s.type);Ob(o)&&!s.isOptional&&n.push([r,o])}return n}case"Refinement":return Ko(e.from,t);case"Suspend":return Ko(e.f(),t);case"Transformation":return Ko(t?e.from:e.to,t)}return[]},lA=(e,t)=>{const n={},r=[];for(let s=0;s<e.length;s++){const o=e[s],i=Ko(o,t);if(i.length>0)for(let c=0;c<i.length;c++){const[a,l]=i[c],f=String(l.literal);n[a]=n[a]||{buckets:{},literals:[]};const m=n[a].buckets;if(Object.prototype.hasOwnProperty.call(m,f)){if(c<i.length-1)continue;m[f].push(o),n[a].literals.push(l)}else{m[f]=[o],n[a].literals.push(l);break}}else r.push(o)}return{keys:n,otherwise:r}},zb=e=>$C(e)?zb(e.from):e,qo=(e,t,n,r)=>{const s=an(e);if(s)return s;if((r==null?void 0:r.isEffectAllowed)===!0)return e;try{return An(rr(e))}catch{return q(new GC(t,n,"cannot be be resolved synchronously, this is caused by using runSync on an effect that performs async work"))}},fA=([e],[t])=>e>t?1:e<t?-1:0;function Ct(e){return e.sort(fA).map(t=>t[1])}const hA=(e,t)=>{switch(e._tag){case"FinalTransformation":return t?e.decode:e.encode;case"ComposeTransformation":return se;case"TypeLiteralTransformation":return n=>{let r=se(n);for(const s of e.propertySignatureTransformations){const[o,i]=t?[s.from,s.to]:[s.to,s.from],c=t?s.decode:s.encode;r=ZC(r,l=>{const f=c(Object.prototype.hasOwnProperty.call(l,o)?T(l[o]):O());return delete l[o],le(f)&&(l[i]=f.value),l})}return r}}},dA=Symbol.for("@effect/schema/EquivalenceHookId"),mA=Symbol.for("@effect/schema/PrettyHookId"),ea=Symbol.for("@effect/schema/Schema"),ds=e=>{var t,n,r;return n=class{constructor(){u(this,t,Wb)}static annotations(o){return ds(ta(this.ast,o))}static pipe(){return v(this,arguments)}static toString(){return String(e)}},t=ea,r=ea,u(n,"Type"),u(n,"Encoded"),u(n,"Context"),u(n,r,Wb),u(n,"ast",e),n},Wb={_A:e=>e,_I:e=>e,_R:e=>e},Af=e=>{if(!e)return{};const t={},n=Object.getOwnPropertySymbols(e);for(const s of n)t[s]=e[s];if(e.typeId!==void 0){const s=e.typeId;typeof s=="object"?(t[hb]=s.id,t[s.id]=s.annotation):t[hb]=s}const r=(s,o)=>{e[s]!==void 0&&(t[o]=e[s])};return r("message",db),r("missingMessage",mb),r("identifier",gb),r("title",or),r("description",Wc),r("examples",Bv),r("default",jv),r("documentation",qv),r("jsonSchema",Kv),r("arbitrary",LC),r("pretty",mA),r("equivalence",dA),r("concurrency",pb),r("batching",yb),r("parseIssueTitle",bb),r("parseOptions",_b),r("decodingFallback",Sb),t},ta=(e,t)=>Ef(e,Af(t)),gA=(e,t)=>{const n=rA(e,t);return(r,s)=>Zc(n(r,s),qb)},Hb=e=>K(e,ea)&&dr(e[ea]);class Gb extends ds(gC){}class xf extends ds(yC){}const Yb=e=>{var t;return t=class extends ds(e){static annotations(r){return Yb(ta(this.ast,r))}},u(t,"make",(r,s)=>t_(s)?r:Jb(t)(r)),t},Mf=(e,t)=>n=>{const r=Ke(zv(n.ast),{onNone:()=>[e],onSome:o=>[...o,e]}),s=Ef(n.ast,Af({title:String(n.ast)+` & Brand<${sr(e)}>`,...t,[fb]:r}));return Yb(s)},pA=Symbol.for("@effect/schema/refine"),Xb=(e,t,n)=>{var r,s;return s=class extends ds(n){static annotations(i){return Xb(this.from,this.filter,ta(this.ast,i))}},r=pA,u(s,r,e),u(s,"from",e),u(s,"filter",t),u(s,"make",(i,c)=>t_(c)?i:Jb(s)(i)),s},Qb=(e,t,n)=>{if(ni(e))return e?O():T(new Jt(t,n));if(Pt(e))return T(new Jt(t,n,e));if(e!==void 0){if("_tag"in e)return T(e);const r=new Jt(t,n,e.message);return T(Le(e.path)?new ze(e.path,n,r):r)}return O()},yA=(e,t,n)=>{if(Mv(e))return Qb(e,t,n);if(Le(e)){const r=ud(e,s=>Qb(s,t,n));if(Le(r))return T(r.length===1?r[0]:new Re(t,n,r))}return O()};function na(e,t){return n=>{function r(o,i,c){return yA(e(o,i,c),c,o)}const s=new Ab(n.ast,r,Af(t));return Xb(n,r,s)}}const Zb=(e,t,n)=>{var r;return r=class extends ds(n){static annotations(o){return Zb(this.from,this.to,ta(this.ast,o))}},u(r,"from",e),u(r,"to",t),r},bA=h(e=>Hb(e[0])&&Hb(e[1]),(e,t,n)=>Zb(e,t,new RC(e.ast,t.ast,new FC(n.decode,n.encode)))),_A=Symbol.for("@effect/schema/TypeId/Pattern"),SA=(e,t)=>n=>{const r=e.source;return n.pipe(na(s=>(e.lastIndex=0,e.test(s)),{typeId:{id:_A,annotation:{regex:e}},description:`a string matching the pattern ${r}`,jsonSchema:{pattern:r},arbitrary:()=>s=>s.stringMatching(e),...t}))},wA=xC,kA=(e,t)=>n=>n.pipe(na(r=>r>e,{typeId:wA,description:`a number greater than ${e}`,jsonSchema:{exclusiveMinimum:e},...t})),EA=MC,OA=(e,t)=>n=>n.pipe(na(r=>r<e,{typeId:EA,description:`a number less than ${e}`,jsonSchema:{exclusiveMaximum:e},...t})),IA=PC,TA=(e,t,n)=>r=>r.pipe(na(s=>s>=e&&s<=t,{typeId:IA,description:`a number between ${e} and ${t}`,jsonSchema:{maximum:t,minimum:e},...n})),$A=e=>bA(e,xf,{strict:!1,decode:(t,n,r)=>QC(sI(t),()=>new Jt(r,t)),encode:t=>XC(String(t))});class e_ extends $A(Gb.annotations({description:"a string that will be parsed into a number"})).annotations({identifier:"NumberFromString"}){}const t_=e=>ni(e)?e:(e==null?void 0:e.disableValidation)??!1;function Pf(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function n_(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function r_(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function yt(e,...t){if(!r_(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function s_(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function RA(e,t){yt(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const xn=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4));if(!(new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68))throw new Error("Non little-endian hardware is not supported");function FA(e){if(typeof e!="string")throw new Error(`string expected, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Lf(e){if(typeof e=="string")e=FA(e);else if(r_(e))e=Df(e);else throw new Error(`Uint8Array expected, got ${typeof e}`);return e}function o_(...e){let t=0;for(let r=0;r<e.length;r++){const s=e[r];yt(s),t+=s.length}const n=new Uint8Array(t);for(let r=0,s=0;r<e.length;r++){const o=e[r];n.set(o,s),s+=o.length}return n}function NA(e,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(e,t)}function vA(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}const CA=(e,t)=>(Object.assign(t,e),t);function Df(e){return Uint8Array.from(e)}function ms(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}const i_=e=>Uint8Array.from(e.split("").map(t=>t.charCodeAt(0))),AA=i_("expand 16-byte k"),xA=i_("expand 32-byte k"),MA=xn(AA),c_=xn(xA);c_.slice();function F(e,t){return e<<t|e>>>32-t}function Uf(e){return e.byteOffset%4===0}const ra=64,PA=16,a_=2**32-1,u_=new Uint32Array;function LA(e,t,n,r,s,o,i,c){const a=s.length,l=new Uint8Array(ra),f=xn(l),m=Uf(s)&&Uf(o),g=m?xn(s):u_,p=m?xn(o):u_;for(let y=0;y<a;i++){if(e(t,n,r,f,i,c),i>=a_)throw new Error("arx: counter overflow");const k=Math.min(ra,a-y);if(m&&k===ra){const b=y/4;if(y%4!==0)throw new Error("arx: invalid block position");for(let _=0,I;_<PA;_++)I=b+_,p[I]=g[I]^f[_];y+=ra;continue}for(let b=0,_;b<k;b++)_=y+b,o[_]=s[_]^l[b];y+=k}}function DA(e,t){const{allowShortKeys:n,extendNonceFn:r,counterLength:s,counterRight:o,rounds:i}=NA({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return Pf(s),Pf(i),n_(o),n_(n),(c,a,l,f,m=0)=>{yt(c),yt(a),yt(l);const g=l.length;if(f===void 0&&(f=new Uint8Array(g)),yt(f),Pf(m),m<0||m>=a_)throw new Error("arx: counter overflow");if(f.length<g)throw new Error(`arx: output (${f.length}) is shorter than data (${g})`);const p=[];let y=c.length,k,b;if(y===32)p.push(k=Df(c)),b=c_;else if(y===16&&n)k=new Uint8Array(32),k.set(c),k.set(c,16),b=MA,p.push(k);else throw new Error(`arx: invalid 32-byte key, got length=${y}`);Uf(a)||p.push(a=Df(a));const _=xn(k);if(r){if(a.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(b,_,xn(a.subarray(0,16)),_),a=a.subarray(16)}const I=16-s;if(I!==a.length)throw new Error(`arx: nonce must be ${I} or 16 bytes`);if(I!==12){const A=new Uint8Array(12);A.set(a,o?0:12-a.length),a=A,p.push(a)}const $=xn(a);return LA(e,b,_,$,l,f,m,i),ms(...p),f}}const He=(e,t)=>e[t++]&255|(e[t++]&255)<<8;class UA{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,t=Lf(t),yt(t,32);const n=He(t,0),r=He(t,2),s=He(t,4),o=He(t,6),i=He(t,8),c=He(t,10),a=He(t,12),l=He(t,14);this.r[0]=n&8191,this.r[1]=(n>>>13|r<<3)&8191,this.r[2]=(r>>>10|s<<6)&7939,this.r[3]=(s>>>7|o<<9)&8191,this.r[4]=(o>>>4|i<<12)&255,this.r[5]=i>>>1&8190,this.r[6]=(i>>>14|c<<2)&8191,this.r[7]=(c>>>11|a<<5)&8065,this.r[8]=(a>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let f=0;f<8;f++)this.pad[f]=He(t,16+2*f)}process(t,n,r=!1){const s=r?0:2048,{h:o,r:i}=this,c=i[0],a=i[1],l=i[2],f=i[3],m=i[4],g=i[5],p=i[6],y=i[7],k=i[8],b=i[9],_=He(t,n+0),I=He(t,n+2),$=He(t,n+4),A=He(t,n+6),V=He(t,n+8),D=He(t,n+10),M=He(t,n+12),P=He(t,n+14);let B=o[0]+(_&8191),U=o[1]+((_>>>13|I<<3)&8191),C=o[2]+((I>>>10|$<<6)&8191),z=o[3]+(($>>>7|A<<9)&8191),Z=o[4]+((A>>>4|V<<12)&8191),ne=o[5]+(V>>>1&8191),ae=o[6]+((V>>>14|D<<2)&8191),re=o[7]+((D>>>11|M<<5)&8191),Q=o[8]+((M>>>8|P<<8)&8191),ue=o[9]+(P>>>5|s),x=0,pe=x+B*c+U*(5*b)+C*(5*k)+z*(5*y)+Z*(5*p);x=pe>>>13,pe&=8191,pe+=ne*(5*g)+ae*(5*m)+re*(5*f)+Q*(5*l)+ue*(5*a),x+=pe>>>13,pe&=8191;let tt=x+B*a+U*c+C*(5*b)+z*(5*k)+Z*(5*y);x=tt>>>13,tt&=8191,tt+=ne*(5*p)+ae*(5*g)+re*(5*m)+Q*(5*f)+ue*(5*l),x+=tt>>>13,tt&=8191;let Oe=x+B*l+U*a+C*c+z*(5*b)+Z*(5*k);x=Oe>>>13,Oe&=8191,Oe+=ne*(5*y)+ae*(5*p)+re*(5*g)+Q*(5*m)+ue*(5*f),x+=Oe>>>13,Oe&=8191;let hn=x+B*f+U*l+C*a+z*c+Z*(5*b);x=hn>>>13,hn&=8191,hn+=ne*(5*k)+ae*(5*y)+re*(5*p)+Q*(5*g)+ue*(5*m),x+=hn>>>13,hn&=8191;let Is=x+B*m+U*f+C*l+z*a+Z*c;x=Is>>>13,Is&=8191,Is+=ne*(5*b)+ae*(5*k)+re*(5*y)+Q*(5*p)+ue*(5*g),x+=Is>>>13,Is&=8191;let Ts=x+B*g+U*m+C*f+z*l+Z*a;x=Ts>>>13,Ts&=8191,Ts+=ne*c+ae*(5*b)+re*(5*k)+Q*(5*y)+ue*(5*p),x+=Ts>>>13,Ts&=8191;let $s=x+B*p+U*g+C*m+z*f+Z*l;x=$s>>>13,$s&=8191,$s+=ne*a+ae*c+re*(5*b)+Q*(5*k)+ue*(5*y),x+=$s>>>13,$s&=8191;let Rs=x+B*y+U*p+C*g+z*m+Z*f;x=Rs>>>13,Rs&=8191,Rs+=ne*l+ae*a+re*c+Q*(5*b)+ue*(5*k),x+=Rs>>>13,Rs&=8191;let Fs=x+B*k+U*y+C*p+z*g+Z*m;x=Fs>>>13,Fs&=8191,Fs+=ne*f+ae*l+re*a+Q*c+ue*(5*b),x+=Fs>>>13,Fs&=8191;let Ns=x+B*b+U*k+C*y+z*p+Z*g;x=Ns>>>13,Ns&=8191,Ns+=ne*m+ae*f+re*l+Q*a+ue*c,x+=Ns>>>13,Ns&=8191,x=(x<<2)+x|0,x=x+pe|0,pe=x&8191,x=x>>>13,tt+=x,o[0]=pe,o[1]=tt,o[2]=Oe,o[3]=hn,o[4]=Is,o[5]=Ts,o[6]=$s,o[7]=Rs,o[8]=Fs,o[9]=Ns}finalize(){const{h:t,pad:n}=this,r=new Uint16Array(10);let s=t[1]>>>13;t[1]&=8191;for(let c=2;c<10;c++)t[c]+=s,s=t[c]>>>13,t[c]&=8191;t[0]+=s*5,s=t[0]>>>13,t[0]&=8191,t[1]+=s,s=t[1]>>>13,t[1]&=8191,t[2]+=s,r[0]=t[0]+5,s=r[0]>>>13,r[0]&=8191;for(let c=1;c<10;c++)r[c]=t[c]+s,s=r[c]>>>13,r[c]&=8191;r[9]-=8192;let o=(s^1)-1;for(let c=0;c<10;c++)r[c]&=o;o=~o;for(let c=0;c<10;c++)t[c]=t[c]&o|r[c];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let i=t[0]+n[0];t[0]=i&65535;for(let c=1;c<8;c++)i=(t[c]+n[c]|0)+(i>>>16)|0,t[c]=i&65535;ms(r)}update(t){s_(this);const{buffer:n,blockLen:r}=this;t=Lf(t);const s=t.length;for(let o=0;o<s;){const i=Math.min(r-this.pos,s-o);if(i===r){for(;r<=s-o;o+=r)this.process(t,o);continue}n.set(t.subarray(o,o+i),this.pos),this.pos+=i,o+=i,this.pos===r&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){ms(this.h,this.r,this.buffer,this.pad)}digestInto(t){s_(this),RA(t,this),this.finished=!0;const{buffer:n,h:r}=this;let{pos:s}=this;if(s){for(n[s++]=1;s<16;s++)n[s]=0;this.process(n,0,!0)}this.finalize();let o=0;for(let i=0;i<8;i++)t[o++]=r[i]>>>0,t[o++]=r[i]>>>8;return t}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}}function BA(e){const t=(r,s)=>e(s).update(Lf(r)).digest(),n=e(new Uint8Array(32));return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=r=>e(r),t}const l_=BA(e=>new UA(e));function jA(e,t,n,r,s,o=20){let i=e[0],c=t[0],a=t[1],l=t[2],f=t[3],m=e[1],g=n[0],p=n[1],y=s,k=0,b=e[2],_=t[4],I=t[5],$=t[6],A=t[7],V=e[3],D=i,M=c,P=a,B=l,U=f,C=m,z=g,Z=p,ne=y,ae=k,re=b,Q=_,ue=I,x=$,pe=A,tt=V;for(let hn=0;hn<o;hn+=2)U^=F(D+ue|0,7),ne^=F(U+D|0,9),ue^=F(ne+U|0,13),D^=F(ue+ne|0,18),ae^=F(C+M|0,7),x^=F(ae+C|0,9),M^=F(x+ae|0,13),C^=F(M+x|0,18),pe^=F(re+z|0,7),P^=F(pe+re|0,9),z^=F(P+pe|0,13),re^=F(z+P|0,18),B^=F(tt+Q|0,7),Z^=F(B+tt|0,9),Q^=F(Z+B|0,13),tt^=F(Q+Z|0,18),M^=F(D+B|0,7),P^=F(M+D|0,9),B^=F(P+M|0,13),D^=F(B+P|0,18),z^=F(C+U|0,7),Z^=F(z+C|0,9),U^=F(Z+z|0,13),C^=F(U+Z|0,18),Q^=F(re+ae|0,7),ne^=F(Q+re|0,9),ae^=F(ne+Q|0,13),re^=F(ae+ne|0,18),ue^=F(tt+pe|0,7),x^=F(ue+tt|0,9),pe^=F(x+ue|0,13),tt^=F(pe+x|0,18);let Oe=0;r[Oe++]=i+D|0,r[Oe++]=c+M|0,r[Oe++]=a+P|0,r[Oe++]=l+B|0,r[Oe++]=f+U|0,r[Oe++]=m+C|0,r[Oe++]=g+z|0,r[Oe++]=p+Z|0,r[Oe++]=y+ne|0,r[Oe++]=k+ae|0,r[Oe++]=b+re|0,r[Oe++]=_+Q|0,r[Oe++]=I+ue|0,r[Oe++]=$+x|0,r[Oe++]=A+pe|0,r[Oe++]=V+tt|0}function KA(e,t,n,r){let s=e[0],o=t[0],i=t[1],c=t[2],a=t[3],l=e[1],f=n[0],m=n[1],g=n[2],p=n[3],y=e[2],k=t[4],b=t[5],_=t[6],I=t[7],$=e[3];for(let V=0;V<20;V+=2)a^=F(s+b|0,7),g^=F(a+s|0,9),b^=F(g+a|0,13),s^=F(b+g|0,18),p^=F(l+o|0,7),_^=F(p+l|0,9),o^=F(_+p|0,13),l^=F(o+_|0,18),I^=F(y+f|0,7),i^=F(I+y|0,9),f^=F(i+I|0,13),y^=F(f+i|0,18),c^=F($+k|0,7),m^=F(c+$|0,9),k^=F(m+c|0,13),$^=F(k+m|0,18),o^=F(s+c|0,7),i^=F(o+s|0,9),c^=F(i+o|0,13),s^=F(c+i|0,18),f^=F(l+a|0,7),m^=F(f+l|0,9),a^=F(m+f|0,13),l^=F(a+m|0,18),k^=F(y+p|0,7),g^=F(k+y|0,9),p^=F(g+k|0,13),y^=F(p+g|0,18),b^=F($+I|0,7),_^=F(b+$|0,9),I^=F(_+b|0,13),$^=F(I+_|0,18);let A=0;r[A++]=s,r[A++]=l,r[A++]=y,r[A++]=$,r[A++]=f,r[A++]=m,r[A++]=g,r[A++]=p}const Bf=DA(jA,{counterRight:!0,extendNonceFn:KA}),qA=CA({blockSize:64,nonceLength:24,tagLength:16},(e,t)=>(yt(e,32),yt(t,24),{encrypt(r,s){yt(r);const o=r.length+32;s?yt(s,o):s=new Uint8Array(o),s.set(r,32),Bf(e,t,s,s);const i=s.subarray(0,32),c=l_(s.subarray(32),i);return s.set(c,16),ms(s.subarray(0,16),c),s.subarray(16)},decrypt(r,s){if(yt(r),r.length<16)throw new Error("encrypted data should be at least 16 bytes");const o=r.length+32;s?yt(s,o):s=new Uint8Array(o),s.set(r,32);const i=s.subarray(0,32);ms(i);const c=Bf(e,t,i,i),a=l_(s.subarray(48),c);if(!vA(s.subarray(32,48),a))throw new Error("invalid tag");return Bf(e,t,s.subarray(16),s.subarray(16)),ms(s.subarray(0,48),a),s.subarray(48)}}));function f_(e,t){const n=qA(e,t);return{seal:n.encrypt,open:n.decrypt}}const gs=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */new Uint8Array(new Uint32Array([287454020]).buffer)[0];function VA(e=32){if(gs&&typeof gs.getRandomValues=="function")return gs.getRandomValues(new Uint8Array(e));if(gs&&typeof gs.randomBytes=="function")return gs.randomBytes(e);throw new Error("crypto.getRandomValues must be defined")}class JA extends gi("NanoIdGenerator")(){}const zA=Gb.pipe(SA(/^[\w-]{16}$/),Mf("NodeId"));class cr extends gi("SecretBox")(){}cr.Live=cf(cr,cr.of({seal:(e,t)=>Ae(()=>{const n=VA(24),r=f_(e,n).seal(t);return o_(n,r)}),open:(e,t)=>Ae(()=>{const n=t.subarray(0,24),r=t.subarray(24);return f_(e,n).open(r)})}));const jf={greaterThan:860934419999,lessThan:258280326e4},h_=xf.pipe(kA(jf.greaterThan),OA(jf.lessThan),Mf("Millis")),WA=jo(h_)(jf.greaterThan+1),d_=xf.pipe(TA(0,65535),Mf("Counter")),HA=jo(d_)(0);jo(zA)("0000000000000000"),JA.pipe(j(({nodeId:e})=>e),Y(e=>({millis:WA,counter:HA,node:e})));class m_ extends gi("Time")(){}m_.Live=cf(m_,{now:je(()=>gA(h_)(Date.now())).pipe(ff("ParseError",()=>qt({_tag:"TimestampTimeOutOfRangeError"})))}),jo(d_)(0);const GA=e=>JSON.stringify(e),YA=e=>JSON.parse(e),XA=e=>e instanceof Error?{message:e.message,name:e.name,stack:e.stack}:e,g_=_t("Owner"),QA=Symbol.for("effect/QueueEnqueue"),ZA=Symbol.for("effect/QueueDequeue"),p_=Symbol.for("effect/QueueStrategy"),ex=Symbol.for("effect/BackingQueue"),y_={_A:e=>e},tx={_A:e=>e},nx={_In:e=>e},rx={_Out:e=>e};class sx extends mc{constructor(n,r,s,o,i){super();u(this,"queue");u(this,"takers");u(this,"shutdownHook");u(this,"shutdownFlag");u(this,"strategy");u(this,pL,nx);u(this,yL,rx);this.queue=n,this.takers=r,this.shutdownHook=s,this.shutdownFlag=o,this.strategy=i}pipe(){return v(this,arguments)}commit(){return this.take}capacity(){return this.queue.capacity()}get size(){return te(()=>no(this.unsafeSize(),()=>nn))}unsafeSize(){return xe(this.shutdownFlag)?O():T(this.queue.length()-rf(this.takers)+this.strategy.surplusSize())}get isEmpty(){return X(this.size,n=>n<=0)}get isFull(){return X(this.size,n=>n>=this.capacity())}get shutdown(){return io(oe(n=>(d(this.shutdownFlag,Gs(!0)),d(on(ps(this.takers),r=>Zm(r,n.id()),!1,!1),Qe(this.strategy.shutdown),Au(Hu(this.shutdownHook,void 0)),wt))))}get isShutdown(){return E(()=>xe(this.shutdownFlag))}get awaitShutdown(){return On(this.shutdownHook)}isActive(){return!xe(this.shutdownFlag)}unsafeOffer(n){if(xe(this.shutdownFlag))return!1;let r;if(this.queue.length()===0){const o=d(this.takers,Cn(ot));o!==ot?(ar(o,n),r=!0):r=!1}else r=!1;if(r)return!0;const s=this.queue.offer(n);return ys(this.strategy,this.queue,this.takers),s}offer(n){return te(()=>{if(xe(this.shutdownFlag))return nn;let r;if(this.queue.length()===0){const o=d(this.takers,Cn(ot));o!==ot?(ar(o,n),r=!0):r=!1}else r=!1;if(r)return R(!0);const s=this.queue.offer(n);return ys(this.strategy,this.queue,this.takers),s?R(!0):this.strategy.handleSurplus([n],this.queue,this.takers,this.shutdownFlag)})}offerAll(n){return te(()=>{if(xe(this.shutdownFlag))return nn;const r=ge(n),s=this.queue.length()===0?ge(yx(this.takers,r.length)):pn,[o,i]=d(r,cd(s.length));for(let a=0;a<s.length;a++){const l=s[a],f=o[a];ar(l,f)}if(i.length===0)return R(!0);const c=this.queue.offerAll(i);return ys(this.strategy,this.queue,this.takers),Za(c)?R(!0):this.strategy.handleSurplus(c,this.queue,this.takers,this.shutdownFlag)})}get take(){return oe(n=>{if(xe(this.shutdownFlag))return nn;const r=this.queue.poll(ot);if(r!==ot)return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),R(r);{const s=uc(n.id());return d(te(()=>(d(this.takers,Co(s)),ys(this.strategy,this.queue,this.takers),xe(this.shutdownFlag)?nn:On(s))),ec(()=>E(()=>bx(this.takers,s))))}})}get takeAll(){return te(()=>xe(this.shutdownFlag)?nn:E(()=>{const n=this.queue.pollUpTo(Number.POSITIVE_INFINITY);return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),Oi(n)}))}takeUpTo(n){return te(()=>xe(this.shutdownFlag)?nn:E(()=>{const r=this.queue.pollUpTo(n);return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),Oi(r)}))}takeBetween(n,r){return te(()=>b_(this,n,r,ut()))}}pL=QA,yL=ZA;const b_=(e,t,n,r)=>n<t?R(r):d(hx(e,n),w(s=>{const o=t-s.length;return o===1?d(Kf(e),X(i=>d(r,rt(s),Xa(i)))):o>1?d(Kf(e),w(i=>b_(e,o-1,n-s.length-1,d(r,rt(s),Xa(i))))):R(d(r,rt(s)))})),ox=e=>d(E(()=>B2(e)),w(t=>__(S_(t),dx()))),ix=()=>d(E(()=>nf()),w(e=>__(S_(e),mx()))),cx=(e,t,n,r,s)=>new sx(e,t,n,r,s),__=(e,t)=>d(lc(),X(n=>cx(e,nf(),n,Hs(!1),t)));class ax{constructor(t){u(this,"mutable");u(this,bL,tx);this.mutable=t}poll(t){return Cn(this.mutable,t)}pollUpTo(t){return of(this.mutable,t)}offerAll(t){return Jy(this.mutable,t)}offer(t){return Co(this.mutable,t)}capacity(){return j2(this.mutable)}length(){return rf(this.mutable)}}bL=ex;const S_=e=>new ax(e),ux=e=>e.size,lx=e=>e.shutdown,fx=h(2,(e,t)=>e.offer(t)),Kf=e=>e.take,hx=h(2,(e,t)=>e.takeUpTo(t)),dx=()=>new gx,mx=()=>new px;class gx{constructor(){u(this,_L,y_);u(this,"putters",nf())}surplusSize(){return rf(this.putters)}onCompleteTakersWithEmptyQueue(t){for(;!sf(this.putters)&&!sf(t);){const n=Cn(t,void 0),r=Cn(this.putters,void 0);r[2]&&ar(r[1],!0),ar(n,r[0])}}get shutdown(){return d(Yi,w(t=>d(E(()=>ps(this.putters)),w(n=>on(n,([r,s,o])=>o?d(Zm(s,t),wt):we,!1,!1)))))}handleSurplus(t,n,r,s){return oe(o=>{const i=uc(o.id());return d(te(()=>(this.unsafeOffer(t,i),this.unsafeOnQueueEmptySpace(n,r),ys(this,n,r),xe(s)?nn:On(i))),ec(()=>E(()=>this.unsafeRemove(i))))})}unsafeOnQueueEmptySpace(t,n){let r=!0;for(;r&&(t.capacity()===Number.POSITIVE_INFINITY||t.length()<t.capacity());){const s=d(this.putters,Cn(ot));if(s===ot)r=!1;else{const o=t.offer(s[0]);o&&s[2]?ar(s[1],!0):o||sa(this.putters,d(ps(this.putters),Xe(s))),ys(this,t,n)}}}unsafeOffer(t,n){const r=ge(t);for(let s=0;s<r.length;s++){const o=r[s];s===r.length-1?d(this.putters,Co([o,n,!0])):d(this.putters,Co([o,n,!1]))}}unsafeRemove(t){sa(this.putters,d(ps(this.putters),pd(([,n])=>n!==t)))}}_L=p_;class px{constructor(){u(this,SL,y_)}surplusSize(){return 0}get shutdown(){return we}onCompleteTakersWithEmptyQueue(){}handleSurplus(t,n,r,s){return R(!1)}unsafeOnQueueEmptySpace(t,n){}}SL=p_;const ar=(e,t)=>Gu(e,R(t)),sa=(e,t)=>d(e,Jy(t)),ps=e=>d(e,of(Number.POSITIVE_INFINITY)),yx=(e,t)=>d(e,of(t)),bx=(e,t)=>{sa(e,d(ps(e),pd(n=>t!==n)))},ys=(e,t,n)=>{let r=!0;for(;r&&t.length()!==0;){const s=d(n,Cn(ot));if(s!==ot){const o=t.poll(ot);o!==ot?(ar(s,o),e.unsafeOnQueueEmptySpace(t,n)):sa(n,d(ps(n),Xe(s))),r=!0}else r=!1}r&&t.length()===0&&!sf(n)&&e.onCompleteTakersWithEmptyQueue(n)},_x=ox,Sx=ix,wx=ux,w_=lx,bs=fx,k_=Kf,qf=Be,E_=Ft,kx=Km,O_="Continue",Ex="Close",Ox="Yield",I_=Symbol.for("effect/ChannelChildExecutorDecision"),Ix={[I_]:I_},T_=e=>{const t=Object.create(Ix);return t._tag=O_,t},oa="ContinuationK",Tx="ContinuationFinalizer",$_=Symbol.for("effect/ChannelContinuation"),R_={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutDone:e=>e,_OutErr2:e=>e,_OutElem:e=>e,_OutDone2:e=>e};class F_{constructor(t,n){u(this,"onSuccess");u(this,"onHalt");u(this,"_tag",oa);u(this,wL,R_);this.onSuccess=t,this.onHalt=n}onExit(t){return C$(t)?this.onHalt(t.cause):this.onSuccess(t.value)}}wL=$_;class $x{constructor(t){u(this,"finalizer");u(this,"_tag",Tx);u(this,kL,R_);this.finalizer=t}}kL=$_;const N_="PullAfterNext",Rx="PullAfterAllEnqueued",Fx=Symbol.for("effect/ChannelUpstreamPullStrategy"),Nx={_A:e=>e},vx={[Fx]:Nx},v_=e=>{const t=Object.create(vx);return t._tag=N_,t.emitSeparator=e,t},C_="BracketOut",A_="Bridge",Vf="ConcatAll",x_="Emit",M_="Ensuring",P_="Fail",L_="Fold",D_="FromEffect",U_="PipeTo",Cx="Provide",B_="Read",j_="Succeed",K_="SucceedNow",q_="Suspend",V_=Symbol.for("effect/Channel"),Ax={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutElem:e=>e,_OutDone:e=>e},ct={[V_]:Ax,pipe(){return v(this,arguments)}},J_=e=>K(e,V_)||Ao(e),xx=h(2,(e,t)=>{const n=Object.create(ct);return n._tag=C_,n.acquire=()=>e,n.finalizer=t,n}),Mx=(e,t,n)=>{const r=Object.create(ct);return r._tag=Vf,r.combineInners=t,r.combineAll=n,r.onPull=()=>v_(O()),r.onEmit=()=>T_,r.value=()=>e,r.k=L,r},Px=h(4,(e,t,n,r)=>{const s=Object.create(ct);return s._tag=Vf,s.combineInners=n,s.combineAll=r,s.onPull=()=>v_(O()),s.onEmit=()=>T_,s.value=()=>e,s.k=t,s}),z_=h(2,(e,t)=>{const n=Object.create(ct);return n._tag=A_,n.input=t,n.channel=e,n}),Lx=h(2,(e,t)=>{const n=Object.create(ct);return n._tag=M_,n.channel=e,n.finalizer=t,n}),W_=e=>ur(uy(e)),ur=e=>Dx(()=>e),Dx=e=>{const t=Object.create(ct);return t._tag=P_,t.error=e,t},at=h(2,(e,t)=>{const n=Object.create(ct);return n._tag=L_,n.channel=e,n.k=new F_(t,ur),n}),At=e=>{const t=Object.create(ct);return t._tag=D_,t.effect=()=>e,t},Vo=h(2,(e,t)=>{const n=Object.create(ct);return n._tag=U_,n.left=()=>e,n.right=()=>t,n}),Ux=e=>Bx({onInput:e.onInput,onFailure:t=>St(ly(t),{onLeft:e.onFailure,onRight:ur}),onDone:e.onDone}),Bx=e=>{const t=Object.create(ct);return t._tag=B_,t.more=e.onInput,t.done=new F_(e.onDone,e.onFailure),t},jx=e=>H_(()=>e),Jf=e=>{const t=Object.create(ct);return t._tag=K_,t.terminal=e,t},Kx=e=>{const t=Object.create(ct);return t._tag=q_,t.channel=e,t},H_=e=>{const t=Object.create(ct);return t._tag=j_,t.evaluate=e,t},Jo=Jf(void 0),xt=e=>{const t=Object.create(ct);return t._tag=x_,t.out=e,t},ia="Done",ca="Emit",zo="FromEffect",aa="Read",qx=Symbol.for("effect/ChannelState"),Vx={_E:e=>e,_R:e=>e},ua={[qx]:Vx},_s=()=>{const e=Object.create(ua);return e._tag=ia,e},zf=()=>{const e=Object.create(ua);return e._tag=ca,e},Wo=e=>{const t=Object.create(ua);return t._tag=zo,t.effect=e,t},Wf=(e,t,n,r)=>{const s=Object.create(ua);return s._tag=aa,s.upstream=e,s.onEffect=t,s.onEmit=n,s.onDone=r,s},la=e=>e._tag===zo,Jx=e=>la(e)?e.effect:fe,G_=e=>la(e)?yv(e.effect):void 0,Y_="PullFromChild",Hf="PullFromUpstream",Gf="DrainChildExecutors",X_="Emit";class fa{constructor(t,n,r){u(this,"childExecutor");u(this,"parentSubexecutor");u(this,"onEmit");u(this,"_tag",Y_);this.childExecutor=t,this.parentSubexecutor=n,this.onEmit=r}close(t){const n=this.childExecutor.close(t),r=this.parentSubexecutor.close(t);return n!==void 0&&r!==void 0?Vc(Ot(n),Ot(r),(s,o)=>d(s,bo(o))):n!==void 0?n:r!==void 0?r:void 0}enqueuePullFromChild(t){return this}}class lr{constructor(t,n,r,s,o,i,c,a){u(this,"upstreamExecutor");u(this,"createChild");u(this,"lastDone");u(this,"activeChildExecutors");u(this,"combineChildResults");u(this,"combineWithChildResult");u(this,"onPull");u(this,"onEmit");u(this,"_tag",Hf);this.upstreamExecutor=t,this.createChild=n,this.lastDone=r,this.activeChildExecutors=s,this.combineChildResults=o,this.combineWithChildResult=i,this.onPull=c,this.onEmit=a}close(t){const n=this.upstreamExecutor.close(t),s=[...this.activeChildExecutors.map(o=>o!==void 0?o.childExecutor.close(t):void 0),n].reduce((o,i)=>o!==void 0&&i!==void 0?Vc(o,Ot(i),(c,a)=>bo(c,a)):o!==void 0?o:i!==void 0?Ot(i):void 0,void 0);return s}enqueuePullFromChild(t){return new lr(this.upstreamExecutor,this.createChild,this.lastDone,[...this.activeChildExecutors,t],this.combineChildResults,this.combineWithChildResult,this.onPull,this.onEmit)}}class Ss{constructor(t,n,r,s,o,i,c){u(this,"upstreamExecutor");u(this,"lastDone");u(this,"activeChildExecutors");u(this,"upstreamDone");u(this,"combineChildResults");u(this,"combineWithChildResult");u(this,"onPull");u(this,"_tag",Gf);this.upstreamExecutor=t,this.lastDone=n,this.activeChildExecutors=r,this.upstreamDone=s,this.combineChildResults=o,this.combineWithChildResult=i,this.onPull=c}close(t){const n=this.upstreamExecutor.close(t),s=[...this.activeChildExecutors.map(o=>o!==void 0?o.childExecutor.close(t):void 0),n].reduce((o,i)=>o!==void 0&&i!==void 0?Vc(o,Ot(i),(c,a)=>bo(c,a)):o!==void 0?o:i!==void 0?Ot(i):void 0,void 0);return s}enqueuePullFromChild(t){return new Ss(this.upstreamExecutor,this.lastDone,[...this.activeChildExecutors,t],this.upstreamDone,this.combineChildResults,this.combineWithChildResult,this.onPull)}}class Yf{constructor(t,n){u(this,"value");u(this,"next");u(this,"_tag",X_);this.value=t,this.next=n}close(t){const n=this.next.close(t);return n}enqueuePullFromChild(t){return this}}const zx="Pulled",Wx="NoUpstream",Hx=Symbol.for("effect/ChannelUpstreamPullRequest"),Gx={_A:e=>e},Q_={[Hx]:Gx},Z_=e=>{const t=Object.create(Q_);return t._tag=zx,t.value=e,t},Yx=e=>{const t=Object.create(Q_);return t._tag=Wx,t.activeDownstreamCount=e,t};class ws{constructor(t,n,r){u(this,"_activeSubexecutor");u(this,"_cancelled");u(this,"_closeLastSubstream");u(this,"_currentChannel");u(this,"_done");u(this,"_doneStack",[]);u(this,"_emitted");u(this,"_executeCloseLastSubstream");u(this,"_input");u(this,"_inProgressFinalizer");u(this,"_providedEnv");this._currentChannel=t,this._executeCloseLastSubstream=r,this._providedEnv=n}run(){let t;for(;t===void 0;)if(this._cancelled!==void 0)t=this.processCancellation();else if(this._activeSubexecutor!==void 0)t=this.runSubexecutor();else try{if(this._currentChannel===void 0)t=_s();else if(Ao(this._currentChannel))this._currentChannel=At(this._currentChannel);else switch(this._currentChannel._tag){case C_:{t=this.runBracketOut(this._currentChannel);break}case A_:{const n=this._currentChannel.input;if(this._currentChannel=this._currentChannel.channel,this._input!==void 0){const r=this._input;this._input=void 0;const s=()=>j(n.awaitRead(),()=>je(()=>{const o=r.run();switch(o._tag){case ia:return rn(r.getDone(),{onFailure:i=>n.error(i),onSuccess:i=>n.done(i)});case ca:return j(n.emit(r.getEmit()),()=>s());case zo:return cn(o.effect,{onFailure:i=>n.error(i),onSuccess:()=>s()});case aa:return eS(o,()=>s(),i=>n.error(i))}}));t=Wo(j(Zy(s()),o=>Ae(()=>this.addFinalizer(i=>j(os(o),()=>je(()=>{const c=this.restorePipe(i,r);return c!==void 0?c:fe}))))))}break}case Vf:{const n=new ws(this._currentChannel.value(),this._providedEnv,s=>Ae(()=>{const o=this._closeLastSubstream===void 0?fe:this._closeLastSubstream;this._closeLastSubstream=d(o,dt(s))}));n._input=this._input;const r=this._currentChannel;this._activeSubexecutor=new lr(n,s=>r.k(s),void 0,[],(s,o)=>r.combineInners(s,o),(s,o)=>r.combineAll(s,o),s=>r.onPull(s),s=>r.onEmit(s)),this._closeLastSubstream=void 0,this._currentChannel=void 0;break}case x_:{this._emitted=this._currentChannel.out,this._currentChannel=this._activeSubexecutor!==void 0?void 0:Jo,t=zf();break}case M_:{this.runEnsuring(this._currentChannel);break}case P_:{t=this.doneHalt(this._currentChannel.error());break}case L_:{this._doneStack.push(this._currentChannel.k),this._currentChannel=this._currentChannel.channel;break}case D_:{const n=this._providedEnv===void 0?this._currentChannel.effect():d(this._currentChannel.effect(),Lo(this._providedEnv));t=Wo(cn(n,{onFailure:r=>{const s=this.doneHalt(r);return s!==void 0&&la(s)?s.effect:fe},onSuccess:r=>{const s=this.doneSucceed(r);return s!==void 0&&la(s)?s.effect:fe}}));break}case U_:{const n=this._input,r=new ws(this._currentChannel.left(),this._providedEnv,s=>this._executeCloseLastSubstream(s));r._input=n,this._input=r,this.addFinalizer(s=>{const o=this.restorePipe(s,n);return o!==void 0?o:fe}),this._currentChannel=this._currentChannel.right();break}case Cx:{const n=this._providedEnv;this._providedEnv=this._currentChannel.context(),this._currentChannel=this._currentChannel.inner,this.addFinalizer(()=>Ae(()=>{this._providedEnv=n}));break}case B_:{const n=this._currentChannel;t=Wf(this._input,L,r=>{try{this._currentChannel=n.more(r)}catch(s){this._currentChannel=n.done.onExit(x$(s))}},r=>{const s=o=>n.done.onExit(o);this._currentChannel=s(r)});break}case j_:{t=this.doneSucceed(this._currentChannel.evaluate());break}case K_:{t=this.doneSucceed(this._currentChannel.terminal);break}case q_:{this._currentChannel=this._currentChannel.channel();break}default:this._currentChannel._tag}}catch(n){this._currentChannel=ur(BF(n))}return t}getDone(){return this._done}getEmit(){return this._emitted}cancelWith(t){this._cancelled=t}clearInProgressFinalizer(){this._inProgressFinalizer=void 0}storeInProgressFinalizer(t){this._inProgressFinalizer=t}popAllFinalizers(t){const n=[];let r=this._doneStack.pop();for(;r;)r._tag==="ContinuationFinalizer"&&n.push(r.finalizer),r=this._doneStack.pop();const s=n.length===0?fe:Qf(n,t);return this.storeInProgressFinalizer(s),s}popNextFinalizers(){const t=[];for(;this._doneStack.length!==0;){const n=this._doneStack[this._doneStack.length-1];if(n._tag===oa)return t;t.push(n),this._doneStack.pop()}return t}restorePipe(t,n){const r=this._input;return this._input=n,r!==void 0?r.close(t):fe}close(t){let n;const r=this._inProgressFinalizer;r!==void 0&&(n=d(r,qc(Ae(()=>this.clearInProgressFinalizer()))));let s;const o=this.popAllFinalizers(t);o!==void 0&&(s=d(o,qc(Ae(()=>this.clearInProgressFinalizer()))));const i=this._activeSubexecutor===void 0?void 0:this._activeSubexecutor.close(t);if(!(i===void 0&&n===void 0&&s===void 0))return d(Ot(Xf(i)),sb(Ot(Xf(n))),sb(Ot(Xf(s))),Y(([[c,a],l])=>d(c,bo(a),bo(l))),jc,j(c=>je(()=>c)))}doneSucceed(t){if(this._doneStack.length===0)return this._done=jt(t),this._currentChannel=void 0,_s();const n=this._doneStack[this._doneStack.length-1];if(n._tag===oa){this._doneStack.pop(),this._currentChannel=n.onSuccess(t);return}const r=this.popNextFinalizers();if(this._doneStack.length===0)return this._doneStack=r.reverse(),this._done=jt(t),this._currentChannel=void 0,_s();const s=Qf(r.map(i=>i.finalizer),jt(t));this.storeInProgressFinalizer(s);const o=d(s,qc(Ae(()=>this.clearInProgressFinalizer())),jc,j(()=>Ae(()=>this.doneSucceed(t))));return Wo(o)}doneHalt(t){if(this._doneStack.length===0)return this._done=Nt(t),this._currentChannel=void 0,_s();const n=this._doneStack[this._doneStack.length-1];if(n._tag===oa){this._doneStack.pop(),this._currentChannel=n.onHalt(t);return}const r=this.popNextFinalizers();if(this._doneStack.length===0)return this._doneStack=r.reverse(),this._done=Nt(t),this._currentChannel=void 0,_s();const s=Qf(r.map(i=>i.finalizer),Nt(t));this.storeInProgressFinalizer(s);const o=d(s,qc(Ae(()=>this.clearInProgressFinalizer())),jc,j(()=>Ae(()=>this.doneHalt(t))));return Wo(o)}processCancellation(){return this._currentChannel=void 0,this._done=this._cancelled,this._cancelled=void 0,_s()}runBracketOut(t){const n=jc(cn(this.provide(t.acquire()),{onFailure:r=>Ae(()=>{this._currentChannel=ur(r)}),onSuccess:r=>Ae(()=>{this.addFinalizer(s=>this.provide(t.finalizer(r,s))),this._currentChannel=xt(r)})}));return Wo(n)}provide(t){return this._providedEnv===void 0?t:d(t,Lo(this._providedEnv))}runEnsuring(t){this.addFinalizer(t.finalizer),this._currentChannel=t.channel}addFinalizer(t){this._doneStack.push(new $x(t))}runSubexecutor(){const t=this._activeSubexecutor;switch(t._tag){case Y_:return this.pullFromChild(t.childExecutor,t.parentSubexecutor,t.onEmit,t);case Hf:return this.pullFromUpstream(t);case Gf:return this.drainChildExecutors(t);case X_:return this._emitted=t.value,this._activeSubexecutor=t.next,zf()}}replaceSubexecutor(t){this._currentChannel=void 0,this._activeSubexecutor=t}finishWithExit(t){const n=rn(t,{onFailure:r=>this.doneHalt(r),onSuccess:r=>this.doneSucceed(r)});return this._activeSubexecutor=void 0,n===void 0?fe:Jx(n)}finishSubexecutorWithCloseEffect(t,...n){this.addFinalizer(()=>d(n,Kt(s=>d(Ae(()=>s(t)),j(o=>o!==void 0?o:fe)),{discard:!0})));const r=d(t,rn({onFailure:s=>this.doneHalt(s),onSuccess:s=>this.doneSucceed(s)}));return this._activeSubexecutor=void 0,r}applyUpstreamPullStrategy(t,n,r){switch(r._tag){case N_:{const s=!t||n.some(o=>o!==void 0);return[r.emitSeparator,s?[void 0,...n]:n]}case Rx:{const s=!t||n.some(o=>o!==void 0);return[r.emitSeparator,s?[...n,void 0]:n]}}}pullFromChild(t,n,r,s){return Wf(t,L,o=>{const i=r(o);switch(i._tag){case O_:break;case Ex:{this.finishWithDoneValue(t,n,i.value);break}case Ox:{const c=n.enqueuePullFromChild(s);this.replaceSubexecutor(c);break}}this._activeSubexecutor=new Yf(o,this._activeSubexecutor)},rn({onFailure:o=>{const i=this.handleSubexecutorFailure(t,n,o);return i===void 0?void 0:G_(i)},onSuccess:o=>{this.finishWithDoneValue(t,n,o)}}))}finishWithDoneValue(t,n,r){const s=n;switch(s._tag){case Hf:{const o=new lr(s.upstreamExecutor,s.createChild,s.lastDone!==void 0?s.combineChildResults(s.lastDone,r):r,s.activeChildExecutors,s.combineChildResults,s.combineWithChildResult,s.onPull,s.onEmit);this._closeLastSubstream=t.close(jt(r)),this.replaceSubexecutor(o);break}case Gf:{const o=new Ss(s.upstreamExecutor,s.lastDone!==void 0?s.combineChildResults(s.lastDone,r):r,s.activeChildExecutors,s.upstreamDone,s.combineChildResults,s.combineWithChildResult,s.onPull);this._closeLastSubstream=t.close(jt(r)),this.replaceSubexecutor(o);break}}}handleSubexecutorFailure(t,n,r){return this.finishSubexecutorWithCloseEffect(Nt(r),s=>n.close(s),s=>t.close(s))}pullFromUpstream(t){if(t.activeChildExecutors.length===0)return this.performPullFromUpstream(t);const n=t.activeChildExecutors[0],r=new lr(t.upstreamExecutor,t.createChild,t.lastDone,t.activeChildExecutors.slice(1),t.combineChildResults,t.combineWithChildResult,t.onPull,t.onEmit);if(n===void 0)return this.performPullFromUpstream(r);this.replaceSubexecutor(new fa(n.childExecutor,r,n.onEmit))}performPullFromUpstream(t){return Wf(t.upstreamExecutor,n=>{const r=this._closeLastSubstream===void 0?fe:this._closeLastSubstream;return this._closeLastSubstream=void 0,d(this._executeCloseLastSubstream(r),dt(n))},n=>{if(this._closeLastSubstream!==void 0){const i=this._closeLastSubstream;return this._closeLastSubstream=void 0,d(this._executeCloseLastSubstream(i),Y(()=>{const c=new ws(t.createChild(n),this._providedEnv,this._executeCloseLastSubstream);c._input=this._input;const[a,l]=this.applyUpstreamPullStrategy(!1,t.activeChildExecutors,t.onPull(Z_(n)));this._activeSubexecutor=new fa(c,new lr(t.upstreamExecutor,t.createChild,t.lastDone,l,t.combineChildResults,t.combineWithChildResult,t.onPull,t.onEmit),t.onEmit),le(a)&&(this._activeSubexecutor=new Yf(a.value,this._activeSubexecutor))}))}const r=new ws(t.createChild(n),this._providedEnv,this._executeCloseLastSubstream);r._input=this._input;const[s,o]=this.applyUpstreamPullStrategy(!1,t.activeChildExecutors,t.onPull(Z_(n)));this._activeSubexecutor=new fa(r,new lr(t.upstreamExecutor,t.createChild,t.lastDone,o,t.combineChildResults,t.combineWithChildResult,t.onPull,t.onEmit),t.onEmit),le(s)&&(this._activeSubexecutor=new Yf(s.value,this._activeSubexecutor))},n=>{if(t.activeChildExecutors.some(o=>o!==void 0)){const o=new Ss(t.upstreamExecutor,t.lastDone,[void 0,...t.activeChildExecutors],t.upstreamExecutor.getDone(),t.combineChildResults,t.combineWithChildResult,t.onPull);if(this._closeLastSubstream!==void 0){const i=this._closeLastSubstream;return this._closeLastSubstream=void 0,d(this._executeCloseLastSubstream(i),Y(()=>this.replaceSubexecutor(o)))}this.replaceSubexecutor(o);return}const r=this._closeLastSubstream,s=this.finishSubexecutorWithCloseEffect(d(n,L$(o=>t.combineWithChildResult(t.lastDone,o))),()=>r,o=>t.upstreamExecutor.close(o));return s===void 0?void 0:G_(s)})}drainChildExecutors(t){if(t.activeChildExecutors.length===0){const o=this._closeLastSubstream;return o!==void 0&&this.addFinalizer(()=>ce(o)),this.finishSubexecutorWithCloseEffect(t.upstreamDone,()=>o,i=>t.upstreamExecutor.close(i))}const n=t.activeChildExecutors[0],r=t.activeChildExecutors.slice(1);if(n===void 0){const[o,i]=this.applyUpstreamPullStrategy(!0,r,t.onPull(Yx(r.reduce((c,a)=>a!==void 0?c+1:c,0))));return this.replaceSubexecutor(new Ss(t.upstreamExecutor,t.lastDone,i,t.upstreamDone,t.combineChildResults,t.combineWithChildResult,t.onPull)),le(o)?(this._emitted=o.value,zf()):void 0}const s=new Ss(t.upstreamExecutor,t.lastDone,r,t.upstreamDone,t.combineChildResults,t.combineWithChildResult,t.onPull);this.replaceSubexecutor(new fa(n.childExecutor,s,n.onEmit))}}const Xf=e=>e!==void 0?e:fe,Qf=(e,t)=>d(Kt(e,n=>Ot(n(t))),Y(n=>d(A$(n),be(()=>gl))),j(n=>je(()=>n))),eS=(e,t,n)=>{const r=[e],s=()=>{const o=r.pop();if(o===void 0||o.upstream===void 0)return dv("Unexpected end of input for channel execution");const i=o.upstream.run();switch(i._tag){case ca:{const c=o.onEmit(o.upstream.getEmit());return r.length===0?c===void 0?je(t):d(c,cn({onFailure:n,onSuccess:t})):c===void 0?je(()=>s()):d(c,cn({onFailure:n,onSuccess:()=>s()}))}case ia:{const c=o.onDone(o.upstream.getDone());return r.length===0?c===void 0?je(t):d(c,cn({onFailure:n,onSuccess:t})):c===void 0?je(()=>s()):d(c,cn({onFailure:n,onSuccess:()=>s()}))}case zo:return r.push(o),d(o.onEffect(i.effect),Xy(c=>je(()=>{const a=o.onDone(Nt(c));return a===void 0?fe:a})),cn({onFailure:n,onSuccess:()=>s()}));case aa:return r.push(o),r.push(i),je(()=>s())}};return s()},Xx="Done",Qx="Await",Zx={[Symbol.for("effect/ChannelMergeDecision")]:{_R:e=>e,_E0:e=>e,_Z0:e=>e,_E:e=>e,_Z:e=>e}},tS=e=>{const t=Object.create(Zx);return t._tag=Qx,t.f=e,t},nS="BothRunning",rS="LeftDone",sS="RightDone",oS=Symbol.for("effect/ChannelMergeState"),Zf={[oS]:oS},eh=(e,t)=>{const n=Object.create(Zf);return n._tag=nS,n.left=e,n.right=t,n},iS=e=>{const t=Object.create(Zf);return t._tag=rS,t.f=e,t},cS=e=>{const t=Object.create(Zf);return t._tag=sS,t.f=e,t},aS="BackPressure",uS="BufferSliding",lS=Symbol.for("effect/ChannelMergeStrategy"),fS={[lS]:lS},eM=e=>{const t=Object.create(fS);return t._tag=aS,t},tM=e=>{const t=Object.create(fS);return t._tag=uS,t},nM=h(2,(e,{onBackPressure:t,onBufferSliding:n})=>{switch(e._tag){case aS:return t();case uS:return n()}}),ks="Empty",Ho="Emit",Go="Error",Yo="Done",hS=e=>({_tag:ks,notifyProducer:e}),th=e=>({_tag:Ho,notifyConsumers:e}),rM=e=>({_tag:Go,cause:e}),sM=e=>({_tag:Yo,done:e});class oM{constructor(t){u(this,"ref");this.ref=t}awaitRead(){return ls(yo(this.ref,t=>t._tag===ks?[ht(t.notifyProducer),t]:[fe,t]))}get close(){return kv(t=>this.error(jF(t)))}done(t){return ls(yo(this.ref,n=>{switch(n._tag){case ks:return[ht(n.notifyProducer),n];case Ho:return[Kt(n.notifyConsumers,r=>Tn(r,q(t)),{discard:!0}),sM(t)];case Go:return[us,n];case Yo:return[us,n]}}))}emit(t){return j(In(),n=>ls(yo(this.ref,r=>{switch(r._tag){case ks:return[ht(r.notifyProducer),r];case Ho:{const s=r.notifyConsumers[0],o=r.notifyConsumers.slice(1);if(s!==void 0)return[Tn(s,se(t)),o.length===0?hS(n):th(o)];throw new Error("Bug: Channel.SingleProducerAsyncInput.emit - Queue was empty! please report an issue at https://github.com/Effect-TS/effect/issues")}case Go:return[us,r];case Yo:return[us,r]}})))}error(t){return ls(yo(this.ref,n=>{switch(n._tag){case ks:return[ht(n.notifyProducer),n];case Ho:return[Kt(n.notifyConsumers,r=>GI(r,t),{discard:!0}),rM(t)];case Go:return[us,n];case Yo:return[us,n]}}))}get take(){return this.takeWith(t=>Nt(qF(t,q)),t=>jt(t),t=>M$(se(t)))}takeWith(t,n,r){return j(In(),s=>ls(yo(this.ref,o=>{switch(o._tag){case ks:return[dt(Tn(o.notifyProducer,void 0),yf(ht(s),{onFailure:t,onSuccess:St({onLeft:r,onRight:n})})),th([s])];case Ho:return[yf(ht(s),{onFailure:t,onSuccess:St({onLeft:r,onRight:n})}),th([...o.notifyConsumers,s])];case Go:return[ce(t(o.cause)),o];case Yo:return[ce(r(o.done)),o]}})))}}const dS=()=>d(In(),j(e=>hl(hS(e))),Y(e=>new oM(e))),nh=h(2,(e,t)=>Px(e,t,()=>{},()=>{})),iM=h(2,(e,t)=>Lx(e,()=>t)),cM=e=>at(e,L),rh=e=>Mn(e.takeWith(ur,t=>at(xt(t),()=>rh(e)),jx)),mS=h(2,(e,t)=>at(e,n=>H_(()=>t(n)))),aM=h(2,(e,t)=>{const n=Ux({onInput:r=>at(xt(t(r)),()=>n),onFailure:W_,onDone:Jf});return Vo(e,n)}),uM=e=>t=>lM(e)(t,ka),lM=({bufferSize:e=16,concurrency:t,mergeStrategy:n=eM()})=>(r,s)=>d(as(function*(o){const i=t==="unbounded"?Number.MAX_SAFE_INTEGER:t,c=yield*o(dS()),a=rh(c),l=yield*o(Kc(_x(e),b=>w_(b))),f=yield*o(Kc(Sx(),b=>w_(b))),m=yield*o(hl(O())),g=yield*o(In()),p=(yield*o(Nv(i))).withPermits,y=yield*o(Es(r)),k=b=>d(j(b,St({onLeft:_=>ce(T(_)),onRight:_=>hf(bs(l,ce(se(_))),O())})),rb({until:_=>le(_)}),j(_=>QT(m,Ke({onNone:()=>T(_.value),onSome:I=>T(s(I,_.value))}))),Xy(_=>KF(_)?xo(_):d(bs(l,xo(_)),dt(Tn(g,void 0)),Qy)));return yield*o(cn(y,{onFailure:b=>d(bs(l,xo(b)),dt(ce(!1))),onSuccess:St({onLeft:b=>tb(nr(ht(g)),nr(p(i)(fe)),{onSelfDone:(_,I)=>hf(os(I),!1),onOtherDone:(_,I)=>dt(os(I),d(YT(m),j(Ke({onNone:()=>bs(l,ce(q(b))),onSome:$=>bs(l,ce(q(s($,b))))})),hf(!1)))}),onRight:b=>nM(n,{onBackPressure:()=>as(function*(_){const I=yield*_(In()),$=d(a,Vo(b),Es,j(V=>pf(k(V),nr(ht(g)))),mf);return yield*_(Tn(I,void 0),dt($),p(1),gf),yield*_(ht(I)),!(yield*_(Eg(g)))}),onBufferSliding:()=>as(function*(_){const I=yield*_(In()),$=yield*_(In()),A=yield*_(wx(f));yield*_(k_(f),j(M=>Tn(M,void 0)),Iv(()=>A>=i)),yield*_(bs(f,I));const V=d(a,Vo(b),Es,j(M=>d(k(M),pf(nr(ht(g))),pf(nr(ht(I))))),mf);return yield*_(Tn($,void 0),dt(V),p(1),gf),yield*_(ht($)),!(yield*_(Eg(g)))})})})}),rb({while:b=>b}),gf),[l,c]}),Y(([o,i])=>{const c=d(k_(o),ls,yf({onFailure:ur,onSuccess:St({onLeft:Jf,onRight:a=>at(xt(a),()=>c)})}),Mn);return z_(c,i)}),yS),gS=h(3,(e,t,n)=>uM(n)(aM(e,t))),fM=h(2,(e,t)=>yS(j(dS(),n=>{const r=rh(n);return Y(fv([Es(Vo(r,e)),Es(Vo(r,t.other)),wv]),([s,o,i])=>{const c=(l,f,m)=>(g,p,y)=>{const k=b=>{const _=b;return _._tag===Xx?ce(At(dt(os(f),_.effect))):Y(t2(f),rn({onFailure:I=>At(_.f(Nt(I))),onSuccess:St({onLeft:I=>At(_.f(jt(I))),onRight:I=>SS(xt(I),a(y(_.f)))})}))};return rn(l,{onFailure:b=>k(g(Nt(b))),onSuccess:St({onLeft:b=>k(g(jt(b))),onRight:b=>ce(at(xt(b),()=>at(At(Zy(m)),_=>a(p(_,f)))))})})},a=l=>{switch(l._tag){case nS:{const f=nr(Ry(l.left)),m=nr(Ry(l.right));return Mn(tb(f,m,{onSelfDone:(g,p)=>dt(os(p),c(g,l.right,s)(t.onSelfDone,eh,y=>iS(y))),onOtherDone:(g,p)=>dt(os(p),c(g,l.left,o)(t.onOtherDone,(y,k)=>eh(k,y),y=>cS(y)))}))}case rS:return Mn(Y(Ot(o),rn({onFailure:f=>At(l.f(Nt(f))),onSuccess:St({onLeft:f=>At(l.f(jt(f))),onRight:f=>at(xt(f),()=>a(iS(l.f)))})})));case sS:return Mn(Y(Ot(s),rn({onFailure:f=>At(l.f(Nt(f))),onSuccess:St({onLeft:f=>At(l.f(jt(f))),onRight:f=>at(xt(f),()=>a(cS(l.f)))})})))}};return d(At(Vc(eb(s,i),eb(o,i),(l,f)=>eh(l,f))),at(a),z_(n))})}))),pS=e=>Mn(Sv(t=>Y(_y(),n=>xx(nb(t(Bl(e,n)),r=>ss(n,Nt(r))),(r,s)=>ss(n,s))))),Es=e=>Y(Kc(Ae(()=>new ws(e,void 0,L)),(t,n)=>{const r=t.close(n);return r===void 0?fe:r}),t=>je(()=>sh(t.run(),t))),sh=(e,t)=>{const n=e;switch(n._tag){case ia:return rn(t.getDone(),{onFailure:xo,onSuccess:r=>ce(q(r))});case ca:return ce(se(t.getEmit()));case zo:return d(n.effect,j(()=>sh(t.run(),t)));case aa:return eS(n,()=>sh(t.run(),t),r=>xo(r))}},Mn=e=>cM(At(e)),yS=e=>Mx(pS(e),(t,n)=>t,(t,n)=>t),bS=e=>_S(0,e.length,e),_S=(e,t,n)=>e===t?Jo:d(xt(d(n,yn(e))),at(()=>_S(e+1,t,n))),hM=h(e=>J_(e[1]),(e,t,n)=>n!=null&&n.concurrent?fM(e,{other:t,onSelfDone:r=>tS(s=>je(()=>yp(r,s))),onOtherDone:r=>tS(s=>je(()=>yp(s,r)))}):at(e,r=>mS(t,s=>[r,s]))),SS=h(e=>J_(e[1]),(e,t,n)=>n!=null&&n.concurrent?mS(hM(e,t,{concurrent:!0}),r=>r[1]):at(e,()=>t)),dM=is,mM=Jl,wS=Symbol.for("effect/Stream"),gM={_R:e=>e,_E:e=>e,_A:e=>e};class fr{constructor(t){u(this,"channel");u(this,EL,gM);this.channel=t}pipe(){return v(this,arguments)}}EL=wS;const ha=e=>K(e,wS)||Ao(e),pM=e=>OS(qt(T(e))),yM=h(e=>ha(e[0]),(e,t,n)=>{const r=(n==null?void 0:n.bufferSize)??16;return n!=null&&n.switch?kS(n==null?void 0:n.concurrency,()=>ES(e,1,r,t),s=>ES(e,s,r,t)):kS(n==null?void 0:n.concurrency,()=>new fr(nh(un(e),s=>d(s,_d(o=>un(t(o))),mk(Jo,(o,i)=>d(o,SS(i)))))),s=>new fr(d(un(e),nh(bS),gS(o=>un(t(o)),n))))}),kS=(e,t,n)=>{switch(e){case void 0:return t();case"unbounded":return n(Number.MAX_SAFE_INTEGER);default:return e>1?n(e):t()}},ES=h(4,(e,t,n,r)=>new fr(d(un(e),nh(bS),gS(s=>un(r(s)),{concurrency:t,mergeStrategy:tM(),bufferSize:n})))),bM=h(e=>ha(e[0]),(e,t)=>yM(e,L,t)),un=e=>{if("channel"in e)return e.channel;if(Ao(e))return un(_M(e));throw new TypeError("Expected a Stream.")},_M=e=>d(e,df(T),OS),OS=e=>new fr(Mn(Tv(e,{onFailure:Ke({onNone:()=>Jo,onSome:W_}),onSuccess:t=>xt(De(t))}))),SM=(e,t)=>FM(Y(Kc(Ae(()=>e().getReader()),n=>mv(()=>n.cancel())),n=>kM(j(Po({try:()=>n.read(),catch:r=>T(t(r))}),({done:r,value:s})=>r?qt(O()):ce(s))))),wM=e=>RM(e,t=>d(Y(t,n=>T([n,t])),Mo(Ke({onNone:()=>ce(O()),onSome:qt})))),kM=e=>wM(d(e,Y(De))),EM=e=>new fr(iM(pS(d(e,Y(De))),fe)),OM=e=>new fr(Kx(()=>un(e()))),IM=e=>Y(Es(un(e)),t=>d(t,df(T),j(St({onLeft:()=>qt(O()),onRight:ce})))),TM=h(e=>ha(e[0]),(e,t)=>Y(Fv(),n=>$M(e,n,t))),$M=h(e=>ha(e[0]),(e,t,n)=>{const r=mM(t),s=dM(t);let o,i;return new ReadableStream({start(c){i=r(_y());const a=d(IM(e),Bl(i),r,j(l=>Za(l)?a:ce(l)));o=d(a,Do(l=>Ae(()=>{_d(l,f=>{c.enqueue(f)})})),nb(()=>ss(i,gl)),pv({None:()=>Ae(()=>{c.close()}),Some:l=>Ae(()=>{c.error(l.value)})}),Qy)},pull(){return new Promise(c=>{s(o,{scope:i}).addObserver(a=>c())})},cancel(){return new Promise(c=>{s(ss(i,gl)).addObserver(a=>c())})}},n==null?void 0:n.strategy)}),RM=(e,t)=>OM(()=>{const n=r=>Mn(Y(t(r),Ke({onNone:()=>Jo,onSome:([s,o])=>at(xt(s),()=>n(o))})));return new fr(n(e))}),FM=e=>bM(EM(e)),NM=pM,vM=SM,CM=TM,IS=(e,t)=>{class n extends Yy{constructor(){super(...arguments);u(this,"_tag",t)}}return n.prototype[e]=e,n.prototype.name=t,n},TS=Symbol.for("@effect/platform/Cookies"),$S=Symbol.for("@effect/platform/Cookies/Cookie"),AM={[TS]:TS,...ai,toJSON(){return{_id:"@effect/platform/Cookies",cookies:Vw(this.cookies,e=>e.toJSON())}},pipe(){return v(this,arguments)}},xM=e=>{const t=Object.create(AM);return t.cookies=e,t},MM=e=>{const t={};for(const n of e)t[n.name]=n;return xM(t)},PM=e=>{const t=typeof e=="string"?[e]:e,n=[];for(const r of t){const s=LM(r.trim());le(s)&&n.push(s.value)}return MM(n)};function LM(e){const t=e.split(";").map(c=>c.trim()).filter(c=>c!=="");if(t.length===0)return O();const n=t[0].indexOf("=");if(n===-1)return O();const r=t[0].slice(0,n);if(!DM.test(r))return O();const s=t[0].slice(n+1),o=UM(s);if(t.length===1)return T(Object.assign(Object.create(RS),{name:r,value:o,valueEncoded:s}));const i={};for(let c=1;c<t.length;c++){const a=t[c],l=a.indexOf("="),f=l===-1?a:a.slice(0,l).trim(),m=l===-1?void 0:a.slice(l+1).trim();switch(f.toLowerCase()){case"domain":{if(m===void 0)break;const g=m.trim().replace(/^\./,"");g&&(i.domain=g);break}case"expires":{if(m===void 0)break;const g=new Date(m);isNaN(g.getTime())||(i.expires=g);break}case"max-age":{if(m===void 0)break;const g=parseInt(m,10);isNaN(g)||(i.maxAge=Zh(g));break}case"path":{if(m===void 0)break;m[0]==="/"&&(i.path=m);break}case"priority":{if(m===void 0)break;switch(m.toLowerCase()){case"low":i.priority="low";break;case"medium":i.priority="medium";break;case"high":i.priority="high";break}break}case"httponly":{i.httpOnly=!0;break}case"secure":{i.secure=!0;break}case"partitioned":{i.partitioned=!0;break}case"samesite":{if(m===void 0)break;switch(m.toLowerCase()){case"lax":i.sameSite="lax";break;case"strict":i.sameSite="strict";break;case"none":i.sameSite="none";break}break}}}return T(Object.assign(Object.create(RS),{name:r,value:o,valueEncoded:s,options:Object.keys(i).length>0?i:void 0}))}const DM=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,RS={[$S]:$S,...ai,toJSON(){return{_id:"@effect/platform/Cookies/Cookie",name:this.name,value:this.value,options:this.options}}},UM=e=>{try{return decodeURIComponent(e)}catch{return e}},FS=Symbol.for("@effect/platform/HttpClientError");class NS extends IS(FS,"RequestError"){get methodAndUrl(){return`${this.request.method} ${this.request.url}`}get message(){return this.description?`${this.reason}: ${this.description} (${this.methodAndUrl})`:`${this.reason} error (${this.methodAndUrl})`}}class Pn extends IS(FS,"ResponseError"){get methodAndUrl(){return`${this.request.method} ${this.request.url}`}get message(){const t=`${this.response.status} ${this.methodAndUrl}`;return this.description?`${this.reason}: ${this.description} (${t})`:`${this.reason} error (${t})`}}const vS=Symbol.for("@effect/platform/Headers"),Xo=Object.assign(Object.create(null),{[vS]:vS}),oh=e=>Object.assign(Object.create(Xo),e),CS=Object.create(Xo),AS=e=>{if(e===void 0)return CS;if(Symbol.iterator in e){const n=Object.create(Xo);for(const[r,s]of e)n[r.toLowerCase()]=s;return n}const t=Object.create(Xo);for(const[n,r]of Object.entries(e))Array.isArray(r)?t[n.toLowerCase()]=r.join(", "):r!==void 0&&(t[n.toLowerCase()]=r);return t},BM=e=>Object.setPrototypeOf(e,Xo),ih=h(3,(e,t,n)=>{const r=oh(e);return r[t.toLowerCase()]=n,r}),jM=h(2,(e,t)=>oh({...e,...AS(t)})),xS=h(2,(e,t)=>{const n=oh(e);return delete n[t.toLowerCase()],n}),MS=h(2,(e,t)=>{const n={...e},r=s=>{if(typeof s=="string"){const o=s.toLowerCase();o in e&&(n[o]=ob(e[o]))}else for(const o in e)s.test(o)&&(n[o]=ob(e[o]))};if(Array.isArray(t))for(let s=0;s<t.length;s++)r(t[s]);else r(t);return n}),KM=W("@effect/platform/Headers/currentRedactedNames",()=>qf(["authorization","cookie","set-cookie","x-api-key"])),qM=e=>BM({b3:`${e.traceId}-${e.spanId}-${e.sampled?"1":"0"}${e.parent._tag==="Some"?`-${e.parent.value.spanId}`:""}`,traceparent:`00-${e.traceId}-${e.spanId}-${e.sampled?"01":"00"}`}),ch=e=>{const t=Symbol.iterator in e?ge(e):Object.entries(e),n=[];for(const[r,s]of t)if(Array.isArray(s))for(let o=0;o<s.length;o++)s[o]!==void 0&&n.push([r,String(s[o])]);else s!==void 0&&n.push([r,String(s)]);return n},VM=[],JM=h(2,(e,t)=>{const n=ch(t),r=n.map(([s])=>s);return Ja(ld(e,([s])=>r.includes(s)),n)}),zM=(e,t,n)=>{try{const r=new URL(e,WM());for(let s=0;s<t.length;s++){const[o,i]=t[s];i!==void 0&&r.searchParams.append(o,i)}return n._tag==="Some"&&(r.hash=n.value),se(r)}catch(r){return q(r)}},WM=()=>{if("location"in globalThis&&globalThis.location!==void 0&&globalThis.location.origin!==void 0&&globalThis.location.pathname!==void 0)return location.origin+location.pathname},ah=Symbol.for("@effect/platform/HttpBody");class PS{constructor(){u(this,OL);this[ah]=ah}[(OL=ah,he)](){return this.toJSON()}toString(){return Ie(this)}}class HM extends PS{constructor(){super(...arguments);u(this,"_tag","Empty")}toJSON(){return{_id:"@effect/platform/HttpBody",_tag:"Empty"}}}const GM=new HM;class YM extends PS{constructor(n,r){super();u(this,"body");u(this,"contentType");u(this,"_tag","Uint8Array");this.body=n,this.contentType=r}get contentLength(){return this.body.length}toJSON(){return{_id:"@effect/platform/HttpBody",_tag:"Uint8Array",body:this.contentType.startsWith("text/")||this.contentType.endsWith("json")?new TextDecoder().decode(this.body):`Uint8Array(${this.body.length})`,contentType:this.contentType,contentLength:this.contentLength}}}const XM=(e,t)=>new YM(e,t??"application/octet-stream"),uh=Symbol.for("@effect/platform/HttpClientRequest"),QM=_t("@effect/platform/HttpClient"),ZM={[uh]:uh,...Og,...ai,commit(){return j(QM,e=>e.execute(this))},toJSON(){return{_id:"@effect/platform/HttpClientRequest",method:this.method,url:this.url,urlParams:this.urlParams,hash:this.hash,headers:this.headers,body:this.body.toJSON()}}};function ln(e,t,n,r,s,o){const i=Object.create(ZM);return i.method=e,i.url=t,i.urlParams=n,i.hash=r,i.headers=s,i.body=o,i}const eP=e=>typeof e=="object"&&e!==null&&uh in e,tP=ln("GET","",VM,O(),CS,GM),hr=e=>(t,n)=>aP(tP,{method:e,url:t,...n??void 0}),nP=hr("GET"),LS=hr("POST"),rP=hr("PUT"),sP=hr("PATCH"),oP=hr("DELETE"),iP=hr("HEAD"),cP=hr("OPTIONS"),aP=h(2,(e,t)=>{let n=e;return t.method&&(n=fP(n,t.method)),t.url&&(n=hP(n,t.url)),t.headers&&(n=DS(n,t.headers)),t.urlParams&&(n=dP(n,t.urlParams)),t.hash&&(n=mP(n,t.hash)),t.body&&(n=BS(n,t.body)),t.accept&&(n=US(n,t.accept)),t.acceptJson&&(n=lP(n)),n}),uP=h(3,(e,t,n)=>ln(e.method,e.url,e.urlParams,e.hash,ih(e.headers,t,n),e.body)),DS=h(2,(e,t)=>ln(e.method,e.url,e.urlParams,e.hash,jM(e.headers,t),e.body)),US=h(2,(e,t)=>uP(e,"Accept",t)),lP=US("application/json"),fP=h(2,(e,t)=>ln(t,e.url,e.urlParams,e.hash,e.headers,e.body)),hP=h(2,(e,t)=>{if(typeof t=="string")return ln(e.method,t,e.urlParams,e.hash,e.headers,e.body);const n=new URL(t.toString()),r=ch(n.searchParams),s=n.hash?T(n.hash.slice(1)):O();return n.search="",n.hash="",ln(e.method,n.toString(),r,s,e.headers,e.body)}),dP=h(2,(e,t)=>ln(e.method,e.url,JM(e.urlParams,t),e.hash,e.headers,e.body)),mP=h(2,(e,t)=>ln(e.method,e.url,e.urlParams,T(t),e.headers,e.body)),BS=h(2,(e,t)=>{let n=e.headers;if(t._tag==="Empty")n=xS(xS(n,"Content-Type"),"Content-length");else{const r=t.contentType;r&&(n=ih(n,"content-type",r));const s=t.contentLength;s&&(n=ih(n,"content-length",s.toString()))}return ln(e.method,e.url,e.urlParams,e.hash,n,t)}),gP=h(e=>eP(e[0]),(e,t,n="application/octet-stream")=>BS(e,XM(t,n))),lh=Symbol.for("@effect/platform/HttpIncomingMessage"),pP=(e,t)=>{const n=e.headers["content-type"]??"";let r;if(n.includes("application/json"))try{r=An(e.json)}catch{}else if(n.includes("text/")||n.includes("urlencoded"))try{r=An(e.text)}catch{}const s={...t,headers:e.headers,remoteAddress:e.remoteAddress.toJSON()};return r!==void 0&&(s.body=r),s},fh=Symbol.for("@effect/platform/HttpClientResponse"),yP=(e,t)=>new bP(e,t);class bP extends D0{constructor(n,r){super();u(this,"request");u(this,"source");u(this,IL);u(this,TL);u(this,"cachedCookies");u(this,"textBody");u(this,"formDataBody");u(this,"arrayBufferBody");this.request=n,this.source=r,this[lh]=lh,this[fh]=fh}toJSON(){return pP(this,{_id:"@effect/platform/HttpClientResponse",request:this.request.toJSON(),status:this.status})}get status(){return this.source.status}get headers(){return AS(this.source.headers)}get cookies(){return this.cachedCookies?this.cachedCookies:this.cachedCookies=PM(this.source.headers.getSetCookie())}get remoteAddress(){return O()}get stream(){return this.source.body?vM(()=>this.source.body,n=>new Pn({request:this.request,response:this,reason:"Decode",cause:n})):NM(new Pn({request:this.request,response:this,reason:"EmptyBody",description:"can not create stream from empty body"}))}get json(){return _v(this.text,{try:n=>n===""?null:JSON.parse(n),catch:n=>new Pn({request:this.request,response:this,reason:"Decode",cause:n})})}get text(){return this.textBody??(this.textBody=Po({try:()=>this.source.text(),catch:n=>new Pn({request:this.request,response:this,reason:"Decode",cause:n})}).pipe(lf,An))}get urlParamsBody(){return j(this.text,n=>bv({try:()=>ch(new URLSearchParams(n)),catch:r=>new Pn({request:this.request,response:this,reason:"Decode",cause:r})}))}get formData(){return this.formDataBody??(this.formDataBody=Po({try:()=>this.source.formData(),catch:n=>new Pn({request:this.request,response:this,reason:"Decode",cause:n})}).pipe(lf,An))}get arrayBuffer(){return this.arrayBufferBody??(this.arrayBufferBody=Po({try:()=>this.source.arrayBuffer(),catch:n=>new Pn({request:this.request,response:this,reason:"Decode",cause:n})}).pipe(lf,An))}}IL=lh,TL=fh;const _P=e=>e.status>=200&&e.status<300?ce(e):qt(new Pn({response:e,request:e.request,reason:"StatusCode",description:"non 2xx status code"})),jS=Symbol.for("@effect/platform/HttpClient"),KS=_t("@effect/platform/HttpClient"),SP=W(Symbol.for("@effect/platform/HttpClient/tracerDisabledWhen"),()=>qf(ei)),wP=W(Symbol.for("@effect/platform/HttpClient/currentTracerPropagation"),()=>qf(!0)),kP={[jS]:jS,pipe(){return v(this,arguments)},...ai,toJSON(){return{_id:"@effect/platform/HttpClient"}},get(e,t){return this.execute(nP(e,t))},head(e,t){return this.execute(iP(e,t))},post(e,t){return this.execute(LS(e,t))},put(e,t){return this.execute(rP(e,t))},patch(e,t){return this.execute(sP(e,t))},del(e,t){return this.execute(oP(e,t))},options(e,t){return this.execute(cP(e,t))}},qS=(e,t)=>{const n=Object.create(kP);return n.preprocess=t,n.postprocess=e,n.execute=function(r){return e(t(r))},n},EP=e=>qS(t=>j(t,n=>hv(r=>{const s=La(r.getFiberRef(E_),pN),o=new AbortController,i=yN(s,Ae(()=>o.abort())),c=zM(n.url,n.urlParams,n.hash);if(c._tag==="Left")return qt(new NS({request:n,reason:"InvalidUrl",cause:c.left}));const a=c.right;return!r.getFiberRef(kx)||r.getFiberRef(SP)(n)?dt(i,e(n,a,o.signal,r)):dt(i,vv(`http.client ${n.method}`,{kind:"client",captureStackTrace:!1},f=>{f.attribute("http.request.method",n.method),f.attribute("server.address",a.origin),a.port!==""&&f.attribute("server.port",+a.port),f.attribute("url.full",a.toString()),f.attribute("url.path",a.pathname),f.attribute("url.scheme",a.protocol.slice(0,-1));const m=a.search.slice(1);m!==""&&f.attribute("url.query",m);const g=r.getFiberRef(KM),p=MS(n.headers,g);for(const y in p)f.attribute(`http.request.header.${y}`,String(p[y]));return n=r.getFiberRef(wP)?DS(n,qM(f)):n,Do(Cv(e(n,a,o.signal,r),f),y=>{f.attribute("http.response.status_code",y.status);const k=MS(y.headers,g);for(const b in k)f.attribute(`http.response.header.${b}`,String(k[b]))})}))})),ce),OP=e=>VS(e,j(_P)),VS=h(2,(e,t)=>{const n=e;return qS(r=>t(n.postprocess(r)),n.preprocess)}),IP=e=>K2(KS,j(Ev(),t=>Y(e,n=>VS(n,Ov(r=>Ds(t,r)))))),TP="@effect/platform/FetchHttpClient/Fetch",$P="@effect/platform/FetchHttpClient/FetchOptions",RP=IP(ce(EP((e,t,n,r)=>{const s=r.getFiberRef(E_),o=s.unsafeMap.get(TP)??globalThis.fetch,i=s.unsafeMap.get($P)??{},c=new globalThis.Headers(e.headers),a=l=>Y(Po({try:()=>o(t,{...i,method:e.method,headers:c,body:l,duplex:e.body._tag==="Stream"?"half":void 0,signal:n}),catch:f=>new NS({request:e,reason:"Transport",cause:f})}),f=>yP(e,f));switch(e.body._tag){case"Raw":case"Uint8Array":return a(e.body.body);case"FormData":return a(e.body.formData);case"Stream":return j(CM(e.body.stream),a)}return a(void 0)}))),FP=KS,NP=OP,vP=LS,CP=gP;function JS(e){let t=typeof e;if(t=="object"){if(Array.isArray(e))return"array";if(e===null)return"null"}return t}function AP(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)}let fn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),da=[];for(let e=0;e<fn.length;e++)da[fn[e].charCodeAt(0)]=e;da[45]=fn.indexOf("+"),da[95]=fn.indexOf("/");function xP(e){let t=e.length*3/4;e[e.length-2]=="="?t-=2:e[e.length-1]=="="&&(t-=1);let n=new Uint8Array(t),r=0,s=0,o,i=0;for(let c=0;c<e.length;c++){if(o=da[e.charCodeAt(c)],o===void 0)switch(e[c]){case"=":s=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(s){case 0:i=o,s=1;break;case 1:n[r++]=i<<2|(o&48)>>4,i=o,s=2;break;case 2:n[r++]=(i&15)<<4|(o&60)>>2,i=o,s=3;break;case 3:n[r++]=(i&3)<<6|o,s=0;break}}if(s==1)throw Error("invalid base64 string.");return n.subarray(0,r)}function MP(e){let t="",n=0,r,s=0;for(let o=0;o<e.length;o++)switch(r=e[o],n){case 0:t+=fn[r>>2],s=(r&3)<<4,n=1;break;case 1:t+=fn[s|r>>4],s=(r&15)<<2,n=2;break;case 2:t+=fn[s|r>>6],t+=fn[r&63],n=0;break}return n&&(t+=fn[s],t+="=",n==1&&(t+="=")),t}var ma;(function(e){e.symbol=Symbol.for("protobuf-ts/unknown"),e.onRead=(n,r,s,o,i)=>{(t(r)?r[e.symbol]:r[e.symbol]=[]).push({no:s,wireType:o,data:i})},e.onWrite=(n,r,s)=>{for(let{no:o,wireType:i,data:c}of e.list(r))s.tag(o,i).raw(c)},e.list=(n,r)=>{if(t(n)){let s=n[e.symbol];return r?s.filter(o=>o.no==r):s}return[]},e.last=(n,r)=>e.list(n,r).slice(-1)[0];const t=n=>n&&Array.isArray(n[e.symbol])})(ma||(ma={}));var Fe;(function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"})(Fe||(Fe={}));function PP(){let e=0,t=0;for(let r=0;r<28;r+=7){let s=this.buf[this.pos++];if(e|=(s&127)<<r,!(s&128))return this.assertBounds(),[e,t]}let n=this.buf[this.pos++];if(e|=(n&15)<<28,t=(n&112)>>4,!(n&128))return this.assertBounds(),[e,t];for(let r=3;r<=31;r+=7){let s=this.buf[this.pos++];if(t|=(s&127)<<r,!(s&128))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function hh(e,t,n){for(let o=0;o<28;o=o+7){const i=e>>>o,c=!(!(i>>>7)&&t==0),a=(c?i|128:i)&255;if(n.push(a),!c)return}const r=e>>>28&15|(t&7)<<4,s=!!(t>>3);if(n.push((s?r|128:r)&255),!!s){for(let o=3;o<31;o=o+7){const i=t>>>o,c=!!(i>>>7),a=(c?i|128:i)&255;if(n.push(a),!c)return}n.push(t>>>31&1)}}const ga=65536*65536;function zS(e){let t=e[0]=="-";t&&(e=e.slice(1));const n=1e6;let r=0,s=0;function o(i,c){const a=Number(e.slice(i,c));s*=n,r=r*n+a,r>=ga&&(s=s+(r/ga|0),r=r%ga)}return o(-24,-18),o(-18,-12),o(-12,-6),o(-6),[t,r,s]}function dh(e,t){if(t>>>0<=2097151)return""+(ga*t+(e>>>0));let n=e&16777215,r=(e>>>24|t<<8)>>>0&16777215,s=t>>16&65535,o=n+r*6777216+s*6710656,i=r+s*8147497,c=s*2,a=1e7;o>=a&&(i+=Math.floor(o/a),o%=a),i>=a&&(c+=Math.floor(i/a),i%=a);function l(f,m){let g=f?String(f):"";return m?"0000000".slice(g.length)+g:g}return l(c,0)+l(i,c)+l(o,1)}function WS(e,t){if(e>=0){for(;e>127;)t.push(e&127|128),e=e>>>7;t.push(e)}else{for(let n=0;n<9;n++)t.push(e&127|128),e=e>>7;t.push(1)}}function LP(){let e=this.buf[this.pos++],t=e&127;if(!(e&128))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(e&127)<<7,!(e&128))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(e&127)<<14,!(e&128))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(e&127)<<21,!(e&128))return this.assertBounds(),t;e=this.buf[this.pos++],t|=(e&15)<<28;for(let n=5;e&128&&n<10;n++)e=this.buf[this.pos++];if(e&128)throw new Error("invalid varint");return this.assertBounds(),t>>>0}let me;function DP(){const e=new DataView(new ArrayBuffer(8));me=globalThis.BigInt!==void 0&&typeof e.getBigInt64=="function"&&typeof e.getBigUint64=="function"&&typeof e.setBigInt64=="function"&&typeof e.setBigUint64=="function"?{MIN:BigInt("-9223372036854775808"),MAX:BigInt("9223372036854775807"),UMIN:BigInt("0"),UMAX:BigInt("18446744073709551615"),C:BigInt,V:e}:void 0}DP();function HS(e){if(!e)throw new Error("BigInt unavailable, see https://github.com/timostamm/protobuf-ts/blob/v1.0.8/MANUAL.md#bigint-support")}const GS=/^-?[0-9]+$/,pa=4294967296,ya=2147483648;class YS{constructor(t,n){this.lo=t|0,this.hi=n|0}isZero(){return this.lo==0&&this.hi==0}toNumber(){let t=this.hi*pa+(this.lo>>>0);if(!Number.isSafeInteger(t))throw new Error("cannot convert to safe number");return t}}class Ze extends YS{static from(t){if(me)switch(typeof t){case"string":if(t=="0")return this.ZERO;if(t=="")throw new Error("string is no integer");t=me.C(t);case"number":if(t===0)return this.ZERO;t=me.C(t);case"bigint":if(!t)return this.ZERO;if(t<me.UMIN)throw new Error("signed value for ulong");if(t>me.UMAX)throw new Error("ulong too large");return me.V.setBigUint64(0,t,!0),new Ze(me.V.getInt32(0,!0),me.V.getInt32(4,!0))}else switch(typeof t){case"string":if(t=="0")return this.ZERO;if(t=t.trim(),!GS.test(t))throw new Error("string is no integer");let[n,r,s]=zS(t);if(n)throw new Error("signed value for ulong");return new Ze(r,s);case"number":if(t==0)return this.ZERO;if(!Number.isSafeInteger(t))throw new Error("number is no integer");if(t<0)throw new Error("signed value for ulong");return new Ze(t,t/pa)}throw new Error("unknown value "+typeof t)}toString(){return me?this.toBigInt().toString():dh(this.lo,this.hi)}toBigInt(){return HS(me),me.V.setInt32(0,this.lo,!0),me.V.setInt32(4,this.hi,!0),me.V.getBigUint64(0,!0)}}Ze.ZERO=new Ze(0,0);class Ne extends YS{static from(t){if(me)switch(typeof t){case"string":if(t=="0")return this.ZERO;if(t=="")throw new Error("string is no integer");t=me.C(t);case"number":if(t===0)return this.ZERO;t=me.C(t);case"bigint":if(!t)return this.ZERO;if(t<me.MIN)throw new Error("signed long too small");if(t>me.MAX)throw new Error("signed long too large");return me.V.setBigInt64(0,t,!0),new Ne(me.V.getInt32(0,!0),me.V.getInt32(4,!0))}else switch(typeof t){case"string":if(t=="0")return this.ZERO;if(t=t.trim(),!GS.test(t))throw new Error("string is no integer");let[n,r,s]=zS(t);if(n){if(s>ya||s==ya&&r!=0)throw new Error("signed long too small")}else if(s>=ya)throw new Error("signed long too large");let o=new Ne(r,s);return n?o.negate():o;case"number":if(t==0)return this.ZERO;if(!Number.isSafeInteger(t))throw new Error("number is no integer");return t>0?new Ne(t,t/pa):new Ne(-t,-t/pa).negate()}throw new Error("unknown value "+typeof t)}isNegative(){return(this.hi&ya)!==0}negate(){let t=~this.hi,n=this.lo;return n?n=~n+1:t+=1,new Ne(n,t)}toString(){if(me)return this.toBigInt().toString();if(this.isNegative()){let t=this.negate();return"-"+dh(t.lo,t.hi)}return dh(this.lo,this.hi)}toBigInt(){return HS(me),me.V.setInt32(0,this.lo,!0),me.V.setInt32(4,this.hi,!0),me.V.getBigInt64(0,!0)}}Ne.ZERO=new Ne(0,0);const XS={readUnknownField:!0,readerFactory:e=>new QS(e)};function UP(e){return e?Object.assign(Object.assign({},XS),e):XS}class QS{constructor(t,n){this.varint64=PP,this.uint32=LP,this.buf=t,this.len=t.length,this.pos=0,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.textDecoder=n??new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0})}tag(){let t=this.uint32(),n=t>>>3,r=t&7;if(n<=0||r<0||r>5)throw new Error("illegal tag: field no "+n+" wire type "+r);return[n,r]}skip(t){let n=this.pos;switch(t){case Fe.Varint:for(;this.buf[this.pos++]&128;);break;case Fe.Bit64:this.pos+=4;case Fe.Bit32:this.pos+=4;break;case Fe.LengthDelimited:let r=this.uint32();this.pos+=r;break;case Fe.StartGroup:let s;for(;(s=this.tag()[1])!==Fe.EndGroup;)this.skip(s);break;default:throw new Error("cant skip wire type "+t)}return this.assertBounds(),this.buf.subarray(n,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)}int64(){return new Ne(...this.varint64())}uint64(){return new Ze(...this.varint64())}sint64(){let[t,n]=this.varint64(),r=-(t&1);return t=(t>>>1|(n&1)<<31)^r,n=n>>>1^r,new Ne(t,n)}bool(){let[t,n]=this.varint64();return t!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return new Ze(this.sfixed32(),this.sfixed32())}sfixed64(){return new Ne(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let t=this.uint32(),n=this.pos;return this.pos+=t,this.assertBounds(),this.buf.subarray(n,n+t)}string(){return this.textDecoder.decode(this.bytes())}}function ie(e,t){if(!e)throw new Error(t)}const BP=34028234663852886e22,jP=-34028234663852886e22,KP=4294967295,qP=2147483647,VP=-2147483648;function Qo(e){if(typeof e!="number")throw new Error("invalid int 32: "+typeof e);if(!Number.isInteger(e)||e>qP||e<VP)throw new Error("invalid int 32: "+e)}function ba(e){if(typeof e!="number")throw new Error("invalid uint 32: "+typeof e);if(!Number.isInteger(e)||e>KP||e<0)throw new Error("invalid uint 32: "+e)}function mh(e){if(typeof e!="number")throw new Error("invalid float 32: "+typeof e);if(Number.isFinite(e)&&(e>BP||e<jP))throw new Error("invalid float 32: "+e)}const ZS={writeUnknownFields:!0,writerFactory:()=>new e0};function JP(e){return e?Object.assign(Object.assign({},ZS),e):ZS}class e0{constructor(t){this.stack=[],this.textEncoder=t??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let t=0;for(let s=0;s<this.chunks.length;s++)t+=this.chunks[s].length;let n=new Uint8Array(t),r=0;for(let s=0;s<this.chunks.length;s++)n.set(this.chunks[s],r),r+=this.chunks[s].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let t=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(t.byteLength),this.raw(t)}tag(t,n){return this.uint32((t<<3|n)>>>0)}raw(t){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(t),this}uint32(t){for(ba(t);t>127;)this.buf.push(t&127|128),t=t>>>7;return this.buf.push(t),this}int32(t){return Qo(t),WS(t,this.buf),this}bool(t){return this.buf.push(t?1:0),this}bytes(t){return this.uint32(t.byteLength),this.raw(t)}string(t){let n=this.textEncoder.encode(t);return this.uint32(n.byteLength),this.raw(n)}float(t){mh(t);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,t,!0),this.raw(n)}double(t){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,t,!0),this.raw(n)}fixed32(t){ba(t);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,t,!0),this.raw(n)}sfixed32(t){Qo(t);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,t,!0),this.raw(n)}sint32(t){return Qo(t),t=(t<<1^t>>31)>>>0,WS(t,this.buf),this}sfixed64(t){let n=new Uint8Array(8),r=new DataView(n.buffer),s=Ne.from(t);return r.setInt32(0,s.lo,!0),r.setInt32(4,s.hi,!0),this.raw(n)}fixed64(t){let n=new Uint8Array(8),r=new DataView(n.buffer),s=Ze.from(t);return r.setInt32(0,s.lo,!0),r.setInt32(4,s.hi,!0),this.raw(n)}int64(t){let n=Ne.from(t);return hh(n.lo,n.hi,this.buf),this}sint64(t){let n=Ne.from(t),r=n.hi>>31,s=n.lo<<1^r,o=(n.hi<<1|n.lo>>>31)^r;return hh(s,o,this.buf),this}uint64(t){let n=Ze.from(t);return hh(n.lo,n.hi,this.buf),this}}const t0={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0},n0={ignoreUnknownFields:!1};function zP(e){return e?Object.assign(Object.assign({},n0),e):n0}function WP(e){return e?Object.assign(Object.assign({},t0),e):t0}const r0=Symbol.for("protobuf-ts/message-type");function s0(e){let t=!1;const n=[];for(let r=0;r<e.length;r++){let s=e.charAt(r);s=="_"?t=!0:/\d/.test(s)?(n.push(s),t=!0):t?(n.push(s.toUpperCase()),t=!1):r==0?n.push(s.toLowerCase()):n.push(s)}return n.join("")}var S;(function(e){e[e.DOUBLE=1]="DOUBLE",e[e.FLOAT=2]="FLOAT",e[e.INT64=3]="INT64",e[e.UINT64=4]="UINT64",e[e.INT32=5]="INT32",e[e.FIXED64=6]="FIXED64",e[e.FIXED32=7]="FIXED32",e[e.BOOL=8]="BOOL",e[e.STRING=9]="STRING",e[e.BYTES=12]="BYTES",e[e.UINT32=13]="UINT32",e[e.SFIXED32=15]="SFIXED32",e[e.SFIXED64=16]="SFIXED64",e[e.SINT32=17]="SINT32",e[e.SINT64=18]="SINT64"})(S||(S={}));var zt;(function(e){e[e.BIGINT=0]="BIGINT",e[e.STRING=1]="STRING",e[e.NUMBER=2]="NUMBER"})(zt||(zt={}));var _a;(function(e){e[e.NO=0]="NO",e[e.PACKED=1]="PACKED",e[e.UNPACKED=2]="UNPACKED"})(_a||(_a={}));function HP(e){var t,n,r,s;return e.localName=(t=e.localName)!==null&&t!==void 0?t:s0(e.name),e.jsonName=(n=e.jsonName)!==null&&n!==void 0?n:s0(e.name),e.repeat=(r=e.repeat)!==null&&r!==void 0?r:_a.NO,e.opt=(s=e.opt)!==null&&s!==void 0?s:e.repeat||e.oneof?!1:e.kind=="message",e}function GP(e){if(typeof e!="object"||e===null||!e.hasOwnProperty("oneofKind"))return!1;switch(typeof e.oneofKind){case"string":return e[e.oneofKind]===void 0?!1:Object.keys(e).length==2;case"undefined":return Object.keys(e).length==1;default:return!1}}class YP{constructor(t){var n;this.fields=(n=t.fields)!==null&&n!==void 0?n:[]}prepare(){if(this.data)return;const t=[],n=[],r=[];for(let s of this.fields)if(s.oneof)r.includes(s.oneof)||(r.push(s.oneof),t.push(s.oneof),n.push(s.oneof));else switch(n.push(s.localName),s.kind){case"scalar":case"enum":(!s.opt||s.repeat)&&t.push(s.localName);break;case"message":s.repeat&&t.push(s.localName);break;case"map":t.push(s.localName);break}this.data={req:t,known:n,oneofs:Object.values(r)}}is(t,n,r=!1){if(n<0)return!0;if(t==null||typeof t!="object")return!1;this.prepare();let s=Object.keys(t),o=this.data;if(s.length<o.req.length||o.req.some(i=>!s.includes(i))||!r&&s.some(i=>!o.known.includes(i)))return!1;if(n<1)return!0;for(const i of o.oneofs){const c=t[i];if(!GP(c))return!1;if(c.oneofKind===void 0)continue;const a=this.fields.find(l=>l.localName===c.oneofKind);if(!a||!this.field(c[c.oneofKind],a,r,n))return!1}for(const i of this.fields)if(i.oneof===void 0&&!this.field(t[i.localName],i,r,n))return!1;return!0}field(t,n,r,s){let o=n.repeat;switch(n.kind){case"scalar":return t===void 0?n.opt:o?this.scalars(t,n.T,s,n.L):this.scalar(t,n.T,n.L);case"enum":return t===void 0?n.opt:o?this.scalars(t,S.INT32,s):this.scalar(t,S.INT32);case"message":return t===void 0?!0:o?this.messages(t,n.T(),r,s):this.message(t,n.T(),r,s);case"map":if(typeof t!="object"||t===null)return!1;if(s<2)return!0;if(!this.mapKeys(t,n.K,s))return!1;switch(n.V.kind){case"scalar":return this.scalars(Object.values(t),n.V.T,s,n.V.L);case"enum":return this.scalars(Object.values(t),S.INT32,s);case"message":return this.messages(Object.values(t),n.V.T(),r,s)}break}return!0}message(t,n,r,s){return r?n.isAssignable(t,s):n.is(t,s)}messages(t,n,r,s){if(!Array.isArray(t))return!1;if(s<2)return!0;if(r){for(let o=0;o<t.length&&o<s;o++)if(!n.isAssignable(t[o],s-1))return!1}else for(let o=0;o<t.length&&o<s;o++)if(!n.is(t[o],s-1))return!1;return!0}scalar(t,n,r){let s=typeof t;switch(n){case S.UINT64:case S.FIXED64:case S.INT64:case S.SFIXED64:case S.SINT64:switch(r){case zt.BIGINT:return s=="bigint";case zt.NUMBER:return s=="number"&&!isNaN(t);default:return s=="string"}case S.BOOL:return s=="boolean";case S.STRING:return s=="string";case S.BYTES:return t instanceof Uint8Array;case S.DOUBLE:case S.FLOAT:return s=="number"&&!isNaN(t);default:return s=="number"&&Number.isInteger(t)}}scalars(t,n,r,s){if(!Array.isArray(t))return!1;if(r<2)return!0;if(Array.isArray(t)){for(let o=0;o<t.length&&o<r;o++)if(!this.scalar(t[o],n,s))return!1}return!0}mapKeys(t,n,r){let s=Object.keys(t);switch(n){case S.INT32:case S.FIXED32:case S.SFIXED32:case S.SINT32:case S.UINT32:return this.scalars(s.slice(0,r).map(o=>parseInt(o)),n,r);case S.BOOL:return this.scalars(s.slice(0,r).map(o=>o=="true"?!0:o=="false"?!1:o),n,r);default:return this.scalars(s,n,r,zt.STRING)}}}function Mt(e,t){switch(t){case zt.BIGINT:return e.toBigInt();case zt.NUMBER:return e.toNumber();default:return e.toString()}}class XP{constructor(t){this.info=t}prepare(){var t;if(this.fMap===void 0){this.fMap={};const n=(t=this.info.fields)!==null&&t!==void 0?t:[];for(const r of n)this.fMap[r.name]=r,this.fMap[r.jsonName]=r,this.fMap[r.localName]=r}}assert(t,n,r){if(!t){let s=JS(r);throw(s=="number"||s=="boolean")&&(s=r.toString()),new Error(`Cannot parse JSON ${s} for ${this.info.typeName}#${n}`)}}read(t,n,r){this.prepare();const s=[];for(const[o,i]of Object.entries(t)){const c=this.fMap[o];if(!c){if(!r.ignoreUnknownFields)throw new Error(`Found unknown field while reading ${this.info.typeName} from JSON format. JSON key: ${o}`);continue}const a=c.localName;let l;if(c.oneof){if(i===null&&(c.kind!=="enum"||c.T()[0]!=="google.protobuf.NullValue"))continue;if(s.includes(c.oneof))throw new Error(`Multiple members of the oneof group "${c.oneof}" of ${this.info.typeName} are present in JSON.`);s.push(c.oneof),l=n[c.oneof]={oneofKind:a}}else l=n;if(c.kind=="map"){if(i===null)continue;this.assert(AP(i),c.name,i);const f=l[a];for(const[m,g]of Object.entries(i)){this.assert(g!==null,c.name+" map value",null);let p;switch(c.V.kind){case"message":p=c.V.T().internalJsonRead(g,r);break;case"enum":if(p=this.enum(c.V.T(),g,c.name,r.ignoreUnknownFields),p===!1)continue;break;case"scalar":p=this.scalar(g,c.V.T,c.V.L,c.name);break}this.assert(p!==void 0,c.name+" map value",g);let y=m;c.K==S.BOOL&&(y=y=="true"?!0:y=="false"?!1:y),y=this.scalar(y,c.K,zt.STRING,c.name).toString(),f[y]=p}}else if(c.repeat){if(i===null)continue;this.assert(Array.isArray(i),c.name,i);const f=l[a];for(const m of i){this.assert(m!==null,c.name,null);let g;switch(c.kind){case"message":g=c.T().internalJsonRead(m,r);break;case"enum":if(g=this.enum(c.T(),m,c.name,r.ignoreUnknownFields),g===!1)continue;break;case"scalar":g=this.scalar(m,c.T,c.L,c.name);break}this.assert(g!==void 0,c.name,i),f.push(g)}}else switch(c.kind){case"message":if(i===null&&c.T().typeName!="google.protobuf.Value"){this.assert(c.oneof===void 0,c.name+" (oneof member)",null);continue}l[a]=c.T().internalJsonRead(i,r,l[a]);break;case"enum":let f=this.enum(c.T(),i,c.name,r.ignoreUnknownFields);if(f===!1)continue;l[a]=f;break;case"scalar":l[a]=this.scalar(i,c.T,c.L,c.name);break}}}enum(t,n,r,s){if(t[0]=="google.protobuf.NullValue"&&ie(n===null||n==="NULL_VALUE",`Unable to parse field ${this.info.typeName}#${r}, enum ${t[0]} only accepts null.`),n===null)return 0;switch(typeof n){case"number":return ie(Number.isInteger(n),`Unable to parse field ${this.info.typeName}#${r}, enum can only be integral number, got ${n}.`),n;case"string":let o=n;t[2]&&n.substring(0,t[2].length)===t[2]&&(o=n.substring(t[2].length));let i=t[1][o];return typeof i>"u"&&s?!1:(ie(typeof i=="number",`Unable to parse field ${this.info.typeName}#${r}, enum ${t[0]} has no value for "${n}".`),i)}ie(!1,`Unable to parse field ${this.info.typeName}#${r}, cannot parse enum value from ${typeof n}".`)}scalar(t,n,r,s){let o;try{switch(n){case S.DOUBLE:case S.FLOAT:if(t===null)return 0;if(t==="NaN")return Number.NaN;if(t==="Infinity")return Number.POSITIVE_INFINITY;if(t==="-Infinity")return Number.NEGATIVE_INFINITY;if(t===""){o="empty string";break}if(typeof t=="string"&&t.trim().length!==t.length){o="extra whitespace";break}if(typeof t!="string"&&typeof t!="number")break;let i=Number(t);if(Number.isNaN(i)){o="not a number";break}if(!Number.isFinite(i)){o="too large or small";break}return n==S.FLOAT&&mh(i),i;case S.INT32:case S.FIXED32:case S.SFIXED32:case S.SINT32:case S.UINT32:if(t===null)return 0;let c;if(typeof t=="number"?c=t:t===""?o="empty string":typeof t=="string"&&(t.trim().length!==t.length?o="extra whitespace":c=Number(t)),c===void 0)break;return n==S.UINT32?ba(c):Qo(c),c;case S.INT64:case S.SFIXED64:case S.SINT64:if(t===null)return Mt(Ne.ZERO,r);if(typeof t!="number"&&typeof t!="string")break;return Mt(Ne.from(t),r);case S.FIXED64:case S.UINT64:if(t===null)return Mt(Ze.ZERO,r);if(typeof t!="number"&&typeof t!="string")break;return Mt(Ze.from(t),r);case S.BOOL:if(t===null)return!1;if(typeof t!="boolean")break;return t;case S.STRING:if(t===null)return"";if(typeof t!="string"){o="extra whitespace";break}try{encodeURIComponent(t)}catch(a){a="invalid UTF8";break}return t;case S.BYTES:if(t===null||t==="")return new Uint8Array(0);if(typeof t!="string")break;return xP(t)}}catch(i){o=i.message}this.assert(!1,s+(o?" - "+o:""),t)}}class QP{constructor(t){var n;this.fields=(n=t.fields)!==null&&n!==void 0?n:[]}write(t,n){const r={},s=t;for(const o of this.fields){if(!o.oneof){let l=this.field(o,s[o.localName],n);l!==void 0&&(r[n.useProtoFieldName?o.name:o.jsonName]=l);continue}const i=s[o.oneof];if(i.oneofKind!==o.localName)continue;const c=o.kind=="scalar"||o.kind=="enum"?Object.assign(Object.assign({},n),{emitDefaultValues:!0}):n;let a=this.field(o,i[o.localName],c);ie(a!==void 0),r[n.useProtoFieldName?o.name:o.jsonName]=a}return r}field(t,n,r){let s;if(t.kind=="map"){ie(typeof n=="object"&&n!==null);const o={};switch(t.V.kind){case"scalar":for(const[a,l]of Object.entries(n)){const f=this.scalar(t.V.T,l,t.name,!1,!0);ie(f!==void 0),o[a.toString()]=f}break;case"message":const i=t.V.T();for(const[a,l]of Object.entries(n)){const f=this.message(i,l,t.name,r);ie(f!==void 0),o[a.toString()]=f}break;case"enum":const c=t.V.T();for(const[a,l]of Object.entries(n)){ie(l===void 0||typeof l=="number");const f=this.enum(c,l,t.name,!1,!0,r.enumAsInteger);ie(f!==void 0),o[a.toString()]=f}break}(r.emitDefaultValues||Object.keys(o).length>0)&&(s=o)}else if(t.repeat){ie(Array.isArray(n));const o=[];switch(t.kind){case"scalar":for(let a=0;a<n.length;a++){const l=this.scalar(t.T,n[a],t.name,t.opt,!0);ie(l!==void 0),o.push(l)}break;case"enum":const i=t.T();for(let a=0;a<n.length;a++){ie(n[a]===void 0||typeof n[a]=="number");const l=this.enum(i,n[a],t.name,t.opt,!0,r.enumAsInteger);ie(l!==void 0),o.push(l)}break;case"message":const c=t.T();for(let a=0;a<n.length;a++){const l=this.message(c,n[a],t.name,r);ie(l!==void 0),o.push(l)}break}(r.emitDefaultValues||o.length>0||r.emitDefaultValues)&&(s=o)}else switch(t.kind){case"scalar":s=this.scalar(t.T,n,t.name,t.opt,r.emitDefaultValues);break;case"enum":s=this.enum(t.T(),n,t.name,t.opt,r.emitDefaultValues,r.enumAsInteger);break;case"message":s=this.message(t.T(),n,t.name,r);break}return s}enum(t,n,r,s,o,i){if(t[0]=="google.protobuf.NullValue")return!o&&!s?void 0:null;if(n===void 0){ie(s);return}if(!(n===0&&!o&&!s))return ie(typeof n=="number"),ie(Number.isInteger(n)),i||!t[1].hasOwnProperty(n)?n:t[2]?t[2]+t[1][n]:t[1][n]}message(t,n,r,s){return n===void 0?s.emitDefaultValues?null:void 0:t.internalJsonWrite(n,s)}scalar(t,n,r,s,o){if(n===void 0){ie(s);return}const i=o||s;switch(t){case S.INT32:case S.SFIXED32:case S.SINT32:return n===0?i?0:void 0:(Qo(n),n);case S.FIXED32:case S.UINT32:return n===0?i?0:void 0:(ba(n),n);case S.FLOAT:mh(n);case S.DOUBLE:return n===0?i?0:void 0:(ie(typeof n=="number"),Number.isNaN(n)?"NaN":n===Number.POSITIVE_INFINITY?"Infinity":n===Number.NEGATIVE_INFINITY?"-Infinity":n);case S.STRING:return n===""?i?"":void 0:(ie(typeof n=="string"),n);case S.BOOL:return n===!1?i?!1:void 0:(ie(typeof n=="boolean"),n);case S.UINT64:case S.FIXED64:ie(typeof n=="number"||typeof n=="string"||typeof n=="bigint");let c=Ze.from(n);return c.isZero()&&!i?void 0:c.toString();case S.INT64:case S.SFIXED64:case S.SINT64:ie(typeof n=="number"||typeof n=="string"||typeof n=="bigint");let a=Ne.from(n);return a.isZero()&&!i?void 0:a.toString();case S.BYTES:return ie(n instanceof Uint8Array),n.byteLength?MP(n):i?"":void 0}}}function gh(e,t=zt.STRING){switch(e){case S.BOOL:return!1;case S.UINT64:case S.FIXED64:return Mt(Ze.ZERO,t);case S.INT64:case S.SFIXED64:case S.SINT64:return Mt(Ne.ZERO,t);case S.DOUBLE:case S.FLOAT:return 0;case S.BYTES:return new Uint8Array(0);case S.STRING:return"";default:return 0}}class ZP{constructor(t){this.info=t}prepare(){var t;if(!this.fieldNoToField){const n=(t=this.info.fields)!==null&&t!==void 0?t:[];this.fieldNoToField=new Map(n.map(r=>[r.no,r]))}}read(t,n,r,s){this.prepare();const o=s===void 0?t.len:t.pos+s;for(;t.pos<o;){const[i,c]=t.tag(),a=this.fieldNoToField.get(i);if(!a){let g=r.readUnknownField;if(g=="throw")throw new Error(`Unknown field ${i} (wire type ${c}) for ${this.info.typeName}`);let p=t.skip(c);g!==!1&&(g===!0?ma.onRead:g)(this.info.typeName,n,i,c,p);continue}let l=n,f=a.repeat,m=a.localName;switch(a.oneof&&(l=l[a.oneof],l.oneofKind!==m&&(l=n[a.oneof]={oneofKind:m})),a.kind){case"scalar":case"enum":let g=a.kind=="enum"?S.INT32:a.T,p=a.kind=="scalar"?a.L:void 0;if(f){let b=l[m];if(c==Fe.LengthDelimited&&g!=S.STRING&&g!=S.BYTES){let _=t.uint32()+t.pos;for(;t.pos<_;)b.push(this.scalar(t,g,p))}else b.push(this.scalar(t,g,p))}else l[m]=this.scalar(t,g,p);break;case"message":if(f){let b=l[m],_=a.T().internalBinaryRead(t,t.uint32(),r);b.push(_)}else l[m]=a.T().internalBinaryRead(t,t.uint32(),r,l[m]);break;case"map":let[y,k]=this.mapEntry(a,t,r);l[m][y]=k;break}}}mapEntry(t,n,r){let s=n.uint32(),o=n.pos+s,i,c;for(;n.pos<o;){let[a,l]=n.tag();switch(a){case 1:t.K==S.BOOL?i=n.bool().toString():i=this.scalar(n,t.K,zt.STRING);break;case 2:switch(t.V.kind){case"scalar":c=this.scalar(n,t.V.T,t.V.L);break;case"enum":c=n.int32();break;case"message":c=t.V.T().internalBinaryRead(n,n.uint32(),r);break}break;default:throw new Error(`Unknown field ${a} (wire type ${l}) in map entry for ${this.info.typeName}#${t.name}`)}}if(i===void 0){let a=gh(t.K);i=t.K==S.BOOL?a.toString():a}if(c===void 0)switch(t.V.kind){case"scalar":c=gh(t.V.T,t.V.L);break;case"enum":c=0;break;case"message":c=t.V.T().create();break}return[i,c]}scalar(t,n,r){switch(n){case S.INT32:return t.int32();case S.STRING:return t.string();case S.BOOL:return t.bool();case S.DOUBLE:return t.double();case S.FLOAT:return t.float();case S.INT64:return Mt(t.int64(),r);case S.UINT64:return Mt(t.uint64(),r);case S.FIXED64:return Mt(t.fixed64(),r);case S.FIXED32:return t.fixed32();case S.BYTES:return t.bytes();case S.UINT32:return t.uint32();case S.SFIXED32:return t.sfixed32();case S.SFIXED64:return Mt(t.sfixed64(),r);case S.SINT32:return t.sint32();case S.SINT64:return Mt(t.sint64(),r)}}}class e3{constructor(t){this.info=t}prepare(){if(!this.fields){const t=this.info.fields?this.info.fields.concat():[];this.fields=t.sort((n,r)=>n.no-r.no)}}write(t,n,r){this.prepare();for(const o of this.fields){let i,c,a=o.repeat,l=o.localName;if(o.oneof){const f=t[o.oneof];if(f.oneofKind!==l)continue;i=f[l],c=!0}else i=t[l],c=!1;switch(o.kind){case"scalar":case"enum":let f=o.kind=="enum"?S.INT32:o.T;if(a)if(ie(Array.isArray(i)),a==_a.PACKED)this.packed(n,f,o.no,i);else for(const m of i)this.scalar(n,f,o.no,m,!0);else i===void 0?ie(o.opt):this.scalar(n,f,o.no,i,c||o.opt);break;case"message":if(a){ie(Array.isArray(i));for(const m of i)this.message(n,r,o.T(),o.no,m)}else this.message(n,r,o.T(),o.no,i);break;case"map":ie(typeof i=="object"&&i!==null);for(const[m,g]of Object.entries(i))this.mapEntry(n,r,o,m,g);break}}let s=r.writeUnknownFields;s!==!1&&(s===!0?ma.onWrite:s)(this.info.typeName,t,n)}mapEntry(t,n,r,s,o){t.tag(r.no,Fe.LengthDelimited),t.fork();let i=s;switch(r.K){case S.INT32:case S.FIXED32:case S.UINT32:case S.SFIXED32:case S.SINT32:i=Number.parseInt(s);break;case S.BOOL:ie(s=="true"||s=="false"),i=s=="true";break}switch(this.scalar(t,r.K,1,i,!0),r.V.kind){case"scalar":this.scalar(t,r.V.T,2,o,!0);break;case"enum":this.scalar(t,S.INT32,2,o,!0);break;case"message":this.message(t,n,r.V.T(),2,o);break}t.join()}message(t,n,r,s,o){o!==void 0&&(r.internalBinaryWrite(o,t.tag(s,Fe.LengthDelimited).fork(),n),t.join())}scalar(t,n,r,s,o){let[i,c,a]=this.scalarInfo(n,s);(!a||o)&&(t.tag(r,i),t[c](s))}packed(t,n,r,s){if(!s.length)return;ie(n!==S.BYTES&&n!==S.STRING),t.tag(r,Fe.LengthDelimited),t.fork();let[,o]=this.scalarInfo(n);for(let i=0;i<s.length;i++)t[o](s[i]);t.join()}scalarInfo(t,n){let r=Fe.Varint,s,o=n===void 0,i=n===0;switch(t){case S.INT32:s="int32";break;case S.STRING:i=o||!n.length,r=Fe.LengthDelimited,s="string";break;case S.BOOL:i=n===!1,s="bool";break;case S.UINT32:s="uint32";break;case S.DOUBLE:r=Fe.Bit64,s="double";break;case S.FLOAT:r=Fe.Bit32,s="float";break;case S.INT64:i=o||Ne.from(n).isZero(),s="int64";break;case S.UINT64:i=o||Ze.from(n).isZero(),s="uint64";break;case S.FIXED64:i=o||Ze.from(n).isZero(),r=Fe.Bit64,s="fixed64";break;case S.BYTES:i=o||!n.byteLength,r=Fe.LengthDelimited,s="bytes";break;case S.FIXED32:r=Fe.Bit32,s="fixed32";break;case S.SFIXED32:r=Fe.Bit32,s="sfixed32";break;case S.SFIXED64:i=o||Ne.from(n).isZero(),r=Fe.Bit64,s="sfixed64";break;case S.SINT32:s="sint32";break;case S.SINT64:i=o||Ne.from(n).isZero(),s="sint64";break}return[r,s,o||i]}}function t3(e){const t=e.messagePrototype?Object.create(e.messagePrototype):Object.defineProperty({},r0,{value:e});for(let n of e.fields){let r=n.localName;if(!n.opt)if(n.oneof)t[n.oneof]={oneofKind:void 0};else if(n.repeat)t[r]=[];else switch(n.kind){case"scalar":t[r]=gh(n.T,n.L);break;case"enum":t[r]=0;break;case"map":t[r]={};break}}return t}function ph(e,t,n){let r,s=n,o;for(let i of e.fields){let c=i.localName;if(i.oneof){const a=s[i.oneof];if((a==null?void 0:a.oneofKind)==null)continue;if(r=a[c],o=t[i.oneof],o.oneofKind=a.oneofKind,r==null){delete o[c];continue}}else if(r=s[c],o=t,r==null)continue;switch(i.repeat&&(o[c].length=r.length),i.kind){case"scalar":case"enum":if(i.repeat)for(let l=0;l<r.length;l++)o[c][l]=r[l];else o[c]=r;break;case"message":let a=i.T();if(i.repeat)for(let l=0;l<r.length;l++)o[c][l]=a.create(r[l]);else o[c]===void 0?o[c]=a.create(r):a.mergePartial(o[c],r);break;case"map":switch(i.V.kind){case"scalar":case"enum":Object.assign(o[c],r);break;case"message":let l=i.V.T();for(let f of Object.keys(r))o[c][f]=l.create(r[f]);break}break}}}function n3(e,t,n){if(t===n)return!0;if(!t||!n)return!1;for(let r of e.fields){let s=r.localName,o=r.oneof?t[r.oneof][s]:t[s],i=r.oneof?n[r.oneof][s]:n[s];switch(r.kind){case"enum":case"scalar":let c=r.kind=="enum"?S.INT32:r.T;if(!(r.repeat?i0(c,o,i):o0(c,o,i)))return!1;break;case"map":if(!(r.V.kind=="message"?c0(r.V.T(),Sa(o),Sa(i)):i0(r.V.kind=="enum"?S.INT32:r.V.T,Sa(o),Sa(i))))return!1;break;case"message":let a=r.T();if(!(r.repeat?c0(a,o,i):a.equals(o,i)))return!1;break}}return!0}const Sa=Object.values;function o0(e,t,n){if(t===n)return!0;if(e!==S.BYTES)return!1;let r=t,s=n;if(r.length!==s.length)return!1;for(let o=0;o<r.length;o++)if(r[o]!=s[o])return!1;return!0}function i0(e,t,n){if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(!o0(e,t[r],n[r]))return!1;return!0}function c0(e,t,n){if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(!e.equals(t[r],n[r]))return!1;return!0}const r3=Object.getOwnPropertyDescriptors(Object.getPrototypeOf({}));class wa{constructor(t,n,r){this.defaultCheckDepth=16,this.typeName=t,this.fields=n.map(HP),this.options=r??{},this.messagePrototype=Object.create(null,Object.assign(Object.assign({},r3),{[r0]:{value:this}})),this.refTypeCheck=new YP(this),this.refJsonReader=new XP(this),this.refJsonWriter=new QP(this),this.refBinReader=new ZP(this),this.refBinWriter=new e3(this)}create(t){let n=t3(this);return t!==void 0&&ph(this,n,t),n}clone(t){let n=this.create();return ph(this,n,t),n}equals(t,n){return n3(this,t,n)}is(t,n=this.defaultCheckDepth){return this.refTypeCheck.is(t,n,!1)}isAssignable(t,n=this.defaultCheckDepth){return this.refTypeCheck.is(t,n,!0)}mergePartial(t,n){ph(this,t,n)}fromBinary(t,n){let r=UP(n);return this.internalBinaryRead(r.readerFactory(t),t.byteLength,r)}fromJson(t,n){return this.internalJsonRead(t,zP(n))}fromJsonString(t,n){let r=JSON.parse(t);return this.fromJson(r,n)}toJson(t,n){return this.internalJsonWrite(t,WP(n))}toJsonString(t,n){var r;let s=this.toJson(t,n);return JSON.stringify(s,null,(r=n==null?void 0:n.prettySpaces)!==null&&r!==void 0?r:0)}toBinary(t,n){let r=JP(n);return this.internalBinaryWrite(t,r.writerFactory(),r).finish()}internalJsonRead(t,n,r){if(t!==null&&typeof t=="object"&&!Array.isArray(t)){let s=r??this.create();return this.refJsonReader.read(t,s,n),s}throw new Error(`Unable to parse message ${this.typeName} from JSON ${JS(t)}.`)}internalJsonWrite(t,n){return this.refJsonWriter.write(t,n)}internalBinaryWrite(t,n,r){return this.refBinWriter.write(t,n,r),n}internalBinaryRead(t,n,r,s){let o=s??this.create();return this.refBinReader.read(t,o,r,n),o}}class s3 extends wa{constructor(){super("SyncRequest",[{no:1,name:"messages",kind:"message",repeat:1,T:()=>a0},{no:2,name:"userId",kind:"scalar",T:9},{no:3,name:"nodeId",kind:"scalar",T:9},{no:4,name:"merkleTree",kind:"scalar",T:9}])}}const o3=new s3;class i3 extends wa{constructor(){super("SyncResponse",[{no:1,name:"messages",kind:"message",repeat:1,T:()=>a0},{no:2,name:"merkleTree",kind:"scalar",T:9}])}}const c3=new i3;class a3 extends wa{constructor(){super("EncryptedMessage",[{no:1,name:"timestamp",kind:"scalar",T:9},{no:2,name:"content",kind:"scalar",T:12}])}}const a0=new a3;class u3 extends wa{constructor(){super("MessageContent",[{no:1,name:"table",kind:"scalar",T:9},{no:2,name:"row",kind:"scalar",T:9},{no:3,name:"column",kind:"scalar",T:9},{no:4,name:"stringValue",kind:"scalar",oneof:"value",T:9},{no:5,name:"numberValue",kind:"scalar",oneof:"value",T:9},{no:6,name:"bytesValue",kind:"scalar",oneof:"value",T:12},{no:7,name:"jsonValue",kind:"scalar",oneof:"value",T:9}])}}const u0=new u3,l3=_t("Sync");class GD extends gi("SyncFactory")(){}const f3=as(function*(){const e=dn().pipe(mn(cr,yield*cr)),t=yield*In();return l3.of({init:n=>bf(["Sync init",{owner:n}]).pipe(Do(Tn(t,e.pipe(mn(g_,n))))),sync:({merkleTree:n,timestamp:r,messages:s})=>as(function*(){yield*bf(["Sync request",{merkleTree:n,timestamp:r,messages:s}]);const o=yield*cr,i=yield*g_,c=yield*Wy;return yield*Kt(s||[],({timestamp:a,...l})=>Y(o.seal(i.encryptionKey,h3(l)),f=>({timestamp:a,content:f}))).pipe(Y(a=>o3.toBinary({messages:a,userId:i.id,nodeId:r.node,merkleTree:GA(n)},l0)),j(a=>as(function*(){const l=(yield*FP).pipe(NP);return yield*vP(c.syncUrl).pipe(CP(a,"application/x-protobuf"),l.execute,j(f=>f.arrayBuffer),mf)}).pipe(Lo(RP))),Y(a=>c3.fromBinary(new Uint8Array(a),f0)),j(a=>Kt(a.messages,l=>Y(o.open(i.encryptionKey,l.content),f=>[f,l.timestamp])).pipe(Y(ud(([l,f])=>Bs(m3(l),m=>({...m,timestamp:f})))),Y(l=>({messages:l,merkleTree:YA(a.merkleTree)})),Do(l=>bf(["Sync response",l])))),ff("RequestError",()=>qt({_tag:"SyncStateIsNotSynced",error:{_tag:"NetworkError"}})),ff("ResponseError",({response:{status:a}})=>{switch(a){case 402:return qt({_tag:"SyncStateIsNotSynced",error:{_tag:"PaymentRequiredError"}});default:return qt({_tag:"SyncStateIsNotSynced",error:{_tag:"ServerError",status:a}})}}))}).pipe(o=>j(ht(t),i=>Lo(o,i)))})}),h3=({value:e,...t})=>o_(yh,u0.toBinary({value:d3(e),...t},l0)),yh=new Uint8Array([0,1]),d3=e=>{switch(typeof e){case"string":return{oneofKind:"stringValue",stringValue:e};case"number":return{oneofKind:"numberValue",numberValue:oA(e_)(e)}}return e==null?{oneofKind:void 0}:k0(e)?{oneofKind:"bytesValue",bytesValue:e}:{oneofKind:"jsonValue",jsonValue:JSON.stringify(e)}},l0={writerFactory:()=>new e0({encode:e=>new TextEncoder().encode(e)})},f0={readerFactory:e=>new QS(e,{decode:t=>new TextDecoder().decode(t)})},m3=e=>{if(!g3(e,yh))return O();const{value:t,...n}=u0.fromBinary(e.slice(yh.length),f0);return T({value:p3(t),...n})},g3=(e,t)=>{if(t.length>e.length)return!1;for(let n=0;n<t.length;n++)if(e[n]!==t[n])return!1;return!0},p3=e=>{switch(e.oneofKind){case"numberValue":return jo(e_)(e.numberValue);case"stringValue":return e.stringValue;case"bytesValue":return e.bytesValue;case"jsonValue":return JSON.parse(e.jsonValue);case void 0:return null;default:return y0()}},y3=e=>{let t=null;onmessage=({data:{id:n,name:r,args:s,config:o}})=>{t==null&&(t=ov(o));const i=s.map(c=>c instanceof MessagePort?(...a)=>{c.postMessage(a)}:c);t.runFork(e[r](...i).pipe(Y(c=>({id:n,response:{_tag:"succeed",value:c}})),Mo(c=>ce({id:n,response:{_tag:"fail",value:c}})),gv(c=>ce({id:n,response:{_tag:"die",value:XA(c)}})),Do(c=>postMessage(c))))}};f3.pipe(Lo(cr.Live),An,y3)})();
